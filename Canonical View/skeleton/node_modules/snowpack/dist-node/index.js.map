{"version":3,"file":"index.js","sources":["../dist-src/logger.js","../dist-src/util.js","../dist-src/resolve-remote.js","../dist-src/rollup-plugins/rollup-plugin-catch-unresolved.js","../dist-src/rollup-plugins/rollup-plugin-catch-fetch.js","../dist-src/rollup-plugins/rollup-plugin-css.js","../dist-src/rollup-plugins/rollup-plugin-remote-cdn.js","../dist-src/rollup-plugins/rollup-plugin-stats.js","../dist-src/rollup-plugins/rollup-plugin-wrap-install-targets.js","../dist-src/rollup-plugins/generateProcessPolyfill.js","../dist-src/rollup-plugins/rollup-plugin-node-process-polyfill.js","../dist-src/rollup-plugins/rollup-plugin-strip-source-mapping.js","../dist-src/scan-imports.js","../dist-src/stats-formatter.js","../dist-src/commands/install.js","../dist-src/commands/add-rm.js","../dist-src/build/build-import-proxy.js","../dist-src/build/src-file-extension-mapping.js","../dist-src/plugins/plugin-esbuild.js","../dist-src/config.js","../dist-src/build/build-pipeline.js","../dist-src/build/import-resolver.js","../dist-src/rewrite-imports.js","../dist-src/hmr-server-engine.js","../dist-src/commands/build.js","../dist-src/commands/paint.js","../dist-src/commands/dev.js","../dist-src/index.js"],"sourcesContent":["import * as colors from 'kleur/colors';\nconst levels = {\n    debug: 20,\n    info: 30,\n    warn: 40,\n    error: 50,\n    silent: 90,\n};\n/** Custom logger heavily-inspired by https://github.com/pinojs/pino with extra features like log retentian */\nclass SnowpackLogger {\n    constructor() {\n        /** set the log level (can be changed after init) */\n        this.level = 'info';\n        /** configure maximum number of logs to keep (default: 500) */\n        this.logCount = 500;\n        this.history = []; // this is immutable; must be accessed with Logger.getHistory()\n        this.callbacks = {\n            debug: (message) => {\n                console.log(message);\n            },\n            info: (message) => {\n                console.log(message);\n            },\n            warn: (message) => {\n                console.warn(message);\n            },\n            error: (message) => {\n                console.error(message);\n            },\n        };\n    }\n    log({ level, name, message }) {\n        // test if this level is enabled or not\n        if (levels[this.level] > levels[level]) {\n            return; // do nothing\n        }\n        // format\n        let text = message;\n        if (level === 'warn')\n            text = colors.yellow(text);\n        if (level === 'error')\n            text = colors.red(text);\n        const log = `${colors.dim(`[${name}]`)} ${text}`;\n        // add to log history and remove old logs to keep memory low\n        this.history.push(log);\n        while (this.history.length > this.logCount) {\n            this.history.shift();\n        }\n        // log\n        if (typeof this.callbacks[level] === 'function') {\n            this.callbacks[level](log);\n        }\n        else {\n            throw new Error(`No logging method defined for ${level}`);\n        }\n    }\n    /** emit messages only visible when --debug is passed */\n    debug(message, options) {\n        const name = (options && options.name) || 'snowpack';\n        this.log({ level: 'debug', name, message });\n    }\n    /** emit general info */\n    info(message, options) {\n        const name = (options && options.name) || 'snowpack';\n        this.log({ level: 'info', name, message });\n    }\n    /** emit non-fatal warnings */\n    warn(message, options) {\n        const name = (options && options.name) || 'snowpack';\n        this.log({ level: 'warn', name, message });\n    }\n    /** emit critical error messages */\n    error(message, options) {\n        const name = (options && options.name) || 'snowpack';\n        this.log({ level: 'error', name, message });\n    }\n    /** get full logging history */\n    getHistory() {\n        return this.history;\n    }\n    /** listen for events */\n    on(event, callback) {\n        this.callbacks[event] = callback;\n    }\n}\n/** export one logger to rest of app */\nexport const logger = new SnowpackLogger();\n","import cacache from 'cacache';\nimport globalCacheDir from 'cachedir';\nimport etag from 'etag';\nimport execa from 'execa';\nimport projectCacheDir from 'find-cache-dir';\nimport findUp from 'find-up';\nimport fs from 'fs';\nimport got from 'got';\nimport { isBinaryFile } from 'isbinaryfile';\nimport mkdirp from 'mkdirp';\nimport open from 'open';\nimport path from 'path';\nimport rimraf from 'rimraf';\nimport validatePackageName from 'validate-npm-package-name';\nexport const PIKA_CDN = `https://cdn.pika.dev`;\nexport const GLOBAL_CACHE_DIR = globalCacheDir('snowpack');\n// A note on cache naming/versioning: We currently version our global caches\n// with the version of the last breaking change. This allows us to re-use the\n// same cache across versions until something in the data structure changes.\n// At that point, bump the version in the cache name to create a new unique\n// cache name.\nexport const RESOURCE_CACHE = path.join(GLOBAL_CACHE_DIR, 'pkg-cache-1.4');\nexport const BUILD_CACHE = path.join(GLOBAL_CACHE_DIR, 'build-cache-2.7');\nexport const PROJECT_CACHE_DIR = projectCacheDir({ name: 'snowpack' });\nexport const DEV_DEPENDENCIES_DIR = path.join(PROJECT_CACHE_DIR, 'dev');\nconst LOCKFILE_HASH_FILE = '.hash';\nexport const HAS_CDN_HASH_REGEX = /\\-[a-zA-Z0-9]{16,}/;\n// NOTE(fks): Must match empty script elements to work properly.\nexport const HTML_JS_REGEX = /(<script[^>]*?type=\"module\".*?>)(.*?)<\\/script>/gims;\nexport const CSS_REGEX = /@import\\s*['\"](.*?)['\"];/gs;\nexport const SVELTE_VUE_REGEX = /(<script[^>]*>)(.*?)<\\/script>/gims;\nexport const URL_HAS_PROTOCOL_REGEX = /^(\\w+:)?\\/\\//;\n/** Read file from disk; return a string if it’s a code file */\nexport async function readFile(filepath) {\n    const data = await fs.promises.readFile(filepath);\n    const isBinary = await isBinaryFile(data);\n    return isBinary ? data : data.toString('utf-8');\n}\nexport async function readLockfile(cwd) {\n    try {\n        var lockfileContents = fs.readFileSync(path.join(cwd, 'snowpack.lock.json'), {\n            encoding: 'utf-8',\n        });\n    }\n    catch (err) {\n        // no lockfile found, ignore and continue\n        return null;\n    }\n    // If this fails, we actually do want to alert the user by throwing\n    return JSON.parse(lockfileContents);\n}\nexport async function writeLockfile(loc, importMap) {\n    const sortedImportMap = { imports: {} };\n    for (const key of Object.keys(importMap.imports).sort()) {\n        sortedImportMap.imports[key] = importMap.imports[key];\n    }\n    fs.writeFileSync(loc, JSON.stringify(sortedImportMap, undefined, 2), { encoding: 'utf-8' });\n}\nexport function fetchCDNResource(resourceUrl, responseType) {\n    if (!resourceUrl.startsWith(PIKA_CDN)) {\n        resourceUrl = PIKA_CDN + resourceUrl;\n    }\n    // @ts-ignore - TS doesn't like responseType being unknown amount three options\n    return got(resourceUrl, {\n        responseType: responseType,\n        headers: { 'user-agent': `snowpack/v1.4 (https://snowpack.dev)` },\n        throwHttpErrors: false,\n    });\n}\nexport function isTruthy(item) {\n    return Boolean(item);\n}\n/** Get the package name + an entrypoint within that package (if given). */\nexport function parsePackageImportSpecifier(imp) {\n    const impParts = imp.split('/');\n    if (imp.startsWith('@')) {\n        const [scope, name, ...rest] = impParts;\n        return [`${scope}/${name}`, rest.join('/') || null];\n    }\n    const [name, ...rest] = impParts;\n    return [name, rest.join('/') || null];\n}\n/**\n * Given a package name, look for that package's package.json manifest.\n * Return both the manifest location (if believed to exist) and the\n * manifest itself (if found).\n *\n * NOTE: You used to be able to require() a package.json file directly,\n * but now with export map support in Node v13 that's no longer possible.\n */\nexport function resolveDependencyManifest(dep, cwd) {\n    // Attempt #1: Resolve the dependency manifest normally. This works for most\n    // packages, but fails when the package defines an export map that doesn't\n    // include a package.json. If we detect that to be the reason for failure,\n    // move on to our custom implementation.\n    try {\n        const depManifest = fs.realpathSync.native(require.resolve(`${dep}/package.json`, { paths: [cwd] }));\n        return [depManifest, require(depManifest)];\n    }\n    catch (err) {\n        // if its an export map issue, move on to our manual resolver.\n        if (err.code !== 'ERR_PACKAGE_PATH_NOT_EXPORTED') {\n            return [null, null];\n        }\n    }\n    // Attempt #2: Resolve the dependency manifest manually. This involves resolving\n    // the dep itself to find the entrypoint file, and then haphazardly replacing the\n    // file path within the package with a \"./package.json\" instead. It's not as\n    // thorough as Attempt #1, but it should work well until export maps become more\n    // established & move out of experimental mode.\n    let result = [null, null];\n    try {\n        const fullPath = fs.realpathSync.native(require.resolve(dep, { paths: [cwd] }));\n        // Strip everything after the package name to get the package root path\n        // NOTE: This find-replace is very gross, replace with something like upath.\n        const searchPath = `${path.sep}node_modules${path.sep}${dep.replace('/', path.sep)}`;\n        const indexOfSearch = fullPath.lastIndexOf(searchPath);\n        if (indexOfSearch >= 0) {\n            const manifestPath = fullPath.substring(0, indexOfSearch + searchPath.length + 1) + 'package.json';\n            result[0] = manifestPath;\n            const manifestStr = fs.readFileSync(manifestPath, { encoding: 'utf-8' });\n            result[1] = JSON.parse(manifestStr);\n        }\n    }\n    catch (err) {\n        // ignore\n    }\n    finally {\n        return result;\n    }\n}\n/**\n * If Rollup erred parsing a particular file, show suggestions based on its\n * file extension (note: lowercase is fine).\n */\nexport const MISSING_PLUGIN_SUGGESTIONS = {\n    '.svelte': 'Try installing rollup-plugin-svelte and adding it to Snowpack (https://www.snowpack.dev/#custom-rollup-plugins)',\n    '.vue': 'Try installing rollup-plugin-vue and adding it to Snowpack (https://www.snowpack.dev/#custom-rollup-plugins)',\n};\nconst appNames = {\n    win32: {\n        brave: 'brave',\n        chrome: 'chrome',\n    },\n    darwin: {\n        brave: 'Brave Browser',\n        chrome: 'Google Chrome',\n    },\n    linux: {\n        brave: 'brave',\n        chrome: 'google-chrome',\n    },\n};\nexport async function openInBrowser(protocol, hostname, port, browser) {\n    const url = `${protocol}//${hostname}:${port}`;\n    browser = /chrome/i.test(browser)\n        ? appNames[process.platform]['chrome']\n        : /brave/i.test(browser)\n            ? appNames[process.platform]['brave']\n            : browser;\n    const isMac = process.platform === 'darwin';\n    const isOpeningInChrome = /chrome|default/i.test(browser);\n    if (isMac && isOpeningInChrome) {\n        // If we're on macOS, and we haven't requested a specific browser,\n        // we can try opening Chrome with AppleScript. This lets us reuse an\n        // existing tab when possible instead of creating a new one.\n        try {\n            // see if Chrome process is open; fail if not\n            await execa.command('ps cax | grep \"Google Chrome\"', {\n                shell: true,\n            });\n            // use open Chrome tab if exists; create new Chrome tab if not\n            const openChrome = execa('osascript ../assets/openChrome.applescript \"' + encodeURI(url) + '\"', {\n                cwd: __dirname,\n                stdio: 'ignore',\n                shell: true,\n            });\n            // if Chrome doesn’t respond within 3s, fall back to opening new tab in default browser\n            let isChromeStalled = setTimeout(() => {\n                openChrome.cancel();\n            }, 3000);\n            try {\n                await openChrome;\n            }\n            catch (err) {\n                if (err.isCanceled) {\n                    console.warn(`Chrome not responding to Snowpack after 3s. Opening dev server in new tab.`);\n                }\n                else {\n                    console.error(err.toString() || err);\n                }\n                open(url);\n            }\n            finally {\n                clearTimeout(isChromeStalled);\n            }\n            return true;\n        }\n        catch (err) {\n            // if no open Chrome process, open default browser\n            // no error message needed here\n            open(url);\n        }\n    }\n    else {\n        browser === 'default' ? open(url) : open(url, { app: browser });\n    }\n}\nexport async function checkLockfileHash(dir) {\n    const lockfileLoc = await findUp(['package-lock.json', 'yarn.lock']);\n    if (!lockfileLoc) {\n        return true;\n    }\n    const hashLoc = path.join(dir, LOCKFILE_HASH_FILE);\n    const newLockHash = etag(await fs.promises.readFile(lockfileLoc, 'utf-8'));\n    const oldLockHash = await fs.promises.readFile(hashLoc, 'utf-8').catch(() => '');\n    return newLockHash === oldLockHash;\n}\nexport async function updateLockfileHash(dir) {\n    const lockfileLoc = await findUp(['package-lock.json', 'yarn.lock']);\n    if (!lockfileLoc) {\n        return;\n    }\n    const hashLoc = path.join(dir, LOCKFILE_HASH_FILE);\n    const newLockHash = etag(await fs.promises.readFile(lockfileLoc));\n    await mkdirp(path.dirname(hashLoc));\n    await fs.promises.writeFile(hashLoc, newLockHash);\n}\nexport async function clearCache() {\n    return Promise.all([\n        cacache.rm.all(RESOURCE_CACHE),\n        cacache.rm.all(BUILD_CACHE),\n        rimraf.sync(PROJECT_CACHE_DIR),\n    ]);\n}\n/**\n * For the given import specifier, return an alias entry if one is matched.\n */\nexport function findMatchingAliasEntry(config, spec) {\n    // Only match bare module specifiers. relative and absolute imports should not match\n    if (spec === '.' ||\n        spec === '..' ||\n        spec.startsWith('./') ||\n        spec.startsWith('../') ||\n        spec.startsWith('/') ||\n        spec.startsWith('http://') ||\n        spec.startsWith('https://')) {\n        return undefined;\n    }\n    for (const [from, to] of Object.entries(config.alias)) {\n        let foundType = isPackageAliasEntry(to) ? 'package' : 'path';\n        const isExactMatch = spec === removeTrailingSlash(from);\n        const isDeepMatch = spec.startsWith(addTrailingSlash(from));\n        if (isExactMatch || isDeepMatch) {\n            return {\n                from,\n                to,\n                type: foundType,\n            };\n        }\n    }\n}\n/**\n * For the given import specifier, return an alias entry if one is matched.\n */\nexport function isPackageAliasEntry(val) {\n    return !path.isAbsolute(val);\n}\n/** Get full extensions of files */\nexport function getExt(fileName) {\n    return {\n        /** base extension (e.g. `.js`) */\n        baseExt: path.extname(fileName).toLocaleLowerCase(),\n        /** full extension, if applicable (e.g. `.proxy.js`) */\n        expandedExt: path.basename(fileName).replace(/[^.]+/, '').toLocaleLowerCase(),\n    };\n}\n/** Replace file extensions */\nexport function replaceExt(fileName, oldExt, newExt) {\n    const extToReplace = new RegExp(`\\\\${oldExt}$`, 'i');\n    return fileName.replace(extToReplace, newExt);\n}\n/**\n * Sanitizes npm packages that end in .js (e.g `tippy.js` -> `tippyjs`).\n * This is necessary because Snowpack can’t create both a file and directory\n * that end in .js.\n */\nexport function sanitizePackageName(filepath) {\n    const dirs = filepath.split('/');\n    const file = dirs.pop();\n    return [...dirs.map((path) => path.replace(/\\.js$/i, 'js')), file].join('/');\n}\n// Source Map spec v3: https://docs.google.com/document/d/1U1RGAehQwRypUTovF1KRlpiOFze0b-_2gc6fAH0KY0k/edit#heading=h.lmz475t4mvbx\n/** CSS sourceMappingURL */\nexport function cssSourceMappingURL(code, sourceMappingURL) {\n    return code + `/*# sourceMappingURL=${sourceMappingURL} */`;\n}\n/** JS sourceMappingURL */\nexport function jsSourceMappingURL(code, sourceMappingURL) {\n    return code.replace(/\\n*$/, '') + `\\n//# sourceMappingURL=${sourceMappingURL}\\n`; // strip ending lines & append source map (with linebreaks for safety)\n}\n/**\n * Formats the snowpack dependency name from a \"webDependencies\" input value:\n * 2. Remove any \".js\"/\".mjs\" extension (will be added automatically by Rollup)\n */\nexport function getWebDependencyName(dep) {\n    return validatePackageName(dep).validForNewPackages\n        ? dep.replace(/\\.js$/i, 'js') // if this is a top-level package ending in .js, replace with js (e.g. tippy.js -> tippyjs)\n        : dep.replace(/\\.m?js$/i, ''); // otherwise simply strip the extension (Rollup will resolve it)\n}\n/** URL relative */\nexport function relativeURL(path1, path2) {\n    let url = path.relative(path1, path2).replace(/\\\\/g, '/');\n    if (!url.startsWith('./') && !url.startsWith('../')) {\n        url = './' + url;\n    }\n    return url;\n}\nconst CLOSING_HEAD_TAG = /<\\s*\\/\\s*head\\s*>/gi;\n/** Append HTML before closing </head> tag */\nexport function appendHTMLToHead(doc, htmlToAdd) {\n    const closingHeadMatch = doc.match(CLOSING_HEAD_TAG);\n    // if no <head> tag found, throw an error (we can’t load your app properly)\n    if (!closingHeadMatch) {\n        throw new Error(`No <head> tag found in HTML (this is needed to optimize your app):\\n${doc}`);\n    }\n    // if multiple <head> tags found, also freak out\n    if (closingHeadMatch.length > 1) {\n        throw new Error(`Multiple <head> tags found in HTML (perhaps commented out?):\\n${doc}`);\n    }\n    return doc.replace(closingHeadMatch[0], htmlToAdd + closingHeadMatch[0]);\n}\nconst CLOSING_BODY_TAG = /<\\s*\\/\\s*body\\s*>/gi;\n/** Append HTML before closing </body> tag */\nexport function appendHTMLToBody(doc, htmlToAdd) {\n    const closingBodyMatch = doc.match(CLOSING_BODY_TAG);\n    // if no <body> tag found, throw an error (we can’t load your app properly)\n    if (!closingBodyMatch) {\n        throw new Error(`No <body> tag found in HTML (this is needed to load your app):\\n\\n${doc}`);\n    }\n    // if multiple <body> tags found, also freak out\n    if (closingBodyMatch.length > 1) {\n        throw new Error(`Multiple <body> tags found in HTML (perhaps commented out?):\\n\\n${doc}`);\n    }\n    return doc.replace(closingBodyMatch[0], htmlToAdd + closingBodyMatch[0]);\n}\n/** Add / to beginning of string (but don’t double-up) */\nexport function addLeadingSlash(path) {\n    return path.replace(/^\\/?/, '/');\n}\n/** Add / to the end of string (but don’t double-up) */\nexport function addTrailingSlash(path) {\n    return path.replace(/\\/?$/, '/');\n}\n/** Remove \\ and / from beginning of string */\nexport function removeLeadingSlash(path) {\n    return path.replace(/^[/\\\\]+/, '');\n}\n/** Remove \\ and / from end of string */\nexport function removeTrailingSlash(path) {\n    return path.replace(/[/\\\\]+$/, '');\n}\nexport const HMR_CLIENT_CODE = fs.readFileSync(path.join(__dirname, '../assets/hmr.js'), 'utf-8');\n","import cacache from 'cacache';\nimport * as colors from 'kleur/colors';\nimport PQueue from 'p-queue';\nimport validatePackageName from 'validate-npm-package-name';\nimport { fetchCDNResource, PIKA_CDN, RESOURCE_CACHE } from './util.js';\nimport { logger } from './logger';\n/**\n * Given an install specifier, attempt to resolve it from the CDN.\n * If no lockfile exists or if the entry is not found in the lockfile, attempt to resolve\n * it from the CDN directly. Otherwise, use the URL found in the lockfile and attempt to\n * check the local cache first.\n *\n * All resolved URLs are populated into the local cache, where our internal Rollup engine\n * will load them from when it installs your dependencies to disk.\n */\nasync function resolveDependency(installSpecifier, packageSemver, lockfile, canRetry = true) {\n    // Right now, the CDN is only for top-level JS packages. The CDN doesn't support CSS,\n    // non-JS assets, and has limited support for deep package imports. Snowpack\n    // will automatically fall-back any failed/not-found assets from local\n    // node_modules/ instead.\n    if (!validatePackageName(installSpecifier).validForNewPackages) {\n        return null;\n    }\n    // Grab the installUrl from our lockfile if it exists, otherwise resolve it yourself.\n    let installUrl;\n    let installUrlType;\n    if (lockfile && lockfile.imports[installSpecifier]) {\n        installUrl = lockfile.imports[installSpecifier];\n        installUrlType = 'pin';\n    }\n    else {\n        if (packageSemver === 'latest') {\n            logger.warn(`warn(${installSpecifier}): Not found in \"dependencies\". Using latest package version...`);\n        }\n        if (packageSemver.startsWith('npm:@reactesm') || packageSemver.startsWith('npm:@pika/react')) {\n            logger.error(`React workaround packages no longer needed! Revert to the official React & React-DOM packages.`);\n            process.exit(1);\n        }\n        if (packageSemver.includes(' ') || packageSemver.includes(':')) {\n            logger.warn(`warn(${installSpecifier}): Can't fetch complex semver \"${packageSemver}\" from remote CDN.`);\n            return null;\n        }\n        installUrlType = 'lookup';\n        installUrl = `${PIKA_CDN}/${installSpecifier}@${packageSemver}`;\n    }\n    // Hashed CDN urls never change, so its safe to grab them directly from the local cache\n    // without a network request.\n    if (installUrlType === 'pin') {\n        const cachedResult = await cacache.get.info(RESOURCE_CACHE, installUrl).catch(() => null);\n        if (cachedResult) {\n            if (cachedResult.metadata) {\n                const { pinnedUrl } = cachedResult.metadata;\n                return pinnedUrl;\n            }\n        }\n    }\n    // Otherwise, resolve from the CDN remotely.\n    const { statusCode, headers, body } = await fetchCDNResource(installUrl);\n    if (statusCode !== 200) {\n        logger.warn(`Failed to resolve [${statusCode}]: ${installUrl} (${body})`);\n        logger.warn(`Falling back to local copy...`);\n        return null;\n    }\n    let importUrlPath = headers['x-import-url'];\n    let pinnedUrlPath = headers['x-pinned-url'];\n    const buildStatus = headers['x-import-status'];\n    const typesUrlPath = headers['x-typescript-types'];\n    const typesUrl = typesUrlPath && `${PIKA_CDN}${typesUrlPath}`;\n    if (installUrlType === 'pin') {\n        const pinnedUrl = installUrl;\n        await cacache.put(RESOURCE_CACHE, pinnedUrl, body, {\n            metadata: { pinnedUrl, typesUrl },\n        });\n        return pinnedUrl;\n    }\n    if (pinnedUrlPath) {\n        const pinnedUrl = `${PIKA_CDN}${pinnedUrlPath}`;\n        await cacache.put(RESOURCE_CACHE, pinnedUrl, body, {\n            metadata: { pinnedUrl, typesUrl },\n        });\n        return pinnedUrl;\n    }\n    if (buildStatus === 'SUCCESS') {\n        logger.warn(`Failed to lookup [${statusCode}]: ${installUrl}`);\n        logger.warn(`Falling back to local copy...`);\n        return null;\n    }\n    if (!canRetry || buildStatus === 'FAIL') {\n        logger.warn(`Failed to build: ${installSpecifier}@${packageSemver}`);\n        logger.warn(`Falling back to local copy...`);\n        return null;\n    }\n    logger.info(colors.cyan(`Building ${installSpecifier}@${packageSemver}... (This takes a moment, but will be cached for future use)`));\n    if (!importUrlPath) {\n        logger.error('X-Import-URL header expected, but none received.');\n        process.exit(1);\n    }\n    const { statusCode: lookupStatusCode } = await fetchCDNResource(importUrlPath);\n    if (lookupStatusCode !== 200) {\n        logger.error(`Unexpected response [${lookupStatusCode}]: ${PIKA_CDN}${importUrlPath}`);\n        process.exit(1);\n    }\n    return resolveDependency(installSpecifier, packageSemver, lockfile, false);\n}\nexport async function resolveTargetsFromRemoteCDN(lockfile, config) {\n    const downloadQueue = new PQueue({ concurrency: 16 });\n    const newLockfile = { imports: {} };\n    let resolutionError;\n    for (const [installSpecifier, installSemver] of Object.entries(config.webDependencies)) {\n        downloadQueue.add(async () => {\n            try {\n                const resolvedUrl = await resolveDependency(installSpecifier, installSemver, lockfile);\n                if (resolvedUrl) {\n                    newLockfile.imports[installSpecifier] = resolvedUrl;\n                }\n            }\n            catch (err) {\n                resolutionError = resolutionError || err;\n            }\n        });\n    }\n    await downloadQueue.onIdle();\n    if (resolutionError) {\n        throw resolutionError;\n    }\n    return newLockfile;\n}\n","import isNodeBuiltin from 'is-builtin-module';\n/**\n * rollup-plugin-catch-unresolved\n *\n * Catch any unresolved imports to give proper warnings (Rollup default is to ignore).\n */\nexport function rollupPluginCatchUnresolved() {\n    return {\n        name: 'snowpack:rollup-plugin-catch-unresolved',\n        resolveId(id, importer) {\n            // Ignore remote http/https imports\n            if (id.startsWith('http://') || id.startsWith('https://')) {\n                return false;\n            }\n            if (isNodeBuiltin(id)) {\n                this.warn({\n                    id: importer,\n                    message: `Module \"${id}\" (Node.js built-in) is not available in the browser. Run Snowpack with --polyfill-node to fix.`,\n                });\n            }\n            else {\n                this.warn({\n                    id: importer,\n                    message: `Module \"${id}\" could not be resolved by Snowpack (Is it installed?).`,\n                });\n            }\n            return false;\n        },\n    };\n}\n","import path from 'path';\nconst FETCH_POLYFILL = `\n// native patch for: node-fetch, whatwg-fetch\n// ref: https://github.com/tc39/proposal-global\nvar getGlobal = function () {\n  if (typeof self !== 'undefined') { return self; }\n  if (typeof window !== 'undefined') { return window; }\n  if (typeof global !== 'undefined') { return global; }\n  throw new Error('unable to locate global object');\n}\nvar global = getGlobal();\nexport default global.fetch.bind(global);\nexport const Headers = global.Headers;\nexport const Request = global.Request;\nexport const Response = global.Response;\n`;\n/**\n * rollup-plugin-catch-fetch\n *\n * How it works: NPM packages will sometimes contain Node.js-specific polyfills\n * for the native browser Fetch API. Since this makes no sense in an ESM web\n * project, we can replace these expensive polyfills with native references to\n * the fetch API.\n *\n * This still allows you to polyfill fetch in older browsers, if you desire.\n */\nfunction isNodeFetch(id) {\n    return (id === 'node-fetch' ||\n        id === 'whatwg-fetch' ||\n        id.includes(path.join('node_modules', 'node-fetch')) || // note: sometimes Snowpack has found the entry file already\n        id.includes(path.join('node_modules', 'whatwg-fetch')));\n}\nexport function rollupPluginCatchFetch() {\n    return {\n        name: 'snowpack:fetch-handler',\n        resolveId(id) {\n            return isNodeFetch(id) ? id : null;\n        },\n        load(id) {\n            return isNodeFetch(id) ? FETCH_POLYFILL : null;\n        },\n    };\n}\n","import { promises as fs } from 'fs';\nfunction getInjectorCode(name, code) {\n    return `\n/** SNOWPACK INJECT STYLE: ${name} */\nfunction __snowpack__injectStyle(css) {\n  const headEl = document.head || document.getElementsByTagName('head')[0];\n  const styleEl = document.createElement('style');\n  styleEl.type = 'text/css';\n  if (styleEl.styleSheet) {\n    styleEl.styleSheet.cssText = css;\n  } else {\n    styleEl.appendChild(document.createTextNode(css));\n  }\n  headEl.appendChild(styleEl);\n}\n__snowpack__injectStyle(${JSON.stringify(code)});\\n`;\n}\n/**\n * rollup-plugin-css\n *\n * Support installing any imported CSS into your dependencies. This isn't strictly valid\n * ESM code, but it is popular in the npm ecosystem & web development ecosystems. It also\n * solves a problem that is difficult to solve otherwise (referencing CSS from JS) so for\n * those reasons we have added default support for importing CSS into Snowpack v2.\n */\nexport function rollupPluginCss() {\n    return {\n        name: 'snowpack:rollup-plugin-css',\n        resolveId(source, importer) {\n            if (!source.endsWith('.css')) {\n                return null;\n            }\n            return this.resolve(source, importer, { skipSelf: true }).then((resolved) => {\n                return resolved || null;\n            });\n        },\n        async load(id) {\n            if (!id.endsWith('.css')) {\n                return null;\n            }\n            const code = await fs.readFile(id, { encoding: 'utf-8' });\n            const humanReadableName = id.replace(/.*node_modules[\\/\\\\]/, '').replace(/[\\/\\\\]/g, '/');\n            return getInjectorCode(humanReadableName, code);\n        },\n    };\n}\n","import fs from 'fs';\nimport cacache from 'cacache';\nimport mkdirp from 'mkdirp';\nimport path from 'path';\nimport tar from 'tar';\nimport url from 'url';\nimport { fetchCDNResource, HAS_CDN_HASH_REGEX, PIKA_CDN, RESOURCE_CACHE } from '../util';\nconst CACHED_FILE_ID_PREFIX = 'snowpack-pkg-cache:';\nconst PIKA_CDN_TRIM_LENGTH = PIKA_CDN.length;\n/**\n * rollup-plugin-remote-cdn\n *\n * Load import URLs from a remote CDN, sitting behind a local cache. The local\n * cache acts as a go-between for the resolve & load step: when we get back a\n * successful CDN resolution, we save the file to the local cache and then tell\n * rollup that it's safe to load from the cache in the `load()` hook.\n */\nexport function rollupPluginDependencyCache({ installTypes, log, }) {\n    const allTypesToInstall = new Set();\n    return {\n        name: 'snowpack:rollup-plugin-remote-cdn',\n        async resolveId(source, importer) {\n            let cacheKey;\n            if (source.startsWith(PIKA_CDN)) {\n                cacheKey = source;\n            }\n            else if (source.startsWith('/-/')) {\n                cacheKey = PIKA_CDN + source;\n            }\n            else if (source.startsWith('/pin/')) {\n                cacheKey = PIKA_CDN + source;\n            }\n            else {\n                return null;\n            }\n            // If the source path is a CDN path including a hash, it's assumed the\n            // file will never change and it is safe to pull from our local cache\n            // without a network request.\n            log(cacheKey);\n            if (HAS_CDN_HASH_REGEX.test(cacheKey)) {\n                const cachedResult = await cacache.get\n                    .info(RESOURCE_CACHE, cacheKey)\n                    .catch(( /* ignore */) => null);\n                if (cachedResult) {\n                    return CACHED_FILE_ID_PREFIX + cacheKey;\n                }\n            }\n            // Otherwise, make the remote request and cache the file on success.\n            const response = await fetchCDNResource(cacheKey);\n            if (response.statusCode === 200) {\n                const typesUrlPath = response.headers['x-typescript-types'];\n                const pinnedUrlPath = response.headers['x-pinned-url'];\n                const typesUrl = typesUrlPath && `${PIKA_CDN}${typesUrlPath}`;\n                const pinnedUrl = pinnedUrlPath && `${PIKA_CDN}${pinnedUrlPath}`;\n                await cacache.put(RESOURCE_CACHE, cacheKey, response.body, {\n                    metadata: { pinnedUrl, typesUrl },\n                });\n                return CACHED_FILE_ID_PREFIX + cacheKey;\n            }\n            // If lookup failed, skip this plugin and resolve the import locally instead.\n            // TODO: Log that this has happened (if some sort of verbose mode is enabled).\n            const packageName = cacheKey\n                .substring(PIKA_CDN_TRIM_LENGTH)\n                .replace('/-/', '')\n                .replace('/pin/', '')\n                .split('@')[0];\n            return this.resolve(packageName, importer, { skipSelf: true }).then((resolved) => {\n                let finalResult = resolved;\n                if (!finalResult) {\n                    finalResult = { id: packageName };\n                }\n                return finalResult;\n            });\n        },\n        async load(id) {\n            if (!id.startsWith(CACHED_FILE_ID_PREFIX)) {\n                return null;\n            }\n            const cacheKey = id.substring(CACHED_FILE_ID_PREFIX.length);\n            log(cacheKey);\n            const cachedResult = await cacache.get(RESOURCE_CACHE, cacheKey);\n            const typesUrl = cachedResult.metadata?.typesUrl;\n            if (typesUrl && installTypes) {\n                const typesTarballUrl = typesUrl.replace(/(mode=types.*?)\\/.*/, '$1/all.tgz');\n                allTypesToInstall.add(typesTarballUrl);\n            }\n            return cachedResult.data.toString('utf-8');\n        },\n        async writeBundle(options) {\n            if (!installTypes) {\n                return;\n            }\n            await mkdirp(path.join(options.dir, '.types'));\n            const tempDir = await cacache.tmp.mkdir(RESOURCE_CACHE);\n            for (const typesTarballUrl of allTypesToInstall) {\n                let tarballContents;\n                const cachedTarball = await cacache\n                    .get(RESOURCE_CACHE, typesTarballUrl)\n                    .catch(( /* ignore */) => null);\n                if (cachedTarball) {\n                    tarballContents = cachedTarball.data;\n                }\n                else {\n                    const tarballResponse = await fetchCDNResource(typesTarballUrl, 'buffer');\n                    if (tarballResponse.statusCode !== 200) {\n                        continue;\n                    }\n                    tarballContents = tarballResponse.body;\n                    await cacache.put(RESOURCE_CACHE, typesTarballUrl, tarballContents);\n                }\n                const typesUrlParts = url.parse(typesTarballUrl).pathname.split('/');\n                const typesPackageName = url.parse(typesTarballUrl).pathname.startsWith('/-/@')\n                    ? typesUrlParts[2] + '/' + typesUrlParts[3].split('@')[0]\n                    : typesUrlParts[2].split('@')[0];\n                const typesPackageTarLoc = path.join(tempDir, `${typesPackageName}.tgz`);\n                if (typesPackageName.includes('/')) {\n                    await mkdirp(path.dirname(typesPackageTarLoc));\n                }\n                fs.writeFileSync(typesPackageTarLoc, tarballContents);\n                const typesPackageLoc = path.join(options.dir, `.types/${typesPackageName}`);\n                await mkdirp(typesPackageLoc);\n                await tar.x({\n                    file: typesPackageTarLoc,\n                    cwd: typesPackageLoc,\n                });\n            }\n        },\n    };\n}\n","import fs from 'fs';\nimport path from 'path';\nimport zlib from 'zlib';\nexport function rollupPluginDependencyStats(cb) {\n    let outputDir;\n    let existingFileCache = {};\n    let statsSummary = {\n        direct: {},\n        common: {},\n    };\n    function buildExistingFileCache(bundle) {\n        for (let fileName of Object.keys(bundle)) {\n            const filePath = path.join(outputDir, fileName);\n            if (fs.existsSync(filePath)) {\n                const { size } = fs.statSync(filePath);\n                existingFileCache[fileName] = size;\n            }\n        }\n    }\n    function compareDependencies(files, type) {\n        for (let { fileName, contents } of files) {\n            const size = contents.byteLength;\n            statsSummary[type][fileName] = {\n                size: size,\n                gzip: zlib.gzipSync(contents).byteLength,\n                brotli: zlib.brotliCompressSync ? zlib.brotliCompressSync(contents).byteLength : 0,\n            };\n            if (existingFileCache[fileName]) {\n                const delta = (size - existingFileCache[fileName]) / 1000;\n                statsSummary[type][fileName].delta = delta;\n            }\n        }\n    }\n    return {\n        name: 'snowpack:rollup-plugin-stats',\n        generateBundle(options, bundle) {\n            outputDir = options.dir;\n            buildExistingFileCache(bundle);\n        },\n        writeBundle(_, bundle) {\n            const directDependencies = [];\n            const commonDependencies = [];\n            for (const [fileName, assetOrChunk] of Object.entries(bundle)) {\n                const raw = assetOrChunk.type === 'asset' ? assetOrChunk.source : assetOrChunk.code;\n                const contents = Buffer.isBuffer(raw)\n                    ? raw\n                    : typeof raw === 'string'\n                        ? Buffer.from(raw, 'utf-8')\n                        : Buffer.from(raw);\n                if (fileName.startsWith('common')) {\n                    commonDependencies.push({ fileName, contents });\n                }\n                else {\n                    directDependencies.push({ fileName, contents });\n                }\n            }\n            compareDependencies(directDependencies, 'direct');\n            compareDependencies(commonDependencies, 'common');\n            cb(statsSummary);\n        },\n    };\n}\n","import * as colors from 'kleur/colors';\nimport path from 'path';\nimport { logger } from '../logger';\nimport { getWebDependencyName } from '../util.js';\nfunction autoDetectExports(fileLoc) {\n    try {\n        return Object.keys(require(fileLoc)).filter((imp) => imp !== 'default');\n    }\n    catch (err) {\n        logger.error(`✘ Could not auto-detect exports for ${colors.bold(fileLoc)}\n${err.message}`);\n    }\n}\n/**\n * rollup-plugin-wrap-install-targets\n *\n * How it works:\n * 1. An array of \"install targets\" are passed in, describing all known imports + metadata.\n * 2. If isTreeshake: Known imports are marked for tree-shaking by appending 'snowpack-wrap:' to the input value.\n * 3. If autoDetectPackageExports match: Also mark for wrapping, and use automatic export detection.\n * 4. On load, we return a false virtual file for all \"snowpack-wrap:\" inputs.\n *    a. That virtual file contains only `export ... from 'ACTUAL_FILE_PATH';` exports\n *    b. Rollup uses those exports to drive its tree-shaking algorithm.\n *    c. Rollup uses those exports to inform its \"namedExports\" for Common.js entrypoints.\n */\nexport function rollupPluginWrapInstallTargets(isTreeshake, autoDetectPackageExports, installTargets) {\n    const installTargetSummaries = {};\n    function isAutoDetect(normalizedFileLoc) {\n        return autoDetectPackageExports.some((p) => normalizedFileLoc.includes(`node_modules/${p}${p.endsWith('.js') ? '' : '/'}`));\n    }\n    return {\n        name: 'snowpack:wrap-install-targets',\n        // Mark some inputs for tree-shaking.\n        buildStart(inputOptions) {\n            const input = inputOptions.input;\n            for (const [key, val] of Object.entries(input)) {\n                const allInstallTargets = installTargets.filter((imp) => getWebDependencyName(imp.specifier) === key);\n                const installTargetSummary = allInstallTargets.reduce((summary, imp) => {\n                    summary.all = summary.all || imp.all;\n                    summary.default = summary.default || imp.default || imp.all;\n                    summary.namespace = summary.namespace || imp.namespace || imp.all;\n                    summary.named = [...(summary.named || []), ...imp.named];\n                    return summary;\n                }, {});\n                installTargetSummaries[val] = installTargetSummary;\n                const normalizedFileLoc = val.split(path.win32.sep).join(path.posix.sep);\n                if (isAutoDetect(normalizedFileLoc)) {\n                    input[key] = `snowpack-wrap:${val}`;\n                }\n                if (isTreeshake && !installTargetSummary.all) {\n                    input[key] = `snowpack-wrap:${val}`;\n                }\n            }\n        },\n        resolveId(source) {\n            if (source.startsWith('snowpack-wrap:')) {\n                return source;\n            }\n            return null;\n        },\n        load(id) {\n            if (!id.startsWith('snowpack-wrap:')) {\n                return null;\n            }\n            const fileLoc = id.substring('snowpack-wrap:'.length);\n            // Reduce all install targets into a single \"summarized\" install target.\n            const installTargetSummary = installTargetSummaries[fileLoc];\n            let uniqueNamedImports = Array.from(new Set(installTargetSummary.named));\n            const normalizedFileLoc = fileLoc.split(path.win32.sep).join(path.posix.sep);\n            if ((!isTreeshake || installTargetSummary.namespace) && isAutoDetect(normalizedFileLoc)) {\n                uniqueNamedImports = autoDetectExports(fileLoc) || uniqueNamedImports;\n                installTargetSummary.default = true;\n            }\n            const result = `\n        ${installTargetSummary.namespace ? `export * from '${normalizedFileLoc}';` : ''}\n        ${installTargetSummary.default\n                ? `import __pika_web_default_export_for_treeshaking__ from '${normalizedFileLoc}'; export default __pika_web_default_export_for_treeshaking__;`\n                : ''}\n        ${`export {${uniqueNamedImports.join(',')}} from '${normalizedFileLoc}';`}\n      `;\n            return result;\n        },\n    };\n}\n","/*\n(The MIT License)\n\nCopyright (c) 2013 Roman Shtylman <shtylman@gmail.com>\n\nPermission is hereby granted, free of charge, to any person obtaining\na copy of this software and associated documentation files (the\n'Software'), to deal in the Software without restriction, including\nwithout limitation the rights to use, copy, modify, merge, publish,\ndistribute, sublicense, and/or sell copies of the Software, and to\npermit persons to whom the Software is furnished to do so, subject to\nthe following conditions:\n\nThe above copyright notice and this permission notice shall be\nincluded in all copies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED 'AS IS', WITHOUT WARRANTY OF ANY KIND,\nEXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\nMERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.\nIN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY\nCLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT,\nTORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE\nSOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n*/\n/*\nTHIS IS A MODIFIED VERSION OF https://github.com/calvinmetcalf/node-process-es6\nORIGIANL ADDED IN COMMIT 6304406e065f356aeaa623a878d02be419b316d8 (good to know for diffing)\n*/\nexport function generateProcessPolyfill(env) {\n    return `/* SNOWPACK PROCESS POLYFILL (based on https://github.com/calvinmetcalf/node-process-es6) */\nfunction defaultSetTimout() {\n    throw new Error('setTimeout has not been defined');\n}\nfunction defaultClearTimeout () {\n    throw new Error('clearTimeout has not been defined');\n}\nvar cachedSetTimeout = defaultSetTimout;\nvar cachedClearTimeout = defaultClearTimeout;\nvar globalContext;\nif (typeof window !== 'undefined') {\n    globalContext = window;\n} else if (typeof self !== 'undefined') {\n    globalContext = self;\n} else {\n    globalContext = {};\n}\nif (typeof globalContext.setTimeout === 'function') {\n    cachedSetTimeout = setTimeout;\n}\nif (typeof globalContext.clearTimeout === 'function') {\n    cachedClearTimeout = clearTimeout;\n}\n\nfunction runTimeout(fun) {\n    if (cachedSetTimeout === setTimeout) {\n        //normal enviroments in sane situations\n        return setTimeout(fun, 0);\n    }\n    // if setTimeout wasn't available but was latter defined\n    if ((cachedSetTimeout === defaultSetTimout || !cachedSetTimeout) && setTimeout) {\n        cachedSetTimeout = setTimeout;\n        return setTimeout(fun, 0);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedSetTimeout(fun, 0);\n    } catch(e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't trust the global object when called normally\n            return cachedSetTimeout.call(null, fun, 0);\n        } catch(e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error\n            return cachedSetTimeout.call(this, fun, 0);\n        }\n    }\n\n\n}\nfunction runClearTimeout(marker) {\n    if (cachedClearTimeout === clearTimeout) {\n        //normal enviroments in sane situations\n        return clearTimeout(marker);\n    }\n    // if clearTimeout wasn't available but was latter defined\n    if ((cachedClearTimeout === defaultClearTimeout || !cachedClearTimeout) && clearTimeout) {\n        cachedClearTimeout = clearTimeout;\n        return clearTimeout(marker);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedClearTimeout(marker);\n    } catch (e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't  trust the global object when called normally\n            return cachedClearTimeout.call(null, marker);\n        } catch (e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error.\n            // Some versions of I.E. have different rules for clearTimeout vs setTimeout\n            return cachedClearTimeout.call(this, marker);\n        }\n    }\n\n\n\n}\nvar queue = [];\nvar draining = false;\nvar currentQueue;\nvar queueIndex = -1;\n\nfunction cleanUpNextTick() {\n    if (!draining || !currentQueue) {\n        return;\n    }\n    draining = false;\n    if (currentQueue.length) {\n        queue = currentQueue.concat(queue);\n    } else {\n        queueIndex = -1;\n    }\n    if (queue.length) {\n        drainQueue();\n    }\n}\n\nfunction drainQueue() {\n    if (draining) {\n        return;\n    }\n    var timeout = runTimeout(cleanUpNextTick);\n    draining = true;\n\n    var len = queue.length;\n    while(len) {\n        currentQueue = queue;\n        queue = [];\n        while (++queueIndex < len) {\n            if (currentQueue) {\n                currentQueue[queueIndex].run();\n            }\n        }\n        queueIndex = -1;\n        len = queue.length;\n    }\n    currentQueue = null;\n    draining = false;\n    runClearTimeout(timeout);\n}\nfunction nextTick(fun) {\n    var args = new Array(arguments.length - 1);\n    if (arguments.length > 1) {\n        for (var i = 1; i < arguments.length; i++) {\n            args[i - 1] = arguments[i];\n        }\n    }\n    queue.push(new Item(fun, args));\n    if (queue.length === 1 && !draining) {\n        runTimeout(drainQueue);\n    }\n}\n// v8 likes predictible objects\nfunction Item(fun, array) {\n    this.fun = fun;\n    this.array = array;\n}\nItem.prototype.run = function () {\n    this.fun.apply(null, this.array);\n};\nvar title = 'browser';\nvar platform = 'browser';\nvar browser = true;\nvar env = {};\nvar argv = [];\nvar version = ''; // empty string to avoid regexp issues\nvar versions = {};\nvar release = {};\nvar config = {};\n\nfunction noop() {}\n\nvar on = noop;\nvar addListener = noop;\nvar once = noop;\nvar off = noop;\nvar removeListener = noop;\nvar removeAllListeners = noop;\nvar emit = noop;\n\nfunction binding(name) {\n    throw new Error('process.binding is not supported');\n}\n\nfunction cwd () { return '/' }\nfunction chdir (dir) {\n    throw new Error('process.chdir is not supported');\n}function umask() { return 0; }\n\n// from https://github.com/kumavis/browser-process-hrtime/blob/master/index.js\nvar performance = globalContext.performance || {};\nvar performanceNow =\n  performance.now        ||\n  performance.mozNow     ||\n  performance.msNow      ||\n  performance.oNow       ||\n  performance.webkitNow  ||\n  function(){ return (new Date()).getTime() };\n\n// generate timestamp or delta\n// see http://nodejs.org/api/process.html#process_process_hrtime\nfunction hrtime(previousTimestamp){\n  var clocktime = performanceNow.call(performance)*1e-3;\n  var seconds = Math.floor(clocktime);\n  var nanoseconds = Math.floor((clocktime%1)*1e9);\n  if (previousTimestamp) {\n    seconds = seconds - previousTimestamp[0];\n    nanoseconds = nanoseconds - previousTimestamp[1];\n    if (nanoseconds<0) {\n      seconds--;\n      nanoseconds += 1e9;\n    }\n  }\n  return [seconds,nanoseconds]\n}\n\nvar startTime = new Date();\nfunction uptime() {\n  var currentTime = new Date();\n  var dif = currentTime - startTime;\n  return dif / 1000;\n}\n\nexport default {\n  nextTick: nextTick,\n  title: title,\n  browser: browser,\n  env: ${JSON.stringify(env)},\n  argv: argv,\n  version: version,\n  versions: versions,\n  on: on,\n  addListener: addListener,\n  once: once,\n  off: off,\n  removeListener: removeListener,\n  removeAllListeners: removeAllListeners,\n  emit: emit,\n  binding: binding,\n  cwd: cwd,\n  chdir: chdir,\n  umask: umask,\n  hrtime: hrtime,\n  platform: platform,\n  release: release,\n  config: config,\n  uptime: uptime\n};\n\nexport { addListener, argv, binding, browser, chdir, config, cwd, emit, env, hrtime, nextTick, off, on, once, platform, release, removeAllListeners, removeListener, title, umask, uptime, version, versions };\n`;\n}\nexport default generateProcessPolyfill;\n","import inject from '@rollup/plugin-inject';\nimport generateProcessPolyfill from './generateProcessPolyfill';\nconst PROCESS_MODULE_NAME = 'process';\nexport function rollupPluginNodeProcessPolyfill(env = {}) {\n    const injectPlugin = inject({\n        process: PROCESS_MODULE_NAME,\n    });\n    return {\n        ...injectPlugin,\n        name: 'snowpack:rollup-plugin-node-process-polyfill',\n        resolveId(source) {\n            if (source === PROCESS_MODULE_NAME) {\n                return PROCESS_MODULE_NAME;\n            }\n            return null;\n        },\n        load(id) {\n            if (id === PROCESS_MODULE_NAME) {\n                return { code: generateProcessPolyfill(env), moduleSideEffects: false };\n            }\n            return null;\n        },\n    };\n}\n","/**\n * rollup-plugin-strip-source-mapping\n *\n * Remove any lingering source map comments\n */\nexport function rollupPluginStripSourceMapping() {\n    return {\n        name: 'snowpack:rollup-plugin-strip-source-mapping',\n        transform: (code) => ({\n            code: code.replace(/\\/\\/+#\\s*sourceMappingURL=.+$/gm, ''),\n            map: null,\n        }),\n    };\n}\n","import { init as initESModuleLexer, parse } from 'es-module-lexer';\nimport glob from 'glob';\nimport path from 'path';\nimport stripComments from 'strip-comments';\nimport { logger } from './logger';\nimport { CSS_REGEX, findMatchingAliasEntry, getExt, HTML_JS_REGEX, isTruthy, readFile, SVELTE_VUE_REGEX, } from './util';\n// [@\\w] - Match a word-character or @ (valid package name)\n// (?!.*(:\\/\\/)) - Ignore if previous match was a protocol (ex: http://)\nconst BARE_SPECIFIER_REGEX = /^[@\\w](?!.*(:\\/\\/))/;\nconst ESM_IMPORT_REGEX = /import(?:[\"'\\s]*([\\w*${}\\n\\r\\t, ]+)\\s*from\\s*)?\\s*[\"'](.*?)[\"']/gm;\nconst ESM_DYNAMIC_IMPORT_REGEX = /(?<!\\.)\\bimport\\((?:['\"].+['\"]|`[^$]+`)\\)/gm;\nconst HAS_NAMED_IMPORTS_REGEX = /^[\\w\\s\\,]*\\{(.*)\\}/s;\nconst STRIP_AS = /\\s+as\\s+.*/; // for `import { foo as bar }`, strips “as bar”\nconst DEFAULT_IMPORT_REGEX = /import\\s+(\\w)+(,\\s\\{[\\w\\s]*\\})?\\s+from/s;\nfunction createInstallTarget(specifier, all = true) {\n    return {\n        specifier,\n        all,\n        default: false,\n        namespace: false,\n        named: [],\n    };\n}\nexport function matchDynamicImportValue(importStatement) {\n    const matched = stripComments(importStatement).match(/^\\s*('([^']+)'|\"([^\"]+)\")\\s*$/m);\n    return matched?.[2] || matched?.[3] || null;\n}\nfunction getWebModuleSpecifierFromCode(code, imp) {\n    // import.meta: we can ignore\n    if (imp.d === -2) {\n        return null;\n    }\n    // Static imports: easy to parse\n    if (imp.d === -1) {\n        return code.substring(imp.s, imp.e);\n    }\n    // Dynamic imports: a bit trickier to parse. Today, we only support string literals.\n    const importStatement = code.substring(imp.s, imp.e);\n    return matchDynamicImportValue(importStatement);\n}\n/**\n * parses an import specifier, looking for a web modules to install. If a web module is not detected,\n * null is returned.\n */\nfunction parseWebModuleSpecifier(specifier) {\n    if (!specifier) {\n        return null;\n    }\n    // If specifier is a \"bare module specifier\" (ie: package name) just return it directly\n    if (BARE_SPECIFIER_REGEX.test(specifier)) {\n        return specifier;\n    }\n    return null;\n}\nfunction parseImportStatement(code, imp) {\n    const webModuleSpecifier = parseWebModuleSpecifier(getWebModuleSpecifierFromCode(code, imp));\n    if (!webModuleSpecifier) {\n        return null;\n    }\n    const importStatement = stripComments(code.substring(imp.ss, imp.se));\n    if (/^import\\s+type/.test(importStatement)) {\n        return null;\n    }\n    const isDynamicImport = imp.d > -1;\n    const hasDefaultImport = !isDynamicImport && DEFAULT_IMPORT_REGEX.test(importStatement);\n    const hasNamespaceImport = !isDynamicImport && importStatement.includes('*');\n    const namedImports = (importStatement.match(HAS_NAMED_IMPORTS_REGEX) || [, ''])[1]\n        .split(',') // split `import { a, b, c }` by comma\n        .map((name) => name.replace(STRIP_AS, '').trim()) // remove “ as …” and trim\n        .filter(isTruthy);\n    return {\n        specifier: webModuleSpecifier,\n        all: isDynamicImport || (!hasDefaultImport && !hasNamespaceImport && namedImports.length === 0),\n        default: hasDefaultImport,\n        namespace: hasNamespaceImport,\n        named: namedImports,\n    };\n}\nfunction cleanCodeForParsing(code) {\n    code = stripComments(code);\n    const allMatches = [];\n    let match;\n    const importRegex = new RegExp(ESM_IMPORT_REGEX);\n    while ((match = importRegex.exec(code))) {\n        allMatches.push(match);\n    }\n    const dynamicImportRegex = new RegExp(ESM_DYNAMIC_IMPORT_REGEX);\n    while ((match = dynamicImportRegex.exec(code))) {\n        allMatches.push(match);\n    }\n    return allMatches.map(([full]) => full).join('\\n');\n}\nfunction parseJsForInstallTargets(contents) {\n    let imports;\n    // Attempt #1: Parse the file as JavaScript. JSX and some decorator\n    // syntax will break this.\n    try {\n        [imports] = parse(contents) || [];\n    }\n    catch (err) {\n        // Attempt #2: Parse only the import statements themselves.\n        // This lets us guarentee we aren't sending any broken syntax to our parser,\n        // but at the expense of possible false +/- caused by our regex extractor.\n        contents = cleanCodeForParsing(contents);\n        [imports] = parse(contents) || [];\n    }\n    return (imports\n        .map((imp) => parseImportStatement(contents, imp))\n        .filter(isTruthy)\n        // Babel macros are not install targets!\n        .filter((target) => !/[./]macro(\\.js)?$/.test(target.specifier)));\n}\nfunction parseCssForInstallTargets(code) {\n    const installTargets = [];\n    let match;\n    const importRegex = new RegExp(CSS_REGEX);\n    while ((match = importRegex.exec(code))) {\n        const [, spec] = match;\n        const webModuleSpecifier = parseWebModuleSpecifier(spec);\n        if (webModuleSpecifier) {\n            installTargets.push(createInstallTarget(webModuleSpecifier));\n        }\n    }\n    return installTargets;\n}\nfunction parseFileForInstallTargets({ locOnDisk, baseExt, contents, }) {\n    const relativeLoc = path.relative(process.cwd(), locOnDisk);\n    try {\n        switch (baseExt) {\n            case '.css':\n            case '.less':\n            case '.sass':\n            case '.scss': {\n                logger.debug(`Scanning ${relativeLoc} for imports as CSS`);\n                return parseCssForInstallTargets(contents);\n            }\n            case '.html':\n            case '.svelte':\n            case '.vue': {\n                logger.debug(`Scanning ${relativeLoc} for imports as HTML`);\n                return parseJsForInstallTargets(extractJSFromHTML({ contents, baseExt }));\n            }\n            case '.js':\n            case '.jsx':\n            case '.mjs':\n            case '.ts':\n            case '.tsx': {\n                logger.debug(`Scanning ${relativeLoc} for imports as JS`);\n                return parseJsForInstallTargets(contents);\n            }\n            default: {\n                logger.debug(`Skip scanning ${relativeLoc} for imports (unknown file extension ${baseExt})`);\n                return [];\n            }\n        }\n    }\n    catch (err) {\n        // Another error! No hope left, just abort.\n        logger.error(`! ${locOnDisk}`);\n        throw err;\n    }\n}\n/** Extract only JS within <script type=\"module\"> tags (works for .svelte and .vue files, too) */\nfunction extractJSFromHTML({ contents, baseExt }) {\n    // TODO: Replace with matchAll once Node v10 is out of TLS.\n    // const allMatches = [...result.matchAll(new RegExp(HTML_JS_REGEX))];\n    const allMatches = [];\n    let match;\n    let regex = new RegExp(HTML_JS_REGEX);\n    if (baseExt === '.svelte' || baseExt === '.vue') {\n        regex = new RegExp(SVELTE_VUE_REGEX); // scan <script> tags, not <script type=\"module\">\n    }\n    while ((match = regex.exec(contents))) {\n        allMatches.push(match);\n    }\n    return allMatches\n        .map((match) => match[2]) // match[2] is the code inside the <script></script> element\n        .filter((s) => s.trim())\n        .join('\\n');\n}\nexport function scanDepList(depList, cwd) {\n    return depList\n        .map((whitelistItem) => {\n        if (!glob.hasMagic(whitelistItem)) {\n            return [createInstallTarget(whitelistItem, true)];\n        }\n        else {\n            const nodeModulesLoc = path.join(cwd, 'node_modules');\n            return scanDepList(glob.sync(whitelistItem, { cwd: nodeModulesLoc, nodir: true }), cwd);\n        }\n    })\n        .reduce((flat, item) => flat.concat(item), []);\n}\nexport async function scanImports(cwd, config) {\n    await initESModuleLexer;\n    const includeFileSets = await Promise.all(Object.keys(config.mount).map((fromDisk) => {\n        const dirDisk = path.resolve(cwd, fromDisk);\n        return glob.sync(`**/*`, {\n            ignore: config.exclude.concat(['**/web_modules/**/*']),\n            cwd: dirDisk,\n            absolute: true,\n            nodir: true,\n        });\n    }));\n    const includeFiles = Array.from(new Set([].concat.apply([], includeFileSets)));\n    if (includeFiles.length === 0) {\n        return [];\n    }\n    // Scan every matched JS file for web dependency imports\n    const loadedFiles = await Promise.all(includeFiles.map(async (filePath) => {\n        const { baseExt, expandedExt } = getExt(filePath);\n        return {\n            baseExt,\n            expandedExt,\n            locOnDisk: filePath,\n            contents: await readFile(filePath),\n        };\n    }));\n    return scanImportsFromFiles(loadedFiles.filter(isTruthy), config);\n}\nexport async function scanImportsFromFiles(loadedFiles, config) {\n    return loadedFiles\n        .filter((sourceFile) => !Buffer.isBuffer(sourceFile.contents)) // filter out binary files from import scanning\n        .map((sourceFile) => parseFileForInstallTargets(sourceFile))\n        .reduce((flat, item) => flat.concat(item), [])\n        .filter((target) => {\n        const aliasEntry = findMatchingAliasEntry(config, target.specifier);\n        return !aliasEntry || aliasEntry.type === 'package';\n    })\n        .sort((impA, impB) => impA.specifier.localeCompare(impB.specifier));\n}\n","import * as colors from 'kleur/colors';\n/** The minimum width, in characters, of each size column */\nconst SIZE_COLUMN_WIDTH = 11;\n/** Generic Object.entries() alphabetical sort by keys. */\nfunction entriesSort([filenameA], [filenameB]) {\n    return filenameA.localeCompare(filenameB);\n}\n/** Pretty-prints number of bytes as \"XXX KB\" */\nfunction formatSize(size) {\n    let kb = Math.round((size / 1000) * 100) / 100;\n    if (kb >= 1000) {\n        kb = Math.floor(kb);\n    }\n    let color;\n    if (kb < 15) {\n        color = 'green';\n    }\n    else if (kb < 30) {\n        color = 'yellow';\n    }\n    else {\n        color = 'red';\n    }\n    return colors[color](`${kb} KB`.padEnd(SIZE_COLUMN_WIDTH));\n}\nfunction formatDelta(delta) {\n    const kb = Math.round(delta * 100) / 100;\n    const color = delta > 0 ? 'red' : 'green';\n    return colors[color](`Δ ${delta > 0 ? '+' : ''}${kb} KB`);\n}\nfunction formatFileInfo(filename, stats, padEnd, isLastFile) {\n    const lineGlyph = colors.dim(isLastFile ? '└─' : '├─');\n    const lineName = filename.padEnd(padEnd);\n    const fileStat = formatSize(stats.size);\n    const gzipStat = formatSize(stats.gzip);\n    const brotliStat = formatSize(stats.brotli);\n    const lineStat = fileStat + gzipStat + brotliStat;\n    let lineDelta = '';\n    if (stats.delta) {\n        lineDelta = colors.dim('[') + formatDelta(stats.delta) + colors.dim(']');\n    }\n    // Trim trailing whitespace (can mess with formatting), but keep indentation.\n    return `    ` + `${lineGlyph} ${lineName} ${lineStat} ${lineDelta}`.trim();\n}\nfunction formatFiles(files, padEnd) {\n    const strippedFiles = files.map(([filename, stats]) => [\n        filename.replace(/^common\\//, ''),\n        stats,\n    ]);\n    return strippedFiles\n        .map(([filename, stats], index) => formatFileInfo(filename, stats, padEnd, index >= files.length - 1))\n        .join('\\n');\n}\nexport function printStats(dependencyStats) {\n    let output = '';\n    const { direct, common } = dependencyStats;\n    const allDirect = Object.entries(direct).sort(entriesSort);\n    const allCommon = Object.entries(common).sort(entriesSort);\n    const maxFileNameLength = [...allCommon, ...allDirect].reduce((max, [filename]) => Math.max(filename.length, max), 'web_modules/'.length) + 1;\n    output +=\n        `  ⦿ ${colors.bold('web_modules/'.padEnd(maxFileNameLength + 4))}` +\n            colors.bold(colors.underline('size'.padEnd(SIZE_COLUMN_WIDTH - 2))) +\n            '  ' +\n            colors.bold(colors.underline('gzip'.padEnd(SIZE_COLUMN_WIDTH - 2))) +\n            '  ' +\n            colors.bold(colors.underline('brotli'.padEnd(SIZE_COLUMN_WIDTH - 2))) +\n            `\\n`;\n    output += `${formatFiles(allDirect, maxFileNameLength)}\\n`;\n    if (Object.values(common).length > 0) {\n        output += `  ⦿ ${colors.bold('web_modules/common/ (Shared)')}\\n`;\n        output += `${formatFiles(allCommon, maxFileNameLength)}\\n`;\n    }\n    return `\\n${output}\\n`;\n}\n","import rollupPluginAlias from '@rollup/plugin-alias';\nimport rollupPluginCommonjs from '@rollup/plugin-commonjs';\nimport rollupPluginJson from '@rollup/plugin-json';\nimport rollupPluginNodeResolve from '@rollup/plugin-node-resolve';\nimport rollupPluginNodePolyfills from 'rollup-plugin-node-polyfills';\nimport rollupPluginReplace from '@rollup/plugin-replace';\nimport { init as initESModuleLexer } from 'es-module-lexer';\nimport findUp from 'find-up';\nimport util from 'util';\nimport fs from 'fs';\nimport * as colors from 'kleur/colors';\nimport mkdirp from 'mkdirp';\nimport path from 'path';\nimport { performance } from 'perf_hooks';\nimport rimraf from 'rimraf';\nimport { rollup } from 'rollup';\nimport validatePackageName from 'validate-npm-package-name';\nimport { logger } from '../logger';\nimport { resolveTargetsFromRemoteCDN } from '../resolve-remote.js';\nimport { rollupPluginCatchUnresolved } from '../rollup-plugins/rollup-plugin-catch-unresolved.js';\nimport { rollupPluginCatchFetch } from '../rollup-plugins/rollup-plugin-catch-fetch';\nimport { rollupPluginCss } from '../rollup-plugins/rollup-plugin-css';\nimport { rollupPluginDependencyCache } from '../rollup-plugins/rollup-plugin-remote-cdn.js';\nimport { rollupPluginDependencyStats } from '../rollup-plugins/rollup-plugin-stats.js';\nimport { rollupPluginWrapInstallTargets } from '../rollup-plugins/rollup-plugin-wrap-install-targets';\nimport { rollupPluginNodeProcessPolyfill } from '../rollup-plugins/rollup-plugin-node-process-polyfill';\nimport { rollupPluginStripSourceMapping } from '../rollup-plugins/rollup-plugin-strip-source-mapping';\nimport { scanDepList, scanImports, scanImportsFromFiles } from '../scan-imports.js';\nimport { printStats } from '../stats-formatter.js';\nimport { isTruthy, MISSING_PLUGIN_SUGGESTIONS, parsePackageImportSpecifier, resolveDependencyManifest, sanitizePackageName, writeLockfile, isPackageAliasEntry, findMatchingAliasEntry, getWebDependencyName, } from '../util.js';\n// Add popular CJS packages here that use \"synthetic\" named imports in their documentation.\n// CJS packages should really only be imported via the default export:\n//   import React from 'react';\n// But, some large projects use named exports in their documentation:\n//   import {useState} from 'react';\n//\n// We use \"/index.js here to match the official package, but not any ESM aliase packages\n// that the user may have installed instead (ex: react-esm).\nconst CJS_PACKAGES_TO_AUTO_DETECT = [\n    'react/index.js',\n    'react-dom/index.js',\n    'react-dom/server.js',\n    'react-is/index.js',\n    'prop-types/index.js',\n    'scheduler/index.js',\n    'react-table',\n];\nconst cwd = process.cwd();\nlet installResults = [];\nlet dependencyStats = null;\nfunction isImportOfPackage(importUrl, packageName) {\n    return packageName === importUrl || importUrl.startsWith(packageName + '/');\n}\n/**\n * Resolve a \"webDependencies\" input value to the correct absolute file location.\n * Supports both npm package names, and file paths relative to the node_modules directory.\n * Follows logic similar to Node's resolution logic, but using a package.json's ESM \"module\"\n * field instead of the CJS \"main\" field.\n */\nfunction resolveWebDependency(dep) {\n    // if dep points directly to a file within a package, return that reference.\n    // No other lookup required.\n    if (path.extname(dep) && !validatePackageName(dep).validForNewPackages) {\n        const isJSFile = ['.js', '.mjs', '.cjs'].includes(path.extname(dep));\n        return {\n            type: isJSFile ? 'JS' : 'ASSET',\n            // For details on why we need to call fs.realpathSync.native here and other places, see\n            // https://github.com/pikapkg/snowpack/pull/999.\n            loc: fs.realpathSync.native(require.resolve(dep, { paths: [cwd] })),\n        };\n    }\n    // If dep is a path within a package (but without an extension), we first need\n    // to check for an export map in the package.json. If one exists, resolve to it.\n    const [packageName, packageEntrypoint] = parsePackageImportSpecifier(dep);\n    if (packageEntrypoint) {\n        const [packageManifestLoc, packageManifest] = resolveDependencyManifest(packageName, cwd);\n        if (packageManifestLoc && packageManifest && packageManifest.exports) {\n            const exportMapEntry = packageManifest.exports['./' + packageEntrypoint];\n            const exportMapValue = exportMapEntry?.browser ||\n                exportMapEntry?.import ||\n                exportMapEntry?.default ||\n                exportMapEntry?.require ||\n                exportMapEntry;\n            if (typeof exportMapValue !== 'string') {\n                logger.error(`Package \"${packageName}\" exists but package.json \"exports\" does not include entry for \"./${packageEntrypoint}\".`);\n                process.exit(1);\n            }\n            return {\n                type: 'JS',\n                loc: path.join(packageManifestLoc, '..', exportMapValue),\n            };\n        }\n    }\n    // Otherwise, resolve directly to the dep specifier. Note that this supports both\n    // \"package-name\" & \"package-name/some/path\" where \"package-name/some/path/package.json\"\n    // exists at that lower path, that must be used to resolve. In that case, export\n    // maps should not be supported.\n    const [depManifestLoc, depManifest] = resolveDependencyManifest(dep, cwd);\n    if (!depManifest) {\n        try {\n            const maybeLoc = fs.realpathSync.native(require.resolve(dep, { paths: [cwd] }));\n            return {\n                type: 'JS',\n                loc: maybeLoc,\n            };\n        }\n        catch (err) {\n            // Oh well, was worth a try\n        }\n    }\n    if (!depManifestLoc || !depManifest) {\n        throw new Error(`Package \"${dep}\" not found. Have you installed it? ${depManifestLoc ? depManifestLoc : ''}`);\n    }\n    if (depManifest.name &&\n        (depManifest.name.startsWith('@reactesm') || depManifest.name.startsWith('@pika/react'))) {\n        logger.error(`React workaround packages no longer needed! Revert back to the official React & React-DOM packages.`);\n        process.exit(1);\n    }\n    let foundEntrypoint = depManifest['browser:module'] ||\n        depManifest.module ||\n        depManifest['main:esnext'] ||\n        depManifest.browser;\n    // Some packages define \"browser\" as an object. We'll do our best to find the\n    // right entrypoint in an entrypoint object, or fail otherwise.\n    // See: https://github.com/defunctzombie/package-browser-field-spec\n    if (typeof foundEntrypoint === 'object') {\n        foundEntrypoint =\n            foundEntrypoint[dep] ||\n                foundEntrypoint['./index.js'] ||\n                foundEntrypoint['./index'] ||\n                foundEntrypoint['./'] ||\n                foundEntrypoint['.'];\n    }\n    // If browser object is set but no relevant entrypoint is found, fall back to \"main\".\n    if (!foundEntrypoint) {\n        foundEntrypoint = depManifest.main;\n    }\n    // Sometimes packages don't give an entrypoint, assuming you'll fall back to \"index.js\".\n    const isImplicitEntrypoint = !foundEntrypoint;\n    if (isImplicitEntrypoint) {\n        foundEntrypoint = 'index.js';\n    }\n    if (typeof foundEntrypoint !== 'string') {\n        throw new Error(`\"${dep}\" has unexpected entrypoint: ${JSON.stringify(foundEntrypoint)}.`);\n    }\n    try {\n        return {\n            type: 'JS',\n            loc: fs.realpathSync.native(require.resolve(path.join(depManifestLoc || '', '..', foundEntrypoint))),\n        };\n    }\n    catch (err) {\n        // Type only packages! Some packages are purely for TypeScript (ex: csstypes).\n        // If no JS entrypoint was given or found, but a TS \"types\"/\"typings\" entrypoint\n        // was given, assume a TS-types only package and ignore.\n        if (isImplicitEntrypoint && (depManifest.types || depManifest.typings)) {\n            return { type: 'IGNORE', loc: '' };\n        }\n        // Otherwise, file truly doesn't exist.\n        throw err;\n    }\n}\nfunction generateEnvObject(userEnv) {\n    return {\n        NODE_ENV: process.env.NODE_ENV || 'production',\n        ...Object.keys(userEnv).reduce((acc, key) => {\n            const value = userEnv[key];\n            acc[key] = value === true ? process.env[key] : value;\n            return acc;\n        }, {}),\n    };\n}\nfunction generateEnvReplacements(env) {\n    return Object.keys(env).reduce((acc, key) => {\n        acc[`process.env.${key}`] = JSON.stringify(env[key]);\n        return acc;\n    }, {});\n}\nconst FAILED_INSTALL_MESSAGE = 'Install failed.';\nconst EMPTY_INSTALL_RETURN = {\n    success: false,\n    importMap: null,\n};\nexport async function install(installTargets, { lockfile, config }) {\n    const { webDependencies, alias: installAlias, installOptions: { installTypes, dest: destLoc, externalPackage: externalPackages, sourceMap, env: userEnv, rollup: userDefinedRollup, treeshake: isTreeshake, polyfillNode, }, } = config;\n    const env = generateEnvObject(userEnv);\n    const nodeModulesInstalled = findUp.sync('node_modules', { cwd, type: 'directory' });\n    if (!webDependencies && !process.versions.pnp && !nodeModulesInstalled) {\n        logger.error('No \"node_modules\" directory exists. Did you run \"npm install\" first?');\n        return EMPTY_INSTALL_RETURN;\n    }\n    const allInstallSpecifiers = new Set(installTargets\n        .filter((dep) => !externalPackages.some((packageName) => isImportOfPackage(dep.specifier, packageName)))\n        .map((dep) => dep.specifier)\n        .map((specifier) => {\n        const aliasEntry = findMatchingAliasEntry(config, specifier);\n        return aliasEntry && aliasEntry.type === 'package' ? aliasEntry.to : specifier;\n    })\n        .sort());\n    const installEntrypoints = {};\n    const assetEntrypoints = {};\n    const importMap = { imports: {} };\n    const skipFailures = false;\n    const autoDetectNamedExports = [\n        ...CJS_PACKAGES_TO_AUTO_DETECT,\n        ...config.installOptions.namedExports,\n    ];\n    for (const installSpecifier of allInstallSpecifiers) {\n        const targetName = getWebDependencyName(installSpecifier);\n        const proxiedName = sanitizePackageName(targetName); // sometimes we need to sanitize webModule names, as in the case of tippy.js -> tippyjs\n        if (lockfile && lockfile.imports[installSpecifier]) {\n            installEntrypoints[targetName] = lockfile.imports[installSpecifier];\n            importMap.imports[installSpecifier] = `./${proxiedName}.js`;\n            installResults.push([targetName, 'SUCCESS']);\n            continue;\n        }\n        try {\n            const { type: targetType, loc: targetLoc } = resolveWebDependency(installSpecifier);\n            if (targetType === 'JS') {\n                installEntrypoints[targetName] = targetLoc;\n                importMap.imports[installSpecifier] = `./${proxiedName}.js`;\n                Object.entries(installAlias)\n                    .filter(([, value]) => value === installSpecifier)\n                    .forEach(([key]) => {\n                    importMap.imports[key] = `./${targetName}.js`;\n                });\n                installResults.push([installSpecifier, 'SUCCESS']);\n            }\n            else if (targetType === 'ASSET') {\n                assetEntrypoints[targetName] = targetLoc;\n                importMap.imports[installSpecifier] = `./${proxiedName}`;\n                installResults.push([installSpecifier, 'ASSET']);\n            }\n        }\n        catch (err) {\n            installResults.push([installSpecifier, 'FAIL']);\n            if (skipFailures) {\n                continue;\n            }\n            logger.error(err.message || err);\n            throw new Error(FAILED_INSTALL_MESSAGE);\n        }\n    }\n    if (Object.keys(installEntrypoints).length === 0 && Object.keys(assetEntrypoints).length === 0) {\n        logger.error(`No ESM dependencies found!\n${colors.dim(`  At least one dependency must have an ESM \"module\" entrypoint. You can find modern, web-ready packages at ${colors.underline('https://www.pika.dev')}`)}`);\n        return EMPTY_INSTALL_RETURN;\n    }\n    await initESModuleLexer;\n    let isCircularImportFound = false;\n    let isFatalWarningFound = false;\n    const inputOptions = {\n        input: installEntrypoints,\n        external: (id) => externalPackages.some((packageName) => isImportOfPackage(id, packageName)),\n        treeshake: { moduleSideEffects: 'no-external' },\n        plugins: [\n            !!webDependencies &&\n                rollupPluginDependencyCache({\n                    installTypes,\n                    log: (url) => {\n                        logger.debug(`installing ${colors.dim(url)}…`);\n                    },\n                }),\n            rollupPluginAlias({\n                entries: Object.entries(installAlias)\n                    .filter(([, val]) => isPackageAliasEntry(val))\n                    .map(([key, val]) => ({\n                    find: key,\n                    replacement: val,\n                })),\n            }),\n            rollupPluginCatchFetch(),\n            rollupPluginNodeResolve({\n                mainFields: ['browser:module', 'module', 'browser', 'main'].filter(isTruthy),\n                extensions: ['.mjs', '.cjs', '.js', '.json'],\n                // whether to prefer built-in modules (e.g. `fs`, `path`) or local ones with the same names\n                preferBuiltins: true,\n                dedupe: userDefinedRollup.dedupe,\n            }),\n            rollupPluginJson({\n                preferConst: true,\n                indent: '  ',\n                compact: false,\n                namedExports: true,\n            }),\n            rollupPluginCss(),\n            rollupPluginReplace(generateEnvReplacements(env)),\n            rollupPluginCommonjs({\n                extensions: ['.js', '.cjs'],\n                externalEsm: process.env.EXTERNAL_ESM_PACKAGES || [],\n                requireReturnsDefault: 'auto',\n            }),\n            rollupPluginWrapInstallTargets(!!isTreeshake, autoDetectNamedExports, installTargets),\n            rollupPluginDependencyStats((info) => (dependencyStats = info)),\n            rollupPluginNodeProcessPolyfill(env),\n            polyfillNode && rollupPluginNodePolyfills(),\n            ...userDefinedRollup.plugins,\n            rollupPluginCatchUnresolved(),\n            rollupPluginStripSourceMapping(),\n        ].filter(Boolean),\n        onwarn(warning, warn) {\n            // Warn about the first circular dependency, but then ignore the rest.\n            if (warning.code === 'CIRCULAR_DEPENDENCY') {\n                if (!isCircularImportFound) {\n                    isCircularImportFound = true;\n                    logger.warn(`Warning: 1+ circular dependencies found via \"${warning.importer}\".`);\n                }\n                return;\n            }\n            // Log \"unresolved\" import warnings as an error, causing Snowpack to fail at the end.\n            if (warning.code === 'PLUGIN_WARNING' &&\n                warning.plugin === 'snowpack:rollup-plugin-catch-unresolved') {\n                isFatalWarningFound = true;\n                // Display posix-style on all environments, mainly to help with CI :)\n                if (warning.id) {\n                    const fileName = path.relative(cwd, warning.id).replace(/\\\\/g, '/');\n                    logger.error(`${fileName}\\n   ${warning.message}`);\n                }\n                else {\n                    logger.error(`${warning.message}. See https://www.snowpack.dev/#troubleshooting`);\n                }\n                return;\n            }\n            warn(warning);\n        },\n    };\n    const outputOptions = {\n        dir: destLoc,\n        format: 'esm',\n        sourcemap: sourceMap,\n        exports: 'named',\n        entryFileNames: (chunk) => {\n            const targetName = getWebDependencyName(chunk.name);\n            const proxiedName = sanitizePackageName(targetName);\n            return `${proxiedName}.js`;\n        },\n        chunkFileNames: 'common/[name]-[hash].js',\n    };\n    if (Object.keys(installEntrypoints).length > 0) {\n        try {\n            logger.debug(`running installer with options: ${util.format(inputOptions)}`);\n            const packageBundle = await rollup(inputOptions);\n            logger.debug(`installing npm packages:\\n    ${Object.keys(installEntrypoints).join('\\n    ')}`);\n            if (isFatalWarningFound) {\n                throw new Error(FAILED_INSTALL_MESSAGE);\n            }\n            logger.debug(`writing install results to disk`);\n            await packageBundle.write(outputOptions);\n        }\n        catch (_err) {\n            const err = _err;\n            const errFilePath = err.loc?.file || err.id;\n            if (!errFilePath) {\n                throw err;\n            }\n            // NOTE: Rollup will fail instantly on most errors. Therefore, we can\n            // only report one error at a time. `err.watchFiles` also exists, but\n            // for now `err.loc.file` and `err.id` have all the info that we need.\n            const failedExtension = path.extname(errFilePath);\n            const suggestion = MISSING_PLUGIN_SUGGESTIONS[failedExtension] || err.message;\n            // Display posix-style on all environments, mainly to help with CI :)\n            const fileName = path.relative(cwd, errFilePath).replace(/\\\\/g, '/');\n            logger.error(`Failed to load ${colors.bold(fileName)}\\n  ${suggestion}`);\n            throw new Error(FAILED_INSTALL_MESSAGE);\n        }\n    }\n    mkdirp.sync(destLoc);\n    await writeLockfile(path.join(destLoc, 'import-map.json'), importMap);\n    for (const [assetName, assetLoc] of Object.entries(assetEntrypoints)) {\n        const assetDest = `${destLoc}/${sanitizePackageName(assetName)}`;\n        mkdirp.sync(path.dirname(assetDest));\n        fs.copyFileSync(assetLoc, assetDest);\n    }\n    return {\n        success: true,\n        importMap,\n    };\n}\nexport async function getInstallTargets(config, scannedFiles) {\n    const { knownEntrypoints, webDependencies } = config;\n    const installTargets = [];\n    if (knownEntrypoints) {\n        installTargets.push(...scanDepList(knownEntrypoints, cwd));\n    }\n    if (webDependencies) {\n        installTargets.push(...scanDepList(Object.keys(webDependencies), cwd));\n    }\n    // TODO: remove this if block; move logic inside scanImports\n    if (scannedFiles) {\n        installTargets.push(...(await scanImportsFromFiles(scannedFiles, config)));\n    }\n    else {\n        installTargets.push(...(await scanImports(cwd, config)));\n    }\n    return installTargets;\n}\nexport async function command(commandOptions) {\n    const { cwd, config } = commandOptions;\n    logger.debug('Starting install');\n    const installTargets = await getInstallTargets(config);\n    logger.debug('Received install targets');\n    if (installTargets.length === 0) {\n        logger.error('Nothing to install.');\n        return;\n    }\n    logger.debug('Running install command');\n    const finalResult = await run({ ...commandOptions, installTargets });\n    logger.debug('Install command successfully ran');\n    if (finalResult.newLockfile) {\n        await writeLockfile(path.join(cwd, 'snowpack.lock.json'), finalResult.newLockfile);\n        logger.debug('Successfully wrote lockfile');\n    }\n    if (finalResult.stats) {\n        logger.info(printStats(finalResult.stats));\n    }\n    if (!finalResult.success || finalResult.hasError) {\n        process.exit(1);\n    }\n}\nexport async function run({ config, lockfile, installTargets, }) {\n    const { installOptions: { dest }, webDependencies, } = config;\n    // start\n    const installStart = performance.now();\n    logger.info(colors.yellow('! installing dependencies…'));\n    installResults = [];\n    dependencyStats = null;\n    if (installTargets.length === 0) {\n        return {\n            success: true,\n            hasError: false,\n            importMap: { imports: {} },\n            newLockfile: null,\n            stats: null,\n        };\n    }\n    let newLockfile = null;\n    if (webDependencies && Object.keys(webDependencies).length > 0) {\n        newLockfile = await resolveTargetsFromRemoteCDN(lockfile, config).catch((err) => {\n            logger.error('\\n' + err.message || err);\n            process.exit(1);\n        });\n    }\n    rimraf.sync(dest);\n    const finalResult = await install(installTargets, {\n        lockfile: newLockfile,\n        config,\n    }).catch((err) => {\n        if (err.loc) {\n            logger.error(colors.red(colors.bold(`✘ ${err.loc.file}`)));\n        }\n        if (err.url) {\n            logger.error(colors.dim(`👉 ${err.url}`));\n        }\n        logger.error(err.message || err);\n        process.exit(1);\n    });\n    // finish\n    const installEnd = performance.now();\n    const depList = (finalResult.importMap && Object.keys(finalResult.importMap.imports)) || [];\n    logger.info(`${depList.length\n        ? colors.green(`✔`) + ' install complete'\n        : 'install skipped (nothing to install)'} ${colors.dim(`[${((installEnd - installStart) / 1000).toFixed(2)}s]`)}`);\n    return {\n        success: true,\n        hasError: false,\n        importMap: finalResult.importMap,\n        newLockfile,\n        stats: dependencyStats,\n    };\n}\n","import { promises as fs } from 'fs';\nimport got from 'got';\nimport path from 'path';\nimport { command as installCommand } from './install';\nexport async function addCommand(addValue, commandOptions) {\n    const { cwd, config, pkgManifest } = commandOptions;\n    let [pkgName, pkgSemver] = addValue.split('@');\n    if (!pkgSemver) {\n        const body = (await got(`http://registry.npmjs.org/${pkgName}/latest`).json());\n        pkgSemver = `^${body.version}`;\n    }\n    pkgManifest.webDependencies = pkgManifest.webDependencies || {};\n    pkgManifest.webDependencies[pkgName] = pkgSemver;\n    config.webDependencies = config.webDependencies || {};\n    config.webDependencies[pkgName] = pkgSemver;\n    await fs.writeFile(path.join(cwd, 'package.json'), JSON.stringify(pkgManifest, null, 2));\n    await installCommand(commandOptions);\n}\nexport async function rmCommand(addValue, commandOptions) {\n    const { cwd, config, pkgManifest } = commandOptions;\n    let [pkgName] = addValue.split('@');\n    pkgManifest.webDependencies = pkgManifest.webDependencies || {};\n    delete pkgManifest.webDependencies[pkgName];\n    config.webDependencies = config.webDependencies || {};\n    delete config.webDependencies[pkgName];\n    await fs.writeFile(path.join(cwd, 'package.json'), JSON.stringify(pkgManifest, null, 2));\n    await installCommand(commandOptions);\n}\n","import path from 'path';\nimport { appendHTMLToBody, getExt } from '../util';\nimport { logger } from '../logger';\nexport function getMetaUrlPath(urlPath, config) {\n    let { metaDir } = config.buildOptions || {};\n    return path.posix.normalize(path.posix.join('/', metaDir, urlPath));\n}\nexport function wrapImportMeta({ code, hmr, env, config, }) {\n    if (!code.includes('import.meta')) {\n        return code;\n    }\n    return ((hmr\n        ? `import * as  __SNOWPACK_HMR__ from '${getMetaUrlPath('hmr.js', config)}';\\nimport.meta.hot = __SNOWPACK_HMR__.createHotContext(import.meta.url);\\n`\n        : ``) +\n        (env\n            ? `import __SNOWPACK_ENV__ from '${getMetaUrlPath('env.js', config)}';\\nimport.meta.env = __SNOWPACK_ENV__;\\n`\n            : ``) +\n        '\\n' +\n        code);\n}\nexport function wrapHtmlResponse({ code, hmr, isDev, config, mode, }) {\n    // replace %PUBLIC_URL% (along with surrounding slashes, if any)\n    code = code.replace(/\\/?%PUBLIC_URL%\\/?/g, isDev ? '/' : config.buildOptions.baseUrl);\n    // replace %MODE%\n    code = code.replace(/%MODE%/g, mode);\n    const snowpackPublicEnv = getSnowpackPublicEnvVariables();\n    code = code.replace(/%SNOWPACK_PUBLIC_.+?%/gi, (match) => {\n        const envVariableName = match.slice(1, -1);\n        if (envVariableName in snowpackPublicEnv) {\n            return snowpackPublicEnv[envVariableName] || '';\n        }\n        logger.warn(`Environment variable \"${envVariableName}\" is not set`);\n        return match;\n    });\n    if (hmr) {\n        const hmrScript = `<script type=\"module\" src=\"${getMetaUrlPath('hmr.js', config)}\"></script>`;\n        code = appendHTMLToBody(code, hmrScript);\n    }\n    return code;\n}\nfunction generateJsonImportProxy({ code, hmr, config, }) {\n    const jsonImportProxyCode = `let json = ${JSON.stringify(JSON.parse(code))};\nexport default json;`;\n    return wrapImportMeta({ code: jsonImportProxyCode, hmr, env: false, config });\n}\nfunction generateCssImportProxy({ code, hmr, config, }) {\n    const cssImportProxyCode = `${hmr\n        ? `\nimport.meta.hot.accept();\nimport.meta.hot.dispose(() => {\ndocument.head.removeChild(styleEl);\n});\\n`\n        : ''}\nconst code = ${JSON.stringify(code)};\n\nconst styleEl = document.createElement(\"style\");\nconst codeEl = document.createTextNode(code);\nstyleEl.type = 'text/css';\n\nstyleEl.appendChild(codeEl);\ndocument.head.appendChild(styleEl);`;\n    return wrapImportMeta({ code: cssImportProxyCode, hmr, env: false, config });\n}\nlet _cssModuleLoader;\nasync function generateCssModuleImportProxy({ url, code, hmr, config, }) {\n    _cssModuleLoader = _cssModuleLoader || new (require('css-modules-loader-core'))();\n    const { injectableSource, exportTokens } = await _cssModuleLoader.load(code, url, undefined, () => {\n        throw new Error('Imports in CSS Modules are not yet supported.');\n    });\n    return `${hmr\n        ? `\nimport * as __SNOWPACK_HMR_API__ from '${getMetaUrlPath('hmr.js', config)}';\nimport.meta.hot = __SNOWPACK_HMR_API__.createHotContext(import.meta.url);\nimport.meta.hot.dispose(() => {\n  document.head.removeChild(styleEl);\n});\\n`\n        : ``}\nexport let code = ${JSON.stringify(injectableSource)};\nlet json = ${JSON.stringify(exportTokens)};\nexport default json;\n\nconst styleEl = document.createElement(\"style\");\nconst codeEl = document.createTextNode(code);\nstyleEl.type = 'text/css';\n\nstyleEl.appendChild(codeEl);\ndocument.head.appendChild(styleEl);`;\n}\nfunction generateDefaultImportProxy(url) {\n    return `export default ${JSON.stringify(url)};`;\n}\nexport async function wrapImportProxy({ url, code, hmr, config, }) {\n    const { baseExt, expandedExt } = getExt(url);\n    if (typeof code === 'string') {\n        if (baseExt === '.json') {\n            return generateJsonImportProxy({ code, hmr, config });\n        }\n        if (baseExt === '.css') {\n            // if proxying a CSS file, remove its source map (the path no longer applies)\n            const sanitized = code.replace(/\\/\\*#\\s*sourceMappingURL=[^/]+\\//gm, '');\n            return expandedExt.endsWith('.module.css')\n                ? generateCssModuleImportProxy({ url, code: sanitized, hmr, config })\n                : generateCssImportProxy({ code: sanitized, hmr, config });\n        }\n    }\n    return generateDefaultImportProxy(url);\n}\nexport function generateEnvModule(mode) {\n    const envObject = getSnowpackPublicEnvVariables();\n    envObject.MODE = mode;\n    envObject.NODE_ENV = mode;\n    return `export default ${JSON.stringify(envObject)};`;\n}\nconst PUBLIC_ENV_REGEX = /^SNOWPACK_PUBLIC_.+/;\nfunction getSnowpackPublicEnvVariables() {\n    const envObject = { ...process.env };\n    for (const env of Object.keys(envObject)) {\n        if (!PUBLIC_ENV_REGEX.test(env)) {\n            delete envObject[env];\n        }\n    }\n    return envObject;\n}\n","export default {\n    '.mjs': '.js',\n    '.jsx': '.js',\n    '.ts': '.js',\n    '.tsx': '.js',\n    '.vue': '.js',\n    '.svelte': '.js',\n    '.mdx': '.js',\n    '.svx': '.js',\n    '.elm': '.js',\n    '.yaml': '.json',\n    '.toml': '.json',\n    '.php': '.html',\n    '.md': '.html',\n    '.ejs': '.html',\n    '.njk': '.html',\n    '.scss': '.css',\n    '.sass': '.css',\n    '.less': '.css',\n};\n","import { startService } from 'esbuild';\nimport * as colors from 'kleur/colors';\nimport path from 'path';\nimport { promises as fs } from 'fs';\nimport { logger } from '../logger';\nlet esbuildService = null;\nconst IS_PREACT = /from\\s+['\"]preact['\"]/;\nfunction checkIsPreact(filePath, contents) {\n    return filePath.endsWith('.jsx') && IS_PREACT.test(contents);\n}\nfunction getLoader(filePath) {\n    const ext = path.extname(filePath);\n    if (ext === '.mjs') {\n        return 'js';\n    }\n    return ext.substr(1);\n}\nexport function esbuildPlugin(config, { input }) {\n    return {\n        name: '@snowpack/plugin-esbuild',\n        resolve: {\n            input,\n            output: ['.js'],\n        },\n        async load({ filePath }) {\n            esbuildService = esbuildService || (await startService());\n            const contents = await fs.readFile(filePath, 'utf-8');\n            const isPreact = checkIsPreact(filePath, contents);\n            const { js, jsSourceMap, warnings } = await esbuildService.transform(contents, {\n                loader: getLoader(filePath),\n                jsxFactory: isPreact ? 'h' : undefined,\n                jsxFragment: isPreact ? 'Fragment' : undefined,\n                sourcefile: filePath,\n                sourcemap: config.buildOptions.sourceMaps,\n            });\n            for (const warning of warnings) {\n                logger.error(`${colors.bold('!')} ${filePath}\n  ${warning.text}`);\n            }\n            return {\n                '.js': {\n                    code: js || '',\n                    map: jsSourceMap,\n                },\n            };\n        },\n        cleanup() {\n            esbuildService && esbuildService.stop();\n        },\n    };\n}\n","import buildScriptPlugin from '@snowpack/plugin-build-script';\nimport runScriptPlugin from '@snowpack/plugin-run-script';\nimport { cosmiconfigSync } from 'cosmiconfig';\nimport { all as merge } from 'deepmerge';\nimport { validate } from 'jsonschema';\nimport path from 'path';\nimport yargs from 'yargs-parser';\nimport { logger } from './logger';\nimport srcFileExtensionMapping from './build/src-file-extension-mapping';\nimport { esbuildPlugin } from './plugins/plugin-esbuild';\nimport { addLeadingSlash, addTrailingSlash, readFile, removeLeadingSlash, removeTrailingSlash, } from './util';\nconst CONFIG_NAME = 'snowpack';\nconst ALWAYS_EXCLUDE = ['**/node_modules/**/*', '**/.types/**/*'];\n// default settings\nconst DEFAULT_CONFIG = {\n    exclude: ['__tests__/**/*', '**/*.@(spec|test).*'],\n    plugins: [],\n    alias: {},\n    installOptions: {\n        dest: 'web_modules',\n        externalPackage: [],\n        installTypes: false,\n        polyfillNode: false,\n        env: {},\n        namedExports: [],\n        rollup: {\n            plugins: [],\n            dedupe: [],\n        },\n    },\n    scripts: {},\n    devOptions: {\n        secure: false,\n        hostname: 'localhost',\n        port: 8080,\n        open: 'default',\n        out: 'build',\n        fallback: 'index.html',\n    },\n    buildOptions: {\n        baseUrl: '/',\n        webModulesUrl: '/web_modules',\n        clean: false,\n        metaDir: '__snowpack__',\n        minify: false,\n        sourceMaps: false,\n        watch: false,\n    },\n};\nconst configSchema = {\n    type: 'object',\n    properties: {\n        extends: { type: 'string' },\n        install: { type: 'array', items: { type: 'string' } },\n        exclude: { type: 'array', items: { type: 'string' } },\n        plugins: { type: 'array' },\n        webDependencies: {\n            type: ['object'],\n            additionalProperties: { type: 'string' },\n        },\n        scripts: {\n            type: ['object'],\n            additionalProperties: { type: 'string' },\n        },\n        alias: {\n            type: 'object',\n            additionalProperties: { type: 'string' },\n        },\n        devOptions: {\n            type: 'object',\n            properties: {\n                secure: { type: 'boolean' },\n                port: { type: 'number' },\n                out: { type: 'string' },\n                fallback: { type: 'string' },\n                bundle: { type: 'boolean' },\n                open: { type: 'string' },\n                hmr: { type: 'boolean' },\n            },\n        },\n        installOptions: {\n            type: 'object',\n            properties: {\n                dest: { type: 'string' },\n                externalPackage: { type: 'array', items: { type: 'string' } },\n                treeshake: { type: 'boolean' },\n                installTypes: { type: 'boolean' },\n                polyfillNode: { type: 'boolean' },\n                sourceMap: { oneOf: [{ type: 'boolean' }, { type: 'string' }] },\n                alias: {\n                    type: 'object',\n                    additionalProperties: { type: 'string' },\n                },\n                env: {\n                    type: 'object',\n                    additionalProperties: {\n                        oneOf: [\n                            { id: 'EnvVarString', type: 'string' },\n                            { id: 'EnvVarNumber', type: 'number' },\n                            { id: 'EnvVarTrue', type: 'boolean', enum: [true] },\n                        ],\n                    },\n                },\n                rollup: {\n                    type: 'object',\n                    properties: {\n                        plugins: { type: 'array', items: { type: 'object' } },\n                        dedupe: {\n                            type: 'array',\n                            items: { type: 'string' },\n                        },\n                    },\n                },\n            },\n        },\n        buildOptions: {\n            type: ['object'],\n            properties: {\n                baseUrl: { type: 'string' },\n                clean: { type: 'boolean' },\n                metaDir: { type: 'string' },\n                minify: { type: 'boolean' },\n                sourceMaps: { type: 'boolean' },\n                watch: { type: 'boolean' },\n            },\n        },\n        proxy: {\n            type: 'object',\n        },\n    },\n};\n/**\n * Convert CLI flags to an incomplete Snowpack config representation.\n * We need to be careful about setting properties here if the flag value\n * is undefined, since the deep merge strategy would then overwrite good\n * defaults with 'undefined'.\n */\nfunction expandCliFlags(flags) {\n    const result = {\n        installOptions: {},\n        devOptions: {},\n        buildOptions: {},\n    };\n    const { help, version, reload, config, ...relevantFlags } = flags;\n    const CLI_ONLY_FLAGS = ['quiet', 'verbose'];\n    for (const [flag, val] of Object.entries(relevantFlags)) {\n        if (flag === '_' || flag.includes('-')) {\n            continue;\n        }\n        if (configSchema.properties[flag]) {\n            result[flag] = val;\n            continue;\n        }\n        if (configSchema.properties.installOptions.properties[flag]) {\n            result.installOptions[flag] = val;\n            continue;\n        }\n        if (configSchema.properties.devOptions.properties[flag]) {\n            result.devOptions[flag] = val;\n            continue;\n        }\n        if (configSchema.properties.buildOptions.properties[flag]) {\n            result.buildOptions[flag] = val;\n            continue;\n        }\n        if (CLI_ONLY_FLAGS.includes(flag)) {\n            continue;\n        }\n        logger.error(`Unknown CLI flag: \"${flag}\"`);\n        process.exit(1);\n    }\n    if (result.installOptions.env) {\n        result.installOptions.env = result.installOptions.env.reduce((acc, id) => {\n            const index = id.indexOf('=');\n            const [key, val] = index > 0 ? [id.substr(0, index), id.substr(index + 1)] : [id, true];\n            acc[key] = val;\n            return acc;\n        }, {});\n    }\n    return result;\n}\n/** ensure extensions all have preceding dots */\nfunction parseScript(script) {\n    const [scriptType, extMatch] = script.toLowerCase().split(':');\n    const [inputMatch, outputMatch] = extMatch ? extMatch.split('->') : [];\n    const cleanInput = [...new Set(inputMatch.split(',').map((ext) => `.${ext}`))];\n    let cleanOutput = [];\n    if (outputMatch) {\n        cleanOutput = [...new Set(outputMatch.split(',').map((ext) => `.${ext}`))];\n    }\n    else if (cleanInput[0] === '.svelte') {\n        cleanOutput = ['.js', '.css'];\n    }\n    else if (cleanInput[0] === '.vue') {\n        cleanOutput = ['.js', '.css'];\n    }\n    else if (cleanInput.length > 0) {\n        cleanOutput = Array.from(new Set(cleanInput.map((ext) => srcFileExtensionMapping[ext] || ext)));\n    }\n    return {\n        scriptType,\n        input: cleanInput,\n        output: cleanOutput,\n    };\n}\n/** load and normalize plugins from config */\nfunction loadPlugins(config) {\n    const plugins = [];\n    function execPluginFactory(pluginFactory, pluginOptions) {\n        let plugin = null;\n        plugin = pluginFactory(config, pluginOptions);\n        return plugin;\n    }\n    function loadPluginFromScript(specifier) {\n        try {\n            const pluginLoc = require.resolve(specifier, { paths: [process.cwd()] });\n            return execPluginFactory(require(pluginLoc)); // no plugin options to load because we’re loading from a string\n        }\n        catch (err) {\n            // ignore\n        }\n    }\n    function loadPluginFromConfig(name, options) {\n        const pluginLoc = require.resolve(name, { paths: [process.cwd()] });\n        const pluginRef = require(pluginLoc);\n        let plugin;\n        try {\n            plugin = typeof pluginRef.default === 'function' ? pluginRef.default : pluginRef;\n            if (typeof plugin !== 'function')\n                logger.error(`plugin ${name} doesn’t return function`);\n            plugin = execPluginFactory(plugin, options);\n        }\n        catch (err) {\n            logger.error(err.toString() || err);\n            throw err;\n        }\n        plugin.name = plugin.name || name;\n        // Legacy support: Map the new load() interface to the old build() interface\n        const { build, bundle } = plugin;\n        if (build) {\n            plugin.load = async (options) => {\n                const result = await build({\n                    ...options,\n                    contents: await readFile(options.filePath),\n                }).catch((err) => {\n                    logger.error(`[${plugin.name}] There was a problem running this older plugin. Please update the plugin to the latest version.`);\n                    throw err;\n                });\n                if (!result) {\n                    return null;\n                }\n                if (result.resources) {\n                    return {\n                        '.js': result.result,\n                        '.css': result.resources.css,\n                    };\n                }\n                return result.result;\n            };\n        }\n        // Legacy support: Map the new optimize() interface to the old bundle() interface\n        if (bundle) {\n            plugin.optimize = async (options) => {\n                return bundle({\n                    srcDirectory: options.buildDirectory,\n                    destDirectory: options.buildDirectory,\n                    // @ts-ignore internal API only\n                    log: options.log,\n                    // It turns out, this was more or less broken (included all files, not just JS).\n                    // Confirmed no plugins are using this now, so safe to use an empty array.\n                    jsFilePaths: [],\n                }).catch((err) => {\n                    logger.error(`[${plugin.name}] There was a problem running this older plugin. Please update the plugin to the latest version.`);\n                    throw err;\n                });\n            };\n        }\n        if (!plugin.resolve &&\n            plugin.defaultBuildScript &&\n            plugin.defaultBuildScript.startsWith('build:')) {\n            const { input, output } = parseScript(plugin.defaultBuildScript);\n            plugin.resolve = { input, output };\n        }\n        else if (plugin.resolve) {\n            const { input, output } = plugin.resolve;\n            plugin.resolve = { input, output };\n        }\n        validatePlugin(plugin);\n        return plugin;\n    }\n    // 1. require & load config.scripts\n    // TODO: deprecate scripts and move out of this function\n    Object.entries(config.scripts).forEach(([target, cmd]) => {\n        const { scriptType, input, output } = parseScript(target);\n        if (config.plugins.some((p) => (Array.isArray(p) ? p[0] : p) === cmd)) {\n            handleConfigError(`[${cmd}]: loaded in both \\`scripts\\` and \\`plugins\\`. Please choose one (preferably \\`plugins\\`).`);\n        }\n        switch (scriptType) {\n            case 'run': {\n                if (target.endsWith('::watch')) {\n                    break;\n                }\n                const watchCmd = config.scripts[target + '::watch'];\n                plugins.push(execPluginFactory(runScriptPlugin, { cmd, watch: watchCmd || cmd }));\n                break;\n            }\n            case 'build': {\n                plugins.push(execPluginFactory(buildScriptPlugin, { input, output, cmd }));\n                break;\n            }\n            case 'bundle': {\n                plugins.push(loadPluginFromScript(cmd));\n                break;\n            }\n        }\n    });\n    // 2. config.plugins\n    config.plugins.forEach((ref) => {\n        const pluginName = Array.isArray(ref) ? ref[0] : ref;\n        const pluginOptions = Array.isArray(ref) ? ref[1] : {};\n        const plugin = loadPluginFromConfig(pluginName, pluginOptions);\n        logger.debug(`loaded plugin: ${pluginName}`);\n        plugins.push(plugin);\n    });\n    // add internal JS handler plugin if none specified\n    const needsDefaultPlugin = new Set(['.mjs', '.jsx', '.ts', '.tsx']);\n    plugins\n        .filter(({ resolve }) => !!resolve)\n        .reduce((arr, a) => arr.concat(a.resolve.input), [])\n        .forEach((ext) => needsDefaultPlugin.delete(ext));\n    if (needsDefaultPlugin.size > 0) {\n        plugins.unshift(execPluginFactory(esbuildPlugin, { input: [...needsDefaultPlugin] }));\n    }\n    const extensionMap = plugins.reduce((map, { resolve }) => {\n        if (resolve) {\n            for (const inputExt of resolve.input) {\n                map[inputExt] = resolve.output[0];\n            }\n        }\n        return map;\n    }, {});\n    return {\n        plugins,\n        extensionMap,\n    };\n}\n/**\n * Convert deprecated proxy scripts to\n * FUTURE: Remove this on next major release\n */\nfunction handleLegacyProxyScripts(config) {\n    for (const scriptId in config.scripts) {\n        if (!scriptId.startsWith('proxy:')) {\n            continue;\n        }\n        const cmdArr = config.scripts[scriptId].split(/\\s+/);\n        if (cmdArr[0] !== 'proxy') {\n            handleConfigError(`scripts[${scriptId}] must use the proxy command`);\n        }\n        cmdArr.shift();\n        const { to, _ } = yargs(cmdArr);\n        if (_.length !== 1) {\n            handleConfigError(`scripts[${scriptId}] must use the format: \"proxy http://SOME.URL --to /PATH\"`);\n        }\n        if (to && to[0] !== '/') {\n            handleConfigError(`scripts[${scriptId}]: \"--to ${to}\" must be a URL path, and start with a \"/\"`);\n        }\n        const { toUrl, fromUrl } = { fromUrl: _[0], toUrl: to };\n        if (config.proxy[toUrl]) {\n            handleConfigError(`scripts[${scriptId}]: Cannot overwrite proxy[${toUrl}].`);\n        }\n        config.proxy[toUrl] = fromUrl;\n        delete config.scripts[scriptId];\n    }\n    return config;\n}\nfunction normalizeProxies(proxies) {\n    return Object.entries(proxies).map(([pathPrefix, options]) => {\n        if (typeof options !== 'string') {\n            return [\n                pathPrefix,\n                {\n                    //@ts-ignore - Seems to be a strange 3.9.x bug\n                    on: {},\n                    ...options,\n                },\n            ];\n        }\n        return [\n            pathPrefix,\n            {\n                on: {\n                    proxyReq: (proxyReq, req) => {\n                        const proxyPath = proxyReq.path.split(req.url)[0];\n                        proxyReq.path = proxyPath + req.url.replace(pathPrefix, '');\n                    },\n                },\n                target: options,\n                changeOrigin: true,\n                secure: false,\n            },\n        ];\n    });\n}\nfunction normalizeMount(config) {\n    const mountedDirs = config.mount || {};\n    for (const [target, cmd] of Object.entries(config.scripts)) {\n        if (target.startsWith('mount:')) {\n            const cmdArr = cmd.split(/\\s+/);\n            if (cmdArr[0] !== 'mount') {\n                handleConfigError(`scripts[${target}] must use the mount command`);\n            }\n            cmdArr.shift();\n            const { to, _ } = yargs(cmdArr);\n            if (_.length !== 1) {\n                handleConfigError(`scripts[${target}] must use the format: \"mount dir [--to /PATH]\"`);\n            }\n            if (target === 'mount:web_modules') {\n                config.buildOptions.webModulesUrl = to;\n            }\n            else {\n                mountedDirs[cmdArr[0]] = to || `/${cmdArr[0]}`;\n            }\n        }\n    }\n    for (const [mountDir, mountUrl] of Object.entries(mountedDirs)) {\n        const fromDisk = path.posix.normalize(mountDir + '/');\n        delete mountedDirs[mountDir];\n        mountedDirs[fromDisk] = mountUrl;\n        if (mountUrl[0] !== '/') {\n            handleConfigError(`mount[${mountDir}]: Value \"${mountUrl}\" must be a URL path, and start with a \"/\"`);\n        }\n    }\n    // if no mounted directories, mount the root directory to the base URL\n    if (!Object.keys(mountedDirs).length) {\n        mountedDirs['.'] = '/';\n    }\n    return mountedDirs;\n}\nfunction normalizeAlias(config, createMountAlias) {\n    const cwd = process.cwd();\n    const cleanAlias = config.alias || {};\n    if (createMountAlias) {\n        for (const mountDir of Object.keys(config.mount)) {\n            if (mountDir !== '.') {\n                cleanAlias[addTrailingSlash(mountDir)] = addTrailingSlash(`./${mountDir}`);\n            }\n        }\n    }\n    for (const [target, replacement] of Object.entries(config.alias)) {\n        if (replacement === '.' ||\n            replacement === '..' ||\n            replacement.startsWith('./') ||\n            replacement.startsWith('../') ||\n            replacement.startsWith('/')) {\n            delete cleanAlias[target];\n            cleanAlias[addTrailingSlash(target)] = addTrailingSlash(path.resolve(cwd, replacement));\n        }\n    }\n    return cleanAlias;\n}\n/** resolve --dest relative to cwd, etc. */\nfunction normalizeConfig(config) {\n    const cwd = process.cwd();\n    config.knownEntrypoints = config.install || [];\n    config.installOptions.dest = path.resolve(cwd, config.installOptions.dest);\n    config.devOptions.out = path.resolve(cwd, config.devOptions.out);\n    config.exclude = Array.from(new Set([...ALWAYS_EXCLUDE, `${config.devOptions.out}/**/*`, ...config.exclude]));\n    if (!config.proxy) {\n        config.proxy = {};\n    }\n    // normalize config URL/path values\n    config.buildOptions.baseUrl = addTrailingSlash(config.buildOptions.baseUrl);\n    config.buildOptions.webModulesUrl = addLeadingSlash(config.buildOptions.webModulesUrl);\n    config.buildOptions.metaDir = removeLeadingSlash(removeTrailingSlash(config.buildOptions.metaDir));\n    const isLegacyMountConfig = !config.mount;\n    config = handleLegacyProxyScripts(config);\n    config.proxy = normalizeProxies(config.proxy);\n    config.mount = normalizeMount(config);\n    config.alias = normalizeAlias(config, isLegacyMountConfig);\n    // new pipeline\n    const { plugins, extensionMap } = loadPlugins(config);\n    config.plugins = plugins;\n    config._extensionMap = extensionMap;\n    // If any plugins defined knownEntrypoints, add them here\n    for (const { knownEntrypoints } of config.plugins) {\n        if (knownEntrypoints) {\n            config.knownEntrypoints = config.knownEntrypoints.concat(knownEntrypoints);\n        }\n    }\n    plugins.forEach((plugin) => {\n        if (plugin.config) {\n            plugin.config(config);\n        }\n    });\n    return config;\n}\nfunction handleConfigError(msg) {\n    logger.error(msg);\n    process.exit(1);\n}\nfunction handleValidationErrors(filepath, errors) {\n    logger.error(`! ${filepath || 'Configuration error'}\n${errors.map((err) => `    - ${err.toString()}`).join('\\n')}\n    See https://www.snowpack.dev/#configuration for more info.`);\n    process.exit(1);\n}\nfunction handleDeprecatedConfigError(mainMsg, ...msgs) {\n    logger.error(`${mainMsg}\n${msgs.join('\\n')}\nSee https://www.snowpack.dev/#configuration for more info.`);\n    process.exit(1);\n}\nfunction validateConfigAgainstV1(rawConfig, cliFlags) {\n    // Moved!\n    if (rawConfig.dedupe || cliFlags.dedupe) {\n        handleDeprecatedConfigError('[Snowpack v1 -> v2] `dedupe` is now `installOptions.rollup.dedupe`.');\n    }\n    if (rawConfig.namedExports) {\n        handleDeprecatedConfigError('[Snowpack v1 -> v2] `rollup.namedExports` is no longer required. See also: installOptions.namedExports');\n    }\n    if (rawConfig.installOptions?.rollup?.namedExports) {\n        delete rawConfig.installOptions.rollup.namedExports;\n        logger.error('[Snowpack v2.3.0] `rollup.namedExports` is no longer required. See also: installOptions.namedExports');\n    }\n    if (rawConfig.rollup) {\n        handleDeprecatedConfigError('[Snowpack v1 -> v2] top-level `rollup` config is now `installOptions.rollup`.');\n    }\n    if (rawConfig.installOptions?.include || cliFlags.include) {\n        handleDeprecatedConfigError('[Snowpack v1 -> v2] `installOptions.include` is now handled via \"mount\" build scripts!');\n    }\n    if (rawConfig.installOptions?.exclude) {\n        handleDeprecatedConfigError('[Snowpack v1 -> v2] `installOptions.exclude` is now `exclude`.');\n    }\n    if (Array.isArray(rawConfig.webDependencies)) {\n        handleDeprecatedConfigError('[Snowpack v1 -> v2] The `webDependencies` array is now `install`.');\n    }\n    if (rawConfig.knownEntrypoints) {\n        handleDeprecatedConfigError('[Snowpack v1 -> v2] `knownEntrypoints` is now `install`.');\n    }\n    if (rawConfig.entrypoints) {\n        handleDeprecatedConfigError('[Snowpack v1 -> v2] `entrypoints` is now `install`.');\n    }\n    if (rawConfig.include) {\n        handleDeprecatedConfigError('[Snowpack v1 -> v2] All files are now included by default. \"include\" config is safe to remove.', 'Whitelist & include specific folders via \"mount\" build scripts.');\n    }\n    // Replaced!\n    if (rawConfig.source || cliFlags.source) {\n        handleDeprecatedConfigError('[Snowpack v1 -> v2] `source` is now detected automatically, this config is safe to remove.');\n    }\n    if (rawConfig.stat || cliFlags.stat) {\n        handleDeprecatedConfigError('[Snowpack v1 -> v2] `stat` is now the default output, this config is safe to remove.');\n    }\n    if (rawConfig.scripts &&\n        Object.keys(rawConfig.scripts).filter((k) => k.startsWith('lintall')).length > 0) {\n        handleDeprecatedConfigError('[Snowpack v1 -> v2] `scripts[\"lintall:...\"]` has been renamed to scripts[\"run:...\"]');\n    }\n    if (rawConfig.scripts &&\n        Object.keys(rawConfig.scripts).filter((k) => k.startsWith('plugin:`')).length > 0) {\n        handleDeprecatedConfigError('[Snowpack v1 -> v2] `scripts[\"plugin:...\"]` have been renamed to scripts[\"build:...\"].');\n    }\n    if (rawConfig.buildOptions?.minify) {\n        handleDeprecatedConfigError('[Snowpack 2.11.0] `buildOptions.minify` has moved to package \"@snowpack/plugin-optimize\". Install it and include as a plugin in your Snowpack config file.');\n    }\n    // Removed!\n    if (rawConfig.devOptions?.dist) {\n        handleDeprecatedConfigError('[Snowpack v1 -> v2] `devOptions.dist` is no longer required. This config is safe to remove.', `If you'd still like to host your src/ directory at the \"/_dist/*\" URL, create a mount script:',\n      '    {\"scripts\": {\"mount:src\": \"mount src --to /_dist_\"}} `);\n    }\n    if (rawConfig.hash || cliFlags.hash) {\n        handleDeprecatedConfigError('[Snowpack v1 -> v2] `installOptions.hash` has been replaced by `snowpack build`.');\n    }\n    if (rawConfig.installOptions?.nomodule || cliFlags.nomodule) {\n        handleDeprecatedConfigError('[Snowpack v1 -> v2] `installOptions.nomodule` has been replaced by `snowpack build`.');\n    }\n    if (rawConfig.installOptions?.nomoduleOutput || cliFlags.nomoduleOutput) {\n        handleDeprecatedConfigError('[Snowpack v1 -> v2] `installOptions.nomoduleOutput` has been replaced by `snowpack build`.');\n    }\n    if (rawConfig.installOptions?.babel || cliFlags.babel) {\n        handleDeprecatedConfigError('[Snowpack v1 -> v2] `installOptions.babel` has been replaced by `snowpack build`.');\n    }\n    if (rawConfig.installOptions?.optimize) {\n        handleDeprecatedConfigError('[Snowpack v1 -> v2] `installOptions.optimize` has been replaced by `snowpack build` minification.');\n    }\n    if (rawConfig.installOptions?.strict || cliFlags.strict) {\n        handleDeprecatedConfigError('[Snowpack v1 -> v2] `installOptions.strict` is no longer supported.');\n    }\n    if (rawConfig.installOptions?.alias) {\n        handleDeprecatedConfigError('[New in v2.7] `installOptions.alias` has been moved to a top-level `alias` config. (https://snowpack.dev#all-config-options)');\n    }\n}\nfunction validatePlugin(plugin) {\n    const pluginName = plugin.name;\n    if (plugin.resolve && !plugin.load) {\n        handleConfigError(`[${pluginName}] \"resolve\" config found but \"load()\" method missing.`);\n    }\n    if (!plugin.resolve && plugin.load) {\n        handleConfigError(`[${pluginName}] \"load\" method found but \"resolve()\" config missing.`);\n    }\n    if (plugin.resolve && !Array.isArray(plugin.resolve.input)) {\n        handleConfigError(`[${pluginName}] \"resolve.input\" should be an array of input file extensions.`);\n    }\n    if (plugin.resolve && !Array.isArray(plugin.resolve.output)) {\n        handleConfigError(`[${pluginName}] \"resolve.output\" should be an array of output file extensions.`);\n    }\n}\nexport function validatePluginLoadResult(plugin, result) {\n    const pluginName = plugin.name;\n    if (!result) {\n        return;\n    }\n    const isValidSingleResultType = typeof result === 'string' || Buffer.isBuffer(result);\n    if (isValidSingleResultType && plugin.resolve.output.length !== 1) {\n        handleConfigError(`[plugin=${pluginName}] \"load()\" returned a string, but \"resolve.output\" contains multiple possible outputs. If multiple outputs are expected, the object return format is required.`);\n    }\n    const unexpectedOutput = typeof result === 'object' &&\n        Object.keys(result).find((fileExt) => !plugin.resolve.output.includes(fileExt));\n    if (unexpectedOutput) {\n        handleConfigError(`[plugin=${pluginName}] \"load()\" returned entry \"${unexpectedOutput}\" not found in \"resolve.output\": ${plugin.resolve.output}`);\n    }\n}\nexport function createConfiguration(config) {\n    const { errors: validationErrors } = validate(config, configSchema, {\n        propertyName: CONFIG_NAME,\n        allowUnknownAttributes: false,\n    });\n    if (validationErrors.length > 0) {\n        return [validationErrors, undefined];\n    }\n    const mergedConfig = merge([DEFAULT_CONFIG, config]);\n    return [null, normalizeConfig(mergedConfig)];\n}\nexport function loadAndValidateConfig(flags, pkgManifest) {\n    const explorerSync = cosmiconfigSync(CONFIG_NAME, {\n        // only support these 4 types of config for now\n        searchPlaces: [\n            'package.json',\n            'snowpack.config.cjs',\n            'snowpack.config.js',\n            'snowpack.config.json',\n        ],\n        // don't support crawling up the folder tree:\n        stopDir: path.dirname(process.cwd()),\n    });\n    let result;\n    // if user specified --config path, load that\n    if (flags.config) {\n        result = explorerSync.load(path.resolve(process.cwd(), flags.config));\n        if (!result) {\n            handleConfigError(`Could not locate Snowpack config at ${flags.config}`);\n        }\n    }\n    // If no config was found above, search for one.\n    result = result || explorerSync.search();\n    // If still no config found, assume none exists and use the default config.\n    if (!result || !result.config || result.isEmpty) {\n        result = { config: { ...DEFAULT_CONFIG } };\n    }\n    // validate against schema; throw helpful user if invalid\n    const config = result.config;\n    validateConfigAgainstV1(config, flags);\n    const cliConfig = expandCliFlags(flags);\n    let extendConfig = {};\n    if (config.extends) {\n        const extendConfigLoc = config.extends.startsWith('.')\n            ? path.resolve(path.dirname(result.filepath), config.extends)\n            : require.resolve(config.extends, { paths: [process.cwd()] });\n        const extendResult = explorerSync.load(extendConfigLoc);\n        if (!extendResult) {\n            handleConfigError(`Could not locate Snowpack config at ${flags.config}`);\n            process.exit(1);\n        }\n        extendConfig = extendResult.config;\n        const extendValidation = validate(extendConfig, configSchema, {\n            allowUnknownAttributes: false,\n            propertyName: CONFIG_NAME,\n        });\n        if (extendValidation.errors && extendValidation.errors.length > 0) {\n            handleValidationErrors(result.filepath, extendValidation.errors);\n            process.exit(1);\n        }\n        if (extendConfig.plugins) {\n            const extendConfigDir = path.dirname(extendConfigLoc);\n            extendConfig.plugins = extendConfig.plugins.map((plugin) => {\n                const name = Array.isArray(plugin) ? plugin[0] : plugin;\n                const absName = path.isAbsolute(name)\n                    ? name\n                    : require.resolve(name, { paths: [extendConfigDir] });\n                if (Array.isArray(plugin)) {\n                    plugin.splice(0, 1, absName);\n                    return plugin;\n                }\n                return absName;\n            });\n        }\n    }\n    // if valid, apply config over defaults\n    const mergedConfig = merge([\n        pkgManifest.homepage ? { buildOptions: { baseUrl: pkgManifest.homepage } } : {},\n        extendConfig,\n        { webDependencies: pkgManifest.webDependencies },\n        config,\n        cliConfig,\n    ]);\n    for (const webDependencyName of Object.keys(mergedConfig.webDependencies || {})) {\n        if (pkgManifest.dependencies && pkgManifest.dependencies[webDependencyName]) {\n            handleConfigError(`\"${webDependencyName}\" is included in \"webDependencies\". Please remove it from your package.json \"dependencies\" config.`);\n        }\n        if (pkgManifest.devDependencies && pkgManifest.devDependencies[webDependencyName]) {\n            handleConfigError(`\"${webDependencyName}\" is included in \"webDependencies\". Please remove it from your package.json \"devDependencies\" config.`);\n        }\n    }\n    const [validationErrors, configResult] = createConfiguration(mergedConfig);\n    if (validationErrors) {\n        handleValidationErrors(result.filepath, validationErrors);\n        process.exit(1);\n    }\n    return configResult;\n}\n","import path from 'path';\nimport { validatePluginLoadResult } from '../config';\nimport { logger } from '../logger';\nimport { getExt, readFile, replaceExt } from '../util';\nexport function getInputsFromOutput(fileLoc, plugins) {\n    const srcFile = replaceExt(fileLoc, '.map', ''); // if this is a .map file, try loading source\n    const { baseExt } = getExt(srcFile);\n    const potentialInputs = new Set([srcFile]);\n    for (const plugin of plugins) {\n        if (plugin.resolve && plugin.resolve.output.includes(baseExt)) {\n            plugin.resolve.input.forEach((input) => potentialInputs.add(replaceExt(srcFile, baseExt, input)));\n        }\n    }\n    return Array.from(potentialInputs);\n}\n/**\n * Build Plugin First Pass: If a plugin defines a\n * `resolve` object, check it against the current\n * file's extension. If it matches, call the load()\n * functon and return it's result.\n *\n * If no match is found, fall back to just reading\n * the file from disk and return it.\n */\nasync function runPipelineLoadStep(srcPath, { isDev, isHmrEnabled, isExitOnBuild, plugins, sourceMaps }) {\n    const srcExt = getExt(srcPath).baseExt;\n    for (const step of plugins) {\n        if (!step.resolve || !step.resolve.input.includes(srcExt)) {\n            continue;\n        }\n        if (!step.load) {\n            continue;\n        }\n        try {\n            const debugPath = path.relative(process.cwd(), srcPath);\n            logger.debug(`load() starting… [${debugPath}]`, { name: step.name });\n            const result = await step.load({\n                fileExt: srcExt,\n                filePath: srcPath,\n                isDev,\n                isHmrEnabled,\n            });\n            logger.debug(`✔ load() success [${debugPath}]`, { name: step.name });\n            validatePluginLoadResult(step, result);\n            if (typeof result === 'string' || Buffer.isBuffer(result)) {\n                const mainOutputExt = step.resolve.output[0];\n                return {\n                    [mainOutputExt]: {\n                        code: result,\n                    },\n                };\n            }\n            else if (result && typeof result === 'object') {\n                Object.keys(result).forEach((ext) => {\n                    const output = result[ext];\n                    // normalize to {code, map} format\n                    if (typeof output === 'string')\n                        result[ext] = { code: output };\n                    // ensure source maps are strings (it’s easy for plugins to pass back a JSON object)\n                    if (result[ext].map && typeof result[ext].map === 'object')\n                        result[ext].map = JSON.stringify(result[ext].map);\n                    // if source maps disabled, don’t return any\n                    if (!sourceMaps)\n                        result[ext].map = undefined;\n                });\n                return result;\n            }\n        }\n        catch (err) {\n            // note: for many plugins like Babel, `err.toString()` is needed to display full output\n            logger.error(err.toString() || err, { name: step.name });\n            if (isExitOnBuild) {\n                process.exit(1);\n            }\n        }\n    }\n    return {\n        [srcExt]: {\n            code: await readFile(srcPath),\n        },\n    };\n}\n/**\n * Build Plugin Second Pass: If a plugin defines a\n * transform() method,call it. Transform cannot change\n * the file extension, and was designed to run on\n * every file type and return null/undefined if no\n * change needed.\n */\nasync function runPipelineTransformStep(output, srcPath, { isDev, isExitOnBuild, plugins, sourceMaps }) {\n    const srcExt = getExt(srcPath).baseExt;\n    const rootFilePath = srcPath.replace(srcExt, '');\n    const rootFileName = path.basename(rootFilePath);\n    for (const step of plugins) {\n        if (!step.transform) {\n            continue;\n        }\n        try {\n            for (const destExt of Object.keys(output)) {\n                const destBuildFile = output[destExt];\n                const { code } = destBuildFile;\n                const fileName = rootFileName + destExt;\n                const filePath = rootFilePath + destExt;\n                const debugPath = path.relative(process.cwd(), filePath);\n                logger.debug(`transform() starting… [${debugPath}]`, { name: step.name });\n                const result = await step.transform({\n                    contents: code,\n                    isDev,\n                    fileExt: destExt,\n                    id: filePath,\n                    // @ts-ignore: Deprecated\n                    filePath: fileName,\n                    // @ts-ignore: Deprecated\n                    urlPath: `./${path.basename(rootFileName + destExt)}`,\n                });\n                logger.debug(`✔ transform() success [${debugPath}]`, { name: step.name });\n                // if step returned a value, only update code (don’t touch .map)\n                if (typeof result === 'string' || Buffer.isBuffer(result)) {\n                    output[destExt].code = result;\n                    output[destExt].map = undefined;\n                }\n                else if (result && typeof result === 'object' && result.result) {\n                    output[destExt].code = result.result;\n                    output[destExt].map = undefined;\n                }\n                // if source maps disabled, don’t return any\n                if (!sourceMaps)\n                    output[destExt].map = undefined;\n            }\n        }\n        catch (err) {\n            // note: for many plugins like Babel, `err.toString()` is needed to display full output\n            logger.error(err.toString() || err, { name: step.name });\n            if (isExitOnBuild) {\n                process.exit(1);\n            }\n        }\n    }\n    return output;\n}\nexport async function runPipelineOptimizeStep(buildDirectory, { plugins }) {\n    for (const step of plugins) {\n        if (!step.optimize) {\n            continue;\n        }\n        try {\n            logger.debug('optimize() starting…', { name: step.name });\n            await step.optimize({\n                buildDirectory,\n                // @ts-ignore: internal API only\n                log: (msg) => {\n                    logger.info(msg, { name: step.name });\n                },\n            });\n            logger.debug('✔ optimize() success', { name: step.name });\n        }\n        catch (err) {\n            logger.error(err.toString() || err, { name: step.name });\n            process.exit(1); // exit on error\n        }\n    }\n    return null;\n}\nexport async function runPipelineCleanupStep({ plugins }) {\n    for (const step of plugins) {\n        if (!step.cleanup) {\n            continue;\n        }\n        await step.cleanup();\n    }\n}\n/** Core Snowpack file pipeline builder */\nexport async function buildFile(srcPath, buildFileOptions) {\n    // Pass 1: Find the first plugin to load this file, and return the result\n    const loadResult = await runPipelineLoadStep(srcPath, buildFileOptions);\n    // Pass 2: Pass that result through every plugin transform() method.\n    const transformResult = await runPipelineTransformStep(loadResult, srcPath, buildFileOptions);\n    // Return the final build result.\n    return transformResult;\n}\n","import fs from 'fs';\nimport path from 'path';\nimport { findMatchingAliasEntry, getExt, relativeURL, replaceExt, URL_HAS_PROTOCOL_REGEX, } from '../util';\nimport srcFileExtensionMapping from './src-file-extension-mapping';\nconst cwd = process.cwd();\n/** Perform a file disk lookup for the requested import specifier. */\nexport function getImportStats(dirLoc, spec) {\n    const importedFileOnDisk = path.resolve(dirLoc, spec);\n    try {\n        return fs.statSync(importedFileOnDisk);\n    }\n    catch (err) {\n        // file doesn't exist, that's fine\n    }\n    return false;\n}\n/** Resolve an import based on the state of the file/folder found on disk. */\nfunction resolveSourceSpecifier(spec, stats, config) {\n    if (stats && stats.isDirectory()) {\n        const trailingSlash = spec.endsWith('/') ? '' : '/';\n        spec = spec + trailingSlash + 'index.js';\n    }\n    else if (!stats && !spec.endsWith('.js') && !spec.endsWith('.css')) {\n        spec = spec + '.js';\n    }\n    const { baseExt } = getExt(spec);\n    const extToReplace = config._extensionMap[baseExt] || srcFileExtensionMapping[baseExt];\n    if (extToReplace) {\n        spec = replaceExt(spec, baseExt, extToReplace);\n    }\n    return spec;\n}\n/**\n * Create a import resolver function, which converts any import relative to the given file at \"fileLoc\"\n * to a proper URL. Returns false if no matching import was found, which usually indicates a package\n * not found in the import map.\n */\nexport function createImportResolver({ fileLoc, dependencyImportMap, config, }) {\n    return function importResolver(spec) {\n        if (URL_HAS_PROTOCOL_REGEX.test(spec)) {\n            return spec;\n        }\n        if (spec.startsWith('/') || spec.startsWith('./') || spec.startsWith('../')) {\n            const importStats = getImportStats(path.dirname(fileLoc), spec);\n            spec = resolveSourceSpecifier(spec, importStats, config);\n            return spec;\n        }\n        const aliasEntry = findMatchingAliasEntry(config, spec);\n        if (aliasEntry && aliasEntry.type === 'path') {\n            const { from, to } = aliasEntry;\n            let result = spec.replace(from, to);\n            const importStats = getImportStats(cwd, result);\n            result = resolveSourceSpecifier(result, importStats, config);\n            // replace Windows backslashes at the end, after resolution\n            result = relativeURL(path.dirname(fileLoc), result);\n            return result;\n        }\n        if (dependencyImportMap) {\n            // NOTE: We don't need special handling for an alias here, since the aliased \"from\"\n            // is already the key in the import map. The aliased \"to\" value is also an entry.\n            const importMapEntry = dependencyImportMap.imports[spec];\n            if (importMapEntry) {\n                return path.posix.resolve(config.buildOptions.webModulesUrl, importMapEntry);\n            }\n        }\n        return false;\n    };\n}\n","import { HTML_JS_REGEX, CSS_REGEX } from './util';\nimport { matchDynamicImportValue } from './scan-imports';\nconst { parse } = require('es-module-lexer');\nfunction spliceString(source, withSlice, start, end) {\n    return source.slice(0, start) + (withSlice || '') + source.slice(end);\n}\nexport async function scanCodeImportsExports(code) {\n    const [imports] = await parse(code);\n    return imports.filter((imp) => {\n        //imp.d = -2 = import.meta.url = we can skip this for now\n        if (imp.d === -2) {\n            return false;\n        }\n        // imp.d > -1 === dynamic import\n        if (imp.d > -1) {\n            const importStatement = code.substring(imp.s, imp.e);\n            return !!matchDynamicImportValue(importStatement);\n        }\n        return true;\n    });\n}\nexport async function transformEsmImports(_code, replaceImport) {\n    const imports = await scanCodeImportsExports(_code);\n    let rewrittenCode = _code;\n    for (const imp of imports.reverse()) {\n        let spec = rewrittenCode.substring(imp.s, imp.e);\n        if (imp.d > -1) {\n            spec = matchDynamicImportValue(spec) || '';\n        }\n        let rewrittenImport = replaceImport(spec);\n        if (imp.d > -1) {\n            rewrittenImport = JSON.stringify(rewrittenImport);\n        }\n        rewrittenCode = spliceString(rewrittenCode, rewrittenImport, imp.s, imp.e);\n    }\n    return rewrittenCode;\n}\nasync function transformHtmlImports(code, replaceImport) {\n    let rewrittenCode = code;\n    let match;\n    const importRegex = new RegExp(HTML_JS_REGEX);\n    while ((match = importRegex.exec(rewrittenCode))) {\n        const [, scriptTag, scriptCode] = match;\n        // Only transform a script element if it contains inlined code / is not empty.\n        if (scriptCode.trim()) {\n            rewrittenCode = spliceString(rewrittenCode, await transformEsmImports(scriptCode, replaceImport), match.index + scriptTag.length, match.index + scriptTag.length + scriptCode.length);\n        }\n    }\n    return rewrittenCode;\n}\nasync function transformCssImports(code, replaceImport) {\n    let rewrittenCode = code;\n    let match;\n    const importRegex = new RegExp(CSS_REGEX);\n    while ((match = importRegex.exec(rewrittenCode))) {\n        const [fullMatch, spec] = match;\n        // Only transform a script element if it contains inlined code / is not empty.\n        rewrittenCode = spliceString(rewrittenCode, `@import \"${replaceImport(spec)}\";`, match.index, match.index + fullMatch.length);\n    }\n    return rewrittenCode;\n}\nexport async function transformFileImports({ baseExt, contents }, replaceImport) {\n    if (baseExt === '.js') {\n        return transformEsmImports(contents, replaceImport);\n    }\n    if (baseExt === '.html') {\n        return transformHtmlImports(contents, replaceImport);\n    }\n    if (baseExt === '.css') {\n        return transformCssImports(contents, replaceImport);\n    }\n    throw new Error(`Incompatible filetype: cannot scan ${baseExt} files for ESM imports. This is most likely an error within Snowpack.`);\n}\n","import WebSocket from 'ws';\nconst DEFAULT_PORT = 12321;\nexport class EsmHmrEngine {\n    constructor(options = {}) {\n        this.clients = new Set();\n        this.dependencyTree = new Map();\n        this.wsUrl = `ws://localhost:${DEFAULT_PORT}`;\n        const wss = options.server\n            ? new WebSocket.Server({ noServer: true })\n            : new WebSocket.Server({ port: DEFAULT_PORT });\n        if (options.server) {\n            options.server.on('upgrade', (req, socket, head) => {\n                // Only handle upgrades to ESM-HMR requests, ignore others.\n                if (req.headers['sec-websocket-protocol'] !== 'esm-hmr') {\n                    return;\n                }\n                wss.handleUpgrade(req, socket, head, (client) => {\n                    wss.emit('connection', client, req);\n                });\n            });\n        }\n        wss.on('connection', (client) => {\n            this.connectClient(client);\n            this.registerListener(client);\n        });\n    }\n    registerListener(client) {\n        client.on('message', (data) => {\n            const message = JSON.parse(data.toString());\n            if (message.type === 'hotAccept') {\n                const entry = this.getEntry(message.id, true);\n                entry.isHmrAccepted = true;\n                entry.isHmrEnabled = true;\n            }\n        });\n    }\n    createEntry(sourceUrl) {\n        const newEntry = {\n            dependencies: new Set(),\n            dependents: new Set(),\n            needsReplacement: false,\n            needsReplacementCount: 0,\n            isHmrEnabled: false,\n            isHmrAccepted: false,\n        };\n        this.dependencyTree.set(sourceUrl, newEntry);\n        return newEntry;\n    }\n    getEntry(sourceUrl, createIfNotFound = false) {\n        const result = this.dependencyTree.get(sourceUrl);\n        if (result) {\n            return result;\n        }\n        if (createIfNotFound) {\n            return this.createEntry(sourceUrl);\n        }\n        return null;\n    }\n    setEntry(sourceUrl, imports, isHmrEnabled = false) {\n        const result = this.getEntry(sourceUrl, true);\n        const outdatedDependencies = new Set(result.dependencies);\n        result.isHmrEnabled = isHmrEnabled;\n        for (const importUrl of imports) {\n            this.addRelationship(sourceUrl, importUrl);\n            outdatedDependencies.delete(importUrl);\n        }\n        for (const importUrl of outdatedDependencies) {\n            this.removeRelationship(sourceUrl, importUrl);\n        }\n    }\n    removeRelationship(sourceUrl, importUrl) {\n        let importResult = this.getEntry(importUrl);\n        importResult && importResult.dependents.delete(sourceUrl);\n        const sourceResult = this.getEntry(sourceUrl);\n        sourceResult && sourceResult.dependencies.delete(importUrl);\n    }\n    addRelationship(sourceUrl, importUrl) {\n        if (importUrl !== sourceUrl) {\n            let importResult = this.getEntry(importUrl, true);\n            importResult.dependents.add(sourceUrl);\n            const sourceResult = this.getEntry(sourceUrl, true);\n            sourceResult.dependencies.add(importUrl);\n        }\n    }\n    markEntryForReplacement(entry, state) {\n        if (state) {\n            entry.needsReplacementCount++;\n        }\n        else {\n            entry.needsReplacementCount--;\n        }\n        entry.needsReplacement = !!entry.needsReplacementCount;\n    }\n    broadcastMessage(data) {\n        this.clients.forEach((client) => {\n            if (client.readyState === WebSocket.OPEN) {\n                client.send(JSON.stringify(data));\n            }\n            else {\n                this.disconnectClient(client);\n            }\n        });\n    }\n    connectClient(client) {\n        this.clients.add(client);\n    }\n    disconnectClient(client) {\n        client.terminate();\n        this.clients.delete(client);\n    }\n    disconnectAllClients() {\n        for (const client of this.clients) {\n            this.disconnectClient(client);\n        }\n    }\n}\n","import merge from 'deepmerge';\nimport { promises as fs } from 'fs';\nimport glob from 'glob';\nimport * as colors from 'kleur/colors';\nimport mkdirp from 'mkdirp';\nimport PQueue from 'p-queue';\nimport path from 'path';\nimport { performance } from 'perf_hooks';\nimport rimraf from 'rimraf';\nimport url from 'url';\nimport { generateEnvModule, wrapHtmlResponse, wrapImportMeta, wrapImportProxy, } from '../build/build-import-proxy';\nimport { buildFile, runPipelineCleanupStep, runPipelineOptimizeStep } from '../build/build-pipeline';\nimport { createImportResolver } from '../build/import-resolver';\nimport { logger } from '../logger';\nimport { transformFileImports } from '../rewrite-imports';\nimport { cssSourceMappingURL, jsSourceMappingURL, readFile, relativeURL, removeLeadingSlash, replaceExt, HMR_CLIENT_CODE, } from '../util';\nimport { getInstallTargets, run as installRunner } from './install';\nimport { EsmHmrEngine } from '../hmr-server-engine';\nconst CONCURRENT_WORKERS = require('os').cpus().length;\nlet hmrEngine = null;\nfunction getIsHmrEnabled(config) {\n    return config.buildOptions.watch && !!config.devOptions.hmr;\n}\nasync function installOptimizedDependencies(scannedFiles, installDest, commandOptions) {\n    const installConfig = merge(commandOptions.config, {\n        installOptions: {\n            dest: installDest,\n            env: { NODE_ENV: process.env.NODE_ENV || 'production' },\n            treeshake: commandOptions.config.buildOptions.watch\n                ? false\n                : commandOptions.config.installOptions.treeshake ?? true,\n        },\n    });\n    // Unlike dev (where we scan from source code) the built output guarantees that we\n    // will can scan all used entrypoints. Set to `[]` to improve tree-shaking performance.\n    installConfig.knownEntrypoints = [];\n    // 1. Scan imports from your final built JS files.\n    const installTargets = await getInstallTargets(installConfig, scannedFiles);\n    // 2. Install dependencies, based on the scan of your final build.\n    const installResult = await installRunner({\n        ...commandOptions,\n        installTargets,\n        config: installConfig,\n    });\n    return installResult;\n}\n/**\n * FileBuilder - This class is responsible for building a file. It is broken into\n * individual stages so that the entire application build process can be tackled\n * in stages (build -> resolve -> write to disk).\n */\nclass FileBuilder {\n    constructor({ filepath, outDir, config, }) {\n        this.output = {};\n        this.filesToResolve = {};\n        this.filesToProxy = [];\n        this.filepath = filepath;\n        this.outDir = outDir;\n        this.config = config;\n    }\n    async buildFile(isExitOnBuild) {\n        this.filesToResolve = {};\n        const srcExt = path.extname(this.filepath);\n        const builtFileOutput = await buildFile(this.filepath, {\n            plugins: this.config.plugins,\n            isDev: false,\n            isExitOnBuild,\n            isHmrEnabled: false,\n            sourceMaps: this.config.buildOptions.sourceMaps,\n        });\n        for (const [fileExt, buildResult] of Object.entries(builtFileOutput)) {\n            let { code, map } = buildResult;\n            if (!code) {\n                continue;\n            }\n            const outFilename = replaceExt(path.basename(this.filepath), srcExt, fileExt);\n            const outLoc = path.join(this.outDir, outFilename);\n            const sourceMappingURL = outFilename + '.map';\n            if (typeof code === 'string') {\n                switch (fileExt) {\n                    case '.css': {\n                        if (map)\n                            code = cssSourceMappingURL(code, sourceMappingURL);\n                        this.filesToResolve[outLoc] = {\n                            baseExt: fileExt,\n                            expandedExt: fileExt,\n                            contents: code,\n                            locOnDisk: this.filepath,\n                        };\n                        break;\n                    }\n                    case '.js': {\n                        if (builtFileOutput['.css']) {\n                            // inject CSS if imported directly\n                            const cssFilename = outFilename.replace(/\\.js$/i, '.css');\n                            code = `import './${cssFilename}';\\n` + code;\n                        }\n                        code = wrapImportMeta({ code, env: true, hmr: false, config: this.config });\n                        if (map)\n                            code = jsSourceMappingURL(code, sourceMappingURL);\n                        this.filesToResolve[outLoc] = {\n                            baseExt: fileExt,\n                            expandedExt: fileExt,\n                            contents: code,\n                            locOnDisk: this.filepath,\n                        };\n                        break;\n                    }\n                    case '.html': {\n                        code = wrapHtmlResponse({\n                            code,\n                            hmr: getIsHmrEnabled(this.config),\n                            isDev: false,\n                            config: this.config,\n                            mode: 'production',\n                        });\n                        this.filesToResolve[outLoc] = {\n                            baseExt: fileExt,\n                            expandedExt: fileExt,\n                            contents: code,\n                            locOnDisk: this.filepath,\n                        };\n                        break;\n                    }\n                }\n            }\n            this.output[outLoc] = code;\n            if (map) {\n                this.output[path.join(this.outDir, sourceMappingURL)] = map;\n            }\n        }\n    }\n    async resolveImports(importMap) {\n        let isSuccess = true;\n        this.filesToProxy = [];\n        for (const [outLoc, rawFile] of Object.entries(this.filesToResolve)) {\n            // don’t transform binary file contents\n            if (Buffer.isBuffer(rawFile.contents)) {\n                continue;\n            }\n            const file = rawFile;\n            const resolveImportSpecifier = createImportResolver({\n                fileLoc: file.locOnDisk,\n                dependencyImportMap: importMap,\n                config: this.config,\n            });\n            const resolvedCode = await transformFileImports(file, (spec) => {\n                // Try to resolve the specifier to a known URL in the project\n                let resolvedImportUrl = resolveImportSpecifier(spec);\n                // NOTE: If the import cannot be resolved, we'll need to re-install\n                // your dependencies. We don't support this yet, but we will.\n                // Until supported, just exit here.\n                if (!resolvedImportUrl) {\n                    isSuccess = false;\n                    logger.error(`${file.locOnDisk} - Could not resolve unknown import \"${spec}\".`);\n                    return spec;\n                }\n                // Ignore \"http://*\" imports\n                if (url.parse(resolvedImportUrl).protocol) {\n                    return spec;\n                }\n                // Handle normal \"./\" & \"../\" import specifiers\n                const importExtName = path.extname(resolvedImportUrl);\n                const isProxyImport = importExtName &&\n                    (file.baseExt === '.js' || file.baseExt === '.html') &&\n                    importExtName !== '.js';\n                const isAbsoluteUrlPath = path.posix.isAbsolute(resolvedImportUrl);\n                let resolvedImportPath = removeLeadingSlash(path.normalize(resolvedImportUrl));\n                // We treat \".proxy.js\" files special: we need to make sure that they exist on disk\n                // in the final build, so we mark them to be written to disk at the next step.\n                if (isProxyImport) {\n                    if (isAbsoluteUrlPath) {\n                        this.filesToProxy.push(path.resolve(this.config.devOptions.out, resolvedImportPath));\n                    }\n                    else {\n                        this.filesToProxy.push(path.resolve(path.dirname(outLoc), resolvedImportPath));\n                    }\n                }\n                if (isProxyImport) {\n                    resolvedImportPath = resolvedImportPath + '.proxy.js';\n                    resolvedImportUrl = resolvedImportUrl + '.proxy.js';\n                }\n                // When dealing with an absolute import path, we need to honor the baseUrl\n                if (isAbsoluteUrlPath) {\n                    resolvedImportUrl = relativeURL(path.dirname(outLoc), path.resolve(this.config.devOptions.out, resolvedImportPath));\n                }\n                // Make sure that a relative URL always starts with \"./\"\n                if (!resolvedImportUrl.startsWith('.') && !resolvedImportUrl.startsWith('/')) {\n                    resolvedImportUrl = './' + resolvedImportUrl;\n                }\n                return resolvedImportUrl;\n            });\n            this.output[outLoc] = resolvedCode;\n        }\n        return isSuccess;\n    }\n    async writeToDisk() {\n        mkdirp.sync(this.outDir);\n        for (const [outLoc, code] of Object.entries(this.output)) {\n            const encoding = typeof code === 'string' ? 'utf-8' : undefined;\n            await fs.writeFile(outLoc, code, encoding);\n        }\n    }\n    async writeProxyToDisk(originalFileLoc) {\n        const proxiedCode = this.output[originalFileLoc];\n        const importProxyFileLoc = originalFileLoc + '.proxy.js';\n        const proxiedUrl = originalFileLoc\n            .substr(this.config.devOptions.out.length)\n            .replace(/\\\\/g, '/');\n        const proxyCode = await wrapImportProxy({\n            url: proxiedUrl,\n            code: proxiedCode,\n            hmr: false,\n            config: this.config,\n        });\n        await fs.writeFile(importProxyFileLoc, proxyCode, 'utf-8');\n    }\n}\nexport async function command(commandOptions) {\n    const { cwd, config } = commandOptions;\n    const buildDirectoryLoc = config.devOptions.out;\n    const internalFilesBuildLoc = path.join(buildDirectoryLoc, config.buildOptions.metaDir);\n    const mountedDirectories = Object.entries(config.mount).map(([fromDisk, toUrl]) => {\n        return [\n            path.resolve(cwd, fromDisk),\n            path.resolve(buildDirectoryLoc, removeLeadingSlash(toUrl)),\n        ];\n    });\n    if (config.buildOptions.clean) {\n        rimraf.sync(buildDirectoryLoc);\n    }\n    mkdirp.sync(buildDirectoryLoc);\n    mkdirp.sync(internalFilesBuildLoc);\n    for (const runPlugin of config.plugins) {\n        if (runPlugin.run) {\n            await runPlugin\n                .run({\n                isDev: false,\n                isHmrEnabled: false,\n                // @ts-ignore: internal API only\n                log: (msg, data = {}) => {\n                    if (msg === 'WORKER_MSG') {\n                        logger.info(`[${runPlugin.name}] ${data.msg.trim()}`);\n                    }\n                },\n            })\n                .catch((err) => {\n                logger.error(err.toString(), { name: runPlugin.name });\n                process.exit(1);\n            });\n        }\n    }\n    // Write the `import.meta.env` contents file to disk\n    await fs.writeFile(path.join(internalFilesBuildLoc, 'env.js'), generateEnvModule('production'));\n    if (getIsHmrEnabled(config)) {\n        await fs.writeFile(path.resolve(internalFilesBuildLoc, 'hmr.js'), HMR_CLIENT_CODE);\n        hmrEngine = new EsmHmrEngine();\n    }\n    logger.info(colors.yellow('! building source…'));\n    const buildStart = performance.now();\n    const buildPipelineFiles = {};\n    /** Install all needed dependencies, based on the master buildPipelineFiles list.  */\n    async function installDependencies() {\n        const scannedFiles = Object.values(buildPipelineFiles)\n            .map((f) => Object.values(f.filesToResolve))\n            .reduce((flat, item) => flat.concat(item), []);\n        const installDest = path.join(buildDirectoryLoc, config.buildOptions.webModulesUrl);\n        const installResult = await installOptimizedDependencies(scannedFiles, installDest, {\n            ...commandOptions,\n        });\n        if (!installResult.success || installResult.hasError || !installResult.importMap) {\n            process.exit(1);\n        }\n        const allFiles = glob.sync(`**/*`, {\n            cwd: installDest,\n            absolute: true,\n            nodir: true,\n            dot: true,\n        });\n        for (const installedFileLoc of allFiles) {\n            if (!installedFileLoc.endsWith('import-map.json') &&\n                path.extname(installedFileLoc) !== '.js') {\n                const proxiedCode = await readFile(installedFileLoc);\n                const importProxyFileLoc = installedFileLoc + '.proxy.js';\n                const proxiedUrl = installedFileLoc.substr(buildDirectoryLoc.length).replace(/\\\\/g, '/');\n                const proxyCode = await wrapImportProxy({\n                    url: proxiedUrl,\n                    code: proxiedCode,\n                    hmr: false,\n                    config: config,\n                });\n                await fs.writeFile(importProxyFileLoc, proxyCode, 'utf-8');\n            }\n        }\n        return installResult;\n    }\n    // 0. Find all source files.\n    for (const [fromDisk, dirDest] of mountedDirectories) {\n        const allFiles = glob.sync(`**/*`, {\n            ignore: config.exclude,\n            cwd: fromDisk,\n            absolute: true,\n            nodir: true,\n            dot: true,\n        });\n        for (const rawLocOnDisk of allFiles) {\n            const locOnDisk = path.resolve(rawLocOnDisk); // this is necessary since glob.sync() returns paths with / on windows.  path.resolve() will switch them to the native path separator.\n            const finalDest = locOnDisk.replace(fromDisk, dirDest);\n            const outDir = path.dirname(finalDest);\n            const buildPipelineFile = new FileBuilder({ filepath: locOnDisk, outDir, config });\n            buildPipelineFiles[locOnDisk] = buildPipelineFile;\n        }\n    }\n    // 1. Build all files for the first time, from source.\n    const parallelWorkQueue = new PQueue({ concurrency: CONCURRENT_WORKERS });\n    const allBuildPipelineFiles = Object.values(buildPipelineFiles);\n    for (const buildPipelineFile of allBuildPipelineFiles) {\n        parallelWorkQueue.add(() => buildPipelineFile.buildFile(true));\n    }\n    await parallelWorkQueue.onIdle();\n    const buildEnd = performance.now();\n    logger.info(`${colors.green('✔')} build complete ${colors.dim(`[${((buildEnd - buildStart) / 1000).toFixed(2)}s]`)}`);\n    // 2. Install all dependencies. This gets us the import map we need to resolve imports.\n    let installResult = await installDependencies();\n    // 3. Resolve all built file imports.\n    for (const buildPipelineFile of allBuildPipelineFiles) {\n        parallelWorkQueue.add(() => buildPipelineFile.resolveImports(installResult.importMap));\n    }\n    await parallelWorkQueue.onIdle();\n    // 4. Write files to disk.\n    const allImportProxyFiles = new Set(allBuildPipelineFiles.map((b) => b.filesToProxy).reduce((flat, item) => flat.concat(item), []));\n    for (const buildPipelineFile of allBuildPipelineFiles) {\n        parallelWorkQueue.add(() => buildPipelineFile.writeToDisk());\n        for (const builtFile of Object.keys(buildPipelineFile.output)) {\n            if (allImportProxyFiles.has(builtFile)) {\n                parallelWorkQueue.add(() => buildPipelineFile.writeProxyToDisk(builtFile));\n            }\n        }\n    }\n    await parallelWorkQueue.onIdle();\n    // 5. Optimize the build.\n    if (!config.buildOptions.watch) {\n        await runPipelineCleanupStep(config);\n        await runPipelineOptimizeStep(buildDirectoryLoc, {\n            plugins: config.plugins,\n            isDev: false,\n            isExitOnBuild: false,\n            isHmrEnabled: false,\n            sourceMaps: config.buildOptions.sourceMaps,\n        });\n        logger.info(`${colors.underline(colors.green(colors.bold('▶ Build Complete!')))}\\n\\n`);\n        return;\n    }\n    // \"--watch --hmr\" mode - Tell users about the HMR WebSocket URL\n    if (hmrEngine) {\n        logger.info(`[HMR] WebSocket URL available at ${colors.cyan(`${hmrEngine.wsUrl}`)}`);\n    }\n    // \"--watch\" mode - Start watching the file system.\n    // Defer \"chokidar\" loading to here, to reduce impact on overall startup time\n    logger.info(colors.cyan('Watching for changes...'));\n    const chokidar = await import('chokidar');\n    function onDeleteEvent(fileLoc) {\n        delete buildPipelineFiles[fileLoc];\n    }\n    async function onWatchEvent(fileLoc) {\n        logger.info(colors.cyan('File changed...'));\n        const [fromDisk, dirDest] = mountedDirectories.find(([fromDisk]) => fileLoc.startsWith(fromDisk)) || [];\n        if (!fromDisk || !dirDest) {\n            return;\n        }\n        const finalDest = fileLoc.replace(fromDisk, dirDest);\n        const outDir = path.dirname(finalDest);\n        const changedPipelineFile = new FileBuilder({ filepath: fileLoc, outDir, config });\n        buildPipelineFiles[fileLoc] = changedPipelineFile;\n        // 1. Build the file.\n        await changedPipelineFile.buildFile(false).catch((err) => {\n            logger.error(err.message, { name: changedPipelineFile.filepath });\n        });\n        // 2. Resolve any ESM imports. Handle new imports by triggering a re-install.\n        let resolveSuccess = await changedPipelineFile.resolveImports(installResult.importMap);\n        if (!resolveSuccess) {\n            await installDependencies();\n            resolveSuccess = await changedPipelineFile.resolveImports(installResult.importMap);\n            if (!resolveSuccess) {\n                logger.error('Exiting...');\n                process.exit(1);\n            }\n        }\n        // 3. Write to disk. If any proxy imports are needed, write those as well.\n        await changedPipelineFile.writeToDisk();\n        const allBuildPipelineFiles = Object.values(buildPipelineFiles);\n        const allImportProxyFiles = new Set(allBuildPipelineFiles\n            .map((b) => b.filesToProxy)\n            .reduce((flat, item) => flat.concat(item), []));\n        for (const builtFile of Object.keys(changedPipelineFile.output)) {\n            if (allImportProxyFiles.has(builtFile)) {\n                await changedPipelineFile.writeProxyToDisk(builtFile);\n            }\n        }\n        if (hmrEngine) {\n            hmrEngine.broadcastMessage({ type: 'reload' });\n        }\n    }\n    const watcher = chokidar.watch(mountedDirectories.map(([dirDisk]) => dirDisk), {\n        ignored: config.exclude,\n        ignoreInitial: true,\n        persistent: true,\n        disableGlobbing: false,\n    });\n    watcher.on('add', (fileLoc) => onWatchEvent(fileLoc));\n    watcher.on('change', (fileLoc) => onWatchEvent(fileLoc));\n    watcher.on('unlink', (fileLoc) => onDeleteEvent(fileLoc));\n    // We intentionally never want to exit in watch mode!\n    return new Promise(() => { });\n}\n","import detectPort from 'detect-port';\nimport * as colors from 'kleur/colors';\nimport path from 'path';\nimport readline from 'readline';\nimport { logger } from '../logger';\nconst cwd = process.cwd();\nexport const paintEvent = {\n    BUILD_FILE: 'BUILD_FILE',\n    LOAD_ERROR: 'LOAD_ERROR',\n    SERVER_RESPONSE: 'SERVER_RESPONSE',\n    SERVER_START: 'SERVER_START',\n    WORKER_COMPLETE: 'WORKER_COMPLETE',\n    WORKER_MSG: 'WORKER_MSG',\n    WORKER_RESET: 'WORKER_RESET',\n    WORKER_UPDATE: 'WORKER_UPDATE',\n};\n/**\n * Get the actual port, based on the `defaultPort`.\n * If the default port was not available, then we'll prompt the user if its okay\n * to use the next available port.\n */\nexport async function getPort(defaultPort) {\n    const bestAvailablePort = await detectPort(defaultPort);\n    if (defaultPort !== bestAvailablePort) {\n        let useNextPort = false;\n        if (process.stdout.isTTY) {\n            const rl = readline.createInterface({ input: process.stdin, output: process.stdout });\n            useNextPort = await new Promise((resolve) => {\n                rl.question(colors.yellow(`! Port ${colors.bold(defaultPort)} not available. Run on port ${colors.bold(bestAvailablePort)} instead? (Y/n) `), (answer) => {\n                    resolve(!/^no?$/i.test(answer));\n                });\n            });\n            rl.close();\n        }\n        if (!useNextPort) {\n            logger.error(`✘ Port ${colors.bold(defaultPort)} not available. Use ${colors.bold('--port')} to specify a different port.`);\n            process.exit(1);\n        }\n    }\n    return bestAvailablePort;\n}\nconst WORKER_BASE_STATE = { done: false, error: null, state: null, output: '' };\nexport function paint(bus, plugins) {\n    let port;\n    let hostname;\n    let protocol = '';\n    let startTimeMs;\n    let ips = [];\n    const allWorkerStates = {};\n    const allFileBuilds = new Set();\n    for (const plugin of plugins) {\n        allWorkerStates[plugin] = { ...WORKER_BASE_STATE };\n    }\n    function setupWorker(id) {\n        if (!allWorkerStates[id]) {\n            allWorkerStates[id] = { ...WORKER_BASE_STATE };\n        }\n    }\n    function repaint() {\n        // Clear Page\n        process.stdout.write(process.platform === 'win32' ? '\\x1B[2J\\x1B[0f' : '\\x1B[2J\\x1B[3J\\x1B[H');\n        // Header\n        process.stdout.write(`${colors.bold(`snowpack`)}\\n\\n`);\n        // Server Stats\n        const isServerStarted = startTimeMs > 0 && port > 0 && protocol;\n        if (isServerStarted) {\n            process.stdout.write(`  ${colors.bold(colors.cyan(`${protocol}//${hostname}:${port}`))}`);\n            for (const ip of ips) {\n                process.stdout.write(`${colors.cyan(` • `)}${colors.bold(colors.cyan(`${protocol}//${ip}:${port}`))}`);\n            }\n            process.stdout.write('\\n');\n            process.stdout.write(colors.dim(startTimeMs < 1000 ? `  Server started in ${startTimeMs}ms.` : `  Server started.`));\n            if (allFileBuilds.size > 0) {\n                process.stdout.write(colors.dim(` Building...`));\n            }\n            process.stdout.write('\\n\\n');\n        }\n        else {\n            process.stdout.write(colors.dim(`  Server starting…`) + '\\n\\n');\n        }\n        // Console Output\n        const history = logger.getHistory();\n        if (history.length) {\n            process.stdout.write(`${colors.underline(colors.bold('▼ Console'))}\\n\\n`);\n            process.stdout.write(history.join('\\n'));\n            process.stdout.write('\\n\\n');\n        }\n        // Worker Dashboards\n        for (const [script, workerState] of Object.entries(allWorkerStates)) {\n            if (!workerState.output) {\n                continue;\n            }\n            const colorsFn = Array.isArray(workerState.error) ? colors.red : colors.reset;\n            process.stdout.write(`${colorsFn(colors.underline(colors.bold('▼ ' + script)))}\\n\\n`);\n            process.stdout.write('  ' + workerState.output.trim().replace(/\\n/gm, '\\n  '));\n            process.stdout.write('\\n\\n');\n        }\n    }\n    bus.on(paintEvent.BUILD_FILE, ({ id, isBuilding }) => {\n        if (isBuilding) {\n            allFileBuilds.add(path.relative(cwd, id));\n        }\n        else {\n            allFileBuilds.delete(path.relative(cwd, id));\n        }\n        repaint();\n    });\n    bus.on(paintEvent.WORKER_MSG, ({ id, msg }) => {\n        setupWorker(id);\n        allWorkerStates[id].output += msg;\n        repaint();\n    });\n    bus.on(paintEvent.WORKER_UPDATE, ({ id, state }) => {\n        if (typeof state !== undefined) {\n            setupWorker(id);\n            allWorkerStates[id].state = state;\n        }\n        repaint();\n    });\n    bus.on(paintEvent.WORKER_COMPLETE, ({ id, error }) => {\n        allWorkerStates[id].state = ['DONE', 'green'];\n        allWorkerStates[id].done = true;\n        allWorkerStates[id].error = allWorkerStates[id].error || error;\n        repaint();\n    });\n    bus.on(paintEvent.WORKER_RESET, ({ id }) => {\n        allWorkerStates[id] = { ...WORKER_BASE_STATE };\n        repaint();\n    });\n    bus.on(paintEvent.SERVER_START, (info) => {\n        startTimeMs = info.startTimeMs;\n        hostname = info.hostname;\n        port = info.port;\n        protocol = info.protocol;\n        ips = info.ips;\n        repaint();\n    });\n    // replace logging behavior with repaint (note: messages are retrieved later, with logger.getHistory())\n    logger.on('debug', () => {\n        repaint();\n    });\n    logger.on('info', () => {\n        repaint();\n    });\n    logger.on('warn', () => {\n        repaint();\n    });\n    logger.on('error', () => {\n        repaint();\n    });\n    repaint();\n}\n","/**\n * This license applies to parts of this file originating from the\n * https://github.com/lukejacksonn/servor repository:\n *\n * MIT License\n * Copyright (c) 2019 Luke Jackson\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\nimport cacache from 'cacache';\nimport isCompressible from 'compressible';\nimport merge from 'deepmerge';\nimport etag from 'etag';\nimport { EventEmitter } from 'events';\nimport { createReadStream, existsSync, promises as fs, statSync } from 'fs';\nimport http from 'http';\nimport HttpProxy from 'http-proxy';\nimport http2 from 'http2';\nimport https from 'https';\nimport * as colors from 'kleur/colors';\nimport mime from 'mime-types';\nimport os from 'os';\nimport path from 'path';\nimport { performance } from 'perf_hooks';\nimport onProcessExit from 'signal-exit';\nimport stream from 'stream';\nimport url from 'url';\nimport util from 'util';\nimport zlib from 'zlib';\nimport { generateEnvModule, getMetaUrlPath, wrapHtmlResponse, wrapImportMeta, wrapImportProxy, } from '../build/build-import-proxy';\nimport { buildFile as _buildFile, getInputsFromOutput } from '../build/build-pipeline';\nimport { createImportResolver } from '../build/import-resolver';\nimport srcFileExtensionMapping from '../build/src-file-extension-mapping';\nimport { EsmHmrEngine } from '../hmr-server-engine';\nimport { logger } from '../logger';\nimport { scanCodeImportsExports, transformEsmImports, transformFileImports, } from '../rewrite-imports';\nimport { matchDynamicImportValue } from '../scan-imports';\nimport { BUILD_CACHE, checkLockfileHash, cssSourceMappingURL, DEV_DEPENDENCIES_DIR, getExt, jsSourceMappingURL, openInBrowser, parsePackageImportSpecifier, readFile, replaceExt, resolveDependencyManifest, updateLockfileHash, HMR_CLIENT_CODE, } from '../util';\nimport { command as installCommand } from './install';\nimport { getPort, paint, paintEvent } from './paint';\nconst DEFAULT_PROXY_ERROR_HANDLER = (err, req, res) => {\n    const reqUrl = req.url;\n    logger.error(`✘ ${reqUrl}\\n${err.message}`);\n    sendError(req, res, 502);\n};\nfunction shouldProxy(pathPrefix, req) {\n    const reqPath = decodeURI(url.parse(req.url).pathname);\n    return reqPath.startsWith(pathPrefix);\n}\nconst sendFile = (req, res, body, fileLoc, ext = '.html') => {\n    body = Buffer.from(body);\n    const ETag = etag(body, { weak: true });\n    const contentType = mime.contentType(ext);\n    const headers = {\n        'Accept-Ranges': 'bytes',\n        'Access-Control-Allow-Origin': '*',\n        'Content-Type': contentType || 'application/octet-stream',\n        ETag,\n        Vary: 'Accept-Encoding',\n    };\n    if (req.headers['if-none-match'] === ETag) {\n        res.writeHead(304, headers);\n        res.end();\n        return;\n    }\n    let acceptEncoding = req.headers['accept-encoding'] || '';\n    if (req.headers['cache-control']?.includes('no-transform') ||\n        ['HEAD', 'OPTIONS'].includes(req.method) ||\n        !contentType ||\n        !isCompressible(contentType)) {\n        acceptEncoding = '';\n    }\n    // Handle gzip compression\n    if (/\\bgzip\\b/.test(acceptEncoding) && stream.Readable.from) {\n        const bodyStream = stream.Readable.from([body]);\n        headers['Content-Encoding'] = 'gzip';\n        res.writeHead(200, headers);\n        stream.pipeline(bodyStream, zlib.createGzip(), res, function onError(err) {\n            if (err) {\n                res.end();\n                logger.error(`✘ An error occurred serving ${colors.bold(req.url)}`);\n                logger.error(typeof err !== 'string' ? err.toString() : err);\n            }\n        });\n        return;\n    }\n    // Handle partial requests\n    const { range } = req.headers;\n    if (range) {\n        const { size: fileSize } = statSync(fileLoc);\n        const [rangeStart, rangeEnd] = range.replace(/bytes=/, '').split('-');\n        const start = parseInt(rangeStart, 10);\n        const end = rangeEnd ? parseInt(rangeEnd, 10) : fileSize - 1;\n        const chunkSize = end - start + 1;\n        const fileStream = createReadStream(fileLoc, { start, end });\n        res.writeHead(206, {\n            ...headers,\n            'Content-Range': `bytes ${start}-${end}/${fileSize}`,\n            'Content-Length': chunkSize,\n        });\n        fileStream.pipe(res);\n        return;\n    }\n    res.writeHead(200, headers);\n    res.write(body);\n    res.end();\n};\nconst sendError = (req, res, status) => {\n    const contentType = mime.contentType(path.extname(req.url) || '.html');\n    const headers = {\n        'Access-Control-Allow-Origin': '*',\n        'Accept-Ranges': 'bytes',\n        'Content-Type': contentType || 'application/octet-stream',\n        Vary: 'Accept-Encoding',\n    };\n    res.writeHead(status, headers);\n    res.end();\n};\nfunction getUrlFromFile(mountedDirectories, fileLoc, config) {\n    for (const [dirDisk, dirUrl] of mountedDirectories) {\n        if (fileLoc.startsWith(dirDisk + path.sep)) {\n            const { baseExt } = getExt(fileLoc);\n            const resolvedDirUrl = dirUrl === '/' ? '' : dirUrl;\n            return replaceExt(fileLoc.replace(dirDisk, resolvedDirUrl).replace(/[/\\\\]+/g, '/'), baseExt, config._extensionMap[baseExt] || srcFileExtensionMapping[baseExt] || baseExt);\n        }\n    }\n    return null;\n}\nexport async function command(commandOptions) {\n    const { cwd, config } = commandOptions;\n    const { port: defaultPort, hostname, open } = config.devOptions;\n    const isHmr = typeof config.devOptions.hmr !== 'undefined' ? config.devOptions.hmr : true;\n    // Start the startup timer!\n    let serverStart = performance.now();\n    const port = await getPort(defaultPort);\n    // Reset the clock if we had to wait for the user to select a new port.\n    if (port !== defaultPort) {\n        serverStart = performance.now();\n    }\n    const messageBus = new EventEmitter();\n    // note: this would cause an infinite loop if not for the logger.on(…) in `paint.ts`.\n    console.log = (...args) => {\n        logger.info(util.format(...args));\n    };\n    console.warn = (...args) => {\n        logger.warn(util.format(...args));\n    };\n    console.error = (...args) => {\n        logger.error(util.format(...args));\n    };\n    paint(messageBus, config.plugins.map((p) => p.name));\n    const inMemoryBuildCache = new Map();\n    const filesBeingDeleted = new Set();\n    const filesBeingBuilt = new Map();\n    const mountedDirectories = Object.entries(config.mount).map(([fromDisk, toUrl]) => {\n        return [path.resolve(cwd, fromDisk), toUrl];\n    });\n    // Set the proper install options, in case an install is needed.\n    const dependencyImportMapLoc = path.join(DEV_DEPENDENCIES_DIR, 'import-map.json');\n    logger.debug(`Using cache folder: ${path.relative(cwd, DEV_DEPENDENCIES_DIR)}`);\n    const installCommandOptions = merge(commandOptions, {\n        config: {\n            installOptions: {\n                dest: DEV_DEPENDENCIES_DIR,\n                env: { NODE_ENV: process.env.NODE_ENV || 'development' },\n                treeshake: false,\n            },\n        },\n    });\n    // Start with a fresh install of your dependencies, if needed.\n    if (!(await checkLockfileHash(DEV_DEPENDENCIES_DIR)) || !existsSync(dependencyImportMapLoc)) {\n        logger.debug('Cache out of date or missing. Updating…');\n        logger.info(colors.yellow('! updating dependencies...'));\n        await installCommand(installCommandOptions);\n        await updateLockfileHash(DEV_DEPENDENCIES_DIR);\n    }\n    else {\n        logger.debug(`Cache up-to-date. Using existing cache`);\n    }\n    let dependencyImportMap = { imports: {} };\n    try {\n        dependencyImportMap = JSON.parse(await fs.readFile(dependencyImportMapLoc, { encoding: 'utf-8' }));\n    }\n    catch (err) {\n        // no import-map found, safe to ignore\n    }\n    const devProxies = {};\n    config.proxy.forEach(([pathPrefix, proxyOptions]) => {\n        const proxyServer = (devProxies[pathPrefix] = HttpProxy.createProxyServer(proxyOptions));\n        for (const [onEventName, eventHandler] of Object.entries(proxyOptions.on)) {\n            proxyServer.on(onEventName, eventHandler);\n        }\n        if (!proxyOptions.on.error) {\n            proxyServer.on('error', DEFAULT_PROXY_ERROR_HANDLER);\n        }\n        logger.info(`Proxy created: ${pathPrefix} -> ${proxyOptions.target || proxyOptions.forward}`);\n    });\n    const readCredentials = async (cwd) => {\n        const [cert, key] = await Promise.all([\n            fs.readFile(path.join(cwd, 'snowpack.crt')),\n            fs.readFile(path.join(cwd, 'snowpack.key')),\n        ]);\n        return {\n            cert,\n            key,\n        };\n    };\n    let credentials;\n    if (config.devOptions.secure) {\n        try {\n            credentials = await readCredentials(cwd);\n        }\n        catch (e) {\n            logger.error(`✘ No HTTPS credentials found! Missing Files:  ${colors.bold('snowpack.crt')}, ${colors.bold('snowpack.key')}`);\n            logger.info(`You can automatically generate credentials for your project via either:\n\n  - ${colors.cyan('devcert')}: ${colors.yellow('npx devcert-cli generate localhost')}\n    https://github.com/davewasmer/devcert-cli (no install required)\n\n  - ${colors.cyan('mkcert')}: ${colors.yellow('mkcert -install && mkcert -key-file snowpack.key -cert-file snowpack.crt localhost')}\n\n    https://github.com/FiloSottile/mkcert (install required)`);\n            process.exit(1);\n        }\n    }\n    for (const runPlugin of config.plugins) {\n        if (runPlugin.run) {\n            runPlugin\n                .run({\n                isDev: true,\n                isHmrEnabled: isHmr,\n                // @ts-ignore: internal API only\n                log: (msg, data) => {\n                    messageBus.emit(msg, { ...data, id: runPlugin.name });\n                },\n            })\n                .then(() => {\n                logger.info('Command completed.', { name: runPlugin.name });\n            })\n                .catch((err) => {\n                logger.error(`Command exited with error code: ${err}`, { name: runPlugin.name });\n                process.exit(1);\n            });\n        }\n    }\n    async function requestHandler(req, res) {\n        const reqUrl = req.url;\n        const reqUrlHmrParam = reqUrl.includes('?mtime=') && reqUrl.split('?')[1];\n        let reqPath = decodeURI(url.parse(reqUrl).pathname);\n        const originalReqPath = reqPath;\n        let isProxyModule = false;\n        let isSourceMap = false;\n        if (reqPath.endsWith('.proxy.js')) {\n            isProxyModule = true;\n            reqPath = replaceExt(reqPath, '.proxy.js', '');\n        }\n        else if (reqPath.endsWith('.map')) {\n            isSourceMap = true;\n            reqPath = replaceExt(reqPath, '.map', '');\n        }\n        res.on('finish', () => {\n            const { method, url } = req;\n            const { statusCode } = res;\n            if (statusCode !== 200) {\n                messageBus.emit(paintEvent.SERVER_RESPONSE, {\n                    method,\n                    url,\n                    statusCode,\n                });\n            }\n        });\n        if (reqPath === getMetaUrlPath('/hmr.js', config)) {\n            sendFile(req, res, HMR_CLIENT_CODE, reqPath, '.js');\n            return;\n        }\n        if (reqPath === getMetaUrlPath('/env.js', config)) {\n            sendFile(req, res, generateEnvModule('development'), reqPath, '.js');\n            return;\n        }\n        for (const [pathPrefix] of config.proxy) {\n            if (!shouldProxy(pathPrefix, req)) {\n                continue;\n            }\n            devProxies[pathPrefix].web(req, res);\n            return;\n        }\n        const attemptedFileLoads = [];\n        function attemptLoadFile(requestedFile) {\n            if (attemptedFileLoads.includes(requestedFile)) {\n                return Promise.resolve(null);\n            }\n            attemptedFileLoads.push(requestedFile);\n            return fs\n                .stat(requestedFile)\n                .then((stat) => (stat.isFile() ? requestedFile : null))\n                .catch(() => null /* ignore */);\n        }\n        let requestedFile = path.parse(reqPath);\n        let requestedFileExt = requestedFile.ext.toLowerCase();\n        let responseFileExt = requestedFileExt;\n        let isRoute = !requestedFileExt || requestedFileExt === '.html';\n        // Now that we've set isRoute properly, give `requestedFileExt` a fallback\n        requestedFileExt = requestedFileExt || '.html';\n        async function getFileFromUrl(reqPath) {\n            if (reqPath.startsWith(config.buildOptions.webModulesUrl)) {\n                const fileLoc = await attemptLoadFile(reqPath.replace(config.buildOptions.webModulesUrl, DEV_DEPENDENCIES_DIR));\n                if (fileLoc) {\n                    return fileLoc;\n                }\n            }\n            for (const [dirDisk, dirUrl] of mountedDirectories) {\n                let requestedFile;\n                if (dirUrl === '/') {\n                    requestedFile = path.join(dirDisk, reqPath);\n                }\n                else if (reqPath.startsWith(dirUrl)) {\n                    requestedFile = path.join(dirDisk, reqPath.replace(dirUrl, './'));\n                }\n                else {\n                    continue;\n                }\n                if (isRoute) {\n                    let fileLoc = (await attemptLoadFile(requestedFile)) ||\n                        (await attemptLoadFile(requestedFile + '.html')) ||\n                        (await attemptLoadFile(requestedFile + 'index.html')) ||\n                        (await attemptLoadFile(requestedFile + '/index.html'));\n                    if (!fileLoc && dirUrl === '/' && config.devOptions.fallback) {\n                        const fallbackFile = path.join(dirDisk, config.devOptions.fallback);\n                        fileLoc = await attemptLoadFile(fallbackFile);\n                    }\n                    if (fileLoc) {\n                        responseFileExt = '.html';\n                        return fileLoc;\n                    }\n                }\n                else {\n                    for (const potentialSourceFile of getInputsFromOutput(requestedFile, config.plugins)) {\n                        const fileLoc = await attemptLoadFile(potentialSourceFile);\n                        if (fileLoc) {\n                            return fileLoc;\n                        }\n                    }\n                }\n            }\n            return null;\n        }\n        const fileLoc = await getFileFromUrl(reqPath);\n        if (!fileLoc) {\n            const prefix = colors.red('  ✘ ');\n            logger.error(`[404] ${reqUrl}\\n${attemptedFileLoads.map((loc) => prefix + loc).join('\\n')}`);\n            return sendError(req, res, 404);\n        }\n        /**\n         * Given a file, build it. Building a file sends it through our internal file builder\n         * pipeline, and outputs a build map representing the final build. A Build Map is used\n         * because one source file can result in multiple built files (Example: .svelte -> .js & .css).\n         */\n        async function buildFile(fileLoc) {\n            const existingBuilderPromise = filesBeingBuilt.get(fileLoc);\n            if (existingBuilderPromise) {\n                return existingBuilderPromise;\n            }\n            const fileBuilderPromise = (async () => {\n                const builtFileOutput = await _buildFile(fileLoc, {\n                    plugins: config.plugins,\n                    isDev: true,\n                    isExitOnBuild: false,\n                    isHmrEnabled: isHmr,\n                    sourceMaps: config.buildOptions.sourceMaps,\n                });\n                inMemoryBuildCache.set(fileLoc, builtFileOutput);\n                return builtFileOutput;\n            })();\n            filesBeingBuilt.set(fileLoc, fileBuilderPromise);\n            try {\n                messageBus.emit(paintEvent.BUILD_FILE, { id: fileLoc, isBuilding: true });\n                return await fileBuilderPromise;\n            }\n            finally {\n                filesBeingBuilt.delete(fileLoc);\n                messageBus.emit(paintEvent.BUILD_FILE, { id: fileLoc, isBuilding: false });\n            }\n        }\n        /**\n         * Wrap Response: The same build result can be expressed in different ways based on\n         * the URL. For example, \"App.css\" should return CSS but \"App.css.proxy.js\" should\n         * return a JS representation of that CSS. This is handled in the wrap step.\n         */\n        async function wrapResponse(code, { hasCssResource, sourceMap, sourceMappingURL, }) {\n            // transform special requests\n            if (isRoute) {\n                code = wrapHtmlResponse({\n                    code: code,\n                    hmr: isHmr,\n                    isDev: true,\n                    config,\n                    mode: 'development',\n                });\n            }\n            else if (isProxyModule) {\n                responseFileExt = '.js';\n            }\n            else if (isSourceMap && sourceMap) {\n                responseFileExt = '.map';\n                code = sourceMap;\n            }\n            // transform other files\n            switch (responseFileExt) {\n                case '.css': {\n                    if (sourceMap)\n                        code = cssSourceMappingURL(code, sourceMappingURL);\n                    break;\n                }\n                case '.js': {\n                    if (isProxyModule) {\n                        code = await wrapImportProxy({ url: reqPath, code, hmr: isHmr, config });\n                    }\n                    else {\n                        code = wrapImportMeta({ code: code, env: true, hmr: isHmr, config });\n                    }\n                    if (hasCssResource)\n                        code =\n                            `import './${path.basename(reqPath).replace(/.js$/, '.css.proxy.js')}';\\n` + code;\n                    // source mapping\n                    if (sourceMap)\n                        code = jsSourceMappingURL(code, sourceMappingURL);\n                    break;\n                }\n            }\n            // by default, return file from disk\n            return code;\n        }\n        /**\n         * Resolve Imports: Resolved imports are based on the state of the file system, so\n         * they can't be cached long-term with the build.\n         */\n        async function resolveResponseImports(fileLoc, responseExt, wrappedResponse) {\n            const resolveImportSpecifier = createImportResolver({\n                fileLoc,\n                dependencyImportMap,\n                config,\n            });\n            wrappedResponse = await transformFileImports({\n                locOnDisk: fileLoc,\n                contents: wrappedResponse,\n                baseExt: responseExt,\n                expandedExt: getExt(fileLoc).expandedExt,\n            }, (spec) => {\n                // Try to resolve the specifier to a known URL in the project\n                const resolvedImportUrl = resolveImportSpecifier(spec);\n                if (resolvedImportUrl) {\n                    // Ignore \"http://*\" imports\n                    if (url.parse(resolvedImportUrl).protocol) {\n                        return resolvedImportUrl;\n                    }\n                    // Support proxy file imports\n                    const extName = path.extname(resolvedImportUrl);\n                    if (extName &&\n                        (responseExt === '.js' || responseExt === '.html') &&\n                        extName !== '.js') {\n                        return resolvedImportUrl + '.proxy.js';\n                    }\n                    return resolvedImportUrl;\n                }\n                logger.error(`Import \"${spec}\" could not be resolved.\nIf this is a new package, re-run Snowpack with the ${colors.bold('--reload')} flag to rebuild.\nIf Snowpack is having trouble detecting the import, add ${colors.bold(`\"install\": [\"${spec}\"]`)} to your Snowpack config file.`);\n                return spec;\n            });\n            let code = wrappedResponse;\n            if (responseFileExt === '.js' && reqUrlHmrParam)\n                code = await transformEsmImports(code, (imp) => {\n                    const importUrl = path.posix.resolve(path.posix.dirname(reqPath), imp);\n                    const node = hmrEngine.getEntry(importUrl);\n                    if (node && node.needsReplacement) {\n                        hmrEngine.markEntryForReplacement(node, false);\n                        return `${imp}?${reqUrlHmrParam}`;\n                    }\n                    return imp;\n                });\n            if (responseFileExt === '.js') {\n                const isHmrEnabled = code.includes('import.meta.hot');\n                const rawImports = await scanCodeImportsExports(code);\n                const resolvedImports = rawImports.map((imp) => {\n                    let spec = code.substring(imp.s, imp.e);\n                    if (imp.d > -1) {\n                        spec = matchDynamicImportValue(spec) || '';\n                    }\n                    spec = spec.replace(/\\?mtime=[0-9]+$/, '');\n                    return path.posix.resolve(path.posix.dirname(reqPath), spec);\n                });\n                hmrEngine.setEntry(originalReqPath, resolvedImports, isHmrEnabled);\n            }\n            wrappedResponse = code;\n            return wrappedResponse;\n        }\n        /**\n         * Given a build, finalize it for the response. This involves running individual steps\n         * needed to go from build result to sever response, including:\n         *   - wrapResponse(): Wrap responses\n         *   - resolveResponseImports(): Resolve all ESM imports\n         */\n        async function finalizeResponse(fileLoc, requestedFileExt, output) {\n            // Verify that the requested file exists in the build output map.\n            if (!output[requestedFileExt] || !Object.keys(output)) {\n                return null;\n            }\n            const { code, map } = output[requestedFileExt];\n            let finalResponse = code;\n            // Wrap the response.\n            const hasAttachedCss = requestedFileExt === '.js' && !!output['.css'];\n            finalResponse = await wrapResponse(finalResponse, {\n                hasCssResource: hasAttachedCss,\n                sourceMap: map,\n                sourceMappingURL: path.basename(requestedFile.base) + '.map',\n            });\n            // Resolve imports.\n            if (requestedFileExt === '.js' ||\n                requestedFileExt === '.html' ||\n                requestedFileExt === '.css') {\n                finalResponse = await resolveResponseImports(fileLoc, requestedFileExt, finalResponse);\n            }\n            // Return the finalized response.\n            return finalResponse;\n        }\n        // 1. Check the hot build cache. If it's already found, then just serve it.\n        let hotCachedResponse = inMemoryBuildCache.get(fileLoc);\n        if (hotCachedResponse) {\n            const responseContent = await finalizeResponse(fileLoc, requestedFileExt, hotCachedResponse);\n            if (!responseContent) {\n                sendError(req, res, 404);\n                return;\n            }\n            sendFile(req, res, responseContent, fileLoc, responseFileExt);\n            return;\n        }\n        // 2. Load the file from disk. We'll need it to check the cold cache or build from scratch.\n        const fileContents = await readFile(fileLoc);\n        // 3. Send dependencies directly, since they were already build & resolved at install time.\n        if (reqPath.startsWith(config.buildOptions.webModulesUrl) && !isProxyModule) {\n            sendFile(req, res, fileContents, fileLoc, responseFileExt);\n            return;\n        }\n        // 4. Check the persistent cache. If found, serve it via a \"trust-but-verify\" strategy.\n        // Build it after sending, and if it no longer matches then assume the entire cache is suspect.\n        // In that case, clear the persistent cache and then force a live-reload of the page.\n        const cachedBuildData = !filesBeingDeleted.has(fileLoc) &&\n            (await cacache.get(BUILD_CACHE, fileLoc).catch(() => null));\n        if (cachedBuildData) {\n            const { originalFileHash } = cachedBuildData.metadata;\n            const newFileHash = etag(fileContents);\n            if (originalFileHash === newFileHash) {\n                // IF THIS FAILS TS CHECK: If you are changing the structure of SnowpackBuildMap, be sure to\n                // also update `BUILD_CACHE` in util.ts to a new unique name, to guarantee a clean cache for\n                // our users.\n                const coldCachedResponse = JSON.parse(cachedBuildData.data.toString());\n                inMemoryBuildCache.set(fileLoc, coldCachedResponse);\n                // Trust...\n                const wrappedResponse = await finalizeResponse(fileLoc, requestedFileExt, coldCachedResponse);\n                if (!wrappedResponse) {\n                    sendError(req, res, 404);\n                    return;\n                }\n                sendFile(req, res, wrappedResponse, fileLoc, responseFileExt);\n                // ...but verify.\n                let checkFinalBuildResult = null;\n                try {\n                    checkFinalBuildResult = await buildFile(fileLoc);\n                }\n                catch (err) {\n                    // safe to ignore, it will be surfaced later anyway\n                }\n                finally {\n                    if (!checkFinalBuildResult ||\n                        !cachedBuildData.data.equals(Buffer.from(JSON.stringify(checkFinalBuildResult)))) {\n                        inMemoryBuildCache.clear();\n                        await cacache.rm.all(BUILD_CACHE);\n                        hmrEngine.broadcastMessage({ type: 'reload' });\n                    }\n                }\n                return;\n            }\n        }\n        // 5. Final option: build the file, serve it, and cache it.\n        let responseContent;\n        let responseOutput;\n        try {\n            responseOutput = await buildFile(fileLoc);\n        }\n        catch (err) {\n            logger.error(`${reqPath}\n${err}`);\n            sendError(req, res, 500);\n            return;\n        }\n        try {\n            responseContent = await finalizeResponse(fileLoc, requestedFileExt, responseOutput);\n        }\n        catch (err) {\n            logger.error(`${reqPath}\n${err}`);\n            sendError(req, res, 500);\n            return;\n        }\n        if (!responseContent) {\n            sendError(req, res, 404);\n            return;\n        }\n        sendFile(req, res, responseContent, fileLoc, responseFileExt);\n        const originalFileHash = etag(fileContents);\n        cacache.put(BUILD_CACHE, fileLoc, Buffer.from(JSON.stringify(responseOutput)), {\n            metadata: { originalFileHash },\n        });\n    }\n    const createServer = (requestHandler) => {\n        if (credentials && config.proxy.length === 0) {\n            return http2.createSecureServer({ ...credentials, allowHTTP1: true }, requestHandler);\n        }\n        else if (credentials) {\n            return https.createServer(credentials, requestHandler);\n        }\n        return http.createServer(requestHandler);\n    };\n    const server = createServer(async (req, res) => {\n        try {\n            return await requestHandler(req, res);\n        }\n        catch (err) {\n            logger.error(`[500] ${req.url}`);\n            logger.error(err.toString() || err);\n            return sendError(req, res, 500);\n        }\n    })\n        .on('error', (err) => {\n        logger.error(colors.red(`  ✘ Failed to start server at port ${colors.bold(port)}.`), err);\n        server.close();\n        process.exit(1);\n    })\n        .on('upgrade', (req, socket, head) => {\n        config.proxy.forEach(([pathPrefix, proxyOptions]) => {\n            const isWebSocket = proxyOptions.ws || proxyOptions.target?.toString().startsWith('ws');\n            if (isWebSocket && shouldProxy(pathPrefix, req)) {\n                devProxies[pathPrefix].ws(req, socket, head);\n                logger.info('Upgrading to WebSocket');\n            }\n        });\n    })\n        .listen(port);\n    const hmrEngine = new EsmHmrEngine({ server });\n    onProcessExit(() => {\n        hmrEngine.disconnectAllClients();\n    });\n    // Live Reload + File System Watching\n    let isLiveReloadPaused = false;\n    function updateOrBubble(url, visited) {\n        if (visited.has(url)) {\n            return;\n        }\n        visited.add(url);\n        const node = hmrEngine.getEntry(url);\n        if (node && node.isHmrEnabled) {\n            hmrEngine.broadcastMessage({ type: 'update', url });\n        }\n        if (node && node.isHmrAccepted) {\n            // Found a boundary, no bubbling needed\n        }\n        else if (node && node.dependents.size > 0) {\n            node.dependents.forEach((dep) => {\n                hmrEngine.markEntryForReplacement(node, true);\n                updateOrBubble(dep, visited);\n            });\n        }\n        else {\n            // We've reached the top, trigger a full page refresh\n            hmrEngine.broadcastMessage({ type: 'reload' });\n        }\n    }\n    function handleHmrUpdate(fileLoc) {\n        if (isLiveReloadPaused) {\n            return;\n        }\n        let updateUrl = getUrlFromFile(mountedDirectories, fileLoc, config);\n        if (!updateUrl) {\n            return;\n        }\n        // Append \".proxy.js\" to Non-JS files to match their registered URL in the client app.\n        if (!updateUrl.endsWith('.js')) {\n            updateUrl += '.proxy.js';\n        }\n        // Check if a virtual file exists in the resource cache (ex: CSS from a Svelte file)\n        // If it does, mark it for HMR replacement but DONT trigger a separate HMR update event.\n        // This is because a virtual resource doesn't actually exist on disk, so we need the main\n        // resource (the JS) to load first. Only after that happens will the CSS exist.\n        const virtualCssFileUrl = updateUrl.replace(/.js$/, '.css');\n        const virtualNode = hmrEngine.getEntry(`${virtualCssFileUrl}.proxy.js`);\n        if (virtualNode) {\n            hmrEngine.markEntryForReplacement(virtualNode, true);\n        }\n        // If the changed file exists on the page, trigger a new HMR update.\n        if (hmrEngine.getEntry(updateUrl)) {\n            updateOrBubble(updateUrl, new Set());\n            return;\n        }\n        // Otherwise, reload the page if the file exists in our hot cache (which means that the\n        // file likely exists on the current page, but is not supported by HMR (HTML, image, etc)).\n        if (inMemoryBuildCache.has(fileLoc)) {\n            hmrEngine.broadcastMessage({ type: 'reload' });\n            return;\n        }\n    }\n    // Announce server has started\n    const ips = Object.values(os.networkInterfaces())\n        .reduce((every, i) => [...every, ...(i || [])], [])\n        .filter((i) => i.family === 'IPv4' && i.internal === false)\n        .map((i) => i.address);\n    const protocol = config.devOptions.secure ? 'https:' : 'http:';\n    messageBus.emit(paintEvent.SERVER_START, {\n        protocol,\n        hostname,\n        port,\n        ips,\n        startTimeMs: Math.round(performance.now() - serverStart),\n    });\n    // Open the user's browser\n    if (open !== 'none') {\n        await openInBrowser(protocol, hostname, port, open);\n    }\n    // Start watching the file system.\n    // Defer \"chokidar\" loading to here, to reduce impact on overall startup time\n    const chokidar = await import('chokidar');\n    // Watch src files\n    async function onWatchEvent(fileLoc) {\n        logger.info(colors.cyan('File changed...'));\n        handleHmrUpdate(fileLoc);\n        inMemoryBuildCache.delete(fileLoc);\n        filesBeingDeleted.add(fileLoc);\n        await cacache.rm.entry(BUILD_CACHE, fileLoc);\n        filesBeingDeleted.delete(fileLoc);\n    }\n    const watcher = chokidar.watch(mountedDirectories.map(([dirDisk]) => dirDisk), {\n        ignored: config.exclude,\n        persistent: true,\n        ignoreInitial: true,\n        disableGlobbing: false,\n    });\n    watcher.on('add', (fileLoc) => onWatchEvent(fileLoc));\n    watcher.on('change', (fileLoc) => onWatchEvent(fileLoc));\n    watcher.on('unlink', (fileLoc) => onWatchEvent(fileLoc));\n    // Watch node_modules & rerun snowpack install if symlinked dep updates\n    const symlinkedFileLocs = new Set(Object.keys(dependencyImportMap.imports)\n        .map((specifier) => {\n        const [packageName] = parsePackageImportSpecifier(specifier);\n        return resolveDependencyManifest(packageName, cwd);\n    }) // resolve symlink src location\n        .filter(([_, packageManifest]) => packageManifest && !packageManifest['_id']) // only watch symlinked deps for now\n        .map(([fileLoc]) => `${path.dirname(fileLoc)}/**`));\n    function onDepWatchEvent() {\n        hmrEngine.broadcastMessage({ type: 'reload' });\n    }\n    const depWatcher = chokidar.watch([...symlinkedFileLocs], {\n        cwd: '/',\n        persistent: true,\n        ignoreInitial: true,\n        disableGlobbing: false,\n    });\n    depWatcher.on('add', onDepWatchEvent);\n    depWatcher.on('change', onDepWatchEvent);\n    depWatcher.on('unlink', onDepWatchEvent);\n    return new Promise(() => { });\n}\n","import * as colors from 'kleur/colors';\nimport path from 'path';\nimport util from 'util';\nimport yargs from 'yargs-parser';\nimport { addCommand, rmCommand } from './commands/add-rm';\nimport { command as buildCommand } from './commands/build';\nimport { command as devCommand } from './commands/dev';\nimport { command as installCommand } from './commands/install';\nimport { loadAndValidateConfig } from './config.js';\nimport { logger } from './logger';\nimport { clearCache, readLockfile } from './util.js';\nexport { install as unstable_installCommand } from './commands/install';\nexport { createConfiguration } from './config.js';\nexport * from './types/snowpack';\nconst cwd = process.cwd();\nfunction printHelp() {\n    logger.info(`\n${colors.bold(`snowpack`)} - A faster build system for the modern web.\n\n  Snowpack is best configured via config file.\n  But, most configuration can also be passed via CLI flags.\n  📖 ${colors.dim('https://www.snowpack.dev/#configuration')}\n\n${colors.bold('Commands:')}\n  snowpack dev          Develop your app locally.\n  snowpack build        Build your app for production.\n  snowpack install      (Advanced) Install web-ready dependencies.\n\n${colors.bold('Flags:')}\n  --config [path]       Set the location of your project config file.\n  --help                Show this help message.\n  --version             Show the current version.\n  --reload              Clear Snowpack's local cache (troubleshooting).\n  --verbose             View debug info (where available)\n  --quiet               Don’t output anything (dev server will still log minimally)\n    `.trim());\n}\nexport async function cli(args) {\n    // parse CLI flags\n    const cliFlags = yargs(args, {\n        array: ['install', 'env', 'exclude', 'externalPackage'],\n    });\n    if (cliFlags.verbose) {\n        logger.level = 'debug';\n    }\n    if (cliFlags.quiet) {\n        logger.level = 'silent';\n    }\n    if (cliFlags.help) {\n        printHelp();\n        process.exit(0);\n    }\n    if (cliFlags.version) {\n        logger.info(require('../package.json').version);\n        process.exit(0);\n    }\n    if (cliFlags.reload) {\n        logger.info(colors.yellow('! clearing cache...'));\n        await clearCache();\n    }\n    // Load the current package manifest\n    let pkgManifest;\n    try {\n        pkgManifest = require(path.join(cwd, 'package.json'));\n    }\n    catch (err) {\n        logger.error(`package.json not found in directory: ${cwd}. Run \\`npm init -y\\` to create one.`);\n        process.exit(1);\n    }\n    const cmd = cliFlags['_'][2] || 'install';\n    logger.debug(`run command: ${cmd}`);\n    // Set this early -- before config loading -- so that plugins see it.\n    if (cmd === 'build') {\n        process.env.NODE_ENV = process.env.NODE_ENV || 'production';\n    }\n    if (cmd === 'dev') {\n        process.env.NODE_ENV = process.env.NODE_ENV || 'development';\n    }\n    const config = loadAndValidateConfig(cliFlags, pkgManifest);\n    logger.debug(`config loaded: ${util.format(config)}`);\n    const lockfile = await readLockfile(cwd);\n    logger.debug(`lockfile ${lockfile ? 'loaded.' : 'not loaded'}`);\n    const commandOptions = {\n        cwd,\n        config,\n        lockfile,\n        pkgManifest,\n        logger,\n    };\n    if (cmd === 'add') {\n        await addCommand(cliFlags['_'][3], commandOptions);\n        return process.exit(0);\n    }\n    if (cmd === 'rm') {\n        await rmCommand(cliFlags['_'][3], commandOptions);\n        return process.exit(0);\n    }\n    if (cliFlags['_'].length > 3) {\n        logger.error(`Unexpected multiple commands`);\n        process.exit(1);\n    }\n    if (cmd === 'build') {\n        await buildCommand(commandOptions);\n        return process.exit(0);\n    }\n    if (cmd === 'dev') {\n        await devCommand(commandOptions);\n        return process.exit(0);\n    }\n    if (cmd === 'install') {\n        await installCommand(commandOptions);\n        return process.exit(0);\n    }\n    logger.error(`Unrecognized command: ${cmd}`);\n    process.exit(1);\n}\n"],"names":["levels","debug","info","warn","error","silent","SnowpackLogger","constructor","level","logCount","history","callbacks","message","console","log","name","text","colors","push","length","shift","Error","options","getHistory","on","event","callback","logger","PIKA_CDN","GLOBAL_CACHE_DIR","globalCacheDir","RESOURCE_CACHE","path","join","BUILD_CACHE","PROJECT_CACHE_DIR","projectCacheDir","DEV_DEPENDENCIES_DIR","LOCKFILE_HASH_FILE","HAS_CDN_HASH_REGEX","HTML_JS_REGEX","CSS_REGEX","SVELTE_VUE_REGEX","URL_HAS_PROTOCOL_REGEX","readFile","filepath","data","fs","promises","isBinary","isBinaryFile","toString","readLockfile","cwd","lockfileContents","readFileSync","encoding","err","JSON","parse","writeLockfile","loc","importMap","sortedImportMap","imports","key","Object","keys","sort","writeFileSync","stringify","undefined","fetchCDNResource","resourceUrl","responseType","startsWith","got","headers","throwHttpErrors","isTruthy","item","Boolean","parsePackageImportSpecifier","imp","impParts","split","scope","rest","resolveDependencyManifest","dep","depManifest","realpathSync","native","require","resolve","paths","code","result","fullPath","searchPath","sep","replace","indexOfSearch","lastIndexOf","manifestPath","substring","manifestStr","MISSING_PLUGIN_SUGGESTIONS","appNames","win32","brave","chrome","darwin","linux","openInBrowser","protocol","hostname","port","browser","url","test","process","platform","isMac","isOpeningInChrome","execa","command","shell","openChrome","encodeURI","__dirname","stdio","isChromeStalled","setTimeout","cancel","isCanceled","open","clearTimeout","app","checkLockfileHash","dir","lockfileLoc","findUp","hashLoc","newLockHash","etag","oldLockHash","catch","updateLockfileHash","mkdirp","dirname","writeFile","clearCache","Promise","all","cacache","rm","rimraf","sync","findMatchingAliasEntry","config","spec","from","to","entries","alias","foundType","isPackageAliasEntry","isExactMatch","removeTrailingSlash","isDeepMatch","addTrailingSlash","type","val","isAbsolute","getExt","fileName","baseExt","extname","toLocaleLowerCase","expandedExt","basename","replaceExt","oldExt","newExt","extToReplace","RegExp","sanitizePackageName","dirs","file","pop","map","cssSourceMappingURL","sourceMappingURL","jsSourceMappingURL","getWebDependencyName","validatePackageName","validForNewPackages","relativeURL","path1","path2","relative","CLOSING_BODY_TAG","appendHTMLToBody","doc","htmlToAdd","closingBodyMatch","match","addLeadingSlash","removeLeadingSlash","HMR_CLIENT_CODE","resolveDependency","installSpecifier","packageSemver","lockfile","canRetry","installUrl","installUrlType","exit","includes","cachedResult","get","metadata","pinnedUrl","statusCode","body","importUrlPath","pinnedUrlPath","buildStatus","typesUrlPath","typesUrl","put","lookupStatusCode","resolveTargetsFromRemoteCDN","downloadQueue","PQueue","concurrency","newLockfile","resolutionError","installSemver","webDependencies","add","resolvedUrl","onIdle","rollupPluginCatchUnresolved","resolveId","id","importer","isNodeBuiltin","FETCH_POLYFILL","isNodeFetch","rollupPluginCatchFetch","load","getInjectorCode","rollupPluginCss","source","endsWith","skipSelf","then","resolved","humanReadableName","CACHED_FILE_ID_PREFIX","PIKA_CDN_TRIM_LENGTH","rollupPluginDependencyCache","installTypes","allTypesToInstall","Set","cacheKey","response","packageName","finalResult","typesTarballUrl","writeBundle","tempDir","tmp","mkdir","tarballContents","cachedTarball","tarballResponse","typesUrlParts","pathname","typesPackageName","typesPackageTarLoc","typesPackageLoc","tar","x","rollupPluginDependencyStats","cb","outputDir","existingFileCache","statsSummary","direct","common","buildExistingFileCache","bundle","filePath","existsSync","size","statSync","compareDependencies","files","contents","byteLength","gzip","zlib","gzipSync","brotli","brotliCompressSync","delta","generateBundle","_","directDependencies","commonDependencies","assetOrChunk","raw","Buffer","isBuffer","autoDetectExports","fileLoc","filter","rollupPluginWrapInstallTargets","isTreeshake","autoDetectPackageExports","installTargets","installTargetSummaries","isAutoDetect","normalizedFileLoc","some","p","buildStart","inputOptions","input","allInstallTargets","specifier","installTargetSummary","reduce","summary","default","namespace","named","posix","uniqueNamedImports","Array","generateProcessPolyfill","env","PROCESS_MODULE_NAME","rollupPluginNodeProcessPolyfill","injectPlugin","inject","moduleSideEffects","rollupPluginStripSourceMapping","transform","BARE_SPECIFIER_REGEX","ESM_IMPORT_REGEX","ESM_DYNAMIC_IMPORT_REGEX","HAS_NAMED_IMPORTS_REGEX","STRIP_AS","DEFAULT_IMPORT_REGEX","createInstallTarget","matchDynamicImportValue","importStatement","matched","stripComments","getWebModuleSpecifierFromCode","d","s","e","parseWebModuleSpecifier","parseImportStatement","webModuleSpecifier","ss","se","isDynamicImport","hasDefaultImport","hasNamespaceImport","namedImports","trim","cleanCodeForParsing","allMatches","importRegex","exec","dynamicImportRegex","full","parseJsForInstallTargets","target","parseCssForInstallTargets","parseFileForInstallTargets","locOnDisk","relativeLoc","extractJSFromHTML","regex","scanDepList","depList","whitelistItem","glob","hasMagic","nodeModulesLoc","nodir","flat","concat","scanImports","initESModuleLexer","includeFileSets","mount","fromDisk","dirDisk","ignore","exclude","absolute","includeFiles","apply","loadedFiles","scanImportsFromFiles","sourceFile","aliasEntry","impA","impB","localeCompare","SIZE_COLUMN_WIDTH","entriesSort","filenameA","filenameB","formatSize","kb","Math","round","floor","color","padEnd","formatDelta","formatFileInfo","filename","stats","isLastFile","lineGlyph","lineName","fileStat","gzipStat","brotliStat","lineStat","lineDelta","formatFiles","strippedFiles","index","printStats","dependencyStats","output","allDirect","allCommon","maxFileNameLength","max","values","CJS_PACKAGES_TO_AUTO_DETECT","installResults","isImportOfPackage","importUrl","resolveWebDependency","isJSFile","packageEntrypoint","packageManifestLoc","packageManifest","exports","exportMapEntry","exportMapValue","import","depManifestLoc","maybeLoc","foundEntrypoint","module","main","isImplicitEntrypoint","types","typings","generateEnvObject","userEnv","NODE_ENV","acc","value","generateEnvReplacements","FAILED_INSTALL_MESSAGE","EMPTY_INSTALL_RETURN","success","install","installAlias","installOptions","dest","destLoc","externalPackage","externalPackages","sourceMap","rollup","userDefinedRollup","treeshake","polyfillNode","nodeModulesInstalled","versions","pnp","allInstallSpecifiers","installEntrypoints","assetEntrypoints","autoDetectNamedExports","namedExports","targetName","proxiedName","targetType","targetLoc","forEach","isCircularImportFound","isFatalWarningFound","external","plugins","rollupPluginAlias","find","replacement","rollupPluginNodeResolve","mainFields","extensions","preferBuiltins","dedupe","rollupPluginJson","preferConst","indent","compact","rollupPluginReplace","rollupPluginCommonjs","externalEsm","EXTERNAL_ESM_PACKAGES","requireReturnsDefault","rollupPluginNodePolyfills","onwarn","warning","plugin","outputOptions","format","sourcemap","entryFileNames","chunk","chunkFileNames","util","packageBundle","write","_err","errFilePath","failedExtension","suggestion","assetName","assetLoc","assetDest","copyFileSync","getInstallTargets","scannedFiles","knownEntrypoints","commandOptions","run","hasError","installStart","performance","now","installEnd","toFixed","addCommand","addValue","pkgManifest","pkgName","pkgSemver","json","version","installCommand","rmCommand","getMetaUrlPath","urlPath","metaDir","buildOptions","normalize","wrapImportMeta","hmr","wrapHtmlResponse","isDev","mode","baseUrl","snowpackPublicEnv","getSnowpackPublicEnvVariables","envVariableName","slice","hmrScript","generateJsonImportProxy","jsonImportProxyCode","generateCssImportProxy","cssImportProxyCode","_cssModuleLoader","generateCssModuleImportProxy","injectableSource","exportTokens","generateDefaultImportProxy","wrapImportProxy","sanitized","generateEnvModule","envObject","MODE","PUBLIC_ENV_REGEX","esbuildService","IS_PREACT","checkIsPreact","getLoader","ext","substr","esbuildPlugin","startService","isPreact","js","jsSourceMap","warnings","loader","jsxFactory","jsxFragment","sourcefile","sourceMaps","cleanup","stop","CONFIG_NAME","ALWAYS_EXCLUDE","DEFAULT_CONFIG","scripts","devOptions","secure","out","fallback","webModulesUrl","clean","minify","watch","configSchema","properties","extends","items","additionalProperties","oneOf","enum","proxy","expandCliFlags","flags","relevantFlags","CLI_ONLY_FLAGS","flag","indexOf","parseScript","script","scriptType","extMatch","toLowerCase","inputMatch","outputMatch","cleanInput","cleanOutput","srcFileExtensionMapping","loadPlugins","execPluginFactory","pluginFactory","pluginOptions","loadPluginFromScript","pluginLoc","loadPluginFromConfig","pluginRef","build","resources","css","optimize","srcDirectory","buildDirectory","destDirectory","jsFilePaths","defaultBuildScript","validatePlugin","cmd","isArray","handleConfigError","watchCmd","runScriptPlugin","buildScriptPlugin","ref","pluginName","needsDefaultPlugin","arr","a","delete","unshift","extensionMap","inputExt","handleLegacyProxyScripts","scriptId","cmdArr","yargs","toUrl","fromUrl","normalizeProxies","proxies","pathPrefix","proxyReq","req","proxyPath","changeOrigin","normalizeMount","mountedDirs","mountDir","mountUrl","normalizeAlias","createMountAlias","cleanAlias","normalizeConfig","isLegacyMountConfig","_extensionMap","msg","handleValidationErrors","errors","handleDeprecatedConfigError","mainMsg","msgs","validateConfigAgainstV1","rawConfig","cliFlags","include","entrypoints","stat","k","dist","hash","nomodule","nomoduleOutput","babel","strict","validatePluginLoadResult","isValidSingleResultType","unexpectedOutput","fileExt","createConfiguration","validationErrors","validate","propertyName","allowUnknownAttributes","mergedConfig","merge","loadAndValidateConfig","explorerSync","cosmiconfigSync","searchPlaces","stopDir","search","isEmpty","cliConfig","extendConfig","extendConfigLoc","extendResult","extendValidation","extendConfigDir","absName","splice","homepage","webDependencyName","dependencies","devDependencies","configResult","getInputsFromOutput","srcFile","potentialInputs","runPipelineLoadStep","srcPath","isHmrEnabled","isExitOnBuild","srcExt","step","debugPath","mainOutputExt","runPipelineTransformStep","rootFilePath","rootFileName","destExt","destBuildFile","runPipelineOptimizeStep","runPipelineCleanupStep","buildFile","buildFileOptions","loadResult","transformResult","getImportStats","dirLoc","importedFileOnDisk","resolveSourceSpecifier","isDirectory","trailingSlash","createImportResolver","dependencyImportMap","importResolver","importStats","importMapEntry","spliceString","withSlice","start","end","scanCodeImportsExports","transformEsmImports","_code","replaceImport","rewrittenCode","reverse","rewrittenImport","transformHtmlImports","scriptTag","scriptCode","transformCssImports","fullMatch","transformFileImports","DEFAULT_PORT","EsmHmrEngine","clients","dependencyTree","Map","wsUrl","wss","server","WebSocket","Server","noServer","socket","head","handleUpgrade","client","emit","connectClient","registerListener","entry","getEntry","isHmrAccepted","createEntry","sourceUrl","newEntry","dependents","needsReplacement","needsReplacementCount","set","createIfNotFound","setEntry","outdatedDependencies","addRelationship","removeRelationship","importResult","sourceResult","markEntryForReplacement","state","broadcastMessage","readyState","OPEN","send","disconnectClient","terminate","disconnectAllClients","CONCURRENT_WORKERS","cpus","hmrEngine","getIsHmrEnabled","installOptimizedDependencies","installDest","installConfig","installResult","installRunner","FileBuilder","outDir","filesToResolve","filesToProxy","builtFileOutput","buildResult","outFilename","outLoc","cssFilename","resolveImports","isSuccess","rawFile","resolveImportSpecifier","resolvedCode","resolvedImportUrl","importExtName","isProxyImport","isAbsoluteUrlPath","resolvedImportPath","writeToDisk","writeProxyToDisk","originalFileLoc","proxiedCode","importProxyFileLoc","proxiedUrl","proxyCode","buildDirectoryLoc","internalFilesBuildLoc","mountedDirectories","runPlugin","buildPipelineFiles","installDependencies","f","allFiles","dot","installedFileLoc","dirDest","rawLocOnDisk","finalDest","buildPipelineFile","parallelWorkQueue","allBuildPipelineFiles","buildEnd","allImportProxyFiles","b","builtFile","has","chokidar","onDeleteEvent","onWatchEvent","changedPipelineFile","resolveSuccess","watcher","ignored","ignoreInitial","persistent","disableGlobbing","paintEvent","BUILD_FILE","LOAD_ERROR","SERVER_RESPONSE","SERVER_START","WORKER_COMPLETE","WORKER_MSG","WORKER_RESET","WORKER_UPDATE","getPort","defaultPort","bestAvailablePort","detectPort","useNextPort","stdout","isTTY","rl","readline","createInterface","stdin","question","answer","close","WORKER_BASE_STATE","done","paint","bus","startTimeMs","ips","allWorkerStates","allFileBuilds","setupWorker","repaint","isServerStarted","ip","workerState","colorsFn","isBuilding","DEFAULT_PROXY_ERROR_HANDLER","res","reqUrl","sendError","shouldProxy","reqPath","decodeURI","sendFile","ETag","weak","contentType","mime","Vary","writeHead","acceptEncoding","method","isCompressible","stream","Readable","bodyStream","pipeline","createGzip","onError","range","fileSize","rangeStart","rangeEnd","parseInt","chunkSize","fileStream","createReadStream","pipe","status","getUrlFromFile","dirUrl","resolvedDirUrl","isHmr","serverStart","messageBus","EventEmitter","args","inMemoryBuildCache","filesBeingDeleted","filesBeingBuilt","dependencyImportMapLoc","installCommandOptions","devProxies","proxyOptions","proxyServer","HttpProxy","createProxyServer","onEventName","eventHandler","forward","readCredentials","cert","credentials","requestHandler","reqUrlHmrParam","originalReqPath","isProxyModule","isSourceMap","web","attemptedFileLoads","attemptLoadFile","requestedFile","isFile","requestedFileExt","responseFileExt","isRoute","getFileFromUrl","fallbackFile","potentialSourceFile","prefix","existingBuilderPromise","fileBuilderPromise","_buildFile","wrapResponse","hasCssResource","resolveResponseImports","responseExt","wrappedResponse","extName","node","rawImports","resolvedImports","finalizeResponse","finalResponse","hasAttachedCss","base","hotCachedResponse","responseContent","fileContents","cachedBuildData","originalFileHash","newFileHash","coldCachedResponse","checkFinalBuildResult","equals","clear","responseOutput","createServer","http2","createSecureServer","allowHTTP1","https","http","isWebSocket","ws","listen","onProcessExit","updateOrBubble","visited","handleHmrUpdate","updateUrl","virtualCssFileUrl","virtualNode","os","networkInterfaces","every","i","family","internal","address","symlinkedFileLocs","onDepWatchEvent","depWatcher","printHelp","cli","array","verbose","quiet","help","reload","buildCommand","devCommand"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AACA,MAAMA,MAAM,GAAG;AACXC,EAAAA,KAAK,EAAE,EADI;AAEXC,EAAAA,IAAI,EAAE,EAFK;AAGXC,EAAAA,IAAI,EAAE,EAHK;AAIXC,EAAAA,KAAK,EAAE,EAJI;AAKXC,EAAAA,MAAM,EAAE;AALG,CAAf;AAOA;;AACA,MAAMC,cAAN,CAAqB;AACjBC,EAAAA,WAAW,GAAG;AACV;AACA,SAAKC,KAAL,GAAa,MAAb;AACA;;AACA,SAAKC,QAAL,GAAgB,GAAhB;AACA,SAAKC,OAAL,GAAe,EAAf,CALU;;AAMV,SAAKC,SAAL,GAAiB;AACbV,MAAAA,KAAK,EAAGW,OAAD,IAAa;AAChBC,QAAAA,OAAO,CAACC,GAAR,CAAYF,OAAZ;AACH,OAHY;AAIbV,MAAAA,IAAI,EAAGU,OAAD,IAAa;AACfC,QAAAA,OAAO,CAACC,GAAR,CAAYF,OAAZ;AACH,OANY;AAObT,MAAAA,IAAI,EAAGS,OAAD,IAAa;AACfC,QAAAA,OAAO,CAACV,IAAR,CAAaS,OAAb;AACH,OATY;AAUbR,MAAAA,KAAK,EAAGQ,OAAD,IAAa;AAChBC,QAAAA,OAAO,CAACT,KAAR,CAAcQ,OAAd;AACH;AAZY,KAAjB;AAcH;;AACDE,EAAAA,GAAG,CAAC;AAAEN,IAAAA,KAAF;AAASO,IAAAA,IAAT;AAAeH,IAAAA;AAAf,GAAD,EAA2B;AAC1B;AACA,QAAIZ,MAAM,CAAC,KAAKQ,KAAN,CAAN,GAAqBR,MAAM,CAACQ,KAAD,CAA/B,EAAwC;AACpC,aADoC;AAEvC,KAJyB;;;AAM1B,QAAIQ,IAAI,GAAGJ,OAAX;AACA,QAAIJ,KAAK,KAAK,MAAd,EACIQ,IAAI,GAAGC,aAAA,CAAcD,IAAd,CAAP;AACJ,QAAIR,KAAK,KAAK,OAAd,EACIQ,IAAI,GAAGC,UAAA,CAAWD,IAAX,CAAP;AACJ,UAAMF,GAAG,GAAI,GAAEG,UAAA,CAAY,IAAGF,IAAK,GAApB,CAAwB,IAAGC,IAAK,EAA/C,CAX0B;;AAa1B,SAAKN,OAAL,CAAaQ,IAAb,CAAkBJ,GAAlB;;AACA,WAAO,KAAKJ,OAAL,CAAaS,MAAb,GAAsB,KAAKV,QAAlC,EAA4C;AACxC,WAAKC,OAAL,CAAaU,KAAb;AACH,KAhByB;;;AAkB1B,QAAI,OAAO,KAAKT,SAAL,CAAeH,KAAf,CAAP,KAAiC,UAArC,EAAiD;AAC7C,WAAKG,SAAL,CAAeH,KAAf,EAAsBM,GAAtB;AACH,KAFD,MAGK;AACD,YAAM,IAAIO,KAAJ,CAAW,iCAAgCb,KAAM,EAAjD,CAAN;AACH;AACJ;AACD;;;AACAP,EAAAA,KAAK,CAACW,OAAD,EAAUU,OAAV,EAAmB;AACpB,UAAMP,IAAI,GAAIO,OAAO,IAAIA,OAAO,CAACP,IAApB,IAA6B,UAA1C;AACA,SAAKD,GAAL,CAAS;AAAEN,MAAAA,KAAK,EAAE,OAAT;AAAkBO,MAAAA,IAAlB;AAAwBH,MAAAA;AAAxB,KAAT;AACH;AACD;;;AACAV,EAAAA,IAAI,CAACU,OAAD,EAAUU,OAAV,EAAmB;AACnB,UAAMP,IAAI,GAAIO,OAAO,IAAIA,OAAO,CAACP,IAApB,IAA6B,UAA1C;AACA,SAAKD,GAAL,CAAS;AAAEN,MAAAA,KAAK,EAAE,MAAT;AAAiBO,MAAAA,IAAjB;AAAuBH,MAAAA;AAAvB,KAAT;AACH;AACD;;;AACAT,EAAAA,IAAI,CAACS,OAAD,EAAUU,OAAV,EAAmB;AACnB,UAAMP,IAAI,GAAIO,OAAO,IAAIA,OAAO,CAACP,IAApB,IAA6B,UAA1C;AACA,SAAKD,GAAL,CAAS;AAAEN,MAAAA,KAAK,EAAE,MAAT;AAAiBO,MAAAA,IAAjB;AAAuBH,MAAAA;AAAvB,KAAT;AACH;AACD;;;AACAR,EAAAA,KAAK,CAACQ,OAAD,EAAUU,OAAV,EAAmB;AACpB,UAAMP,IAAI,GAAIO,OAAO,IAAIA,OAAO,CAACP,IAApB,IAA6B,UAA1C;AACA,SAAKD,GAAL,CAAS;AAAEN,MAAAA,KAAK,EAAE,OAAT;AAAkBO,MAAAA,IAAlB;AAAwBH,MAAAA;AAAxB,KAAT;AACH;AACD;;;AACAW,EAAAA,UAAU,GAAG;AACT,WAAO,KAAKb,OAAZ;AACH;AACD;;;AACAc,EAAAA,EAAE,CAACC,KAAD,EAAQC,QAAR,EAAkB;AAChB,SAAKf,SAAL,CAAec,KAAf,IAAwBC,QAAxB;AACH;;AA1EgB;AA4ErB;;;AACO,MAAMC,MAAM,GAAG,IAAIrB,cAAJ,EAAf;;ACxEA,MAAMsB,QAAQ,GAAI,sBAAlB;AACP,AAAO,MAAMC,gBAAgB,GAAGC,cAAc,CAAC,UAAD,CAAvC;AAEP;AACA;AACA;AACA;;AACA,AAAO,MAAMC,cAAc,GAAGC,IAAI,CAACC,IAAL,CAAUJ,gBAAV,EAA4B,eAA5B,CAAvB;AACP,AAAO,MAAMK,WAAW,GAAGF,IAAI,CAACC,IAAL,CAAUJ,gBAAV,EAA4B,iBAA5B,CAApB;AACP,AAAO,MAAMM,iBAAiB,GAAGC,eAAe,CAAC;AAAErB,EAAAA,IAAI,EAAE;AAAR,CAAD,CAAzC;AACP,AAAO,MAAMsB,oBAAoB,GAAGL,IAAI,CAACC,IAAL,CAAUE,iBAAV,EAA6B,KAA7B,CAA7B;AACP,MAAMG,kBAAkB,GAAG,OAA3B;AACA,AAAO,MAAMC,kBAAkB,GAAG,oBAA3B;;AAEP,AAAO,MAAMC,aAAa,GAAG,yEAAtB;AACP,AAAO,MAAMC,SAAS,GAAG,iGAAlB;AACP,AAAO,MAAMC,gBAAgB,GAAG,mDAAzB;AACP,AAAO,MAAMC,sBAAsB,GAAG,cAA/B;AACP;;AACA,AAAO,eAAeC,QAAf,CAAwBC,QAAxB,EAAkC;AACrC,QAAMC,IAAI,GAAG,MAAMC,WAAE,CAACC,QAAH,CAAYJ,QAAZ,CAAqBC,QAArB,CAAnB;AACA,QAAMI,QAAQ,GAAG,MAAMC,yBAAY,CAACJ,IAAD,CAAnC;AACA,SAAOG,QAAQ,GAAGH,IAAH,GAAUA,IAAI,CAACK,QAAL,CAAc,OAAd,CAAzB;AACH;AACD,AAAO,eAAeC,YAAf,CAA4BC,GAA5B,EAAiC;AACpC,MAAI;AACA,QAAIC,gBAAgB,GAAGP,WAAE,CAACQ,YAAH,CAAgBvB,IAAI,CAACC,IAAL,CAAUoB,GAAV,EAAe,oBAAf,CAAhB,EAAsD;AACzEG,MAAAA,QAAQ,EAAE;AAD+D,KAAtD,CAAvB;AAGH,GAJD,CAKA,OAAOC,GAAP,EAAY;AACR;AACA,WAAO,IAAP;AACH,GATmC;;;AAWpC,SAAOC,IAAI,CAACC,KAAL,CAAWL,gBAAX,CAAP;AACH;AACD,AAAO,eAAeM,aAAf,CAA6BC,GAA7B,EAAkCC,SAAlC,EAA6C;AAChD,QAAMC,eAAe,GAAG;AAAEC,IAAAA,OAAO,EAAE;AAAX,GAAxB;;AACA,OAAK,MAAMC,GAAX,IAAkBC,MAAM,CAACC,IAAP,CAAYL,SAAS,CAACE,OAAtB,EAA+BI,IAA/B,EAAlB,EAAyD;AACrDL,IAAAA,eAAe,CAACC,OAAhB,CAAwBC,GAAxB,IAA+BH,SAAS,CAACE,OAAV,CAAkBC,GAAlB,CAA/B;AACH;;AACDlB,EAAAA,WAAE,CAACsB,aAAH,CAAiBR,GAAjB,EAAsBH,IAAI,CAACY,SAAL,CAAeP,eAAf,EAAgCQ,SAAhC,EAA2C,CAA3C,CAAtB,EAAqE;AAAEf,IAAAA,QAAQ,EAAE;AAAZ,GAArE;AACH;AACD,AAAO,SAASgB,gBAAT,CAA0BC,WAA1B,EAAuCC,YAAvC,EAAqD;AACxD,MAAI,CAACD,WAAW,CAACE,UAAZ,CAAuB/C,QAAvB,CAAL,EAAuC;AACnC6C,IAAAA,WAAW,GAAG7C,QAAQ,GAAG6C,WAAzB;AACH,GAHuD;;;AAKxD,SAAOG,GAAG,CAACH,WAAD,EAAc;AACpBC,IAAAA,YAAY,EAAEA,YADM;AAEpBG,IAAAA,OAAO,EAAE;AAAE,oBAAe;AAAjB,KAFW;AAGpBC,IAAAA,eAAe,EAAE;AAHG,GAAd,CAAV;AAKH;AACD,AAAO,SAASC,QAAT,CAAkBC,IAAlB,EAAwB;AAC3B,SAAOC,OAAO,CAACD,IAAD,CAAd;AACH;AACD;;AACA,AAAO,SAASE,2BAAT,CAAqCC,GAArC,EAA0C;AAC7C,QAAMC,QAAQ,GAAGD,GAAG,CAACE,KAAJ,CAAU,GAAV,CAAjB;;AACA,MAAIF,GAAG,CAACR,UAAJ,CAAe,GAAf,CAAJ,EAAyB;AACrB,UAAM,CAACW,KAAD,EAAQvE,IAAR,EAAc,GAAGwE,IAAjB,IAAyBH,QAA/B;AACA,WAAO,CAAE,GAAEE,KAAM,IAAGvE,IAAK,EAAlB,EAAqBwE,IAAI,CAACtD,IAAL,CAAU,GAAV,KAAkB,IAAvC,CAAP;AACH;;AACD,QAAM,CAAClB,IAAD,EAAO,GAAGwE,IAAV,IAAkBH,QAAxB;AACA,SAAO,CAACrE,IAAD,EAAOwE,IAAI,CAACtD,IAAL,CAAU,GAAV,KAAkB,IAAzB,CAAP;AACH;AACD;;;;;;;;;AAQA,AAAO,SAASuD,yBAAT,CAAmCC,GAAnC,EAAwCpC,GAAxC,EAA6C;AAChD;AACA;AACA;AACA;AACA,MAAI;AACA,UAAMqC,WAAW,GAAG3C,WAAE,CAAC4C,YAAH,CAAgBC,MAAhB,CAAuBC,OAAO,CAACC,OAAR,CAAiB,GAAEL,GAAI,eAAvB,EAAuC;AAAEM,MAAAA,KAAK,EAAE,CAAC1C,GAAD;AAAT,KAAvC,CAAvB,CAApB;AACA,WAAO,CAACqC,WAAD,EAAcG,OAAO,CAACH,WAAD,CAArB,CAAP;AACH,GAHD,CAIA,OAAOjC,GAAP,EAAY;AACR;AACA,QAAIA,GAAG,CAACuC,IAAJ,KAAa,+BAAjB,EAAkD;AAC9C,aAAO,CAAC,IAAD,EAAO,IAAP,CAAP;AACH;AACJ,GAd+C;AAgBhD;AACA;AACA;AACA;;;AACA,MAAIC,MAAM,GAAG,CAAC,IAAD,EAAO,IAAP,CAAb;;AACA,MAAI;AACA,UAAMC,QAAQ,GAAGnD,WAAE,CAAC4C,YAAH,CAAgBC,MAAhB,CAAuBC,OAAO,CAACC,OAAR,CAAgBL,GAAhB,EAAqB;AAAEM,MAAAA,KAAK,EAAE,CAAC1C,GAAD;AAAT,KAArB,CAAvB,CAAjB,CADA;AAGA;;AACA,UAAM8C,UAAU,GAAI,GAAEnE,IAAI,CAACoE,GAAI,eAAcpE,IAAI,CAACoE,GAAI,GAAEX,GAAG,CAACY,OAAJ,CAAY,GAAZ,EAAiBrE,IAAI,CAACoE,GAAtB,CAA2B,EAAnF;AACA,UAAME,aAAa,GAAGJ,QAAQ,CAACK,WAAT,CAAqBJ,UAArB,CAAtB;;AACA,QAAIG,aAAa,IAAI,CAArB,EAAwB;AACpB,YAAME,YAAY,GAAGN,QAAQ,CAACO,SAAT,CAAmB,CAAnB,EAAsBH,aAAa,GAAGH,UAAU,CAAChF,MAA3B,GAAoC,CAA1D,IAA+D,cAApF;AACA8E,MAAAA,MAAM,CAAC,CAAD,CAAN,GAAYO,YAAZ;AACA,YAAME,WAAW,GAAG3D,WAAE,CAACQ,YAAH,CAAgBiD,YAAhB,EAA8B;AAAEhD,QAAAA,QAAQ,EAAE;AAAZ,OAA9B,CAApB;AACAyC,MAAAA,MAAM,CAAC,CAAD,CAAN,GAAYvC,IAAI,CAACC,KAAL,CAAW+C,WAAX,CAAZ;AACH;AACJ,GAZD,CAaA,OAAOjD,GAAP,EAAY;AAEX,GAfD,SAgBQ;AACJ,WAAOwC,MAAP;AACH;AACJ;AACD;;;;;AAIA,AAAO,MAAMU,0BAA0B,GAAG;AACtC,aAAW,iHAD2B;AAEtC,UAAQ;AAF8B,CAAnC;AAIP,MAAMC,QAAQ,GAAG;AACbC,EAAAA,KAAK,EAAE;AACHC,IAAAA,KAAK,EAAE,OADJ;AAEHC,IAAAA,MAAM,EAAE;AAFL,GADM;AAKbC,EAAAA,MAAM,EAAE;AACJF,IAAAA,KAAK,EAAE,eADH;AAEJC,IAAAA,MAAM,EAAE;AAFJ,GALK;AASbE,EAAAA,KAAK,EAAE;AACHH,IAAAA,KAAK,EAAE,OADJ;AAEHC,IAAAA,MAAM,EAAE;AAFL;AATM,CAAjB;AAcA,AAAO,eAAeG,aAAf,CAA6BC,QAA7B,EAAuCC,QAAvC,EAAiDC,IAAjD,EAAuDC,OAAvD,EAAgE;AACnE,QAAMC,GAAG,GAAI,GAAEJ,QAAS,KAAIC,QAAS,IAAGC,IAAK,EAA7C;AACAC,EAAAA,OAAO,GAAG,UAAUE,IAAV,CAAeF,OAAf,IACJV,QAAQ,CAACa,OAAO,CAACC,QAAT,CAAR,CAA2B,QAA3B,CADI,GAEJ,SAASF,IAAT,CAAcF,OAAd,IACIV,QAAQ,CAACa,OAAO,CAACC,QAAT,CAAR,CAA2B,OAA3B,CADJ,GAEIJ,OAJV;AAKA,QAAMK,KAAK,GAAGF,OAAO,CAACC,QAAR,KAAqB,QAAnC;AACA,QAAME,iBAAiB,GAAG,kBAAkBJ,IAAlB,CAAuBF,OAAvB,CAA1B;;AACA,MAAIK,KAAK,IAAIC,iBAAb,EAAgC;AAC5B;AACA;AACA;AACA,QAAI;AACA;AACA,YAAMC,KAAK,CAACC,OAAN,CAAc,+BAAd,EAA+C;AACjDC,QAAAA,KAAK,EAAE;AAD0C,OAA/C,CAAN,CAFA;;AAMA,YAAMC,UAAU,GAAGH,KAAK,CAAC,iDAAiDI,SAAS,CAACV,GAAD,CAA1D,GAAkE,GAAnE,EAAwE;AAC5FlE,QAAAA,GAAG,EAAE6E,SADuF;AAE5FC,QAAAA,KAAK,EAAE,QAFqF;AAG5FJ,QAAAA,KAAK,EAAE;AAHqF,OAAxE,CAAxB,CANA;;AAYA,UAAIK,eAAe,GAAGC,UAAU,CAAC,MAAM;AACnCL,QAAAA,UAAU,CAACM,MAAX;AACH,OAF+B,EAE7B,IAF6B,CAAhC;;AAGA,UAAI;AACA,cAAMN,UAAN;AACH,OAFD,CAGA,OAAOvE,GAAP,EAAY;AACR,YAAIA,GAAG,CAAC8E,UAAR,EAAoB;AAChB1H,UAAAA,OAAO,CAACV,IAAR,CAAc,4EAAd;AACH,SAFD,MAGK;AACDU,UAAAA,OAAO,CAACT,KAAR,CAAcqD,GAAG,CAACN,QAAJ,MAAkBM,GAAhC;AACH;;AACD+E,QAAAA,IAAI,CAACjB,GAAD,CAAJ;AACH,OAXD,SAYQ;AACJkB,QAAAA,YAAY,CAACL,eAAD,CAAZ;AACH;;AACD,aAAO,IAAP;AACH,KA/BD,CAgCA,OAAO3E,GAAP,EAAY;AACR;AACA;AACA+E,MAAAA,IAAI,CAACjB,GAAD,CAAJ;AACH;AACJ,GAzCD,MA0CK;AACDD,IAAAA,OAAO,KAAK,SAAZ,GAAwBkB,IAAI,CAACjB,GAAD,CAA5B,GAAoCiB,IAAI,CAACjB,GAAD,EAAM;AAAEmB,MAAAA,GAAG,EAAEpB;AAAP,KAAN,CAAxC;AACH;AACJ;AACD,AAAO,eAAeqB,iBAAf,CAAiCC,GAAjC,EAAsC;AACzC,QAAMC,WAAW,GAAG,MAAMC,MAAM,CAAC,CAAC,mBAAD,EAAsB,WAAtB,CAAD,CAAhC;;AACA,MAAI,CAACD,WAAL,EAAkB;AACd,WAAO,IAAP;AACH;;AACD,QAAME,OAAO,GAAG/G,IAAI,CAACC,IAAL,CAAU2G,GAAV,EAAetG,kBAAf,CAAhB;AACA,QAAM0G,WAAW,GAAGC,IAAI,CAAC,MAAMlG,WAAE,CAACC,QAAH,CAAYJ,QAAZ,CAAqBiG,WAArB,EAAkC,OAAlC,CAAP,CAAxB;AACA,QAAMK,WAAW,GAAG,MAAMnG,WAAE,CAACC,QAAH,CAAYJ,QAAZ,CAAqBmG,OAArB,EAA8B,OAA9B,EAAuCI,KAAvC,CAA6C,MAAM,EAAnD,CAA1B;AACA,SAAOH,WAAW,KAAKE,WAAvB;AACH;AACD,AAAO,eAAeE,kBAAf,CAAkCR,GAAlC,EAAuC;AAC1C,QAAMC,WAAW,GAAG,MAAMC,MAAM,CAAC,CAAC,mBAAD,EAAsB,WAAtB,CAAD,CAAhC;;AACA,MAAI,CAACD,WAAL,EAAkB;AACd;AACH;;AACD,QAAME,OAAO,GAAG/G,IAAI,CAACC,IAAL,CAAU2G,GAAV,EAAetG,kBAAf,CAAhB;AACA,QAAM0G,WAAW,GAAGC,IAAI,CAAC,MAAMlG,WAAE,CAACC,QAAH,CAAYJ,QAAZ,CAAqBiG,WAArB,CAAP,CAAxB;AACA,QAAMQ,MAAM,CAACrH,IAAI,CAACsH,OAAL,CAAaP,OAAb,CAAD,CAAZ;AACA,QAAMhG,WAAE,CAACC,QAAH,CAAYuG,SAAZ,CAAsBR,OAAtB,EAA+BC,WAA/B,CAAN;AACH;AACD,AAAO,eAAeQ,UAAf,GAA4B;AAC/B,SAAOC,OAAO,CAACC,GAAR,CAAY,CACfC,OAAO,CAACC,EAAR,CAAWF,GAAX,CAAe3H,cAAf,CADe,EAEf4H,OAAO,CAACC,EAAR,CAAWF,GAAX,CAAexH,WAAf,CAFe,EAGf2H,MAAM,CAACC,IAAP,CAAY3H,iBAAZ,CAHe,CAAZ,CAAP;AAKH;AACD;;;;AAGA,AAAO,SAAS4H,sBAAT,CAAgCC,MAAhC,EAAwCC,IAAxC,EAA8C;AACjD;AACA,MAAIA,IAAI,KAAK,GAAT,IACAA,IAAI,KAAK,IADT,IAEAA,IAAI,CAACtF,UAAL,CAAgB,IAAhB,CAFA,IAGAsF,IAAI,CAACtF,UAAL,CAAgB,KAAhB,CAHA,IAIAsF,IAAI,CAACtF,UAAL,CAAgB,GAAhB,CAJA,IAKAsF,IAAI,CAACtF,UAAL,CAAgB,SAAhB,CALA,IAMAsF,IAAI,CAACtF,UAAL,CAAgB,UAAhB,CANJ,EAMiC;AAC7B,WAAOJ,SAAP;AACH;;AACD,OAAK,MAAM,CAAC2F,IAAD,EAAOC,EAAP,CAAX,IAAyBjG,MAAM,CAACkG,OAAP,CAAeJ,MAAM,CAACK,KAAtB,CAAzB,EAAuD;AACnD,QAAIC,SAAS,GAAGC,mBAAmB,CAACJ,EAAD,CAAnB,GAA0B,SAA1B,GAAsC,MAAtD;AACA,UAAMK,YAAY,GAAGP,IAAI,KAAKQ,mBAAmB,CAACP,IAAD,CAAjD;AACA,UAAMQ,WAAW,GAAGT,IAAI,CAACtF,UAAL,CAAgBgG,gBAAgB,CAACT,IAAD,CAAhC,CAApB;;AACA,QAAIM,YAAY,IAAIE,WAApB,EAAiC;AAC7B,aAAO;AACHR,QAAAA,IADG;AAEHC,QAAAA,EAFG;AAGHS,QAAAA,IAAI,EAAEN;AAHH,OAAP;AAKH;AACJ;AACJ;AACD;;;;AAGA,AAAO,SAASC,mBAAT,CAA6BM,GAA7B,EAAkC;AACrC,SAAO,CAAC7I,IAAI,CAAC8I,UAAL,CAAgBD,GAAhB,CAAR;AACH;AACD;;AACA,AAAO,SAASE,MAAT,CAAgBC,QAAhB,EAA0B;AAC7B,SAAO;AACH;AACAC,IAAAA,OAAO,EAAEjJ,IAAI,CAACkJ,OAAL,CAAaF,QAAb,EAAuBG,iBAAvB,EAFN;;AAGH;AACAC,IAAAA,WAAW,EAAEpJ,IAAI,CAACqJ,QAAL,CAAcL,QAAd,EAAwB3E,OAAxB,CAAgC,OAAhC,EAAyC,EAAzC,EAA6C8E,iBAA7C;AAJV,GAAP;AAMH;AACD;;AACA,AAAO,SAASG,UAAT,CAAoBN,QAApB,EAA8BO,MAA9B,EAAsCC,MAAtC,EAA8C;AACjD,QAAMC,YAAY,GAAG,IAAIC,MAAJ,CAAY,KAAIH,MAAO,GAAvB,EAA2B,GAA3B,CAArB;AACA,SAAOP,QAAQ,CAAC3E,OAAT,CAAiBoF,YAAjB,EAA+BD,MAA/B,CAAP;AACH;AACD;;;;;;AAKA,AAAO,SAASG,mBAAT,CAA6B9I,QAA7B,EAAuC;AAC1C,QAAM+I,IAAI,GAAG/I,QAAQ,CAACwC,KAAT,CAAe,GAAf,CAAb;AACA,QAAMwG,IAAI,GAAGD,IAAI,CAACE,GAAL,EAAb;AACA,SAAO,CAAC,GAAGF,IAAI,CAACG,GAAL,CAAU/J,IAAD,IAAUA,IAAI,CAACqE,OAAL,CAAa,QAAb,EAAuB,IAAvB,CAAnB,CAAJ,EAAsDwF,IAAtD,EAA4D5J,IAA5D,CAAiE,GAAjE,CAAP;AACH;;AAED;;AACA,AAAO,SAAS+J,mBAAT,CAA6BhG,IAA7B,EAAmCiG,gBAAnC,EAAqD;AACxD,SAAOjG,IAAI,GAAI,wBAAuBiG,gBAAiB,KAAvD;AACH;AACD;;AACA,AAAO,SAASC,kBAAT,CAA4BlG,IAA5B,EAAkCiG,gBAAlC,EAAoD;AACvD,SAAOjG,IAAI,CAACK,OAAL,CAAa,MAAb,EAAqB,EAArB,IAA4B,0BAAyB4F,gBAAiB,IAA7E,CADuD;AAE1D;AACD;;;;;AAIA,AAAO,SAASE,oBAAT,CAA8B1G,GAA9B,EAAmC;AACtC,SAAO2G,mBAAmB,CAAC3G,GAAD,CAAnB,CAAyB4G,mBAAzB,GACD5G,GAAG,CAACY,OAAJ,CAAY,QAAZ,EAAsB,IAAtB,CADC;AAAA,IAEDZ,GAAG,CAACY,OAAJ,CAAY,UAAZ,EAAwB,EAAxB,CAFN,CADsC;AAIzC;AACD;;AACA,AAAO,SAASiG,WAAT,CAAqBC,KAArB,EAA4BC,KAA5B,EAAmC;AACtC,MAAIjF,GAAG,GAAGvF,IAAI,CAACyK,QAAL,CAAcF,KAAd,EAAqBC,KAArB,EAA4BnG,OAA5B,CAAoC,KAApC,EAA2C,GAA3C,CAAV;;AACA,MAAI,CAACkB,GAAG,CAAC5C,UAAJ,CAAe,IAAf,CAAD,IAAyB,CAAC4C,GAAG,CAAC5C,UAAJ,CAAe,KAAf,CAA9B,EAAqD;AACjD4C,IAAAA,GAAG,GAAG,OAAOA,GAAb;AACH;;AACD,SAAOA,GAAP;AACH;AACD,AAcA,MAAMmF,gBAAgB,GAAG,qBAAzB;AACA;;AACA,AAAO,SAASC,gBAAT,CAA0BC,GAA1B,EAA+BC,SAA/B,EAA0C;AAC7C,QAAMC,gBAAgB,GAAGF,GAAG,CAACG,KAAJ,CAAUL,gBAAV,CAAzB,CAD6C;;AAG7C,MAAI,CAACI,gBAAL,EAAuB;AACnB,UAAM,IAAIzL,KAAJ,CAAW,qEAAoEuL,GAAI,EAAnF,CAAN;AACH,GAL4C;;;AAO7C,MAAIE,gBAAgB,CAAC3L,MAAjB,GAA0B,CAA9B,EAAiC;AAC7B,UAAM,IAAIE,KAAJ,CAAW,mEAAkEuL,GAAI,EAAjF,CAAN;AACH;;AACD,SAAOA,GAAG,CAACvG,OAAJ,CAAYyG,gBAAgB,CAAC,CAAD,CAA5B,EAAiCD,SAAS,GAAGC,gBAAgB,CAAC,CAAD,CAA7D,CAAP;AACH;AACD;;AACA,AAAO,SAASE,eAAT,CAAyBhL,IAAzB,EAA+B;AAClC,SAAOA,IAAI,CAACqE,OAAL,CAAa,MAAb,EAAqB,GAArB,CAAP;AACH;AACD;;AACA,AAAO,SAASsE,gBAAT,CAA0B3I,IAA1B,EAAgC;AACnC,SAAOA,IAAI,CAACqE,OAAL,CAAa,MAAb,EAAqB,GAArB,CAAP;AACH;AACD;;AACA,AAAO,SAAS4G,kBAAT,CAA4BjL,IAA5B,EAAkC;AACrC,SAAOA,IAAI,CAACqE,OAAL,CAAa,SAAb,EAAwB,EAAxB,CAAP;AACH;AACD;;AACA,AAAO,SAASoE,mBAAT,CAA6BzI,IAA7B,EAAmC;AACtC,SAAOA,IAAI,CAACqE,OAAL,CAAa,SAAb,EAAwB,EAAxB,CAAP;AACH;AACD,AAAO,MAAM6G,eAAe,GAAGnK,WAAE,CAACQ,YAAH,CAAgBvB,IAAI,CAACC,IAAL,CAAUiG,SAAV,EAAqB,kBAArB,CAAhB,EAA0D,OAA1D,CAAxB;;ACpWP;;;;;;;;;;AASA,eAAeiF,iBAAf,CAAiCC,gBAAjC,EAAmDC,aAAnD,EAAkEC,QAAlE,EAA4EC,QAAQ,GAAG,IAAvF,EAA6F;AACzF;AACA;AACA;AACA;AACA,MAAI,CAACnB,mBAAmB,CAACgB,gBAAD,CAAnB,CAAsCf,mBAA3C,EAAgE;AAC5D,WAAO,IAAP;AACH,GAPwF;;;AASzF,MAAImB,UAAJ;AACA,MAAIC,cAAJ;;AACA,MAAIH,QAAQ,IAAIA,QAAQ,CAACtJ,OAAT,CAAiBoJ,gBAAjB,CAAhB,EAAoD;AAChDI,IAAAA,UAAU,GAAGF,QAAQ,CAACtJ,OAAT,CAAiBoJ,gBAAjB,CAAb;AACAK,IAAAA,cAAc,GAAG,KAAjB;AACH,GAHD,MAIK;AACD,QAAIJ,aAAa,KAAK,QAAtB,EAAgC;AAC5B1L,MAAAA,MAAM,CAACxB,IAAP,CAAa,QAAOiN,gBAAiB,iEAArC;AACH;;AACD,QAAIC,aAAa,CAAC1I,UAAd,CAAyB,eAAzB,KAA6C0I,aAAa,CAAC1I,UAAd,CAAyB,iBAAzB,CAAjD,EAA8F;AAC1FhD,MAAAA,MAAM,CAACvB,KAAP,CAAc,gGAAd;AACAqH,MAAAA,OAAO,CAACiG,IAAR,CAAa,CAAb;AACH;;AACD,QAAIL,aAAa,CAACM,QAAd,CAAuB,GAAvB,KAA+BN,aAAa,CAACM,QAAd,CAAuB,GAAvB,CAAnC,EAAgE;AAC5DhM,MAAAA,MAAM,CAACxB,IAAP,CAAa,QAAOiN,gBAAiB,kCAAiCC,aAAc,oBAApF;AACA,aAAO,IAAP;AACH;;AACDI,IAAAA,cAAc,GAAG,QAAjB;AACAD,IAAAA,UAAU,GAAI,GAAE5L,QAAS,IAAGwL,gBAAiB,IAAGC,aAAc,EAA9D;AACH,GA7BwF;AA+BzF;;;AACA,MAAII,cAAc,KAAK,KAAvB,EAA8B;AAC1B,UAAMG,YAAY,GAAG,MAAMjE,OAAO,CAACkE,GAAR,CAAY3N,IAAZ,CAAiB6B,cAAjB,EAAiCyL,UAAjC,EAA6CrE,KAA7C,CAAmD,MAAM,IAAzD,CAA3B;;AACA,QAAIyE,YAAJ,EAAkB;AACd,UAAIA,YAAY,CAACE,QAAjB,EAA2B;AACvB,cAAM;AAAEC,UAAAA;AAAF,YAAgBH,YAAY,CAACE,QAAnC;AACA,eAAOC,SAAP;AACH;AACJ;AACJ,GAxCwF;;;AA0CzF,QAAM;AAAEC,IAAAA,UAAF;AAAcnJ,IAAAA,OAAd;AAAuBoJ,IAAAA;AAAvB,MAAgC,MAAMzJ,gBAAgB,CAACgJ,UAAD,CAA5D;;AACA,MAAIQ,UAAU,KAAK,GAAnB,EAAwB;AACpBrM,IAAAA,MAAM,CAACxB,IAAP,CAAa,sBAAqB6N,UAAW,MAAKR,UAAW,KAAIS,IAAK,GAAtE;AACAtM,IAAAA,MAAM,CAACxB,IAAP,CAAa,+BAAb;AACA,WAAO,IAAP;AACH;;AACD,MAAI+N,aAAa,GAAGrJ,OAAO,CAAC,cAAD,CAA3B;AACA,MAAIsJ,aAAa,GAAGtJ,OAAO,CAAC,cAAD,CAA3B;AACA,QAAMuJ,WAAW,GAAGvJ,OAAO,CAAC,iBAAD,CAA3B;AACA,QAAMwJ,YAAY,GAAGxJ,OAAO,CAAC,oBAAD,CAA5B;AACA,QAAMyJ,QAAQ,GAAGD,YAAY,IAAK,GAAEzM,QAAS,GAAEyM,YAAa,EAA5D;;AACA,MAAIZ,cAAc,KAAK,KAAvB,EAA8B;AAC1B,UAAMM,SAAS,GAAGP,UAAlB;AACA,UAAM7D,OAAO,CAAC4E,GAAR,CAAYxM,cAAZ,EAA4BgM,SAA5B,EAAuCE,IAAvC,EAA6C;AAC/CH,MAAAA,QAAQ,EAAE;AAAEC,QAAAA,SAAF;AAAaO,QAAAA;AAAb;AADqC,KAA7C,CAAN;AAGA,WAAOP,SAAP;AACH;;AACD,MAAII,aAAJ,EAAmB;AACf,UAAMJ,SAAS,GAAI,GAAEnM,QAAS,GAAEuM,aAAc,EAA9C;AACA,UAAMxE,OAAO,CAAC4E,GAAR,CAAYxM,cAAZ,EAA4BgM,SAA5B,EAAuCE,IAAvC,EAA6C;AAC/CH,MAAAA,QAAQ,EAAE;AAAEC,QAAAA,SAAF;AAAaO,QAAAA;AAAb;AADqC,KAA7C,CAAN;AAGA,WAAOP,SAAP;AACH;;AACD,MAAIK,WAAW,KAAK,SAApB,EAA+B;AAC3BzM,IAAAA,MAAM,CAACxB,IAAP,CAAa,qBAAoB6N,UAAW,MAAKR,UAAW,EAA5D;AACA7L,IAAAA,MAAM,CAACxB,IAAP,CAAa,+BAAb;AACA,WAAO,IAAP;AACH;;AACD,MAAI,CAACoN,QAAD,IAAaa,WAAW,KAAK,MAAjC,EAAyC;AACrCzM,IAAAA,MAAM,CAACxB,IAAP,CAAa,oBAAmBiN,gBAAiB,IAAGC,aAAc,EAAlE;AACA1L,IAAAA,MAAM,CAACxB,IAAP,CAAa,+BAAb;AACA,WAAO,IAAP;AACH;;AACDwB,EAAAA,MAAM,CAACzB,IAAP,CAAYe,WAAA,CAAa,YAAWmM,gBAAiB,IAAGC,aAAc,8DAA1D,CAAZ;;AACA,MAAI,CAACa,aAAL,EAAoB;AAChBvM,IAAAA,MAAM,CAACvB,KAAP,CAAa,kDAAb;AACAqH,IAAAA,OAAO,CAACiG,IAAR,CAAa,CAAb;AACH;;AACD,QAAM;AAAEM,IAAAA,UAAU,EAAEQ;AAAd,MAAmC,MAAMhK,gBAAgB,CAAC0J,aAAD,CAA/D;;AACA,MAAIM,gBAAgB,KAAK,GAAzB,EAA8B;AAC1B7M,IAAAA,MAAM,CAACvB,KAAP,CAAc,wBAAuBoO,gBAAiB,MAAK5M,QAAS,GAAEsM,aAAc,EAApF;AACAzG,IAAAA,OAAO,CAACiG,IAAR,CAAa,CAAb;AACH;;AACD,SAAOP,iBAAiB,CAACC,gBAAD,EAAmBC,aAAnB,EAAkCC,QAAlC,EAA4C,KAA5C,CAAxB;AACH;;AACD,AAAO,eAAemB,2BAAf,CAA2CnB,QAA3C,EAAqDtD,MAArD,EAA6D;AAChE,QAAM0E,aAAa,GAAG,IAAIC,MAAJ,CAAW;AAAEC,IAAAA,WAAW,EAAE;AAAf,GAAX,CAAtB;AACA,QAAMC,WAAW,GAAG;AAAE7K,IAAAA,OAAO,EAAE;AAAX,GAApB;AACA,MAAI8K,eAAJ;;AACA,OAAK,MAAM,CAAC1B,gBAAD,EAAmB2B,aAAnB,CAAX,IAAgD7K,MAAM,CAACkG,OAAP,CAAeJ,MAAM,CAACgF,eAAtB,CAAhD,EAAwF;AACpFN,IAAAA,aAAa,CAACO,GAAd,CAAkB,YAAY;AAC1B,UAAI;AACA,cAAMC,WAAW,GAAG,MAAM/B,iBAAiB,CAACC,gBAAD,EAAmB2B,aAAnB,EAAkCzB,QAAlC,CAA3C;;AACA,YAAI4B,WAAJ,EAAiB;AACbL,UAAAA,WAAW,CAAC7K,OAAZ,CAAoBoJ,gBAApB,IAAwC8B,WAAxC;AACH;AACJ,OALD,CAMA,OAAOzL,GAAP,EAAY;AACRqL,QAAAA,eAAe,GAAGA,eAAe,IAAIrL,GAArC;AACH;AACJ,KAVD;AAWH;;AACD,QAAMiL,aAAa,CAACS,MAAd,EAAN;;AACA,MAAIL,eAAJ,EAAqB;AACjB,UAAMA,eAAN;AACH;;AACD,SAAOD,WAAP;AACH;;AC7HD;;;;;;AAKA,AAAO,SAASO,2BAAT,GAAuC;AAC1C,SAAO;AACHrO,IAAAA,IAAI,EAAE,yCADH;;AAEHsO,IAAAA,SAAS,CAACC,EAAD,EAAKC,QAAL,EAAe;AACpB;AACA,UAAID,EAAE,CAAC3K,UAAH,CAAc,SAAd,KAA4B2K,EAAE,CAAC3K,UAAH,CAAc,UAAd,CAAhC,EAA2D;AACvD,eAAO,KAAP;AACH;;AACD,UAAI6K,aAAa,CAACF,EAAD,CAAjB,EAAuB;AACnB,aAAKnP,IAAL,CAAU;AACNmP,UAAAA,EAAE,EAAEC,QADE;AAEN3O,UAAAA,OAAO,EAAG,WAAU0O,EAAG;AAFjB,SAAV;AAIH,OALD,MAMK;AACD,aAAKnP,IAAL,CAAU;AACNmP,UAAAA,EAAE,EAAEC,QADE;AAEN3O,UAAAA,OAAO,EAAG,WAAU0O,EAAG;AAFjB,SAAV;AAIH;;AACD,aAAO,KAAP;AACH;;AApBE,GAAP;AAsBH;;AC5BD,MAAMG,cAAc,GAAI;;;;;;;;;;;;;;CAAxB;AAeA;;;;;;;;;;;AAUA,SAASC,WAAT,CAAqBJ,EAArB,EAAyB;AACrB,SAAQA,EAAE,KAAK,YAAP,IACJA,EAAE,KAAK,cADH,IAEJA,EAAE,CAAC3B,QAAH,CAAY3L,IAAI,CAACC,IAAL,CAAU,cAAV,EAA0B,YAA1B,CAAZ,CAFI;AAGJqN,EAAAA,EAAE,CAAC3B,QAAH,CAAY3L,IAAI,CAACC,IAAL,CAAU,cAAV,EAA0B,cAA1B,CAAZ,CAHJ;AAIH;;AACD,AAAO,SAAS0N,sBAAT,GAAkC;AACrC,SAAO;AACH5O,IAAAA,IAAI,EAAE,wBADH;;AAEHsO,IAAAA,SAAS,CAACC,EAAD,EAAK;AACV,aAAOI,WAAW,CAACJ,EAAD,CAAX,GAAkBA,EAAlB,GAAuB,IAA9B;AACH,KAJE;;AAKHM,IAAAA,IAAI,CAACN,EAAD,EAAK;AACL,aAAOI,WAAW,CAACJ,EAAD,CAAX,GAAkBG,cAAlB,GAAmC,IAA1C;AACH;;AAPE,GAAP;AASH;;ACzCD,SAASI,eAAT,CAAyB9O,IAAzB,EAA+BiF,IAA/B,EAAqC;AACjC,SAAQ;6BACiBjF,IAAK;;;;;;;;;;;;0BAYR2C,IAAI,CAACY,SAAL,CAAe0B,IAAf,CAAqB,MAb3C;AAcH;AACD;;;;;;;;;;AAQA,AAAO,SAAS8J,eAAT,GAA2B;AAC9B,SAAO;AACH/O,IAAAA,IAAI,EAAE,4BADH;;AAEHsO,IAAAA,SAAS,CAACU,MAAD,EAASR,QAAT,EAAmB;AACxB,UAAI,CAACQ,MAAM,CAACC,QAAP,CAAgB,MAAhB,CAAL,EAA8B;AAC1B,eAAO,IAAP;AACH;;AACD,aAAO,KAAKlK,OAAL,CAAaiK,MAAb,EAAqBR,QAArB,EAA+B;AAAEU,QAAAA,QAAQ,EAAE;AAAZ,OAA/B,EAAmDC,IAAnD,CAAyDC,QAAD,IAAc;AACzE,eAAOA,QAAQ,IAAI,IAAnB;AACH,OAFM,CAAP;AAGH,KATE;;AAUH,UAAMP,IAAN,CAAWN,EAAX,EAAe;AACX,UAAI,CAACA,EAAE,CAACU,QAAH,CAAY,MAAZ,CAAL,EAA0B;AACtB,eAAO,IAAP;AACH;;AACD,YAAMhK,IAAI,GAAG,MAAMjD,WAAE,CAACH,QAAH,CAAY0M,EAAZ,EAAgB;AAAE9L,QAAAA,QAAQ,EAAE;AAAZ,OAAhB,CAAnB;AACA,YAAM4M,iBAAiB,GAAGd,EAAE,CAACjJ,OAAH,CAAW,sBAAX,EAAmC,EAAnC,EAAuCA,OAAvC,CAA+C,SAA/C,EAA0D,GAA1D,CAA1B;AACA,aAAOwJ,eAAe,CAACO,iBAAD,EAAoBpK,IAApB,CAAtB;AACH;;AAjBE,GAAP;AAmBH;;ACtCD,MAAMqK,qBAAqB,GAAG,qBAA9B;AACA,MAAMC,oBAAoB,GAAG1O,QAAQ,CAACT,MAAtC;AACA;;;;;;;;;AAQA,AAAO,SAASoP,2BAAT,CAAqC;AAAEC,EAAAA,YAAF;AAAgB1P,EAAAA;AAAhB,CAArC,EAA6D;AAChE,QAAM2P,iBAAiB,GAAG,IAAIC,GAAJ,EAA1B;AACA,SAAO;AACH3P,IAAAA,IAAI,EAAE,mCADH;;AAEH,UAAMsO,SAAN,CAAgBU,MAAhB,EAAwBR,QAAxB,EAAkC;AAC9B,UAAIoB,QAAJ;;AACA,UAAIZ,MAAM,CAACpL,UAAP,CAAkB/C,QAAlB,CAAJ,EAAiC;AAC7B+O,QAAAA,QAAQ,GAAGZ,MAAX;AACH,OAFD,MAGK,IAAIA,MAAM,CAACpL,UAAP,CAAkB,KAAlB,CAAJ,EAA8B;AAC/BgM,QAAAA,QAAQ,GAAG/O,QAAQ,GAAGmO,MAAtB;AACH,OAFI,MAGA,IAAIA,MAAM,CAACpL,UAAP,CAAkB,OAAlB,CAAJ,EAAgC;AACjCgM,QAAAA,QAAQ,GAAG/O,QAAQ,GAAGmO,MAAtB;AACH,OAFI,MAGA;AACD,eAAO,IAAP;AACH,OAb6B;AAe9B;AACA;;;AACAjP,MAAAA,GAAG,CAAC6P,QAAD,CAAH;;AACA,UAAIpO,kBAAkB,CAACiF,IAAnB,CAAwBmJ,QAAxB,CAAJ,EAAuC;AACnC,cAAM/C,YAAY,GAAG,MAAMjE,OAAO,CAACkE,GAAR,CACtB3N,IADsB,CACjB6B,cADiB,EACD4O,QADC,EAEtBxH,KAFsB,CAEhB;AAAE;AAAiB,YAFH,CAA3B;;AAGA,YAAIyE,YAAJ,EAAkB;AACd,iBAAOyC,qBAAqB,GAAGM,QAA/B;AACH;AACJ,OAzB6B;;;AA2B9B,YAAMC,QAAQ,GAAG,MAAMpM,gBAAgB,CAACmM,QAAD,CAAvC;;AACA,UAAIC,QAAQ,CAAC5C,UAAT,KAAwB,GAA5B,EAAiC;AAC7B,cAAMK,YAAY,GAAGuC,QAAQ,CAAC/L,OAAT,CAAiB,oBAAjB,CAArB;AACA,cAAMsJ,aAAa,GAAGyC,QAAQ,CAAC/L,OAAT,CAAiB,cAAjB,CAAtB;AACA,cAAMyJ,QAAQ,GAAGD,YAAY,IAAK,GAAEzM,QAAS,GAAEyM,YAAa,EAA5D;AACA,cAAMN,SAAS,GAAGI,aAAa,IAAK,GAAEvM,QAAS,GAAEuM,aAAc,EAA/D;AACA,cAAMxE,OAAO,CAAC4E,GAAR,CAAYxM,cAAZ,EAA4B4O,QAA5B,EAAsCC,QAAQ,CAAC3C,IAA/C,EAAqD;AACvDH,UAAAA,QAAQ,EAAE;AAAEC,YAAAA,SAAF;AAAaO,YAAAA;AAAb;AAD6C,SAArD,CAAN;AAGA,eAAO+B,qBAAqB,GAAGM,QAA/B;AACH,OArC6B;AAuC9B;;;AACA,YAAME,WAAW,GAAGF,QAAQ,CACvBlK,SADe,CACL6J,oBADK,EAEfjK,OAFe,CAEP,KAFO,EAEA,EAFA,EAGfA,OAHe,CAGP,OAHO,EAGE,EAHF,EAIfhB,KAJe,CAIT,GAJS,EAIJ,CAJI,CAApB;AAKA,aAAO,KAAKS,OAAL,CAAa+K,WAAb,EAA0BtB,QAA1B,EAAoC;AAAEU,QAAAA,QAAQ,EAAE;AAAZ,OAApC,EAAwDC,IAAxD,CAA8DC,QAAD,IAAc;AAC9E,YAAIW,WAAW,GAAGX,QAAlB;;AACA,YAAI,CAACW,WAAL,EAAkB;AACdA,UAAAA,WAAW,GAAG;AAAExB,YAAAA,EAAE,EAAEuB;AAAN,WAAd;AACH;;AACD,eAAOC,WAAP;AACH,OANM,CAAP;AAOH,KAtDE;;AAuDH,UAAMlB,IAAN,CAAWN,EAAX,EAAe;AAAA;;AACX,UAAI,CAACA,EAAE,CAAC3K,UAAH,CAAc0L,qBAAd,CAAL,EAA2C;AACvC,eAAO,IAAP;AACH;;AACD,YAAMM,QAAQ,GAAGrB,EAAE,CAAC7I,SAAH,CAAa4J,qBAAqB,CAAClP,MAAnC,CAAjB;AACAL,MAAAA,GAAG,CAAC6P,QAAD,CAAH;AACA,YAAM/C,YAAY,GAAG,MAAMjE,OAAO,CAACkE,GAAR,CAAY9L,cAAZ,EAA4B4O,QAA5B,CAA3B;AACA,YAAMrC,QAAQ,4BAAGV,YAAY,CAACE,QAAhB,0DAAG,sBAAuBQ,QAAxC;;AACA,UAAIA,QAAQ,IAAIkC,YAAhB,EAA8B;AAC1B,cAAMO,eAAe,GAAGzC,QAAQ,CAACjI,OAAT,CAAiB,qBAAjB,EAAwC,YAAxC,CAAxB;AACAoK,QAAAA,iBAAiB,CAACxB,GAAlB,CAAsB8B,eAAtB;AACH;;AACD,aAAOnD,YAAY,CAAC9K,IAAb,CAAkBK,QAAlB,CAA2B,OAA3B,CAAP;AACH,KApEE;;AAqEH,UAAM6N,WAAN,CAAkB1P,OAAlB,EAA2B;AACvB,UAAI,CAACkP,YAAL,EAAmB;AACf;AACH;;AACD,YAAMnH,MAAM,CAACrH,IAAI,CAACC,IAAL,CAAUX,OAAO,CAACsH,GAAlB,EAAuB,QAAvB,CAAD,CAAZ;AACA,YAAMqI,OAAO,GAAG,MAAMtH,OAAO,CAACuH,GAAR,CAAYC,KAAZ,CAAkBpP,cAAlB,CAAtB;;AACA,WAAK,MAAMgP,eAAX,IAA8BN,iBAA9B,EAAiD;AAC7C,YAAIW,eAAJ;AACA,cAAMC,aAAa,GAAG,MAAM1H,OAAO,CAC9BkE,GADuB,CACnB9L,cADmB,EACHgP,eADG,EAEvB5H,KAFuB,CAEjB;AAAE;AAAiB,YAFF,CAA5B;;AAGA,YAAIkI,aAAJ,EAAmB;AACfD,UAAAA,eAAe,GAAGC,aAAa,CAACvO,IAAhC;AACH,SAFD,MAGK;AACD,gBAAMwO,eAAe,GAAG,MAAM9M,gBAAgB,CAACuM,eAAD,EAAkB,QAAlB,CAA9C;;AACA,cAAIO,eAAe,CAACtD,UAAhB,KAA+B,GAAnC,EAAwC;AACpC;AACH;;AACDoD,UAAAA,eAAe,GAAGE,eAAe,CAACrD,IAAlC;AACA,gBAAMtE,OAAO,CAAC4E,GAAR,CAAYxM,cAAZ,EAA4BgP,eAA5B,EAA6CK,eAA7C,CAAN;AACH;;AACD,cAAMG,aAAa,GAAGhK,GAAG,CAAC5D,KAAJ,CAAUoN,eAAV,EAA2BS,QAA3B,CAAoCnM,KAApC,CAA0C,GAA1C,CAAtB;AACA,cAAMoM,gBAAgB,GAAGlK,GAAG,CAAC5D,KAAJ,CAAUoN,eAAV,EAA2BS,QAA3B,CAAoC7M,UAApC,CAA+C,MAA/C,IACnB4M,aAAa,CAAC,CAAD,CAAb,GAAmB,GAAnB,GAAyBA,aAAa,CAAC,CAAD,CAAb,CAAiBlM,KAAjB,CAAuB,GAAvB,EAA4B,CAA5B,CADN,GAEnBkM,aAAa,CAAC,CAAD,CAAb,CAAiBlM,KAAjB,CAAuB,GAAvB,EAA4B,CAA5B,CAFN;AAGA,cAAMqM,kBAAkB,GAAG1P,IAAI,CAACC,IAAL,CAAUgP,OAAV,EAAoB,GAAEQ,gBAAiB,MAAvC,CAA3B;;AACA,YAAIA,gBAAgB,CAAC9D,QAAjB,CAA0B,GAA1B,CAAJ,EAAoC;AAChC,gBAAMtE,MAAM,CAACrH,IAAI,CAACsH,OAAL,CAAaoI,kBAAb,CAAD,CAAZ;AACH;;AACD3O,QAAAA,WAAE,CAACsB,aAAH,CAAiBqN,kBAAjB,EAAqCN,eAArC;AACA,cAAMO,eAAe,GAAG3P,IAAI,CAACC,IAAL,CAAUX,OAAO,CAACsH,GAAlB,EAAwB,UAAS6I,gBAAiB,EAAlD,CAAxB;AACA,cAAMpI,MAAM,CAACsI,eAAD,CAAZ;AACA,cAAMC,GAAG,CAACC,CAAJ,CAAM;AACRhG,UAAAA,IAAI,EAAE6F,kBADE;AAERrO,UAAAA,GAAG,EAAEsO;AAFG,SAAN,CAAN;AAIH;AACJ;;AA3GE,GAAP;AA6GH;;AC7HM,SAASG,2BAAT,CAAqCC,EAArC,EAAyC;AAC5C,MAAIC,SAAJ;AACA,MAAIC,iBAAiB,GAAG,EAAxB;AACA,MAAIC,YAAY,GAAG;AACfC,IAAAA,MAAM,EAAE,EADO;AAEfC,IAAAA,MAAM,EAAE;AAFO,GAAnB;;AAIA,WAASC,sBAAT,CAAgCC,MAAhC,EAAwC;AACpC,SAAK,IAAItH,QAAT,IAAqB9G,MAAM,CAACC,IAAP,CAAYmO,MAAZ,CAArB,EAA0C;AACtC,YAAMC,QAAQ,GAAGvQ,IAAI,CAACC,IAAL,CAAU+P,SAAV,EAAqBhH,QAArB,CAAjB;;AACA,UAAIjI,WAAE,CAACyP,UAAH,CAAcD,QAAd,CAAJ,EAA6B;AACzB,cAAM;AAAEE,UAAAA;AAAF,YAAW1P,WAAE,CAAC2P,QAAH,CAAYH,QAAZ,CAAjB;AACAN,QAAAA,iBAAiB,CAACjH,QAAD,CAAjB,GAA8ByH,IAA9B;AACH;AACJ;AACJ;;AACD,WAASE,mBAAT,CAA6BC,KAA7B,EAAoChI,IAApC,EAA0C;AACtC,SAAK,IAAI;AAAEI,MAAAA,QAAF;AAAY6H,MAAAA;AAAZ,KAAT,IAAmCD,KAAnC,EAA0C;AACtC,YAAMH,IAAI,GAAGI,QAAQ,CAACC,UAAtB;AACAZ,MAAAA,YAAY,CAACtH,IAAD,CAAZ,CAAmBI,QAAnB,IAA+B;AAC3ByH,QAAAA,IAAI,EAAEA,IADqB;AAE3BM,QAAAA,IAAI,EAAEC,IAAI,CAACC,QAAL,CAAcJ,QAAd,EAAwBC,UAFH;AAG3BI,QAAAA,MAAM,EAAEF,IAAI,CAACG,kBAAL,GAA0BH,IAAI,CAACG,kBAAL,CAAwBN,QAAxB,EAAkCC,UAA5D,GAAyE;AAHtD,OAA/B;;AAKA,UAAIb,iBAAiB,CAACjH,QAAD,CAArB,EAAiC;AAC7B,cAAMoI,KAAK,GAAG,CAACX,IAAI,GAAGR,iBAAiB,CAACjH,QAAD,CAAzB,IAAuC,IAArD;AACAkH,QAAAA,YAAY,CAACtH,IAAD,CAAZ,CAAmBI,QAAnB,EAA6BoI,KAA7B,GAAqCA,KAArC;AACH;AACJ;AACJ;;AACD,SAAO;AACHrS,IAAAA,IAAI,EAAE,8BADH;;AAEHsS,IAAAA,cAAc,CAAC/R,OAAD,EAAUgR,MAAV,EAAkB;AAC5BN,MAAAA,SAAS,GAAG1Q,OAAO,CAACsH,GAApB;AACAyJ,MAAAA,sBAAsB,CAACC,MAAD,CAAtB;AACH,KALE;;AAMHtB,IAAAA,WAAW,CAACsC,CAAD,EAAIhB,MAAJ,EAAY;AACnB,YAAMiB,kBAAkB,GAAG,EAA3B;AACA,YAAMC,kBAAkB,GAAG,EAA3B;;AACA,WAAK,MAAM,CAACxI,QAAD,EAAWyI,YAAX,CAAX,IAAuCvP,MAAM,CAACkG,OAAP,CAAekI,MAAf,CAAvC,EAA+D;AAC3D,cAAMoB,GAAG,GAAGD,YAAY,CAAC7I,IAAb,KAAsB,OAAtB,GAAgC6I,YAAY,CAAC1D,MAA7C,GAAsD0D,YAAY,CAACzN,IAA/E;AACA,cAAM6M,QAAQ,GAAGc,MAAM,CAACC,QAAP,CAAgBF,GAAhB,IACXA,GADW,GAEX,OAAOA,GAAP,KAAe,QAAf,GACIC,MAAM,CAACzJ,IAAP,CAAYwJ,GAAZ,EAAiB,OAAjB,CADJ,GAEIC,MAAM,CAACzJ,IAAP,CAAYwJ,GAAZ,CAJV;;AAKA,YAAI1I,QAAQ,CAACrG,UAAT,CAAoB,QAApB,CAAJ,EAAmC;AAC/B6O,UAAAA,kBAAkB,CAACtS,IAAnB,CAAwB;AAAE8J,YAAAA,QAAF;AAAY6H,YAAAA;AAAZ,WAAxB;AACH,SAFD,MAGK;AACDU,UAAAA,kBAAkB,CAACrS,IAAnB,CAAwB;AAAE8J,YAAAA,QAAF;AAAY6H,YAAAA;AAAZ,WAAxB;AACH;AACJ;;AACDF,MAAAA,mBAAmB,CAACY,kBAAD,EAAqB,QAArB,CAAnB;AACAZ,MAAAA,mBAAmB,CAACa,kBAAD,EAAqB,QAArB,CAAnB;AACAzB,MAAAA,EAAE,CAACG,YAAD,CAAF;AACH;;AA1BE,GAAP;AA4BH;;ACzDD,SAAS2B,iBAAT,CAA2BC,OAA3B,EAAoC;AAChC,MAAI;AACA,WAAO5P,MAAM,CAACC,IAAP,CAAY0B,OAAO,CAACiO,OAAD,CAAnB,EAA8BC,MAA9B,CAAsC5O,GAAD,IAASA,GAAG,KAAK,SAAtD,CAAP;AACH,GAFD,CAGA,OAAO1B,GAAP,EAAY;AACR9B,IAAAA,MAAM,CAACvB,KAAP,CAAc,uCAAsCa,WAAA,CAAY6S,OAAZ,CAAqB;EAC/ErQ,GAAG,CAAC7C,OAAQ,EADN;AAEH;AACJ;AACD;;;;;;;;;;;;;;AAYA,AAAO,SAASoT,8BAAT,CAAwCC,WAAxC,EAAqDC,wBAArD,EAA+EC,cAA/E,EAA+F;AAClG,QAAMC,sBAAsB,GAAG,EAA/B;;AACA,WAASC,YAAT,CAAsBC,iBAAtB,EAAyC;AACrC,WAAOJ,wBAAwB,CAACK,IAAzB,CAA+BC,CAAD,IAAOF,iBAAiB,CAAC3G,QAAlB,CAA4B,gBAAe6G,CAAE,GAAEA,CAAC,CAACxE,QAAF,CAAW,KAAX,IAAoB,EAApB,GAAyB,GAAI,EAA5E,CAArC,CAAP;AACH;;AACD,SAAO;AACHjP,IAAAA,IAAI,EAAE,+BADH;;AAEH;AACA0T,IAAAA,UAAU,CAACC,YAAD,EAAe;AACrB,YAAMC,KAAK,GAAGD,YAAY,CAACC,KAA3B;;AACA,WAAK,MAAM,CAAC1Q,GAAD,EAAM4G,GAAN,CAAX,IAAyB3G,MAAM,CAACkG,OAAP,CAAeuK,KAAf,CAAzB,EAAgD;AAC5C,cAAMC,iBAAiB,GAAGT,cAAc,CAACJ,MAAf,CAAuB5O,GAAD,IAASgH,oBAAoB,CAAChH,GAAG,CAAC0P,SAAL,CAApB,KAAwC5Q,GAAvE,CAA1B;AACA,cAAM6Q,oBAAoB,GAAGF,iBAAiB,CAACG,MAAlB,CAAyB,CAACC,OAAD,EAAU7P,GAAV,KAAkB;AACpE6P,UAAAA,OAAO,CAACtL,GAAR,GAAcsL,OAAO,CAACtL,GAAR,IAAevE,GAAG,CAACuE,GAAjC;AACAsL,UAAAA,OAAO,CAACC,OAAR,GAAkBD,OAAO,CAACC,OAAR,IAAmB9P,GAAG,CAAC8P,OAAvB,IAAkC9P,GAAG,CAACuE,GAAxD;AACAsL,UAAAA,OAAO,CAACE,SAAR,GAAoBF,OAAO,CAACE,SAAR,IAAqB/P,GAAG,CAAC+P,SAAzB,IAAsC/P,GAAG,CAACuE,GAA9D;AACAsL,UAAAA,OAAO,CAACG,KAAR,GAAgB,CAAC,IAAIH,OAAO,CAACG,KAAR,IAAiB,EAArB,CAAD,EAA2B,GAAGhQ,GAAG,CAACgQ,KAAlC,CAAhB;AACA,iBAAOH,OAAP;AACH,SAN4B,EAM1B,EAN0B,CAA7B;AAOAZ,QAAAA,sBAAsB,CAACvJ,GAAD,CAAtB,GAA8BiK,oBAA9B;AACA,cAAMR,iBAAiB,GAAGzJ,GAAG,CAACxF,KAAJ,CAAUrD,IAAI,CAAC6E,KAAL,CAAWT,GAArB,EAA0BnE,IAA1B,CAA+BD,IAAI,CAACoT,KAAL,CAAWhP,GAA1C,CAA1B;;AACA,YAAIiO,YAAY,CAACC,iBAAD,CAAhB,EAAqC;AACjCK,UAAAA,KAAK,CAAC1Q,GAAD,CAAL,GAAc,iBAAgB4G,GAAI,EAAlC;AACH;;AACD,YAAIoJ,WAAW,IAAI,CAACa,oBAAoB,CAACpL,GAAzC,EAA8C;AAC1CiL,UAAAA,KAAK,CAAC1Q,GAAD,CAAL,GAAc,iBAAgB4G,GAAI,EAAlC;AACH;AACJ;AACJ,KAvBE;;AAwBHwE,IAAAA,SAAS,CAACU,MAAD,EAAS;AACd,UAAIA,MAAM,CAACpL,UAAP,CAAkB,gBAAlB,CAAJ,EAAyC;AACrC,eAAOoL,MAAP;AACH;;AACD,aAAO,IAAP;AACH,KA7BE;;AA8BHH,IAAAA,IAAI,CAACN,EAAD,EAAK;AACL,UAAI,CAACA,EAAE,CAAC3K,UAAH,CAAc,gBAAd,CAAL,EAAsC;AAClC,eAAO,IAAP;AACH;;AACD,YAAMmP,OAAO,GAAGxE,EAAE,CAAC7I,SAAH,CAAa,iBAAiBtF,MAA9B,CAAhB,CAJK;;AAML,YAAM2T,oBAAoB,GAAGV,sBAAsB,CAACN,OAAD,CAAnD;AACA,UAAIuB,kBAAkB,GAAGC,KAAK,CAACpL,IAAN,CAAW,IAAIwG,GAAJ,CAAQoE,oBAAoB,CAACK,KAA7B,CAAX,CAAzB;AACA,YAAMb,iBAAiB,GAAGR,OAAO,CAACzO,KAAR,CAAcrD,IAAI,CAAC6E,KAAL,CAAWT,GAAzB,EAA8BnE,IAA9B,CAAmCD,IAAI,CAACoT,KAAL,CAAWhP,GAA9C,CAA1B;;AACA,UAAI,CAAC,CAAC6N,WAAD,IAAgBa,oBAAoB,CAACI,SAAtC,KAAoDb,YAAY,CAACC,iBAAD,CAApE,EAAyF;AACrFe,QAAAA,kBAAkB,GAAGxB,iBAAiB,CAACC,OAAD,CAAjB,IAA8BuB,kBAAnD;AACAP,QAAAA,oBAAoB,CAACG,OAArB,GAA+B,IAA/B;AACH;;AACD,YAAMhP,MAAM,GAAI;UAClB6O,oBAAoB,CAACI,SAArB,GAAkC,kBAAiBZ,iBAAkB,IAArE,GAA2E,EAAG;UAC9EQ,oBAAoB,CAACG,OAArB,GACS,4DAA2DX,iBAAkB,gEADtF,GAEQ,EAAG;UACV,WAAUe,kBAAkB,CAACpT,IAAnB,CAAwB,GAAxB,CAA6B,WAAUqS,iBAAkB,IAAI;OALtE;AAOA,aAAOrO,MAAP;AACH;;AAnDE,GAAP;AAqDH;;ACnFD;;;;;;;;;;;;;;;;;;;;;;;;;AAwBA;;;;AAIA,AAAO,SAASsP,uBAAT,CAAiCC,GAAjC,EAAsC;AACzC,SAAQ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;SA8MH9R,IAAI,CAACY,SAAL,CAAekR,GAAf,CAAoB;;;;;;;;;;;;;;;;;;;;;;;CA9MzB;AAsOH;;ACjQD,MAAMC,mBAAmB,GAAG,SAA5B;AACA,AAAO,SAASC,+BAAT,CAAyCF,GAAG,GAAG,EAA/C,EAAmD;AACtD,QAAMG,YAAY,GAAGC,MAAM,CAAC;AACxBnO,IAAAA,OAAO,EAAEgO;AADe,GAAD,CAA3B;AAGA,2CACOE,YADP;AAEI5U,IAAAA,IAAI,EAAE,8CAFV;;AAGIsO,IAAAA,SAAS,CAACU,MAAD,EAAS;AACd,UAAIA,MAAM,KAAK0F,mBAAf,EAAoC;AAChC,eAAOA,mBAAP;AACH;;AACD,aAAO,IAAP;AACH,KARL;;AASI7F,IAAAA,IAAI,CAACN,EAAD,EAAK;AACL,UAAIA,EAAE,KAAKmG,mBAAX,EAAgC;AAC5B,eAAO;AAAEzP,UAAAA,IAAI,EAAEuP,uBAAuB,CAACC,GAAD,CAA/B;AAAsCK,UAAAA,iBAAiB,EAAE;AAAzD,SAAP;AACH;;AACD,aAAO,IAAP;AACH;;AAdL;AAgBH;;ACvBD;;;;;AAKA,AAAO,SAASC,8BAAT,GAA0C;AAC7C,SAAO;AACH/U,IAAAA,IAAI,EAAE,6CADH;AAEHgV,IAAAA,SAAS,EAAG/P,IAAD,KAAW;AAClBA,MAAAA,IAAI,EAAEA,IAAI,CAACK,OAAL,CAAa,iCAAb,EAAgD,EAAhD,CADY;AAElB0F,MAAAA,GAAG,EAAE;AAFa,KAAX;AAFR,GAAP;AAOH;;ACND;;AACA,MAAMiK,oBAAoB,GAAG,qBAA7B;AACA,MAAMC,gBAAgB,GAAG,mEAAzB;AACA,MAAMC,wBAAwB,GAAG,6CAAjC;AACA,MAAMC,uBAAuB,GAAG,+FAAhC;AACA,MAAMC,QAAQ,GAAG,YAAjB;;AACA,MAAMC,oBAAoB,GAAG,4TAA7B;;AACA,SAASC,mBAAT,CAA6BzB,SAA7B,EAAwCnL,GAAG,GAAG,IAA9C,EAAoD;AAChD,SAAO;AACHmL,IAAAA,SADG;AAEHnL,IAAAA,GAFG;AAGHuL,IAAAA,OAAO,EAAE,KAHN;AAIHC,IAAAA,SAAS,EAAE,KAJR;AAKHC,IAAAA,KAAK,EAAE;AALJ,GAAP;AAOH;;AACD,AAAO,SAASoB,uBAAT,CAAiCC,eAAjC,EAAkD;AACrD,QAAMC,OAAO,GAAGC,aAAa,CAACF,eAAD,CAAb,CAA+BzJ,KAA/B,CAAqC,gCAArC,CAAhB;AACA,SAAO,CAAA0J,OAAO,SAAP,IAAAA,OAAO,WAAP,YAAAA,OAAO,CAAG,CAAH,CAAP,MAAgBA,OAAhB,aAAgBA,OAAhB,uBAAgBA,OAAO,CAAG,CAAH,CAAvB,KAAgC,IAAvC;AACH;;AACD,SAASE,6BAAT,CAAuC3Q,IAAvC,EAA6Cb,GAA7C,EAAkD;AAC9C;AACA,MAAIA,GAAG,CAACyR,CAAJ,KAAU,CAAC,CAAf,EAAkB;AACd,WAAO,IAAP;AACH,GAJ6C;;;AAM9C,MAAIzR,GAAG,CAACyR,CAAJ,KAAU,CAAC,CAAf,EAAkB;AACd,WAAO5Q,IAAI,CAACS,SAAL,CAAetB,GAAG,CAAC0R,CAAnB,EAAsB1R,GAAG,CAAC2R,CAA1B,CAAP;AACH,GAR6C;;;AAU9C,QAAMN,eAAe,GAAGxQ,IAAI,CAACS,SAAL,CAAetB,GAAG,CAAC0R,CAAnB,EAAsB1R,GAAG,CAAC2R,CAA1B,CAAxB;AACA,SAAOP,uBAAuB,CAACC,eAAD,CAA9B;AACH;AACD;;;;;;AAIA,SAASO,uBAAT,CAAiClC,SAAjC,EAA4C;AACxC,MAAI,CAACA,SAAL,EAAgB;AACZ,WAAO,IAAP;AACH,GAHuC;;;AAKxC,MAAImB,oBAAoB,CAACxO,IAArB,CAA0BqN,SAA1B,CAAJ,EAA0C;AACtC,WAAOA,SAAP;AACH;;AACD,SAAO,IAAP;AACH;;AACD,SAASmC,oBAAT,CAA8BhR,IAA9B,EAAoCb,GAApC,EAAyC;AACrC,QAAM8R,kBAAkB,GAAGF,uBAAuB,CAACJ,6BAA6B,CAAC3Q,IAAD,EAAOb,GAAP,CAA9B,CAAlD;;AACA,MAAI,CAAC8R,kBAAL,EAAyB;AACrB,WAAO,IAAP;AACH;;AACD,QAAMT,eAAe,GAAGE,aAAa,CAAC1Q,IAAI,CAACS,SAAL,CAAetB,GAAG,CAAC+R,EAAnB,EAAuB/R,GAAG,CAACgS,EAA3B,CAAD,CAArC;;AACA,MAAI,iBAAiB3P,IAAjB,CAAsBgP,eAAtB,CAAJ,EAA4C;AACxC,WAAO,IAAP;AACH;;AACD,QAAMY,eAAe,GAAGjS,GAAG,CAACyR,CAAJ,GAAQ,CAAC,CAAjC;AACA,QAAMS,gBAAgB,GAAG,CAACD,eAAD,IAAoBf,oBAAoB,CAAC7O,IAArB,CAA0BgP,eAA1B,CAA7C;AACA,QAAMc,kBAAkB,GAAG,CAACF,eAAD,IAAoBZ,eAAe,CAAC7I,QAAhB,CAAyB,GAAzB,CAA/C;AACA,QAAM4J,YAAY,GAAG,CAACf,eAAe,CAACzJ,KAAhB,CAAsBoJ,uBAAtB,KAAkD,GAAG,EAAH,CAAnD,EAA2D,CAA3D,EAChB9Q,KADgB,CACV,GADU;AAAA,GAEhB0G,GAFgB,CAEXhL,IAAD,IAAUA,IAAI,CAACsF,OAAL,CAAa+P,QAAb,EAAuB,EAAvB,EAA2BoB,IAA3B,EAFE;AAAA,GAGhBzD,MAHgB,CAGThP,QAHS,CAArB;AAIA,SAAO;AACH8P,IAAAA,SAAS,EAAEoC,kBADR;AAEHvN,IAAAA,GAAG,EAAE0N,eAAe,IAAK,CAACC,gBAAD,IAAqB,CAACC,kBAAtB,IAA4CC,YAAY,CAACpW,MAAb,KAAwB,CAF1F;AAGH8T,IAAAA,OAAO,EAAEoC,gBAHN;AAIHnC,IAAAA,SAAS,EAAEoC,kBAJR;AAKHnC,IAAAA,KAAK,EAAEoC;AALJ,GAAP;AAOH;;AACD,SAASE,mBAAT,CAA6BzR,IAA7B,EAAmC;AAC/BA,EAAAA,IAAI,GAAG0Q,aAAa,CAAC1Q,IAAD,CAApB;AACA,QAAM0R,UAAU,GAAG,EAAnB;AACA,MAAI3K,KAAJ;AACA,QAAM4K,WAAW,GAAG,IAAIjM,MAAJ,CAAWuK,gBAAX,CAApB;;AACA,SAAQlJ,KAAK,GAAG4K,WAAW,CAACC,IAAZ,CAAiB5R,IAAjB,CAAhB,EAAyC;AACrC0R,IAAAA,UAAU,CAACxW,IAAX,CAAgB6L,KAAhB;AACH;;AACD,QAAM8K,kBAAkB,GAAG,IAAInM,MAAJ,CAAWwK,wBAAX,CAA3B;;AACA,SAAQnJ,KAAK,GAAG8K,kBAAkB,CAACD,IAAnB,CAAwB5R,IAAxB,CAAhB,EAAgD;AAC5C0R,IAAAA,UAAU,CAACxW,IAAX,CAAgB6L,KAAhB;AACH;;AACD,SAAO2K,UAAU,CAAC3L,GAAX,CAAe,CAAC,CAAC+L,IAAD,CAAD,KAAYA,IAA3B,EAAiC7V,IAAjC,CAAsC,IAAtC,CAAP;AACH;;AACD,SAAS8V,wBAAT,CAAkClF,QAAlC,EAA4C;AACxC,MAAI7O,OAAJ,CADwC;AAGxC;;AACA,MAAI;AACA,KAACA,OAAD,IAAYL,mBAAK,CAACkP,QAAD,CAAL,IAAmB,EAA/B;AACH,GAFD,CAGA,OAAOpP,GAAP,EAAY;AACR;AACA;AACA;AACAoP,IAAAA,QAAQ,GAAG4E,mBAAmB,CAAC5E,QAAD,CAA9B;AACA,KAAC7O,OAAD,IAAYL,mBAAK,CAACkP,QAAD,CAAL,IAAmB,EAA/B;AACH;;AACD,SAAQ7O,OAAO,CACV+H,GADG,CACE5G,GAAD,IAAS6R,oBAAoB,CAACnE,QAAD,EAAW1N,GAAX,CAD9B,EAEH4O,MAFG,CAEIhP,QAFJ;AAAA,GAIHgP,MAJG,CAIKiE,MAAD,IAAY,CAAC,oBAAoBxQ,IAApB,CAAyBwQ,MAAM,CAACnD,SAAhC,CAJjB,CAAR;AAKH;;AACD,SAASoD,yBAAT,CAAmCjS,IAAnC,EAAyC;AACrC,QAAMmO,cAAc,GAAG,EAAvB;AACA,MAAIpH,KAAJ;AACA,QAAM4K,WAAW,GAAG,IAAIjM,MAAJ,CAAWjJ,SAAX,CAApB;;AACA,SAAQsK,KAAK,GAAG4K,WAAW,CAACC,IAAZ,CAAiB5R,IAAjB,CAAhB,EAAyC;AACrC,UAAM,GAAGiE,IAAH,IAAW8C,KAAjB;AACA,UAAMkK,kBAAkB,GAAGF,uBAAuB,CAAC9M,IAAD,CAAlD;;AACA,QAAIgN,kBAAJ,EAAwB;AACpB9C,MAAAA,cAAc,CAACjT,IAAf,CAAoBoV,mBAAmB,CAACW,kBAAD,CAAvC;AACH;AACJ;;AACD,SAAO9C,cAAP;AACH;;AACD,SAAS+D,0BAAT,CAAoC;AAAEC,EAAAA,SAAF;AAAalN,EAAAA,OAAb;AAAsB4H,EAAAA;AAAtB,CAApC,EAAuE;AACnE,QAAMuF,WAAW,GAAGpW,IAAI,CAACyK,QAAL,CAAchF,OAAO,CAACpE,GAAR,EAAd,EAA6B8U,SAA7B,CAApB;;AACA,MAAI;AACA,YAAQlN,OAAR;AACI,WAAK,MAAL;AACA,WAAK,OAAL;AACA,WAAK,OAAL;AACA,WAAK,OAAL;AAAc;AACVtJ,UAAAA,MAAM,CAAC1B,KAAP,CAAc,YAAWmY,WAAY,qBAArC;AACA,iBAAOH,yBAAyB,CAACpF,QAAD,CAAhC;AACH;;AACD,WAAK,OAAL;AACA,WAAK,SAAL;AACA,WAAK,MAAL;AAAa;AACTlR,UAAAA,MAAM,CAAC1B,KAAP,CAAc,YAAWmY,WAAY,sBAArC;AACA,iBAAOL,wBAAwB,CAACM,iBAAiB,CAAC;AAAExF,YAAAA,QAAF;AAAY5H,YAAAA;AAAZ,WAAD,CAAlB,CAA/B;AACH;;AACD,WAAK,KAAL;AACA,WAAK,MAAL;AACA,WAAK,MAAL;AACA,WAAK,KAAL;AACA,WAAK,MAAL;AAAa;AACTtJ,UAAAA,MAAM,CAAC1B,KAAP,CAAc,YAAWmY,WAAY,oBAArC;AACA,iBAAOL,wBAAwB,CAAClF,QAAD,CAA/B;AACH;;AACD;AAAS;AACLlR,UAAAA,MAAM,CAAC1B,KAAP,CAAc,iBAAgBmY,WAAY,wCAAuCnN,OAAQ,GAAzF;AACA,iBAAO,EAAP;AACH;AAzBL;AA2BH,GA5BD,CA6BA,OAAOxH,GAAP,EAAY;AACR;AACA9B,IAAAA,MAAM,CAACvB,KAAP,CAAc,KAAI+X,SAAU,EAA5B;AACA,UAAM1U,GAAN;AACH;AACJ;AACD;;;AACA,SAAS4U,iBAAT,CAA2B;AAAExF,EAAAA,QAAF;AAAY5H,EAAAA;AAAZ,CAA3B,EAAkD;AAC9C;AACA;AACA,QAAMyM,UAAU,GAAG,EAAnB;AACA,MAAI3K,KAAJ;AACA,MAAIuL,KAAK,GAAG,IAAI5M,MAAJ,CAAWlJ,aAAX,CAAZ;;AACA,MAAIyI,OAAO,KAAK,SAAZ,IAAyBA,OAAO,KAAK,MAAzC,EAAiD;AAC7CqN,IAAAA,KAAK,GAAG,IAAI5M,MAAJ,CAAWhJ,gBAAX,CAAR,CAD6C;AAEhD;;AACD,SAAQqK,KAAK,GAAGuL,KAAK,CAACV,IAAN,CAAW/E,QAAX,CAAhB,EAAuC;AACnC6E,IAAAA,UAAU,CAACxW,IAAX,CAAgB6L,KAAhB;AACH;;AACD,SAAO2K,UAAU,CACZ3L,GADE,CACGgB,KAAD,IAAWA,KAAK,CAAC,CAAD,CADlB;AAAA,GAEFgH,MAFE,CAEM8C,CAAD,IAAOA,CAAC,CAACW,IAAF,EAFZ,EAGFvV,IAHE,CAGG,IAHH,CAAP;AAIH;;AACD,AAAO,SAASsW,WAAT,CAAqBC,OAArB,EAA8BnV,GAA9B,EAAmC;AACtC,SAAOmV,OAAO,CACTzM,GADE,CACG0M,aAAD,IAAmB;AACxB,QAAI,CAACC,IAAI,CAACC,QAAL,CAAcF,aAAd,CAAL,EAAmC;AAC/B,aAAO,CAACnC,mBAAmB,CAACmC,aAAD,EAAgB,IAAhB,CAApB,CAAP;AACH,KAFD,MAGK;AACD,YAAMG,cAAc,GAAG5W,IAAI,CAACC,IAAL,CAAUoB,GAAV,EAAe,cAAf,CAAvB;AACA,aAAOkV,WAAW,CAACG,IAAI,CAAC5O,IAAL,CAAU2O,aAAV,EAAyB;AAAEpV,QAAAA,GAAG,EAAEuV,cAAP;AAAuBC,QAAAA,KAAK,EAAE;AAA9B,OAAzB,CAAD,EAAiExV,GAAjE,CAAlB;AACH;AACJ,GATM,EAUF0R,MAVE,CAUK,CAAC+D,IAAD,EAAO9T,IAAP,KAAgB8T,IAAI,CAACC,MAAL,CAAY/T,IAAZ,CAVrB,EAUwC,EAVxC,CAAP;AAWH;AACD,AAAO,eAAegU,WAAf,CAA2B3V,GAA3B,EAAgC2G,MAAhC,EAAwC;AAC3C,QAAMiP,kBAAN;AACA,QAAMC,eAAe,GAAG,MAAMzP,OAAO,CAACC,GAAR,CAAYxF,MAAM,CAACC,IAAP,CAAY6F,MAAM,CAACmP,KAAnB,EAA0BpN,GAA1B,CAA+BqN,QAAD,IAAc;AAClF,UAAMC,OAAO,GAAGrX,IAAI,CAAC8D,OAAL,CAAazC,GAAb,EAAkB+V,QAAlB,CAAhB;AACA,WAAOV,IAAI,CAAC5O,IAAL,CAAW,MAAX,EAAkB;AACrBwP,MAAAA,MAAM,EAAEtP,MAAM,CAACuP,OAAP,CAAeR,MAAf,CAAsB,CAAC,qBAAD,CAAtB,CADa;AAErB1V,MAAAA,GAAG,EAAEgW,OAFgB;AAGrBG,MAAAA,QAAQ,EAAE,IAHW;AAIrBX,MAAAA,KAAK,EAAE;AAJc,KAAlB,CAAP;AAMH,GARyC,CAAZ,CAA9B;AASA,QAAMY,YAAY,GAAGnE,KAAK,CAACpL,IAAN,CAAW,IAAIwG,GAAJ,CAAQ,GAAGqI,MAAH,CAAUW,KAAV,CAAgB,EAAhB,EAAoBR,eAApB,CAAR,CAAX,CAArB;;AACA,MAAIO,YAAY,CAACtY,MAAb,KAAwB,CAA5B,EAA+B;AAC3B,WAAO,EAAP;AACH,GAd0C;;;AAgB3C,QAAMwY,WAAW,GAAG,MAAMlQ,OAAO,CAACC,GAAR,CAAY+P,YAAY,CAAC1N,GAAb,CAAiB,MAAOwG,QAAP,IAAoB;AACvE,UAAM;AAAEtH,MAAAA,OAAF;AAAWG,MAAAA;AAAX,QAA2BL,MAAM,CAACwH,QAAD,CAAvC;AACA,WAAO;AACHtH,MAAAA,OADG;AAEHG,MAAAA,WAFG;AAGH+M,MAAAA,SAAS,EAAE5F,QAHR;AAIHM,MAAAA,QAAQ,EAAE,MAAMjQ,QAAQ,CAAC2P,QAAD;AAJrB,KAAP;AAMH,GARqC,CAAZ,CAA1B;AASA,SAAOqH,oBAAoB,CAACD,WAAW,CAAC5F,MAAZ,CAAmBhP,QAAnB,CAAD,EAA+BiF,MAA/B,CAA3B;AACH;AACD,AAAO,eAAe4P,oBAAf,CAAoCD,WAApC,EAAiD3P,MAAjD,EAAyD;AAC5D,SAAO2P,WAAW,CACb5F,MADE,CACM8F,UAAD,IAAgB,CAAClG,MAAM,CAACC,QAAP,CAAgBiG,UAAU,CAAChH,QAA3B,CADtB;AAAA,GAEF9G,GAFE,CAEG8N,UAAD,IAAgB3B,0BAA0B,CAAC2B,UAAD,CAF5C,EAGF9E,MAHE,CAGK,CAAC+D,IAAD,EAAO9T,IAAP,KAAgB8T,IAAI,CAACC,MAAL,CAAY/T,IAAZ,CAHrB,EAGwC,EAHxC,EAIF+O,MAJE,CAIMiE,MAAD,IAAY;AACpB,UAAM8B,UAAU,GAAG/P,sBAAsB,CAACC,MAAD,EAASgO,MAAM,CAACnD,SAAhB,CAAzC;AACA,WAAO,CAACiF,UAAD,IAAeA,UAAU,CAAClP,IAAX,KAAoB,SAA1C;AACH,GAPM,EAQFxG,IARE,CAQG,CAAC2V,IAAD,EAAOC,IAAP,KAAgBD,IAAI,CAAClF,SAAL,CAAeoF,aAAf,CAA6BD,IAAI,CAACnF,SAAlC,CARnB,CAAP;AASH;;ACrOD;;AACA,MAAMqF,iBAAiB,GAAG,EAA1B;AACA;;AACA,SAASC,WAAT,CAAqB,CAACC,SAAD,CAArB,EAAkC,CAACC,SAAD,CAAlC,EAA+C;AAC3C,SAAOD,SAAS,CAACH,aAAV,CAAwBI,SAAxB,CAAP;AACH;AACD;;;AACA,SAASC,UAAT,CAAoB7H,IAApB,EAA0B;AACtB,MAAI8H,EAAE,GAAGC,IAAI,CAACC,KAAL,CAAYhI,IAAI,GAAG,IAAR,GAAgB,GAA3B,IAAkC,GAA3C;;AACA,MAAI8H,EAAE,IAAI,IAAV,EAAgB;AACZA,IAAAA,EAAE,GAAGC,IAAI,CAACE,KAAL,CAAWH,EAAX,CAAL;AACH;;AACD,MAAII,KAAJ;;AACA,MAAIJ,EAAE,GAAG,EAAT,EAAa;AACTI,IAAAA,KAAK,GAAG,OAAR;AACH,GAFD,MAGK,IAAIJ,EAAE,GAAG,EAAT,EAAa;AACdI,IAAAA,KAAK,GAAG,QAAR;AACH,GAFI,MAGA;AACDA,IAAAA,KAAK,GAAG,KAAR;AACH;;AACD,SAAO1Z,MAAM,CAAC0Z,KAAD,CAAN,CAAe,GAAEJ,EAAG,KAAN,CAAWK,MAAX,CAAkBV,iBAAlB,CAAd,CAAP;AACH;;AACD,SAASW,WAAT,CAAqBzH,KAArB,EAA4B;AACxB,QAAMmH,EAAE,GAAGC,IAAI,CAACC,KAAL,CAAWrH,KAAK,GAAG,GAAnB,IAA0B,GAArC;AACA,QAAMuH,KAAK,GAAGvH,KAAK,GAAG,CAAR,GAAY,KAAZ,GAAoB,OAAlC;AACA,SAAOnS,MAAM,CAAC0Z,KAAD,CAAN,CAAe,KAAIvH,KAAK,GAAG,CAAR,GAAY,GAAZ,GAAkB,EAAG,GAAEmH,EAAG,KAA7C,CAAP;AACH;;AACD,SAASO,cAAT,CAAwBC,QAAxB,EAAkCC,KAAlC,EAAyCJ,MAAzC,EAAiDK,UAAjD,EAA6D;AACzD,QAAMC,SAAS,GAAGja,UAAA,CAAWga,UAAU,GAAG,IAAH,GAAU,IAA/B,CAAlB;AACA,QAAME,QAAQ,GAAGJ,QAAQ,CAACH,MAAT,CAAgBA,MAAhB,CAAjB;AACA,QAAMQ,QAAQ,GAAGd,UAAU,CAACU,KAAK,CAACvI,IAAP,CAA3B;AACA,QAAM4I,QAAQ,GAAGf,UAAU,CAACU,KAAK,CAACjI,IAAP,CAA3B;AACA,QAAMuI,UAAU,GAAGhB,UAAU,CAACU,KAAK,CAAC9H,MAAP,CAA7B;AACA,QAAMqI,QAAQ,GAAGH,QAAQ,GAAGC,QAAX,GAAsBC,UAAvC;AACA,MAAIE,SAAS,GAAG,EAAhB;;AACA,MAAIR,KAAK,CAAC5H,KAAV,EAAiB;AACboI,IAAAA,SAAS,GAAGva,UAAA,CAAW,GAAX,IAAkB4Z,WAAW,CAACG,KAAK,CAAC5H,KAAP,CAA7B,GAA6CnS,UAAA,CAAW,GAAX,CAAzD;AACH,GAVwD;;;AAYzD,SAAQ,MAAD,GAAU,GAAEia,SAAU,IAAGC,QAAS,IAAGI,QAAS,IAAGC,SAAU,EAAlD,CAAoDhE,IAApD,EAAhB;AACH;;AACD,SAASiE,WAAT,CAAqB7I,KAArB,EAA4BgI,MAA5B,EAAoC;AAChC,QAAMc,aAAa,GAAG9I,KAAK,CAAC7G,GAAN,CAAU,CAAC,CAACgP,QAAD,EAAWC,KAAX,CAAD,KAAuB,CACnDD,QAAQ,CAAC1U,OAAT,CAAiB,WAAjB,EAA8B,EAA9B,CADmD,EAEnD2U,KAFmD,CAAjC,CAAtB;AAIA,SAAOU,aAAa,CACf3P,GADE,CACE,CAAC,CAACgP,QAAD,EAAWC,KAAX,CAAD,EAAoBW,KAApB,KAA8Bb,cAAc,CAACC,QAAD,EAAWC,KAAX,EAAkBJ,MAAlB,EAA0Be,KAAK,IAAI/I,KAAK,CAACzR,MAAN,GAAe,CAAlD,CAD9C,EAEFc,IAFE,CAEG,IAFH,CAAP;AAGH;;AACD,AAAO,SAAS2Z,UAAT,CAAoBC,eAApB,EAAqC;AACxC,MAAIC,MAAM,GAAG,EAAb;AACA,QAAM;AAAE3J,IAAAA,MAAF;AAAUC,IAAAA;AAAV,MAAqByJ,eAA3B;AACA,QAAME,SAAS,GAAG7X,MAAM,CAACkG,OAAP,CAAe+H,MAAf,EAAuB/N,IAAvB,CAA4B+V,WAA5B,CAAlB;AACA,QAAM6B,SAAS,GAAG9X,MAAM,CAACkG,OAAP,CAAegI,MAAf,EAAuBhO,IAAvB,CAA4B+V,WAA5B,CAAlB;AACA,QAAM8B,iBAAiB,GAAG,CAAC,GAAGD,SAAJ,EAAe,GAAGD,SAAlB,EAA6BhH,MAA7B,CAAoC,CAACmH,GAAD,EAAM,CAACnB,QAAD,CAAN,KAAqBP,IAAI,CAAC0B,GAAL,CAASnB,QAAQ,CAAC5Z,MAAlB,EAA0B+a,GAA1B,CAAzD,EAAyF,eAAe/a,MAAxG,IAAkH,CAA5I;AACA2a,EAAAA,MAAM,IACD,OAAM7a,WAAA,CAAY,eAAe2Z,MAAf,CAAsBqB,iBAAiB,GAAG,CAA1C,CAAZ,CAA0D,EAAjE,GACIhb,WAAA,CAAYA,gBAAA,CAAiB,OAAO2Z,MAAP,CAAcV,iBAAiB,GAAG,CAAlC,CAAjB,CAAZ,CADJ,GAEI,IAFJ,GAGIjZ,WAAA,CAAYA,gBAAA,CAAiB,OAAO2Z,MAAP,CAAcV,iBAAiB,GAAG,CAAlC,CAAjB,CAAZ,CAHJ,GAII,IAJJ,GAKIjZ,WAAA,CAAYA,gBAAA,CAAiB,SAAS2Z,MAAT,CAAgBV,iBAAiB,GAAG,CAApC,CAAjB,CAAZ,CALJ,GAMK,IAPT;AAQA4B,EAAAA,MAAM,IAAK,GAAEL,WAAW,CAACM,SAAD,EAAYE,iBAAZ,CAA+B,IAAvD;;AACA,MAAI/X,MAAM,CAACiY,MAAP,CAAc/J,MAAd,EAAsBjR,MAAtB,GAA+B,CAAnC,EAAsC;AAClC2a,IAAAA,MAAM,IAAK,OAAM7a,WAAA,CAAY,8BAAZ,CAA4C,IAA7D;AACA6a,IAAAA,MAAM,IAAK,GAAEL,WAAW,CAACO,SAAD,EAAYC,iBAAZ,CAA+B,IAAvD;AACH;;AACD,SAAQ,KAAIH,MAAO,IAAnB;AACH;;AC1CD;AACA;AACA;AACA;AACA;AACA;AACA;;AACA,MAAMM,2BAA2B,GAAG,CAChC,gBADgC,EAEhC,oBAFgC,EAGhC,qBAHgC,EAIhC,mBAJgC,EAKhC,qBALgC,EAMhC,oBANgC,EAOhC,aAPgC,CAApC;AASA,MAAM/Y,GAAG,GAAGoE,OAAO,CAACpE,GAAR,EAAZ;AACA,IAAIgZ,cAAc,GAAG,EAArB;AACA,IAAIR,eAAe,GAAG,IAAtB;;AACA,SAASS,iBAAT,CAA2BC,SAA3B,EAAsC1L,WAAtC,EAAmD;AAC/C,SAAOA,WAAW,KAAK0L,SAAhB,IAA6BA,SAAS,CAAC5X,UAAV,CAAqBkM,WAAW,GAAG,GAAnC,CAApC;AACH;AACD;;;;;;;;AAMA,SAAS2L,oBAAT,CAA8B/W,GAA9B,EAAmC;AAC/B;AACA;AACA,MAAIzD,IAAI,CAACkJ,OAAL,CAAazF,GAAb,KAAqB,CAAC2G,mBAAmB,CAAC3G,GAAD,CAAnB,CAAyB4G,mBAAnD,EAAwE;AACpE,UAAMoQ,QAAQ,GAAG,CAAC,KAAD,EAAQ,MAAR,EAAgB,MAAhB,EAAwB9O,QAAxB,CAAiC3L,IAAI,CAACkJ,OAAL,CAAazF,GAAb,CAAjC,CAAjB;AACA,WAAO;AACHmF,MAAAA,IAAI,EAAE6R,QAAQ,GAAG,IAAH,GAAU,OADrB;AAEH;AACA;AACA5Y,MAAAA,GAAG,EAAEd,WAAE,CAAC4C,YAAH,CAAgBC,MAAhB,CAAuBC,OAAO,CAACC,OAAR,CAAgBL,GAAhB,EAAqB;AAAEM,QAAAA,KAAK,EAAE,CAAC1C,GAAD;AAAT,OAArB,CAAvB;AAJF,KAAP;AAMH,GAX8B;AAa/B;;;AACA,QAAM,CAACwN,WAAD,EAAc6L,iBAAd,IAAmCxX,2BAA2B,CAACO,GAAD,CAApE;;AACA,MAAIiX,iBAAJ,EAAuB;AACnB,UAAM,CAACC,kBAAD,EAAqBC,eAArB,IAAwCpX,yBAAyB,CAACqL,WAAD,EAAcxN,GAAd,CAAvE;;AACA,QAAIsZ,kBAAkB,IAAIC,eAAtB,IAAyCA,eAAe,CAACC,OAA7D,EAAsE;AAClE,YAAMC,cAAc,GAAGF,eAAe,CAACC,OAAhB,CAAwB,OAAOH,iBAA/B,CAAvB;AACA,YAAMK,cAAc,GAAG,CAAAD,cAAc,SAAd,IAAAA,cAAc,WAAd,YAAAA,cAAc,CAAExV,OAAhB,MACnBwV,cADmB,aACnBA,cADmB,uBACnBA,cAAc,CAAEE,MADG,MAEnBF,cAFmB,aAEnBA,cAFmB,uBAEnBA,cAAc,CAAE7H,OAFG,MAGnB6H,cAHmB,aAGnBA,cAHmB,uBAGnBA,cAAc,CAAEjX,OAHG,KAInBiX,cAJJ;;AAKA,UAAI,OAAOC,cAAP,KAA0B,QAA9B,EAAwC;AACpCpb,QAAAA,MAAM,CAACvB,KAAP,CAAc,YAAWyQ,WAAY,qEAAoE6L,iBAAkB,IAA3H;AACAjV,QAAAA,OAAO,CAACiG,IAAR,CAAa,CAAb;AACH;;AACD,aAAO;AACH9C,QAAAA,IAAI,EAAE,IADH;AAEH/G,QAAAA,GAAG,EAAE7B,IAAI,CAACC,IAAL,CAAU0a,kBAAV,EAA8B,IAA9B,EAAoCI,cAApC;AAFF,OAAP;AAIH;AACJ,GAjC8B;AAmC/B;AACA;AACA;;;AACA,QAAM,CAACE,cAAD,EAAiBvX,WAAjB,IAAgCF,yBAAyB,CAACC,GAAD,EAAMpC,GAAN,CAA/D;;AACA,MAAI,CAACqC,WAAL,EAAkB;AACd,QAAI;AACA,YAAMwX,QAAQ,GAAGna,WAAE,CAAC4C,YAAH,CAAgBC,MAAhB,CAAuBC,OAAO,CAACC,OAAR,CAAgBL,GAAhB,EAAqB;AAAEM,QAAAA,KAAK,EAAE,CAAC1C,GAAD;AAAT,OAArB,CAAvB,CAAjB;AACA,aAAO;AACHuH,QAAAA,IAAI,EAAE,IADH;AAEH/G,QAAAA,GAAG,EAAEqZ;AAFF,OAAP;AAIH,KAND,CAOA,OAAOzZ,GAAP,EAAY;AAEX;AACJ;;AACD,MAAI,CAACwZ,cAAD,IAAmB,CAACvX,WAAxB,EAAqC;AACjC,UAAM,IAAIrE,KAAJ,CAAW,YAAWoE,GAAI,uCAAsCwX,cAAc,GAAGA,cAAH,GAAoB,EAAG,EAArG,CAAN;AACH;;AACD,MAAIvX,WAAW,CAAC3E,IAAZ,KACC2E,WAAW,CAAC3E,IAAZ,CAAiB4D,UAAjB,CAA4B,WAA5B,KAA4Ce,WAAW,CAAC3E,IAAZ,CAAiB4D,UAAjB,CAA4B,aAA5B,CAD7C,CAAJ,EAC8F;AAC1FhD,IAAAA,MAAM,CAACvB,KAAP,CAAc,qGAAd;AACAqH,IAAAA,OAAO,CAACiG,IAAR,CAAa,CAAb;AACH;;AACD,MAAIyP,eAAe,GAAGzX,WAAW,CAAC,gBAAD,CAAX,IAClBA,WAAW,CAAC0X,MADM,IAElB1X,WAAW,CAAC,aAAD,CAFO,IAGlBA,WAAW,CAAC4B,OAHhB,CA3D+B;AAgE/B;AACA;;AACA,MAAI,OAAO6V,eAAP,KAA2B,QAA/B,EAAyC;AACrCA,IAAAA,eAAe,GACXA,eAAe,CAAC1X,GAAD,CAAf,IACI0X,eAAe,CAAC,YAAD,CADnB,IAEIA,eAAe,CAAC,SAAD,CAFnB,IAGIA,eAAe,CAAC,IAAD,CAHnB,IAIIA,eAAe,CAAC,GAAD,CALvB;AAMH,GAzE8B;;;AA2E/B,MAAI,CAACA,eAAL,EAAsB;AAClBA,IAAAA,eAAe,GAAGzX,WAAW,CAAC2X,IAA9B;AACH,GA7E8B;;;AA+E/B,QAAMC,oBAAoB,GAAG,CAACH,eAA9B;;AACA,MAAIG,oBAAJ,EAA0B;AACtBH,IAAAA,eAAe,GAAG,UAAlB;AACH;;AACD,MAAI,OAAOA,eAAP,KAA2B,QAA/B,EAAyC;AACrC,UAAM,IAAI9b,KAAJ,CAAW,IAAGoE,GAAI,gCAA+B/B,IAAI,CAACY,SAAL,CAAe6Y,eAAf,CAAgC,GAAjF,CAAN;AACH;;AACD,MAAI;AACA,WAAO;AACHvS,MAAAA,IAAI,EAAE,IADH;AAEH/G,MAAAA,GAAG,EAAEd,WAAE,CAAC4C,YAAH,CAAgBC,MAAhB,CAAuBC,OAAO,CAACC,OAAR,CAAgB9D,IAAI,CAACC,IAAL,CAAUgb,cAAc,IAAI,EAA5B,EAAgC,IAAhC,EAAsCE,eAAtC,CAAhB,CAAvB;AAFF,KAAP;AAIH,GALD,CAMA,OAAO1Z,GAAP,EAAY;AACR;AACA;AACA;AACA,QAAI6Z,oBAAoB,KAAK5X,WAAW,CAAC6X,KAAZ,IAAqB7X,WAAW,CAAC8X,OAAtC,CAAxB,EAAwE;AACpE,aAAO;AAAE5S,QAAAA,IAAI,EAAE,QAAR;AAAkB/G,QAAAA,GAAG,EAAE;AAAvB,OAAP;AACH,KANO;;;AAQR,UAAMJ,GAAN;AACH;AACJ;;AACD,SAASga,iBAAT,CAA2BC,OAA3B,EAAoC;AAChC;AACIC,IAAAA,QAAQ,EAAElW,OAAO,CAAC+N,GAAR,CAAYmI,QAAZ,IAAwB;AADtC,KAEOzZ,MAAM,CAACC,IAAP,CAAYuZ,OAAZ,EAAqB3I,MAArB,CAA4B,CAAC6I,GAAD,EAAM3Z,GAAN,KAAc;AACzC,UAAM4Z,KAAK,GAAGH,OAAO,CAACzZ,GAAD,CAArB;AACA2Z,IAAAA,GAAG,CAAC3Z,GAAD,CAAH,GAAW4Z,KAAK,KAAK,IAAV,GAAiBpW,OAAO,CAAC+N,GAAR,CAAYvR,GAAZ,CAAjB,GAAoC4Z,KAA/C;AACA,WAAOD,GAAP;AACH,GAJE,EAIA,EAJA,CAFP;AAQH;;AACD,SAASE,uBAAT,CAAiCtI,GAAjC,EAAsC;AAClC,SAAOtR,MAAM,CAACC,IAAP,CAAYqR,GAAZ,EAAiBT,MAAjB,CAAwB,CAAC6I,GAAD,EAAM3Z,GAAN,KAAc;AACzC2Z,IAAAA,GAAG,CAAE,eAAc3Z,GAAI,EAApB,CAAH,GAA4BP,IAAI,CAACY,SAAL,CAAekR,GAAG,CAACvR,GAAD,CAAlB,CAA5B;AACA,WAAO2Z,GAAP;AACH,GAHM,EAGJ,EAHI,CAAP;AAIH;;AACD,MAAMG,sBAAsB,GAAG,iBAA/B;AACA,MAAMC,oBAAoB,GAAG;AACzBC,EAAAA,OAAO,EAAE,KADgB;AAEzBna,EAAAA,SAAS,EAAE;AAFc,CAA7B;AAIA,AAAO,eAAeoa,OAAf,CAAuB/J,cAAvB,EAAuC;AAAE7G,EAAAA,QAAF;AAAYtD,EAAAA;AAAZ,CAAvC,EAA6D;AAChE,QAAM;AAAEgF,IAAAA,eAAF;AAAmB3E,IAAAA,KAAK,EAAE8T,YAA1B;AAAwCC,IAAAA,cAAc,EAAE;AAAE5N,MAAAA,YAAF;AAAgB6N,MAAAA,IAAI,EAAEC,OAAtB;AAA+BC,MAAAA,eAAe,EAAEC,gBAAhD;AAAkEC,MAAAA,SAAlE;AAA6EjJ,MAAAA,GAAG,EAAEkI,OAAlF;AAA2FgB,MAAAA,MAAM,EAAEC,iBAAnG;AAAsHC,MAAAA,SAAS,EAAE3K,WAAjI;AAA8I4K,MAAAA;AAA9I;AAAxD,MAA2N7U,MAAjO;AACA,QAAMwL,GAAG,GAAGiI,iBAAiB,CAACC,OAAD,CAA7B;AACA,QAAMoB,oBAAoB,GAAGhW,MAAM,CAACgB,IAAP,CAAY,cAAZ,EAA4B;AAAEzG,IAAAA,GAAF;AAAOuH,IAAAA,IAAI,EAAE;AAAb,GAA5B,CAA7B;;AACA,MAAI,CAACoE,eAAD,IAAoB,CAACvH,OAAO,CAACsX,QAAR,CAAiBC,GAAtC,IAA6C,CAACF,oBAAlD,EAAwE;AACpEnd,IAAAA,MAAM,CAACvB,KAAP,CAAa,sEAAb;AACA,WAAO4d,oBAAP;AACH;;AACD,QAAMiB,oBAAoB,GAAG,IAAIvO,GAAJ,CAAQyD,cAAc,CAC9CJ,MADgC,CACxBtO,GAAD,IAAS,CAAC+Y,gBAAgB,CAACjK,IAAjB,CAAuB1D,WAAD,IAAiByL,iBAAiB,CAAC7W,GAAG,CAACoP,SAAL,EAAgBhE,WAAhB,CAAxD,CADe,EAEhC9E,GAFgC,CAE3BtG,GAAD,IAASA,GAAG,CAACoP,SAFe,EAGhC9I,GAHgC,CAG3B8I,SAAD,IAAe;AACpB,UAAMiF,UAAU,GAAG/P,sBAAsB,CAACC,MAAD,EAAS6K,SAAT,CAAzC;AACA,WAAOiF,UAAU,IAAIA,UAAU,CAAClP,IAAX,KAAoB,SAAlC,GAA8CkP,UAAU,CAAC3P,EAAzD,GAA8D0K,SAArE;AACH,GANoC,EAOhCzQ,IAPgC,EAAR,CAA7B;AAQA,QAAM8a,kBAAkB,GAAG,EAA3B;AACA,QAAMC,gBAAgB,GAAG,EAAzB;AACA,QAAMrb,SAAS,GAAG;AAAEE,IAAAA,OAAO,EAAE;AAAX,GAAlB;AACA,AACA,QAAMob,sBAAsB,GAAG,CAC3B,GAAGhD,2BADwB,EAE3B,GAAGpS,MAAM,CAACoU,cAAP,CAAsBiB,YAFE,CAA/B;;AAIA,OAAK,MAAMjS,gBAAX,IAA+B6R,oBAA/B,EAAqD;AACjD,UAAMK,UAAU,GAAGnT,oBAAoB,CAACiB,gBAAD,CAAvC;AACA,UAAMmS,WAAW,GAAG5T,mBAAmB,CAAC2T,UAAD,CAAvC,CAFiD;;AAGjD,QAAIhS,QAAQ,IAAIA,QAAQ,CAACtJ,OAAT,CAAiBoJ,gBAAjB,CAAhB,EAAoD;AAChD8R,MAAAA,kBAAkB,CAACI,UAAD,CAAlB,GAAiChS,QAAQ,CAACtJ,OAAT,CAAiBoJ,gBAAjB,CAAjC;AACAtJ,MAAAA,SAAS,CAACE,OAAV,CAAkBoJ,gBAAlB,IAAuC,KAAImS,WAAY,KAAvD;AACAlD,MAAAA,cAAc,CAACnb,IAAf,CAAoB,CAACoe,UAAD,EAAa,SAAb,CAApB;AACA;AACH;;AACD,QAAI;AACA,YAAM;AAAE1U,QAAAA,IAAI,EAAE4U,UAAR;AAAoB3b,QAAAA,GAAG,EAAE4b;AAAzB,UAAuCjD,oBAAoB,CAACpP,gBAAD,CAAjE;;AACA,UAAIoS,UAAU,KAAK,IAAnB,EAAyB;AACrBN,QAAAA,kBAAkB,CAACI,UAAD,CAAlB,GAAiCG,SAAjC;AACA3b,QAAAA,SAAS,CAACE,OAAV,CAAkBoJ,gBAAlB,IAAuC,KAAImS,WAAY,KAAvD;AACArb,QAAAA,MAAM,CAACkG,OAAP,CAAe+T,YAAf,EACKpK,MADL,CACY,CAAC,GAAG8J,KAAH,CAAD,KAAeA,KAAK,KAAKzQ,gBADrC,EAEKsS,OAFL,CAEa,CAAC,CAACzb,GAAD,CAAD,KAAW;AACpBH,UAAAA,SAAS,CAACE,OAAV,CAAkBC,GAAlB,IAA0B,KAAIqb,UAAW,KAAzC;AACH,SAJD;AAKAjD,QAAAA,cAAc,CAACnb,IAAf,CAAoB,CAACkM,gBAAD,EAAmB,SAAnB,CAApB;AACH,OATD,MAUK,IAAIoS,UAAU,KAAK,OAAnB,EAA4B;AAC7BL,QAAAA,gBAAgB,CAACG,UAAD,CAAhB,GAA+BG,SAA/B;AACA3b,QAAAA,SAAS,CAACE,OAAV,CAAkBoJ,gBAAlB,IAAuC,KAAImS,WAAY,EAAvD;AACAlD,QAAAA,cAAc,CAACnb,IAAf,CAAoB,CAACkM,gBAAD,EAAmB,OAAnB,CAApB;AACH;AACJ,KAjBD,CAkBA,OAAO3J,GAAP,EAAY;AACR4Y,MAAAA,cAAc,CAACnb,IAAf,CAAoB,CAACkM,gBAAD,EAAmB,MAAnB,CAApB;;AAIAzL,MAAAA,MAAM,CAACvB,KAAP,CAAaqD,GAAG,CAAC7C,OAAJ,IAAe6C,GAA5B;AACA,YAAM,IAAIpC,KAAJ,CAAU0c,sBAAV,CAAN;AACH;AACJ;;AACD,MAAI7Z,MAAM,CAACC,IAAP,CAAY+a,kBAAZ,EAAgC/d,MAAhC,KAA2C,CAA3C,IAAgD+C,MAAM,CAACC,IAAP,CAAYgb,gBAAZ,EAA8Bhe,MAA9B,KAAyC,CAA7F,EAAgG;AAC5FQ,IAAAA,MAAM,CAACvB,KAAP,CAAc;EACpBa,UAAA,CAAY,8GAA6GA,gBAAA,CAAiB,sBAAjB,CAAyC,EAAlK,CAAqK,EAD/J;AAEA,WAAO+c,oBAAP;AACH;;AACD,QAAM/E,kBAAN;AACA,MAAI0G,qBAAqB,GAAG,KAA5B;AACA,MAAIC,mBAAmB,GAAG,KAA1B;AACA,QAAMlL,YAAY,GAAG;AACjBC,IAAAA,KAAK,EAAEuK,kBADU;AAEjBW,IAAAA,QAAQ,EAAGvQ,EAAD,IAAQkP,gBAAgB,CAACjK,IAAjB,CAAuB1D,WAAD,IAAiByL,iBAAiB,CAAChN,EAAD,EAAKuB,WAAL,CAAxD,CAFD;AAGjB+N,IAAAA,SAAS,EAAE;AAAE/I,MAAAA,iBAAiB,EAAE;AAArB,KAHM;AAIjBiK,IAAAA,OAAO,EAAE,CACL,CAAC,CAAC9Q,eAAF,IACIuB,2BAA2B,CAAC;AACxBC,MAAAA,YADwB;AAExB1P,MAAAA,GAAG,EAAGyG,GAAD,IAAS;AACV5F,QAAAA,MAAM,CAAC1B,KAAP,CAAc,cAAagB,UAAA,CAAWsG,GAAX,CAAgB,GAA3C;AACH;AAJuB,KAAD,CAF1B,EAQLwY,iBAAiB,CAAC;AACd3V,MAAAA,OAAO,EAAElG,MAAM,CAACkG,OAAP,CAAe+T,YAAf,EACJpK,MADI,CACG,CAAC,GAAGlJ,GAAH,CAAD,KAAaN,mBAAmB,CAACM,GAAD,CADnC,EAEJkB,GAFI,CAEA,CAAC,CAAC9H,GAAD,EAAM4G,GAAN,CAAD,MAAiB;AACtBmV,QAAAA,IAAI,EAAE/b,GADgB;AAEtBgc,QAAAA,WAAW,EAAEpV;AAFS,OAAjB,CAFA;AADK,KAAD,CARZ,EAgBL8E,sBAAsB,EAhBjB,EAiBLuQ,uBAAuB,CAAC;AACpBC,MAAAA,UAAU,EAAE,CAAC,gBAAD,EAAmB,QAAnB,EAA6B,SAA7B,EAAwC,MAAxC,EAAgDpM,MAAhD,CAAuDhP,QAAvD,CADQ;AAEpBqb,MAAAA,UAAU,EAAE,CAAC,MAAD,EAAS,MAAT,EAAiB,KAAjB,EAAwB,OAAxB,CAFQ;AAGpB;AACAC,MAAAA,cAAc,EAAE,IAJI;AAKpBC,MAAAA,MAAM,EAAE3B,iBAAiB,CAAC2B;AALN,KAAD,CAjBlB,EAwBLC,gBAAgB,CAAC;AACbC,MAAAA,WAAW,EAAE,IADA;AAEbC,MAAAA,MAAM,EAAE,IAFK;AAGbC,MAAAA,OAAO,EAAE,KAHI;AAIbrB,MAAAA,YAAY,EAAE;AAJD,KAAD,CAxBX,EA8BLvP,eAAe,EA9BV,EA+BL6Q,mBAAmB,CAAC7C,uBAAuB,CAACtI,GAAD,CAAxB,CA/Bd,EAgCLoL,oBAAoB,CAAC;AACjBR,MAAAA,UAAU,EAAE,CAAC,KAAD,EAAQ,MAAR,CADK;AAEjBS,MAAAA,WAAW,EAAEpZ,OAAO,CAAC+N,GAAR,CAAYsL,qBAAZ,IAAqC,EAFjC;AAGjBC,MAAAA,qBAAqB,EAAE;AAHN,KAAD,CAhCf,EAqCL/M,8BAA8B,CAAC,CAAC,CAACC,WAAH,EAAgBmL,sBAAhB,EAAwCjL,cAAxC,CArCzB,EAsCLrC,2BAA2B,CAAE5R,IAAD,IAAW2b,eAAe,GAAG3b,IAA9B,CAtCtB,EAuCLwV,+BAA+B,CAACF,GAAD,CAvC1B,EAwCLqJ,YAAY,IAAImC,yBAAyB,EAxCpC,EAyCL,GAAGrC,iBAAiB,CAACmB,OAzChB,EA0CL1Q,2BAA2B,EA1CtB,EA2CL0G,8BAA8B,EA3CzB,EA4CP/B,MA5CO,CA4CA9O,OA5CA,CAJQ;;AAiDjBgc,IAAAA,MAAM,CAACC,OAAD,EAAU/gB,IAAV,EAAgB;AAClB;AACA,UAAI+gB,OAAO,CAAClb,IAAR,KAAiB,qBAArB,EAA4C;AACxC,YAAI,CAAC2Z,qBAAL,EAA4B;AACxBA,UAAAA,qBAAqB,GAAG,IAAxB;AACAhe,UAAAA,MAAM,CAACxB,IAAP,CAAa,gDAA+C+gB,OAAO,CAAC3R,QAAS,IAA7E;AACH;;AACD;AACH,OARiB;;;AAUlB,UAAI2R,OAAO,CAAClb,IAAR,KAAiB,gBAAjB,IACAkb,OAAO,CAACC,MAAR,KAAmB,yCADvB,EACkE;AAC9DvB,QAAAA,mBAAmB,GAAG,IAAtB,CAD8D;;AAG9D,YAAIsB,OAAO,CAAC5R,EAAZ,EAAgB;AACZ,gBAAMtE,QAAQ,GAAGhJ,IAAI,CAACyK,QAAL,CAAcpJ,GAAd,EAAmB6d,OAAO,CAAC5R,EAA3B,EAA+BjJ,OAA/B,CAAuC,KAAvC,EAA8C,GAA9C,CAAjB;AACA1E,UAAAA,MAAM,CAACvB,KAAP,CAAc,GAAE4K,QAAS,QAAOkW,OAAO,CAACtgB,OAAQ,EAAhD;AACH,SAHD,MAIK;AACDe,UAAAA,MAAM,CAACvB,KAAP,CAAc,GAAE8gB,OAAO,CAACtgB,OAAQ,iDAAhC;AACH;;AACD;AACH;;AACDT,MAAAA,IAAI,CAAC+gB,OAAD,CAAJ;AACH;;AAzEgB,GAArB;AA2EA,QAAME,aAAa,GAAG;AAClBxY,IAAAA,GAAG,EAAE0V,OADa;AAElB+C,IAAAA,MAAM,EAAE,KAFU;AAGlBC,IAAAA,SAAS,EAAE7C,SAHO;AAIlB5B,IAAAA,OAAO,EAAE,OAJS;AAKlB0E,IAAAA,cAAc,EAAGC,KAAD,IAAW;AACvB,YAAMlC,UAAU,GAAGnT,oBAAoB,CAACqV,KAAK,CAACzgB,IAAP,CAAvC;AACA,YAAMwe,WAAW,GAAG5T,mBAAmB,CAAC2T,UAAD,CAAvC;AACA,aAAQ,GAAEC,WAAY,KAAtB;AACH,KATiB;AAUlBkC,IAAAA,cAAc,EAAE;AAVE,GAAtB;;AAYA,MAAIvd,MAAM,CAACC,IAAP,CAAY+a,kBAAZ,EAAgC/d,MAAhC,GAAyC,CAA7C,EAAgD;AAC5C,QAAI;AACAQ,MAAAA,MAAM,CAAC1B,KAAP,CAAc,mCAAkCyhB,IAAI,CAACL,MAAL,CAAY3M,YAAZ,CAA0B,EAA1E;AACA,YAAMiN,aAAa,GAAG,MAAMjD,aAAM,CAAChK,YAAD,CAAlC;AACA/S,MAAAA,MAAM,CAAC1B,KAAP,CAAc,iCAAgCiE,MAAM,CAACC,IAAP,CAAY+a,kBAAZ,EAAgCjd,IAAhC,CAAqC,QAArC,CAA+C,EAA7F;;AACA,UAAI2d,mBAAJ,EAAyB;AACrB,cAAM,IAAIve,KAAJ,CAAU0c,sBAAV,CAAN;AACH;;AACDpc,MAAAA,MAAM,CAAC1B,KAAP,CAAc,iCAAd;AACA,YAAM0hB,aAAa,CAACC,KAAd,CAAoBR,aAApB,CAAN;AACH,KATD,CAUA,OAAOS,IAAP,EAAa;AAAA;;AACT,YAAMpe,GAAG,GAAGoe,IAAZ;AACA,YAAMC,WAAW,GAAG,aAAAre,GAAG,CAACI,GAAJ,sDAASgI,IAAT,KAAiBpI,GAAG,CAAC6L,EAAzC;;AACA,UAAI,CAACwS,WAAL,EAAkB;AACd,cAAMre,GAAN;AACH,OALQ;AAOT;AACA;;;AACA,YAAMse,eAAe,GAAG/f,IAAI,CAACkJ,OAAL,CAAa4W,WAAb,CAAxB;AACA,YAAME,UAAU,GAAGrb,0BAA0B,CAACob,eAAD,CAA1B,IAA+Cte,GAAG,CAAC7C,OAAtE,CAVS;;AAYT,YAAMoK,QAAQ,GAAGhJ,IAAI,CAACyK,QAAL,CAAcpJ,GAAd,EAAmBye,WAAnB,EAAgCzb,OAAhC,CAAwC,KAAxC,EAA+C,GAA/C,CAAjB;AACA1E,MAAAA,MAAM,CAACvB,KAAP,CAAc,kBAAiBa,WAAA,CAAY+J,QAAZ,CAAsB,OAAMgX,UAAW,EAAtE;AACA,YAAM,IAAI3gB,KAAJ,CAAU0c,sBAAV,CAAN;AACH;AACJ;;AACD1U,EAAAA,MAAM,CAACS,IAAP,CAAYwU,OAAZ;AACA,QAAM1a,aAAa,CAAC5B,IAAI,CAACC,IAAL,CAAUqc,OAAV,EAAmB,iBAAnB,CAAD,EAAwCxa,SAAxC,CAAnB;;AACA,OAAK,MAAM,CAACme,SAAD,EAAYC,QAAZ,CAAX,IAAoChe,MAAM,CAACkG,OAAP,CAAe+U,gBAAf,CAApC,EAAsE;AAClE,UAAMgD,SAAS,GAAI,GAAE7D,OAAQ,IAAG3S,mBAAmB,CAACsW,SAAD,CAAY,EAA/D;AACA5Y,IAAAA,MAAM,CAACS,IAAP,CAAY9H,IAAI,CAACsH,OAAL,CAAa6Y,SAAb,CAAZ;AACApf,IAAAA,WAAE,CAACqf,YAAH,CAAgBF,QAAhB,EAA0BC,SAA1B;AACH;;AACD,SAAO;AACHlE,IAAAA,OAAO,EAAE,IADN;AAEHna,IAAAA;AAFG,GAAP;AAIH;AACD,AAAO,eAAeue,iBAAf,CAAiCrY,MAAjC,EAAyCsY,YAAzC,EAAuD;AAC1D,QAAM;AAAEC,IAAAA,gBAAF;AAAoBvT,IAAAA;AAApB,MAAwChF,MAA9C;AACA,QAAMmK,cAAc,GAAG,EAAvB;;AACA,MAAIoO,gBAAJ,EAAsB;AAClBpO,IAAAA,cAAc,CAACjT,IAAf,CAAoB,GAAGqX,WAAW,CAACgK,gBAAD,EAAmBlf,GAAnB,CAAlC;AACH;;AACD,MAAI2L,eAAJ,EAAqB;AACjBmF,IAAAA,cAAc,CAACjT,IAAf,CAAoB,GAAGqX,WAAW,CAACrU,MAAM,CAACC,IAAP,CAAY6K,eAAZ,CAAD,EAA+B3L,GAA/B,CAAlC;AACH,GARyD;;;AAU1D,MAAIif,YAAJ,EAAkB;AACdnO,IAAAA,cAAc,CAACjT,IAAf,CAAoB,IAAI,MAAM0Y,oBAAoB,CAAC0I,YAAD,EAAetY,MAAf,CAA9B,CAApB;AACH,GAFD,MAGK;AACDmK,IAAAA,cAAc,CAACjT,IAAf,CAAoB,IAAI,MAAM8X,WAAW,CAAC3V,GAAD,EAAM2G,MAAN,CAArB,CAApB;AACH;;AACD,SAAOmK,cAAP;AACH;AACD,AAAO,eAAerM,OAAf,CAAuB0a,cAAvB,EAAuC;AAC1C,QAAM;AAAEnf,IAAAA,GAAF;AAAO2G,IAAAA;AAAP,MAAkBwY,cAAxB;AACA7gB,EAAAA,MAAM,CAAC1B,KAAP,CAAa,kBAAb;AACA,QAAMkU,cAAc,GAAG,MAAMkO,iBAAiB,CAACrY,MAAD,CAA9C;AACArI,EAAAA,MAAM,CAAC1B,KAAP,CAAa,0BAAb;;AACA,MAAIkU,cAAc,CAAChT,MAAf,KAA0B,CAA9B,EAAiC;AAC7BQ,IAAAA,MAAM,CAACvB,KAAP,CAAa,qBAAb;AACA;AACH;;AACDuB,EAAAA,MAAM,CAAC1B,KAAP,CAAa,yBAAb;AACA,QAAM6Q,WAAW,GAAG,MAAM2R,GAAG,mCAAMD,cAAN;AAAsBrO,IAAAA;AAAtB,KAA7B;AACAxS,EAAAA,MAAM,CAAC1B,KAAP,CAAa,kCAAb;;AACA,MAAI6Q,WAAW,CAACjC,WAAhB,EAA6B;AACzB,UAAMjL,aAAa,CAAC5B,IAAI,CAACC,IAAL,CAAUoB,GAAV,EAAe,oBAAf,CAAD,EAAuCyN,WAAW,CAACjC,WAAnD,CAAnB;AACAlN,IAAAA,MAAM,CAAC1B,KAAP,CAAa,6BAAb;AACH;;AACD,MAAI6Q,WAAW,CAACkK,KAAhB,EAAuB;AACnBrZ,IAAAA,MAAM,CAACzB,IAAP,CAAY0b,UAAU,CAAC9K,WAAW,CAACkK,KAAb,CAAtB;AACH;;AACD,MAAI,CAAClK,WAAW,CAACmN,OAAb,IAAwBnN,WAAW,CAAC4R,QAAxC,EAAkD;AAC9Cjb,IAAAA,OAAO,CAACiG,IAAR,CAAa,CAAb;AACH;AACJ;AACD,AAAO,eAAe+U,GAAf,CAAmB;AAAEzY,EAAAA,MAAF;AAAUsD,EAAAA,QAAV;AAAoB6G,EAAAA;AAApB,CAAnB,EAA0D;AAC7D,QAAM;AAAEiK,IAAAA,cAAc,EAAE;AAAEC,MAAAA;AAAF,KAAlB;AAA4BrP,IAAAA;AAA5B,MAAiDhF,MAAvD,CAD6D;;AAG7D,QAAM2Y,YAAY,GAAGC,sBAAW,CAACC,GAAZ,EAArB;AACAlhB,EAAAA,MAAM,CAACzB,IAAP,CAAYe,aAAA,CAAc,4BAAd,CAAZ;AACAob,EAAAA,cAAc,GAAG,EAAjB;AACAR,EAAAA,eAAe,GAAG,IAAlB;;AACA,MAAI1H,cAAc,CAAChT,MAAf,KAA0B,CAA9B,EAAiC;AAC7B,WAAO;AACH8c,MAAAA,OAAO,EAAE,IADN;AAEHyE,MAAAA,QAAQ,EAAE,KAFP;AAGH5e,MAAAA,SAAS,EAAE;AAAEE,QAAAA,OAAO,EAAE;AAAX,OAHR;AAIH6K,MAAAA,WAAW,EAAE,IAJV;AAKHmM,MAAAA,KAAK,EAAE;AALJ,KAAP;AAOH;;AACD,MAAInM,WAAW,GAAG,IAAlB;;AACA,MAAIG,eAAe,IAAI9K,MAAM,CAACC,IAAP,CAAY6K,eAAZ,EAA6B7N,MAA7B,GAAsC,CAA7D,EAAgE;AAC5D0N,IAAAA,WAAW,GAAG,MAAMJ,2BAA2B,CAACnB,QAAD,EAAWtD,MAAX,CAA3B,CAA8Cb,KAA9C,CAAqD1F,GAAD,IAAS;AAC7E9B,MAAAA,MAAM,CAACvB,KAAP,CAAa,OAAOqD,GAAG,CAAC7C,OAAX,IAAsB6C,GAAnC;AACAgE,MAAAA,OAAO,CAACiG,IAAR,CAAa,CAAb;AACH,KAHmB,CAApB;AAIH;;AACD7D,EAAAA,MAAM,CAACC,IAAP,CAAYuU,IAAZ;AACA,QAAMvN,WAAW,GAAG,MAAMoN,OAAO,CAAC/J,cAAD,EAAiB;AAC9C7G,IAAAA,QAAQ,EAAEuB,WADoC;AAE9C7E,IAAAA;AAF8C,GAAjB,CAAP,CAGvBb,KAHuB,CAGhB1F,GAAD,IAAS;AACd,QAAIA,GAAG,CAACI,GAAR,EAAa;AACTlC,MAAAA,MAAM,CAACvB,KAAP,CAAaa,UAAA,CAAWA,WAAA,CAAa,KAAIwC,GAAG,CAACI,GAAJ,CAAQgI,IAAK,EAA9B,CAAX,CAAb;AACH;;AACD,QAAIpI,GAAG,CAAC8D,GAAR,EAAa;AACT5F,MAAAA,MAAM,CAACvB,KAAP,CAAaa,UAAA,CAAY,MAAKwC,GAAG,CAAC8D,GAAI,EAAzB,CAAb;AACH;;AACD5F,IAAAA,MAAM,CAACvB,KAAP,CAAaqD,GAAG,CAAC7C,OAAJ,IAAe6C,GAA5B;AACAgE,IAAAA,OAAO,CAACiG,IAAR,CAAa,CAAb;AACH,GAZyB,CAA1B,CAxB6D;;AAsC7D,QAAMoV,UAAU,GAAGF,sBAAW,CAACC,GAAZ,EAAnB;AACA,QAAMrK,OAAO,GAAI1H,WAAW,CAAChN,SAAZ,IAAyBI,MAAM,CAACC,IAAP,CAAY2M,WAAW,CAAChN,SAAZ,CAAsBE,OAAlC,CAA1B,IAAyE,EAAzF;AACArC,EAAAA,MAAM,CAACzB,IAAP,CAAa,GAAEsY,OAAO,CAACrX,MAAR,GACTF,YAAA,CAAc,GAAd,IAAoB,mBADX,GAET,sCAAuC,IAAGA,UAAA,CAAY,IAAG,CAAC,CAAC6hB,UAAU,GAAGH,YAAd,IAA8B,IAA/B,EAAqCI,OAArC,CAA6C,CAA7C,CAAgD,IAA/D,CAAoE,EAFpH;AAGA,SAAO;AACH9E,IAAAA,OAAO,EAAE,IADN;AAEHyE,IAAAA,QAAQ,EAAE,KAFP;AAGH5e,IAAAA,SAAS,EAAEgN,WAAW,CAAChN,SAHpB;AAIH+K,IAAAA,WAJG;AAKHmM,IAAAA,KAAK,EAAEa;AALJ,GAAP;AAOH;;ACjdM,eAAemH,UAAf,CAA0BC,QAA1B,EAAoCT,cAApC,EAAoD;AACvD,QAAM;AAAEnf,IAAAA,GAAF;AAAO2G,IAAAA,MAAP;AAAekZ,IAAAA;AAAf,MAA+BV,cAArC;AACA,MAAI,CAACW,OAAD,EAAUC,SAAV,IAAuBH,QAAQ,CAAC5d,KAAT,CAAe,GAAf,CAA3B;;AACA,MAAI,CAAC+d,SAAL,EAAgB;AACZ,UAAMnV,IAAI,GAAI,MAAMrJ,GAAG,CAAE,6BAA4Bue,OAAQ,SAAtC,CAAH,CAAmDE,IAAnD,EAApB;AACAD,IAAAA,SAAS,GAAI,IAAGnV,IAAI,CAACqV,OAAQ,EAA7B;AACH;;AACDJ,EAAAA,WAAW,CAAClU,eAAZ,GAA8BkU,WAAW,CAAClU,eAAZ,IAA+B,EAA7D;AACAkU,EAAAA,WAAW,CAAClU,eAAZ,CAA4BmU,OAA5B,IAAuCC,SAAvC;AACApZ,EAAAA,MAAM,CAACgF,eAAP,GAAyBhF,MAAM,CAACgF,eAAP,IAA0B,EAAnD;AACAhF,EAAAA,MAAM,CAACgF,eAAP,CAAuBmU,OAAvB,IAAkCC,SAAlC;AACA,QAAMrgB,WAAE,CAACwG,SAAH,CAAavH,IAAI,CAACC,IAAL,CAAUoB,GAAV,EAAe,cAAf,CAAb,EAA6CK,IAAI,CAACY,SAAL,CAAe4e,WAAf,EAA4B,IAA5B,EAAkC,CAAlC,CAA7C,CAAN;AACA,QAAMK,OAAc,CAACf,cAAD,CAApB;AACH;AACD,AAAO,eAAegB,SAAf,CAAyBP,QAAzB,EAAmCT,cAAnC,EAAmD;AACtD,QAAM;AAAEnf,IAAAA,GAAF;AAAO2G,IAAAA,MAAP;AAAekZ,IAAAA;AAAf,MAA+BV,cAArC;AACA,MAAI,CAACW,OAAD,IAAYF,QAAQ,CAAC5d,KAAT,CAAe,GAAf,CAAhB;AACA6d,EAAAA,WAAW,CAAClU,eAAZ,GAA8BkU,WAAW,CAAClU,eAAZ,IAA+B,EAA7D;AACA,SAAOkU,WAAW,CAAClU,eAAZ,CAA4BmU,OAA5B,CAAP;AACAnZ,EAAAA,MAAM,CAACgF,eAAP,GAAyBhF,MAAM,CAACgF,eAAP,IAA0B,EAAnD;AACA,SAAOhF,MAAM,CAACgF,eAAP,CAAuBmU,OAAvB,CAAP;AACA,QAAMpgB,WAAE,CAACwG,SAAH,CAAavH,IAAI,CAACC,IAAL,CAAUoB,GAAV,EAAe,cAAf,CAAb,EAA6CK,IAAI,CAACY,SAAL,CAAe4e,WAAf,EAA4B,IAA5B,EAAkC,CAAlC,CAA7C,CAAN;AACA,QAAMK,OAAc,CAACf,cAAD,CAApB;AACH;;ACxBM,SAASiB,cAAT,CAAwBC,OAAxB,EAAiC1Z,MAAjC,EAAyC;AAC5C,MAAI;AAAE2Z,IAAAA;AAAF,MAAc3Z,MAAM,CAAC4Z,YAAP,IAAuB,EAAzC;AACA,SAAO5hB,IAAI,CAACoT,KAAL,CAAWyO,SAAX,CAAqB7hB,IAAI,CAACoT,KAAL,CAAWnT,IAAX,CAAgB,GAAhB,EAAqB0hB,OAArB,EAA8BD,OAA9B,CAArB,CAAP;AACH;AACD,AAAO,SAASI,cAAT,CAAwB;AAAE9d,EAAAA,IAAF;AAAQ+d,EAAAA,GAAR;AAAavO,EAAAA,GAAb;AAAkBxL,EAAAA;AAAlB,CAAxB,EAAqD;AACxD,MAAI,CAAChE,IAAI,CAAC2H,QAAL,CAAc,aAAd,CAAL,EAAmC;AAC/B,WAAO3H,IAAP;AACH;;AACD,SAAQ,CAAC+d,GAAG,GACL,uCAAsCN,cAAc,CAAC,QAAD,EAAWzZ,MAAX,CAAmB,6EADlE,GAEL,EAFC,KAGHwL,GAAG,GACG,iCAAgCiO,cAAc,CAAC,QAAD,EAAWzZ,MAAX,CAAmB,2CADpE,GAEG,EALH,IAMJ,IANI,GAOJhE,IAPJ;AAQH;AACD,AAAO,SAASge,gBAAT,CAA0B;AAAEhe,EAAAA,IAAF;AAAQ+d,EAAAA,GAAR;AAAaE,EAAAA,KAAb;AAAoBja,EAAAA,MAApB;AAA4Bka,EAAAA;AAA5B,CAA1B,EAA+D;AAClE;AACAle,EAAAA,IAAI,GAAGA,IAAI,CAACK,OAAL,CAAa,qBAAb,EAAoC4d,KAAK,GAAG,GAAH,GAASja,MAAM,CAAC4Z,YAAP,CAAoBO,OAAtE,CAAP,CAFkE;;AAIlEne,EAAAA,IAAI,GAAGA,IAAI,CAACK,OAAL,CAAa,SAAb,EAAwB6d,IAAxB,CAAP;AACA,QAAME,iBAAiB,GAAGC,6BAA6B,EAAvD;AACAre,EAAAA,IAAI,GAAGA,IAAI,CAACK,OAAL,CAAa,yBAAb,EAAyC0G,KAAD,IAAW;AACtD,UAAMuX,eAAe,GAAGvX,KAAK,CAACwX,KAAN,CAAY,CAAZ,EAAe,CAAC,CAAhB,CAAxB;;AACA,QAAID,eAAe,IAAIF,iBAAvB,EAA0C;AACtC,aAAOA,iBAAiB,CAACE,eAAD,CAAjB,IAAsC,EAA7C;AACH;;AACD3iB,IAAAA,MAAM,CAACxB,IAAP,CAAa,yBAAwBmkB,eAAgB,cAArD;AACA,WAAOvX,KAAP;AACH,GAPM,CAAP;;AAQA,MAAIgX,GAAJ,EAAS;AACL,UAAMS,SAAS,GAAI,8BAA6Bf,cAAc,CAAC,QAAD,EAAWzZ,MAAX,CAAmB,aAAjF;AACAhE,IAAAA,IAAI,GAAG2G,gBAAgB,CAAC3G,IAAD,EAAOwe,SAAP,CAAvB;AACH;;AACD,SAAOxe,IAAP;AACH;;AACD,SAASye,uBAAT,CAAiC;AAAEze,EAAAA,IAAF;AAAQ+d,EAAAA,GAAR;AAAa/Z,EAAAA;AAAb,CAAjC,EAAyD;AACrD,QAAM0a,mBAAmB,GAAI,cAAahhB,IAAI,CAACY,SAAL,CAAeZ,IAAI,CAACC,KAAL,CAAWqC,IAAX,CAAf,CAAiC;qBAA3E;AAEA,SAAO8d,cAAc,CAAC;AAAE9d,IAAAA,IAAI,EAAE0e,mBAAR;AAA6BX,IAAAA,GAA7B;AAAkCvO,IAAAA,GAAG,EAAE,KAAvC;AAA8CxL,IAAAA;AAA9C,GAAD,CAArB;AACH;;AACD,SAAS2a,sBAAT,CAAgC;AAAE3e,EAAAA,IAAF;AAAQ+d,EAAAA,GAAR;AAAa/Z,EAAAA;AAAb,CAAhC,EAAwD;AACpD,QAAM4a,kBAAkB,GAAI,GAAEb,GAAG,GAC1B;;;;MAD0B,GAM3B,EAAG;eACErgB,IAAI,CAACY,SAAL,CAAe0B,IAAf,CAAqB;;;;;;;oCAPhC;AAeA,SAAO8d,cAAc,CAAC;AAAE9d,IAAAA,IAAI,EAAE4e,kBAAR;AAA4Bb,IAAAA,GAA5B;AAAiCvO,IAAAA,GAAG,EAAE,KAAtC;AAA6CxL,IAAAA;AAA7C,GAAD,CAArB;AACH;;AACD,IAAI6a,gBAAJ;;AACA,eAAeC,4BAAf,CAA4C;AAAEvd,EAAAA,GAAF;AAAOvB,EAAAA,IAAP;AAAa+d,EAAAA,GAAb;AAAkB/Z,EAAAA;AAAlB,CAA5C,EAAyE;AACrE6a,EAAAA,gBAAgB,GAAGA,gBAAgB,IAAI,KAAKhf,OAAO,CAAC,yBAAD,CAAZ,GAAvC;AACA,QAAM;AAAEkf,IAAAA,gBAAF;AAAoBC,IAAAA;AAApB,MAAqC,MAAMH,gBAAgB,CAACjV,IAAjB,CAAsB5J,IAAtB,EAA4BuB,GAA5B,EAAiChD,SAAjC,EAA4C,MAAM;AAC/F,UAAM,IAAIlD,KAAJ,CAAU,+CAAV,CAAN;AACH,GAFgD,CAAjD;AAGA,SAAQ,GAAE0iB,GAAG,GACN;yCAC8BN,cAAc,CAAC,QAAD,EAAWzZ,MAAX,CAAmB;;;;MAFzD,GAON,EAAE;oBACOtG,IAAI,CAACY,SAAL,CAAeygB,gBAAf,CAAiC;aACxCrhB,IAAI,CAACY,SAAL,CAAe0gB,YAAf,CAA6B;;;;;;;;oCATtC;AAkBH;;AACD,SAASC,0BAAT,CAAoC1d,GAApC,EAAyC;AACrC,SAAQ,kBAAiB7D,IAAI,CAACY,SAAL,CAAeiD,GAAf,CAAoB,GAA7C;AACH;;AACD,AAAO,eAAe2d,eAAf,CAA+B;AAAE3d,EAAAA,GAAF;AAAOvB,EAAAA,IAAP;AAAa+d,EAAAA,GAAb;AAAkB/Z,EAAAA;AAAlB,CAA/B,EAA4D;AAC/D,QAAM;AAAEiB,IAAAA,OAAF;AAAWG,IAAAA;AAAX,MAA2BL,MAAM,CAACxD,GAAD,CAAvC;;AACA,MAAI,OAAOvB,IAAP,KAAgB,QAApB,EAA8B;AAC1B,QAAIiF,OAAO,KAAK,OAAhB,EAAyB;AACrB,aAAOwZ,uBAAuB,CAAC;AAAEze,QAAAA,IAAF;AAAQ+d,QAAAA,GAAR;AAAa/Z,QAAAA;AAAb,OAAD,CAA9B;AACH;;AACD,QAAIiB,OAAO,KAAK,MAAhB,EAAwB;AACpB;AACA,YAAMka,SAAS,GAAGnf,IAAI,CAACK,OAAL,CAAa,oCAAb,EAAmD,EAAnD,CAAlB;AACA,aAAO+E,WAAW,CAAC4E,QAAZ,CAAqB,aAArB,IACD8U,4BAA4B,CAAC;AAAEvd,QAAAA,GAAF;AAAOvB,QAAAA,IAAI,EAAEmf,SAAb;AAAwBpB,QAAAA,GAAxB;AAA6B/Z,QAAAA;AAA7B,OAAD,CAD3B,GAED2a,sBAAsB,CAAC;AAAE3e,QAAAA,IAAI,EAAEmf,SAAR;AAAmBpB,QAAAA,GAAnB;AAAwB/Z,QAAAA;AAAxB,OAAD,CAF5B;AAGH;AACJ;;AACD,SAAOib,0BAA0B,CAAC1d,GAAD,CAAjC;AACH;AACD,AAAO,SAAS6d,iBAAT,CAA2BlB,IAA3B,EAAiC;AACpC,QAAMmB,SAAS,GAAGhB,6BAA6B,EAA/C;AACAgB,EAAAA,SAAS,CAACC,IAAV,GAAiBpB,IAAjB;AACAmB,EAAAA,SAAS,CAAC1H,QAAV,GAAqBuG,IAArB;AACA,SAAQ,kBAAiBxgB,IAAI,CAACY,SAAL,CAAe+gB,SAAf,CAA0B,GAAnD;AACH;AACD,MAAME,gBAAgB,GAAG,qBAAzB;;AACA,SAASlB,6BAAT,GAAyC;AACrC,QAAMgB,SAAS,sBAAQ5d,OAAO,CAAC+N,GAAhB,CAAf;;AACA,OAAK,MAAMA,GAAX,IAAkBtR,MAAM,CAACC,IAAP,CAAYkhB,SAAZ,CAAlB,EAA0C;AACtC,QAAI,CAACE,gBAAgB,CAAC/d,IAAjB,CAAsBgO,GAAtB,CAAL,EAAiC;AAC7B,aAAO6P,SAAS,CAAC7P,GAAD,CAAhB;AACH;AACJ;;AACD,SAAO6P,SAAP;AACH;;AC1HD,8BAAe;AACX,UAAQ,KADG;AAEX,UAAQ,KAFG;AAGX,SAAO,KAHI;AAIX,UAAQ,KAJG;AAKX,UAAQ,KALG;AAMX,aAAW,KANA;AAOX,UAAQ,KAPG;AAQX,UAAQ,KARG;AASX,UAAQ,KATG;AAUX,WAAS,OAVE;AAWX,WAAS,OAXE;AAYX,UAAQ,OAZG;AAaX,SAAO,OAbI;AAcX,UAAQ,OAdG;AAeX,UAAQ,OAfG;AAgBX,WAAS,MAhBE;AAiBX,WAAS,MAjBE;AAkBX,WAAS;AAlBE,CAAf;;ACKA,IAAIG,cAAc,GAAG,IAArB;AACA,MAAMC,SAAS,GAAG,uBAAlB;;AACA,SAASC,aAAT,CAAuBnT,QAAvB,EAAiCM,QAAjC,EAA2C;AACvC,SAAON,QAAQ,CAACvC,QAAT,CAAkB,MAAlB,KAA6ByV,SAAS,CAACje,IAAV,CAAeqL,QAAf,CAApC;AACH;;AACD,SAAS8S,SAAT,CAAmBpT,QAAnB,EAA6B;AACzB,QAAMqT,GAAG,GAAG5jB,IAAI,CAACkJ,OAAL,CAAaqH,QAAb,CAAZ;;AACA,MAAIqT,GAAG,KAAK,MAAZ,EAAoB;AAChB,WAAO,IAAP;AACH;;AACD,SAAOA,GAAG,CAACC,MAAJ,CAAW,CAAX,CAAP;AACH;;AACD,AAAO,SAASC,aAAT,CAAuB9b,MAAvB,EAA+B;AAAE2K,EAAAA;AAAF,CAA/B,EAA0C;AAC7C,SAAO;AACH5T,IAAAA,IAAI,EAAE,0BADH;AAEH+E,IAAAA,OAAO,EAAE;AACL6O,MAAAA,KADK;AAELmH,MAAAA,MAAM,EAAE,CAAC,KAAD;AAFH,KAFN;;AAMH,UAAMlM,IAAN,CAAW;AAAE2C,MAAAA;AAAF,KAAX,EAAyB;AACrBiT,MAAAA,cAAc,GAAGA,cAAc,KAAK,MAAMO,oBAAY,EAAvB,CAA/B;AACA,YAAMlT,QAAQ,GAAG,MAAM9P,WAAE,CAACH,QAAH,CAAY2P,QAAZ,EAAsB,OAAtB,CAAvB;AACA,YAAMyT,QAAQ,GAAGN,aAAa,CAACnT,QAAD,EAAWM,QAAX,CAA9B;AACA,YAAM;AAAEoT,QAAAA,EAAF;AAAMC,QAAAA,WAAN;AAAmBC,QAAAA;AAAnB,UAAgC,MAAMX,cAAc,CAACzP,SAAf,CAAyBlD,QAAzB,EAAmC;AAC3EuT,QAAAA,MAAM,EAAET,SAAS,CAACpT,QAAD,CAD0D;AAE3E8T,QAAAA,UAAU,EAAEL,QAAQ,GAAG,GAAH,GAASzhB,SAF8C;AAG3E+hB,QAAAA,WAAW,EAAEN,QAAQ,GAAG,UAAH,GAAgBzhB,SAHsC;AAI3EgiB,QAAAA,UAAU,EAAEhU,QAJ+D;AAK3E+O,QAAAA,SAAS,EAAEtX,MAAM,CAAC4Z,YAAP,CAAoB4C;AAL4C,OAAnC,CAA5C;;AAOA,WAAK,MAAMtF,OAAX,IAAsBiF,QAAtB,EAAgC;AAC5BxkB,QAAAA,MAAM,CAACvB,KAAP,CAAc,GAAEa,WAAA,CAAY,GAAZ,CAAiB,IAAGsR,QAAS;IACzD2O,OAAO,CAAClgB,IAAK,EADD;AAEH;;AACD,aAAO;AACH,eAAO;AACHgF,UAAAA,IAAI,EAAEigB,EAAE,IAAI,EADT;AAEHla,UAAAA,GAAG,EAAEma;AAFF;AADJ,OAAP;AAMH,KA3BE;;AA4BHO,IAAAA,OAAO,GAAG;AACNjB,MAAAA,cAAc,IAAIA,cAAc,CAACkB,IAAf,EAAlB;AACH;;AA9BE,GAAP;AAgCH;;ACvCD,MAAMC,WAAW,GAAG,UAApB;AACA,MAAMC,cAAc,GAAG,CAAC,sBAAD,EAAyB,gBAAzB,CAAvB;;AAEA,MAAMC,cAAc,GAAG;AACnBtN,EAAAA,OAAO,EAAE,CAAC,gBAAD,EAAmB,qBAAnB,CADU;AAEnBuG,EAAAA,OAAO,EAAE,EAFU;AAGnBzV,EAAAA,KAAK,EAAE,EAHY;AAInB+T,EAAAA,cAAc,EAAE;AACZC,IAAAA,IAAI,EAAE,aADM;AAEZE,IAAAA,eAAe,EAAE,EAFL;AAGZ/N,IAAAA,YAAY,EAAE,KAHF;AAIZqO,IAAAA,YAAY,EAAE,KAJF;AAKZrJ,IAAAA,GAAG,EAAE,EALO;AAMZ6J,IAAAA,YAAY,EAAE,EANF;AAOZX,IAAAA,MAAM,EAAE;AACJoB,MAAAA,OAAO,EAAE,EADL;AAEJQ,MAAAA,MAAM,EAAE;AAFJ;AAPI,GAJG;AAgBnBwG,EAAAA,OAAO,EAAE,EAhBU;AAiBnBC,EAAAA,UAAU,EAAE;AACRC,IAAAA,MAAM,EAAE,KADA;AAER5f,IAAAA,QAAQ,EAAE,WAFF;AAGRC,IAAAA,IAAI,EAAE,IAHE;AAIRmB,IAAAA,IAAI,EAAE,SAJE;AAKRye,IAAAA,GAAG,EAAE,OALG;AAMRC,IAAAA,QAAQ,EAAE;AANF,GAjBO;AAyBnBtD,EAAAA,YAAY,EAAE;AACVO,IAAAA,OAAO,EAAE,GADC;AAEVgD,IAAAA,aAAa,EAAE,cAFL;AAGVC,IAAAA,KAAK,EAAE,KAHG;AAIVzD,IAAAA,OAAO,EAAE,cAJC;AAKV0D,IAAAA,MAAM,EAAE,KALE;AAMVb,IAAAA,UAAU,EAAE,KANF;AAOVc,IAAAA,KAAK,EAAE;AAPG;AAzBK,CAAvB;AAmCA,MAAMC,YAAY,GAAG;AACjB3c,EAAAA,IAAI,EAAE,QADW;AAEjB4c,EAAAA,UAAU,EAAE;AACRC,IAAAA,OAAO,EAAE;AAAE7c,MAAAA,IAAI,EAAE;AAAR,KADD;AAERsT,IAAAA,OAAO,EAAE;AAAEtT,MAAAA,IAAI,EAAE,OAAR;AAAiB8c,MAAAA,KAAK,EAAE;AAAE9c,QAAAA,IAAI,EAAE;AAAR;AAAxB,KAFD;AAGR2O,IAAAA,OAAO,EAAE;AAAE3O,MAAAA,IAAI,EAAE,OAAR;AAAiB8c,MAAAA,KAAK,EAAE;AAAE9c,QAAAA,IAAI,EAAE;AAAR;AAAxB,KAHD;AAIRkV,IAAAA,OAAO,EAAE;AAAElV,MAAAA,IAAI,EAAE;AAAR,KAJD;AAKRoE,IAAAA,eAAe,EAAE;AACbpE,MAAAA,IAAI,EAAE,CAAC,QAAD,CADO;AAEb+c,MAAAA,oBAAoB,EAAE;AAAE/c,QAAAA,IAAI,EAAE;AAAR;AAFT,KALT;AASRkc,IAAAA,OAAO,EAAE;AACLlc,MAAAA,IAAI,EAAE,CAAC,QAAD,CADD;AAEL+c,MAAAA,oBAAoB,EAAE;AAAE/c,QAAAA,IAAI,EAAE;AAAR;AAFjB,KATD;AAaRP,IAAAA,KAAK,EAAE;AACHO,MAAAA,IAAI,EAAE,QADH;AAEH+c,MAAAA,oBAAoB,EAAE;AAAE/c,QAAAA,IAAI,EAAE;AAAR;AAFnB,KAbC;AAiBRmc,IAAAA,UAAU,EAAE;AACRnc,MAAAA,IAAI,EAAE,QADE;AAER4c,MAAAA,UAAU,EAAE;AACRR,QAAAA,MAAM,EAAE;AAAEpc,UAAAA,IAAI,EAAE;AAAR,SADA;AAERvD,QAAAA,IAAI,EAAE;AAAEuD,UAAAA,IAAI,EAAE;AAAR,SAFE;AAGRqc,QAAAA,GAAG,EAAE;AAAErc,UAAAA,IAAI,EAAE;AAAR,SAHG;AAIRsc,QAAAA,QAAQ,EAAE;AAAEtc,UAAAA,IAAI,EAAE;AAAR,SAJF;AAKR0H,QAAAA,MAAM,EAAE;AAAE1H,UAAAA,IAAI,EAAE;AAAR,SALA;AAMRpC,QAAAA,IAAI,EAAE;AAAEoC,UAAAA,IAAI,EAAE;AAAR,SANE;AAORmZ,QAAAA,GAAG,EAAE;AAAEnZ,UAAAA,IAAI,EAAE;AAAR;AAPG;AAFJ,KAjBJ;AA6BRwT,IAAAA,cAAc,EAAE;AACZxT,MAAAA,IAAI,EAAE,QADM;AAEZ4c,MAAAA,UAAU,EAAE;AACRnJ,QAAAA,IAAI,EAAE;AAAEzT,UAAAA,IAAI,EAAE;AAAR,SADE;AAER2T,QAAAA,eAAe,EAAE;AAAE3T,UAAAA,IAAI,EAAE,OAAR;AAAiB8c,UAAAA,KAAK,EAAE;AAAE9c,YAAAA,IAAI,EAAE;AAAR;AAAxB,SAFT;AAGRgU,QAAAA,SAAS,EAAE;AAAEhU,UAAAA,IAAI,EAAE;AAAR,SAHH;AAIR4F,QAAAA,YAAY,EAAE;AAAE5F,UAAAA,IAAI,EAAE;AAAR,SAJN;AAKRiU,QAAAA,YAAY,EAAE;AAAEjU,UAAAA,IAAI,EAAE;AAAR,SALN;AAMR6T,QAAAA,SAAS,EAAE;AAAEmJ,UAAAA,KAAK,EAAE,CAAC;AAAEhd,YAAAA,IAAI,EAAE;AAAR,WAAD,EAAsB;AAAEA,YAAAA,IAAI,EAAE;AAAR,WAAtB;AAAT,SANH;AAORP,QAAAA,KAAK,EAAE;AACHO,UAAAA,IAAI,EAAE,QADH;AAEH+c,UAAAA,oBAAoB,EAAE;AAAE/c,YAAAA,IAAI,EAAE;AAAR;AAFnB,SAPC;AAWR4K,QAAAA,GAAG,EAAE;AACD5K,UAAAA,IAAI,EAAE,QADL;AAED+c,UAAAA,oBAAoB,EAAE;AAClBC,YAAAA,KAAK,EAAE,CACH;AAAEtY,cAAAA,EAAE,EAAE,cAAN;AAAsB1E,cAAAA,IAAI,EAAE;AAA5B,aADG,EAEH;AAAE0E,cAAAA,EAAE,EAAE,cAAN;AAAsB1E,cAAAA,IAAI,EAAE;AAA5B,aAFG,EAGH;AAAE0E,cAAAA,EAAE,EAAE,YAAN;AAAoB1E,cAAAA,IAAI,EAAE,SAA1B;AAAqCid,cAAAA,IAAI,EAAE,CAAC,IAAD;AAA3C,aAHG;AADW;AAFrB,SAXG;AAqBRnJ,QAAAA,MAAM,EAAE;AACJ9T,UAAAA,IAAI,EAAE,QADF;AAEJ4c,UAAAA,UAAU,EAAE;AACR1H,YAAAA,OAAO,EAAE;AAAElV,cAAAA,IAAI,EAAE,OAAR;AAAiB8c,cAAAA,KAAK,EAAE;AAAE9c,gBAAAA,IAAI,EAAE;AAAR;AAAxB,aADD;AAER0V,YAAAA,MAAM,EAAE;AACJ1V,cAAAA,IAAI,EAAE,OADF;AAEJ8c,cAAAA,KAAK,EAAE;AAAE9c,gBAAAA,IAAI,EAAE;AAAR;AAFH;AAFA;AAFR;AArBA;AAFA,KA7BR;AAgERgZ,IAAAA,YAAY,EAAE;AACVhZ,MAAAA,IAAI,EAAE,CAAC,QAAD,CADI;AAEV4c,MAAAA,UAAU,EAAE;AACRrD,QAAAA,OAAO,EAAE;AAAEvZ,UAAAA,IAAI,EAAE;AAAR,SADD;AAERwc,QAAAA,KAAK,EAAE;AAAExc,UAAAA,IAAI,EAAE;AAAR,SAFC;AAGR+Y,QAAAA,OAAO,EAAE;AAAE/Y,UAAAA,IAAI,EAAE;AAAR,SAHD;AAIRyc,QAAAA,MAAM,EAAE;AAAEzc,UAAAA,IAAI,EAAE;AAAR,SAJA;AAKR4b,QAAAA,UAAU,EAAE;AAAE5b,UAAAA,IAAI,EAAE;AAAR,SALJ;AAMR0c,QAAAA,KAAK,EAAE;AAAE1c,UAAAA,IAAI,EAAE;AAAR;AANC;AAFF,KAhEN;AA2ERkd,IAAAA,KAAK,EAAE;AACHld,MAAAA,IAAI,EAAE;AADH;AA3EC;AAFK,CAArB;AAkFA;;;;;;;AAMA,SAASmd,cAAT,CAAwBC,KAAxB,EAA+B;AAC3B,QAAM/hB,MAAM,GAAG;AACXmY,IAAAA,cAAc,EAAE,EADL;AAEX2I,IAAAA,UAAU,EAAE,EAFD;AAGXnD,IAAAA,YAAY,EAAE;AAHH,GAAf;;AAKA,QAA0CqE,aAA1C,4BAA4DD,KAA5D;;AACA,QAAME,cAAc,GAAG,CAAC,OAAD,EAAU,SAAV,CAAvB;;AACA,OAAK,MAAM,CAACC,IAAD,EAAOtd,GAAP,CAAX,IAA0B3G,MAAM,CAACkG,OAAP,CAAe6d,aAAf,CAA1B,EAAyD;AACrD,QAAIE,IAAI,KAAK,GAAT,IAAgBA,IAAI,CAACxa,QAAL,CAAc,GAAd,CAApB,EAAwC;AACpC;AACH;;AACD,QAAI4Z,YAAY,CAACC,UAAb,CAAwBW,IAAxB,CAAJ,EAAmC;AAC/BliB,MAAAA,MAAM,CAACkiB,IAAD,CAAN,GAAetd,GAAf;AACA;AACH;;AACD,QAAI0c,YAAY,CAACC,UAAb,CAAwBpJ,cAAxB,CAAuCoJ,UAAvC,CAAkDW,IAAlD,CAAJ,EAA6D;AACzDliB,MAAAA,MAAM,CAACmY,cAAP,CAAsB+J,IAAtB,IAA8Btd,GAA9B;AACA;AACH;;AACD,QAAI0c,YAAY,CAACC,UAAb,CAAwBT,UAAxB,CAAmCS,UAAnC,CAA8CW,IAA9C,CAAJ,EAAyD;AACrDliB,MAAAA,MAAM,CAAC8gB,UAAP,CAAkBoB,IAAlB,IAA0Btd,GAA1B;AACA;AACH;;AACD,QAAI0c,YAAY,CAACC,UAAb,CAAwB5D,YAAxB,CAAqC4D,UAArC,CAAgDW,IAAhD,CAAJ,EAA2D;AACvDliB,MAAAA,MAAM,CAAC2d,YAAP,CAAoBuE,IAApB,IAA4Btd,GAA5B;AACA;AACH;;AACD,QAAIqd,cAAc,CAACva,QAAf,CAAwBwa,IAAxB,CAAJ,EAAmC;AAC/B;AACH;;AACDxmB,IAAAA,MAAM,CAACvB,KAAP,CAAc,sBAAqB+nB,IAAK,GAAxC;AACA1gB,IAAAA,OAAO,CAACiG,IAAR,CAAa,CAAb;AACH;;AACD,MAAIzH,MAAM,CAACmY,cAAP,CAAsB5I,GAA1B,EAA+B;AAC3BvP,IAAAA,MAAM,CAACmY,cAAP,CAAsB5I,GAAtB,GAA4BvP,MAAM,CAACmY,cAAP,CAAsB5I,GAAtB,CAA0BT,MAA1B,CAAiC,CAAC6I,GAAD,EAAMtO,EAAN,KAAa;AACtE,YAAMqM,KAAK,GAAGrM,EAAE,CAAC8Y,OAAH,CAAW,GAAX,CAAd;AACA,YAAM,CAACnkB,GAAD,EAAM4G,GAAN,IAAa8Q,KAAK,GAAG,CAAR,GAAY,CAACrM,EAAE,CAACuW,MAAH,CAAU,CAAV,EAAalK,KAAb,CAAD,EAAsBrM,EAAE,CAACuW,MAAH,CAAUlK,KAAK,GAAG,CAAlB,CAAtB,CAAZ,GAA0D,CAACrM,EAAD,EAAK,IAAL,CAA7E;AACAsO,MAAAA,GAAG,CAAC3Z,GAAD,CAAH,GAAW4G,GAAX;AACA,aAAO+S,GAAP;AACH,KAL2B,EAKzB,EALyB,CAA5B;AAMH;;AACD,SAAO3X,MAAP;AACH;AACD;;;AACA,SAASoiB,WAAT,CAAqBC,MAArB,EAA6B;AACzB,QAAM,CAACC,UAAD,EAAaC,QAAb,IAAyBF,MAAM,CAACG,WAAP,GAAqBpjB,KAArB,CAA2B,GAA3B,CAA/B;AACA,QAAM,CAACqjB,UAAD,EAAaC,WAAb,IAA4BH,QAAQ,GAAGA,QAAQ,CAACnjB,KAAT,CAAe,IAAf,CAAH,GAA0B,EAApE;AACA,QAAMujB,UAAU,GAAG,CAAC,GAAG,IAAIlY,GAAJ,CAAQgY,UAAU,CAACrjB,KAAX,CAAiB,GAAjB,EAAsB0G,GAAtB,CAA2B6Z,GAAD,IAAU,IAAGA,GAAI,EAA3C,CAAR,CAAJ,CAAnB;AACA,MAAIiD,WAAW,GAAG,EAAlB;;AACA,MAAIF,WAAJ,EAAiB;AACbE,IAAAA,WAAW,GAAG,CAAC,GAAG,IAAInY,GAAJ,CAAQiY,WAAW,CAACtjB,KAAZ,CAAkB,GAAlB,EAAuB0G,GAAvB,CAA4B6Z,GAAD,IAAU,IAAGA,GAAI,EAA5C,CAAR,CAAJ,CAAd;AACH,GAFD,MAGK,IAAIgD,UAAU,CAAC,CAAD,CAAV,KAAkB,SAAtB,EAAiC;AAClCC,IAAAA,WAAW,GAAG,CAAC,KAAD,EAAQ,MAAR,CAAd;AACH,GAFI,MAGA,IAAID,UAAU,CAAC,CAAD,CAAV,KAAkB,MAAtB,EAA8B;AAC/BC,IAAAA,WAAW,GAAG,CAAC,KAAD,EAAQ,MAAR,CAAd;AACH,GAFI,MAGA,IAAID,UAAU,CAACznB,MAAX,GAAoB,CAAxB,EAA2B;AAC5B0nB,IAAAA,WAAW,GAAGvT,KAAK,CAACpL,IAAN,CAAW,IAAIwG,GAAJ,CAAQkY,UAAU,CAAC7c,GAAX,CAAgB6Z,GAAD,IAASkD,uBAAuB,CAAClD,GAAD,CAAvB,IAAgCA,GAAxD,CAAR,CAAX,CAAd;AACH;;AACD,SAAO;AACH2C,IAAAA,UADG;AAEH5T,IAAAA,KAAK,EAAEiU,UAFJ;AAGH9M,IAAAA,MAAM,EAAE+M;AAHL,GAAP;AAKH;AACD;;;AACA,SAASE,WAAT,CAAqB/e,MAArB,EAA6B;AACzB,QAAM8V,OAAO,GAAG,EAAhB;;AACA,WAASkJ,iBAAT,CAA2BC,aAA3B,EAA0CC,aAA1C,EAAyD;AACrD,QAAI/H,MAAM,GAAG,IAAb;AACAA,IAAAA,MAAM,GAAG8H,aAAa,CAACjf,MAAD,EAASkf,aAAT,CAAtB;AACA,WAAO/H,MAAP;AACH;;AACD,WAASgI,oBAAT,CAA8BtU,SAA9B,EAAyC;AACrC,QAAI;AACA,YAAMuU,SAAS,GAAGvjB,OAAO,CAACC,OAAR,CAAgB+O,SAAhB,EAA2B;AAAE9O,QAAAA,KAAK,EAAE,CAAC0B,OAAO,CAACpE,GAAR,EAAD;AAAT,OAA3B,CAAlB;;AACA,aAAO2lB,iBAAiB,CAACnjB,OAAO,CAACujB,SAAD,CAAR,CAAxB,CAFA;AAGH,KAHD,CAIA,OAAO3lB,GAAP,EAAY;AAEX;AACJ;;AACD,WAAS4lB,oBAAT,CAA8BtoB,IAA9B,EAAoCO,OAApC,EAA6C;AACzC,UAAM8nB,SAAS,GAAGvjB,OAAO,CAACC,OAAR,CAAgB/E,IAAhB,EAAsB;AAAEgF,MAAAA,KAAK,EAAE,CAAC0B,OAAO,CAACpE,GAAR,EAAD;AAAT,KAAtB,CAAlB;;AACA,UAAMimB,SAAS,GAAGzjB,OAAO,CAACujB,SAAD,CAAzB;;AACA,QAAIjI,MAAJ;;AACA,QAAI;AACAA,MAAAA,MAAM,GAAG,OAAOmI,SAAS,CAACrU,OAAjB,KAA6B,UAA7B,GAA0CqU,SAAS,CAACrU,OAApD,GAA8DqU,SAAvE;AACA,UAAI,OAAOnI,MAAP,KAAkB,UAAtB,EACIxf,MAAM,CAACvB,KAAP,CAAc,UAASW,IAAK,0BAA5B;AACJogB,MAAAA,MAAM,GAAG6H,iBAAiB,CAAC7H,MAAD,EAAS7f,OAAT,CAA1B;AACH,KALD,CAMA,OAAOmC,GAAP,EAAY;AACR9B,MAAAA,MAAM,CAACvB,KAAP,CAAaqD,GAAG,CAACN,QAAJ,MAAkBM,GAA/B;AACA,YAAMA,GAAN;AACH;;AACD0d,IAAAA,MAAM,CAACpgB,IAAP,GAAcogB,MAAM,CAACpgB,IAAP,IAAeA,IAA7B,CAdyC;;AAgBzC,UAAM;AAAEwoB,MAAAA,KAAF;AAASjX,MAAAA;AAAT,QAAoB6O,MAA1B;;AACA,QAAIoI,KAAJ,EAAW;AACPpI,MAAAA,MAAM,CAACvR,IAAP,GAAc,MAAOtO,OAAP,IAAmB;AAC7B,cAAM2E,MAAM,GAAG,MAAMsjB,KAAK,mCACnBjoB,OADmB;AAEtBuR,UAAAA,QAAQ,EAAE,MAAMjQ,QAAQ,CAACtB,OAAO,CAACiR,QAAT;AAFF,WAAL,CAGlBpJ,KAHkB,CAGX1F,GAAD,IAAS;AACd9B,UAAAA,MAAM,CAACvB,KAAP,CAAc,IAAG+gB,MAAM,CAACpgB,IAAK,kGAA7B;AACA,gBAAM0C,GAAN;AACH,SANoB,CAArB;;AAOA,YAAI,CAACwC,MAAL,EAAa;AACT,iBAAO,IAAP;AACH;;AACD,YAAIA,MAAM,CAACujB,SAAX,EAAsB;AAClB,iBAAO;AACH,mBAAOvjB,MAAM,CAACA,MADX;AAEH,oBAAQA,MAAM,CAACujB,SAAP,CAAiBC;AAFtB,WAAP;AAIH;;AACD,eAAOxjB,MAAM,CAACA,MAAd;AACH,OAlBD;AAmBH,KArCwC;;;AAuCzC,QAAIqM,MAAJ,EAAY;AACR6O,MAAAA,MAAM,CAACuI,QAAP,GAAkB,MAAOpoB,OAAP,IAAmB;AACjC,eAAOgR,MAAM,CAAC;AACVqX,UAAAA,YAAY,EAAEroB,OAAO,CAACsoB,cADZ;AAEVC,UAAAA,aAAa,EAAEvoB,OAAO,CAACsoB,cAFb;AAGV;AACA9oB,UAAAA,GAAG,EAAEQ,OAAO,CAACR,GAJH;AAKV;AACA;AACAgpB,UAAAA,WAAW,EAAE;AAPH,SAAD,CAAN,CAQJ3gB,KARI,CAQG1F,GAAD,IAAS;AACd9B,UAAAA,MAAM,CAACvB,KAAP,CAAc,IAAG+gB,MAAM,CAACpgB,IAAK,kGAA7B;AACA,gBAAM0C,GAAN;AACH,SAXM,CAAP;AAYH,OAbD;AAcH;;AACD,QAAI,CAAC0d,MAAM,CAACrb,OAAR,IACAqb,MAAM,CAAC4I,kBADP,IAEA5I,MAAM,CAAC4I,kBAAP,CAA0BplB,UAA1B,CAAqC,QAArC,CAFJ,EAEoD;AAChD,YAAM;AAAEgQ,QAAAA,KAAF;AAASmH,QAAAA;AAAT,UAAoBuM,WAAW,CAAClH,MAAM,CAAC4I,kBAAR,CAArC;AACA5I,MAAAA,MAAM,CAACrb,OAAP,GAAiB;AAAE6O,QAAAA,KAAF;AAASmH,QAAAA;AAAT,OAAjB;AACH,KALD,MAMK,IAAIqF,MAAM,CAACrb,OAAX,EAAoB;AACrB,YAAM;AAAE6O,QAAAA,KAAF;AAASmH,QAAAA;AAAT,UAAoBqF,MAAM,CAACrb,OAAjC;AACAqb,MAAAA,MAAM,CAACrb,OAAP,GAAiB;AAAE6O,QAAAA,KAAF;AAASmH,QAAAA;AAAT,OAAjB;AACH;;AACDkO,IAAAA,cAAc,CAAC7I,MAAD,CAAd;AACA,WAAOA,MAAP;AACH,GAnFwB;AAqFzB;;;AACAjd,EAAAA,MAAM,CAACkG,OAAP,CAAeJ,MAAM,CAAC8c,OAAtB,EAA+BpH,OAA/B,CAAuC,CAAC,CAAC1H,MAAD,EAASiS,GAAT,CAAD,KAAmB;AACtD,UAAM;AAAE1B,MAAAA,UAAF;AAAc5T,MAAAA,KAAd;AAAqBmH,MAAAA;AAArB,QAAgCuM,WAAW,CAACrQ,MAAD,CAAjD;;AACA,QAAIhO,MAAM,CAAC8V,OAAP,CAAevL,IAAf,CAAqBC,CAAD,IAAO,CAACc,KAAK,CAAC4U,OAAN,CAAc1V,CAAd,IAAmBA,CAAC,CAAC,CAAD,CAApB,GAA0BA,CAA3B,MAAkCyV,GAA7D,CAAJ,EAAuE;AACnEE,MAAAA,iBAAiB,CAAE,IAAGF,GAAI,4FAAT,CAAjB;AACH;;AACD,YAAQ1B,UAAR;AACI,WAAK,KAAL;AAAY;AACR,cAAIvQ,MAAM,CAAChI,QAAP,CAAgB,SAAhB,CAAJ,EAAgC;AAC5B;AACH;;AACD,gBAAMoa,QAAQ,GAAGpgB,MAAM,CAAC8c,OAAP,CAAe9O,MAAM,GAAG,SAAxB,CAAjB;AACA8H,UAAAA,OAAO,CAAC5e,IAAR,CAAa8nB,iBAAiB,CAACqB,eAAD,EAAkB;AAAEJ,YAAAA,GAAF;AAAO3C,YAAAA,KAAK,EAAE8C,QAAQ,IAAIH;AAA1B,WAAlB,CAA9B;AACA;AACH;;AACD,WAAK,OAAL;AAAc;AACVnK,UAAAA,OAAO,CAAC5e,IAAR,CAAa8nB,iBAAiB,CAACsB,iBAAD,EAAoB;AAAE3V,YAAAA,KAAF;AAASmH,YAAAA,MAAT;AAAiBmO,YAAAA;AAAjB,WAApB,CAA9B;AACA;AACH;;AACD,WAAK,QAAL;AAAe;AACXnK,UAAAA,OAAO,CAAC5e,IAAR,CAAaioB,oBAAoB,CAACc,GAAD,CAAjC;AACA;AACH;AAhBL;AAkBH,GAvBD,EAtFyB;;AA+GzBjgB,EAAAA,MAAM,CAAC8V,OAAP,CAAeJ,OAAf,CAAwB6K,GAAD,IAAS;AAC5B,UAAMC,UAAU,GAAGlV,KAAK,CAAC4U,OAAN,CAAcK,GAAd,IAAqBA,GAAG,CAAC,CAAD,CAAxB,GAA8BA,GAAjD;AACA,UAAMrB,aAAa,GAAG5T,KAAK,CAAC4U,OAAN,CAAcK,GAAd,IAAqBA,GAAG,CAAC,CAAD,CAAxB,GAA8B,EAApD;AACA,UAAMpJ,MAAM,GAAGkI,oBAAoB,CAACmB,UAAD,EAAatB,aAAb,CAAnC;AACAvnB,IAAAA,MAAM,CAAC1B,KAAP,CAAc,kBAAiBuqB,UAAW,EAA1C;AACA1K,IAAAA,OAAO,CAAC5e,IAAR,CAAaigB,MAAb;AACH,GAND,EA/GyB;;AAuHzB,QAAMsJ,kBAAkB,GAAG,IAAI/Z,GAAJ,CAAQ,CAAC,MAAD,EAAS,MAAT,EAAiB,KAAjB,EAAwB,MAAxB,CAAR,CAA3B;AACAoP,EAAAA,OAAO,CACF/L,MADL,CACY,CAAC;AAAEjO,IAAAA;AAAF,GAAD,KAAiB,CAAC,CAACA,OAD/B,EAEKiP,MAFL,CAEY,CAAC2V,GAAD,EAAMC,CAAN,KAAYD,GAAG,CAAC3R,MAAJ,CAAW4R,CAAC,CAAC7kB,OAAF,CAAU6O,KAArB,CAFxB,EAEqD,EAFrD,EAGK+K,OAHL,CAGckG,GAAD,IAAS6E,kBAAkB,CAACG,MAAnB,CAA0BhF,GAA1B,CAHtB;;AAIA,MAAI6E,kBAAkB,CAAChY,IAAnB,GAA0B,CAA9B,EAAiC;AAC7BqN,IAAAA,OAAO,CAAC+K,OAAR,CAAgB7B,iBAAiB,CAAClD,aAAD,EAAgB;AAAEnR,MAAAA,KAAK,EAAE,CAAC,GAAG8V,kBAAJ;AAAT,KAAhB,CAAjC;AACH;;AACD,QAAMK,YAAY,GAAGhL,OAAO,CAAC/K,MAAR,CAAe,CAAChJ,GAAD,EAAM;AAAEjG,IAAAA;AAAF,GAAN,KAAsB;AACtD,QAAIA,OAAJ,EAAa;AACT,WAAK,MAAMilB,QAAX,IAAuBjlB,OAAO,CAAC6O,KAA/B,EAAsC;AAClC5I,QAAAA,GAAG,CAACgf,QAAD,CAAH,GAAgBjlB,OAAO,CAACgW,MAAR,CAAe,CAAf,CAAhB;AACH;AACJ;;AACD,WAAO/P,GAAP;AACH,GAPoB,EAOlB,EAPkB,CAArB;AAQA,SAAO;AACH+T,IAAAA,OADG;AAEHgL,IAAAA;AAFG,GAAP;AAIH;AACD;;;;;;AAIA,SAASE,wBAAT,CAAkChhB,MAAlC,EAA0C;AACtC,OAAK,MAAMihB,QAAX,IAAuBjhB,MAAM,CAAC8c,OAA9B,EAAuC;AACnC,QAAI,CAACmE,QAAQ,CAACtmB,UAAT,CAAoB,QAApB,CAAL,EAAoC;AAChC;AACH;;AACD,UAAMumB,MAAM,GAAGlhB,MAAM,CAAC8c,OAAP,CAAemE,QAAf,EAAyB5lB,KAAzB,CAA+B,KAA/B,CAAf;;AACA,QAAI6lB,MAAM,CAAC,CAAD,CAAN,KAAc,OAAlB,EAA2B;AACvBf,MAAAA,iBAAiB,CAAE,WAAUc,QAAS,8BAArB,CAAjB;AACH;;AACDC,IAAAA,MAAM,CAAC9pB,KAAP;AACA,UAAM;AAAE+I,MAAAA,EAAF;AAAMmJ,MAAAA;AAAN,QAAY6X,KAAK,CAACD,MAAD,CAAvB;;AACA,QAAI5X,CAAC,CAACnS,MAAF,KAAa,CAAjB,EAAoB;AAChBgpB,MAAAA,iBAAiB,CAAE,WAAUc,QAAS,2DAArB,CAAjB;AACH;;AACD,QAAI9gB,EAAE,IAAIA,EAAE,CAAC,CAAD,CAAF,KAAU,GAApB,EAAyB;AACrBggB,MAAAA,iBAAiB,CAAE,WAAUc,QAAS,YAAW9gB,EAAG,4CAAnC,CAAjB;AACH;;AACD,UAAM;AAAEihB,MAAAA,KAAF;AAASC,MAAAA;AAAT,QAAqB;AAAEA,MAAAA,OAAO,EAAE/X,CAAC,CAAC,CAAD,CAAZ;AAAiB8X,MAAAA,KAAK,EAAEjhB;AAAxB,KAA3B;;AACA,QAAIH,MAAM,CAAC8d,KAAP,CAAasD,KAAb,CAAJ,EAAyB;AACrBjB,MAAAA,iBAAiB,CAAE,WAAUc,QAAS,6BAA4BG,KAAM,IAAvD,CAAjB;AACH;;AACDphB,IAAAA,MAAM,CAAC8d,KAAP,CAAasD,KAAb,IAAsBC,OAAtB;AACA,WAAOrhB,MAAM,CAAC8c,OAAP,CAAemE,QAAf,CAAP;AACH;;AACD,SAAOjhB,MAAP;AACH;;AACD,SAASshB,gBAAT,CAA0BC,OAA1B,EAAmC;AAC/B,SAAOrnB,MAAM,CAACkG,OAAP,CAAemhB,OAAf,EAAwBxf,GAAxB,CAA4B,CAAC,CAACyf,UAAD,EAAalqB,OAAb,CAAD,KAA2B;AAC1D,QAAI,OAAOA,OAAP,KAAmB,QAAvB,EAAiC;AAC7B,aAAO,CACHkqB,UADG;AAGC;AACAhqB,QAAAA,EAAE,EAAE;AAJL,SAKIF,OALJ,EAAP;AAQH;;AACD,WAAO,CACHkqB,UADG,EAEH;AACIhqB,MAAAA,EAAE,EAAE;AACAiqB,QAAAA,QAAQ,EAAE,CAACA,QAAD,EAAWC,GAAX,KAAmB;AACzB,gBAAMC,SAAS,GAAGF,QAAQ,CAACzpB,IAAT,CAAcqD,KAAd,CAAoBqmB,GAAG,CAACnkB,GAAxB,EAA6B,CAA7B,CAAlB;AACAkkB,UAAAA,QAAQ,CAACzpB,IAAT,GAAgB2pB,SAAS,GAAGD,GAAG,CAACnkB,GAAJ,CAAQlB,OAAR,CAAgBmlB,UAAhB,EAA4B,EAA5B,CAA5B;AACH;AAJD,OADR;AAOIxT,MAAAA,MAAM,EAAE1W,OAPZ;AAQIsqB,MAAAA,YAAY,EAAE,IARlB;AASI5E,MAAAA,MAAM,EAAE;AATZ,KAFG,CAAP;AAcH,GAzBM,CAAP;AA0BH;;AACD,SAAS6E,cAAT,CAAwB7hB,MAAxB,EAAgC;AAC5B,QAAM8hB,WAAW,GAAG9hB,MAAM,CAACmP,KAAP,IAAgB,EAApC;;AACA,OAAK,MAAM,CAACnB,MAAD,EAASiS,GAAT,CAAX,IAA4B/lB,MAAM,CAACkG,OAAP,CAAeJ,MAAM,CAAC8c,OAAtB,CAA5B,EAA4D;AACxD,QAAI9O,MAAM,CAACrT,UAAP,CAAkB,QAAlB,CAAJ,EAAiC;AAC7B,YAAMumB,MAAM,GAAGjB,GAAG,CAAC5kB,KAAJ,CAAU,KAAV,CAAf;;AACA,UAAI6lB,MAAM,CAAC,CAAD,CAAN,KAAc,OAAlB,EAA2B;AACvBf,QAAAA,iBAAiB,CAAE,WAAUnS,MAAO,8BAAnB,CAAjB;AACH;;AACDkT,MAAAA,MAAM,CAAC9pB,KAAP;AACA,YAAM;AAAE+I,QAAAA,EAAF;AAAMmJ,QAAAA;AAAN,UAAY6X,KAAK,CAACD,MAAD,CAAvB;;AACA,UAAI5X,CAAC,CAACnS,MAAF,KAAa,CAAjB,EAAoB;AAChBgpB,QAAAA,iBAAiB,CAAE,WAAUnS,MAAO,iDAAnB,CAAjB;AACH;;AACD,UAAIA,MAAM,KAAK,mBAAf,EAAoC;AAChChO,QAAAA,MAAM,CAAC4Z,YAAP,CAAoBuD,aAApB,GAAoChd,EAApC;AACH,OAFD,MAGK;AACD2hB,QAAAA,WAAW,CAACZ,MAAM,CAAC,CAAD,CAAP,CAAX,GAAyB/gB,EAAE,IAAK,IAAG+gB,MAAM,CAAC,CAAD,CAAI,EAA7C;AACH;AACJ;AACJ;;AACD,OAAK,MAAM,CAACa,QAAD,EAAWC,QAAX,CAAX,IAAmC9nB,MAAM,CAACkG,OAAP,CAAe0hB,WAAf,CAAnC,EAAgE;AAC5D,UAAM1S,QAAQ,GAAGpX,IAAI,CAACoT,KAAL,CAAWyO,SAAX,CAAqBkI,QAAQ,GAAG,GAAhC,CAAjB;AACA,WAAOD,WAAW,CAACC,QAAD,CAAlB;AACAD,IAAAA,WAAW,CAAC1S,QAAD,CAAX,GAAwB4S,QAAxB;;AACA,QAAIA,QAAQ,CAAC,CAAD,CAAR,KAAgB,GAApB,EAAyB;AACrB7B,MAAAA,iBAAiB,CAAE,SAAQ4B,QAAS,aAAYC,QAAS,4CAAxC,CAAjB;AACH;AACJ,GA5B2B;;;AA8B5B,MAAI,CAAC9nB,MAAM,CAACC,IAAP,CAAY2nB,WAAZ,EAAyB3qB,MAA9B,EAAsC;AAClC2qB,IAAAA,WAAW,CAAC,GAAD,CAAX,GAAmB,GAAnB;AACH;;AACD,SAAOA,WAAP;AACH;;AACD,SAASG,cAAT,CAAwBjiB,MAAxB,EAAgCkiB,gBAAhC,EAAkD;AAC9C,QAAM7oB,GAAG,GAAGoE,OAAO,CAACpE,GAAR,EAAZ;AACA,QAAM8oB,UAAU,GAAGniB,MAAM,CAACK,KAAP,IAAgB,EAAnC;;AACA,MAAI6hB,gBAAJ,EAAsB;AAClB,SAAK,MAAMH,QAAX,IAAuB7nB,MAAM,CAACC,IAAP,CAAY6F,MAAM,CAACmP,KAAnB,CAAvB,EAAkD;AAC9C,UAAI4S,QAAQ,KAAK,GAAjB,EAAsB;AAClBI,QAAAA,UAAU,CAACxhB,gBAAgB,CAACohB,QAAD,CAAjB,CAAV,GAAyCphB,gBAAgB,CAAE,KAAIohB,QAAS,EAAf,CAAzD;AACH;AACJ;AACJ;;AACD,OAAK,MAAM,CAAC/T,MAAD,EAASiI,WAAT,CAAX,IAAoC/b,MAAM,CAACkG,OAAP,CAAeJ,MAAM,CAACK,KAAtB,CAApC,EAAkE;AAC9D,QAAI4V,WAAW,KAAK,GAAhB,IACAA,WAAW,KAAK,IADhB,IAEAA,WAAW,CAACtb,UAAZ,CAAuB,IAAvB,CAFA,IAGAsb,WAAW,CAACtb,UAAZ,CAAuB,KAAvB,CAHA,IAIAsb,WAAW,CAACtb,UAAZ,CAAuB,GAAvB,CAJJ,EAIiC;AAC7B,aAAOwnB,UAAU,CAACnU,MAAD,CAAjB;AACAmU,MAAAA,UAAU,CAACxhB,gBAAgB,CAACqN,MAAD,CAAjB,CAAV,GAAuCrN,gBAAgB,CAAC3I,IAAI,CAAC8D,OAAL,CAAazC,GAAb,EAAkB4c,WAAlB,CAAD,CAAvD;AACH;AACJ;;AACD,SAAOkM,UAAP;AACH;AACD;;;AACA,SAASC,eAAT,CAAyBpiB,MAAzB,EAAiC;AAC7B,QAAM3G,GAAG,GAAGoE,OAAO,CAACpE,GAAR,EAAZ;AACA2G,EAAAA,MAAM,CAACuY,gBAAP,GAA0BvY,MAAM,CAACkU,OAAP,IAAkB,EAA5C;AACAlU,EAAAA,MAAM,CAACoU,cAAP,CAAsBC,IAAtB,GAA6Brc,IAAI,CAAC8D,OAAL,CAAazC,GAAb,EAAkB2G,MAAM,CAACoU,cAAP,CAAsBC,IAAxC,CAA7B;AACArU,EAAAA,MAAM,CAAC+c,UAAP,CAAkBE,GAAlB,GAAwBjlB,IAAI,CAAC8D,OAAL,CAAazC,GAAb,EAAkB2G,MAAM,CAAC+c,UAAP,CAAkBE,GAApC,CAAxB;AACAjd,EAAAA,MAAM,CAACuP,OAAP,GAAiBjE,KAAK,CAACpL,IAAN,CAAW,IAAIwG,GAAJ,CAAQ,CAAC,GAAGkW,cAAJ,EAAqB,GAAE5c,MAAM,CAAC+c,UAAP,CAAkBE,GAAI,OAA7C,EAAqD,GAAGjd,MAAM,CAACuP,OAA/D,CAAR,CAAX,CAAjB;;AACA,MAAI,CAACvP,MAAM,CAAC8d,KAAZ,EAAmB;AACf9d,IAAAA,MAAM,CAAC8d,KAAP,GAAe,EAAf;AACH,GAR4B;;;AAU7B9d,EAAAA,MAAM,CAAC4Z,YAAP,CAAoBO,OAApB,GAA8BxZ,gBAAgB,CAACX,MAAM,CAAC4Z,YAAP,CAAoBO,OAArB,CAA9C;AACAna,EAAAA,MAAM,CAAC4Z,YAAP,CAAoBuD,aAApB,GAAoCna,eAAe,CAAChD,MAAM,CAAC4Z,YAAP,CAAoBuD,aAArB,CAAnD;AACAnd,EAAAA,MAAM,CAAC4Z,YAAP,CAAoBD,OAApB,GAA8B1W,kBAAkB,CAACxC,mBAAmB,CAACT,MAAM,CAAC4Z,YAAP,CAAoBD,OAArB,CAApB,CAAhD;AACA,QAAM0I,mBAAmB,GAAG,CAACriB,MAAM,CAACmP,KAApC;AACAnP,EAAAA,MAAM,GAAGghB,wBAAwB,CAAChhB,MAAD,CAAjC;AACAA,EAAAA,MAAM,CAAC8d,KAAP,GAAewD,gBAAgB,CAACthB,MAAM,CAAC8d,KAAR,CAA/B;AACA9d,EAAAA,MAAM,CAACmP,KAAP,GAAe0S,cAAc,CAAC7hB,MAAD,CAA7B;AACAA,EAAAA,MAAM,CAACK,KAAP,GAAe4hB,cAAc,CAACjiB,MAAD,EAASqiB,mBAAT,CAA7B,CAjB6B;;AAmB7B,QAAM;AAAEvM,IAAAA,OAAF;AAAWgL,IAAAA;AAAX,MAA4B/B,WAAW,CAAC/e,MAAD,CAA7C;AACAA,EAAAA,MAAM,CAAC8V,OAAP,GAAiBA,OAAjB;AACA9V,EAAAA,MAAM,CAACsiB,aAAP,GAAuBxB,YAAvB,CArB6B;;AAuB7B,OAAK,MAAM;AAAEvI,IAAAA;AAAF,GAAX,IAAmCvY,MAAM,CAAC8V,OAA1C,EAAmD;AAC/C,QAAIyC,gBAAJ,EAAsB;AAClBvY,MAAAA,MAAM,CAACuY,gBAAP,GAA0BvY,MAAM,CAACuY,gBAAP,CAAwBxJ,MAAxB,CAA+BwJ,gBAA/B,CAA1B;AACH;AACJ;;AACDzC,EAAAA,OAAO,CAACJ,OAAR,CAAiByB,MAAD,IAAY;AACxB,QAAIA,MAAM,CAACnX,MAAX,EAAmB;AACfmX,MAAAA,MAAM,CAACnX,MAAP,CAAcA,MAAd;AACH;AACJ,GAJD;AAKA,SAAOA,MAAP;AACH;;AACD,SAASmgB,iBAAT,CAA2BoC,GAA3B,EAAgC;AAC5B5qB,EAAAA,MAAM,CAACvB,KAAP,CAAamsB,GAAb;AACA9kB,EAAAA,OAAO,CAACiG,IAAR,CAAa,CAAb;AACH;;AACD,SAAS8e,sBAAT,CAAgC3pB,QAAhC,EAA0C4pB,MAA1C,EAAkD;AAC9C9qB,EAAAA,MAAM,CAACvB,KAAP,CAAc,KAAIyC,QAAQ,IAAI,qBAAsB;EACtD4pB,MAAM,CAAC1gB,GAAP,CAAYtI,GAAD,IAAU,SAAQA,GAAG,CAACN,QAAJ,EAAe,EAA5C,EAA+ClB,IAA/C,CAAoD,IAApD,CAA0D;+DADxD;AAGAwF,EAAAA,OAAO,CAACiG,IAAR,CAAa,CAAb;AACH;;AACD,SAASgf,2BAAT,CAAqCC,OAArC,EAA8C,GAAGC,IAAjD,EAAuD;AACnDjrB,EAAAA,MAAM,CAACvB,KAAP,CAAc,GAAEusB,OAAQ;EAC1BC,IAAI,CAAC3qB,IAAL,CAAU,IAAV,CAAgB;2DADd;AAGAwF,EAAAA,OAAO,CAACiG,IAAR,CAAa,CAAb;AACH;;AACD,SAASmf,uBAAT,CAAiCC,SAAjC,EAA4CC,QAA5C,EAAsD;AAAA;;AAClD;AACA,MAAID,SAAS,CAACxM,MAAV,IAAoByM,QAAQ,CAACzM,MAAjC,EAAyC;AACrCoM,IAAAA,2BAA2B,CAAC,qEAAD,CAA3B;AACH;;AACD,MAAII,SAAS,CAACzN,YAAd,EAA4B;AACxBqN,IAAAA,2BAA2B,CAAC,wGAAD,CAA3B;AACH;;AACD,+BAAII,SAAS,CAAC1O,cAAd,oFAAI,sBAA0BM,MAA9B,2DAAI,uBAAkCW,YAAtC,EAAoD;AAChD,WAAOyN,SAAS,CAAC1O,cAAV,CAAyBM,MAAzB,CAAgCW,YAAvC;AACA1d,IAAAA,MAAM,CAACvB,KAAP,CAAa,sGAAb;AACH;;AACD,MAAI0sB,SAAS,CAACpO,MAAd,EAAsB;AAClBgO,IAAAA,2BAA2B,CAAC,+EAAD,CAA3B;AACH;;AACD,MAAI,2BAAAI,SAAS,CAAC1O,cAAV,kFAA0B4O,OAA1B,KAAqCD,QAAQ,CAACC,OAAlD,EAA2D;AACvDN,IAAAA,2BAA2B,CAAC,wFAAD,CAA3B;AACH;;AACD,gCAAII,SAAS,CAAC1O,cAAd,2DAAI,uBAA0B7E,OAA9B,EAAuC;AACnCmT,IAAAA,2BAA2B,CAAC,gEAAD,CAA3B;AACH;;AACD,MAAIpX,KAAK,CAAC4U,OAAN,CAAc4C,SAAS,CAAC9d,eAAxB,CAAJ,EAA8C;AAC1C0d,IAAAA,2BAA2B,CAAC,mEAAD,CAA3B;AACH;;AACD,MAAII,SAAS,CAACvK,gBAAd,EAAgC;AAC5BmK,IAAAA,2BAA2B,CAAC,0DAAD,CAA3B;AACH;;AACD,MAAII,SAAS,CAACG,WAAd,EAA2B;AACvBP,IAAAA,2BAA2B,CAAC,qDAAD,CAA3B;AACH;;AACD,MAAII,SAAS,CAACE,OAAd,EAAuB;AACnBN,IAAAA,2BAA2B,CAAC,gGAAD,EAAmG,iEAAnG,CAA3B;AACH,GAhCiD;;;AAkClD,MAAII,SAAS,CAAC/c,MAAV,IAAoBgd,QAAQ,CAAChd,MAAjC,EAAyC;AACrC2c,IAAAA,2BAA2B,CAAC,4FAAD,CAA3B;AACH;;AACD,MAAII,SAAS,CAACI,IAAV,IAAkBH,QAAQ,CAACG,IAA/B,EAAqC;AACjCR,IAAAA,2BAA2B,CAAC,sFAAD,CAA3B;AACH;;AACD,MAAII,SAAS,CAAChG,OAAV,IACA5iB,MAAM,CAACC,IAAP,CAAY2oB,SAAS,CAAChG,OAAtB,EAA+B/S,MAA/B,CAAuCoZ,CAAD,IAAOA,CAAC,CAACxoB,UAAF,CAAa,SAAb,CAA7C,EAAsExD,MAAtE,GAA+E,CADnF,EACsF;AAClFurB,IAAAA,2BAA2B,CAAC,qFAAD,CAA3B;AACH;;AACD,MAAII,SAAS,CAAChG,OAAV,IACA5iB,MAAM,CAACC,IAAP,CAAY2oB,SAAS,CAAChG,OAAtB,EAA+B/S,MAA/B,CAAuCoZ,CAAD,IAAOA,CAAC,CAACxoB,UAAF,CAAa,UAAb,CAA7C,EAAuExD,MAAvE,GAAgF,CADpF,EACuF;AACnFurB,IAAAA,2BAA2B,CAAC,wFAAD,CAA3B;AACH;;AACD,+BAAII,SAAS,CAAClJ,YAAd,0DAAI,sBAAwByD,MAA5B,EAAoC;AAChCqF,IAAAA,2BAA2B,CAAC,4JAAD,CAA3B;AACH,GAlDiD;;;AAoDlD,+BAAII,SAAS,CAAC/F,UAAd,0DAAI,sBAAsBqG,IAA1B,EAAgC;AAC5BV,IAAAA,2BAA2B,CAAC,6FAAD,EAAiG;iEAAjG,CAA3B;AAEH;;AACD,MAAII,SAAS,CAACO,IAAV,IAAkBN,QAAQ,CAACM,IAA/B,EAAqC;AACjCX,IAAAA,2BAA2B,CAAC,kFAAD,CAA3B;AACH;;AACD,MAAI,2BAAAI,SAAS,CAAC1O,cAAV,kFAA0BkP,QAA1B,KAAsCP,QAAQ,CAACO,QAAnD,EAA6D;AACzDZ,IAAAA,2BAA2B,CAAC,sFAAD,CAA3B;AACH;;AACD,MAAI,2BAAAI,SAAS,CAAC1O,cAAV,kFAA0BmP,cAA1B,KAA4CR,QAAQ,CAACQ,cAAzD,EAAyE;AACrEb,IAAAA,2BAA2B,CAAC,4FAAD,CAA3B;AACH;;AACD,MAAI,2BAAAI,SAAS,CAAC1O,cAAV,kFAA0BoP,KAA1B,KAAmCT,QAAQ,CAACS,KAAhD,EAAuD;AACnDd,IAAAA,2BAA2B,CAAC,mFAAD,CAA3B;AACH;;AACD,gCAAII,SAAS,CAAC1O,cAAd,2DAAI,uBAA0BsL,QAA9B,EAAwC;AACpCgD,IAAAA,2BAA2B,CAAC,mGAAD,CAA3B;AACH;;AACD,MAAI,2BAAAI,SAAS,CAAC1O,cAAV,kFAA0BqP,MAA1B,KAAoCV,QAAQ,CAACU,MAAjD,EAAyD;AACrDf,IAAAA,2BAA2B,CAAC,qEAAD,CAA3B;AACH;;AACD,iCAAII,SAAS,CAAC1O,cAAd,4DAAI,wBAA0B/T,KAA9B,EAAqC;AACjCqiB,IAAAA,2BAA2B,CAAC,8HAAD,CAA3B;AACH;AACJ;;AACD,SAAS1C,cAAT,CAAwB7I,MAAxB,EAAgC;AAC5B,QAAMqJ,UAAU,GAAGrJ,MAAM,CAACpgB,IAA1B;;AACA,MAAIogB,MAAM,CAACrb,OAAP,IAAkB,CAACqb,MAAM,CAACvR,IAA9B,EAAoC;AAChCua,IAAAA,iBAAiB,CAAE,IAAGK,UAAW,uDAAhB,CAAjB;AACH;;AACD,MAAI,CAACrJ,MAAM,CAACrb,OAAR,IAAmBqb,MAAM,CAACvR,IAA9B,EAAoC;AAChCua,IAAAA,iBAAiB,CAAE,IAAGK,UAAW,uDAAhB,CAAjB;AACH;;AACD,MAAIrJ,MAAM,CAACrb,OAAP,IAAkB,CAACwP,KAAK,CAAC4U,OAAN,CAAc/I,MAAM,CAACrb,OAAP,CAAe6O,KAA7B,CAAvB,EAA4D;AACxDwV,IAAAA,iBAAiB,CAAE,IAAGK,UAAW,gEAAhB,CAAjB;AACH;;AACD,MAAIrJ,MAAM,CAACrb,OAAP,IAAkB,CAACwP,KAAK,CAAC4U,OAAN,CAAc/I,MAAM,CAACrb,OAAP,CAAegW,MAA7B,CAAvB,EAA6D;AACzDqO,IAAAA,iBAAiB,CAAE,IAAGK,UAAW,kEAAhB,CAAjB;AACH;AACJ;;AACD,AAAO,SAASkD,wBAAT,CAAkCvM,MAAlC,EAA0Clb,MAA1C,EAAkD;AACrD,QAAMukB,UAAU,GAAGrJ,MAAM,CAACpgB,IAA1B;;AACA,MAAI,CAACkF,MAAL,EAAa;AACT;AACH;;AACD,QAAM0nB,uBAAuB,GAAG,OAAO1nB,MAAP,KAAkB,QAAlB,IAA8B0N,MAAM,CAACC,QAAP,CAAgB3N,MAAhB,CAA9D;;AACA,MAAI0nB,uBAAuB,IAAIxM,MAAM,CAACrb,OAAP,CAAegW,MAAf,CAAsB3a,MAAtB,KAAiC,CAAhE,EAAmE;AAC/DgpB,IAAAA,iBAAiB,CAAE,WAAUK,UAAW,gKAAvB,CAAjB;AACH;;AACD,QAAMoD,gBAAgB,GAAG,OAAO3nB,MAAP,KAAkB,QAAlB,IACrB/B,MAAM,CAACC,IAAP,CAAY8B,MAAZ,EAAoB+Z,IAApB,CAA0B6N,OAAD,IAAa,CAAC1M,MAAM,CAACrb,OAAP,CAAegW,MAAf,CAAsBnO,QAAtB,CAA+BkgB,OAA/B,CAAvC,CADJ;;AAEA,MAAID,gBAAJ,EAAsB;AAClBzD,IAAAA,iBAAiB,CAAE,WAAUK,UAAW,8BAA6BoD,gBAAiB,oCAAmCzM,MAAM,CAACrb,OAAP,CAAegW,MAAO,EAA9H,CAAjB;AACH;AACJ;AACD,AAAO,SAASgS,mBAAT,CAA6B9jB,MAA7B,EAAqC;AACxC,QAAM;AAAEyiB,IAAAA,MAAM,EAAEsB;AAAV,MAA+BC,mBAAQ,CAAChkB,MAAD,EAASud,YAAT,EAAuB;AAChE0G,IAAAA,YAAY,EAAEtH,WADkD;AAEhEuH,IAAAA,sBAAsB,EAAE;AAFwC,GAAvB,CAA7C;;AAIA,MAAIH,gBAAgB,CAAC5sB,MAAjB,GAA0B,CAA9B,EAAiC;AAC7B,WAAO,CAAC4sB,gBAAD,EAAmBxpB,SAAnB,CAAP;AACH;;AACD,QAAM4pB,YAAY,GAAGC,SAAK,CAAC,CAACvH,cAAD,EAAiB7c,MAAjB,CAAD,CAA1B;AACA,SAAO,CAAC,IAAD,EAAOoiB,eAAe,CAAC+B,YAAD,CAAtB,CAAP;AACH;AACD,AAAO,SAASE,qBAAT,CAA+BrG,KAA/B,EAAsC9E,WAAtC,EAAmD;AACtD,QAAMoL,YAAY,GAAGC,2BAAe,CAAC5H,WAAD,EAAc;AAC9C;AACA6H,IAAAA,YAAY,EAAE,CACV,cADU,EAEV,qBAFU,EAGV,oBAHU,EAIV,sBAJU,CAFgC;AAQ9C;AACAC,IAAAA,OAAO,EAAEzsB,IAAI,CAACsH,OAAL,CAAa7B,OAAO,CAACpE,GAAR,EAAb;AATqC,GAAd,CAApC;AAWA,MAAI4C,MAAJ,CAZsD;;AActD,MAAI+hB,KAAK,CAAChe,MAAV,EAAkB;AACd/D,IAAAA,MAAM,GAAGqoB,YAAY,CAAC1e,IAAb,CAAkB5N,IAAI,CAAC8D,OAAL,CAAa2B,OAAO,CAACpE,GAAR,EAAb,EAA4B2kB,KAAK,CAAChe,MAAlC,CAAlB,CAAT;;AACA,QAAI,CAAC/D,MAAL,EAAa;AACTkkB,MAAAA,iBAAiB,CAAE,uCAAsCnC,KAAK,CAAChe,MAAO,EAArD,CAAjB;AACH;AACJ,GAnBqD;;;AAqBtD/D,EAAAA,MAAM,GAAGA,MAAM,IAAIqoB,YAAY,CAACI,MAAb,EAAnB,CArBsD;;AAuBtD,MAAI,CAACzoB,MAAD,IAAW,CAACA,MAAM,CAAC+D,MAAnB,IAA6B/D,MAAM,CAAC0oB,OAAxC,EAAiD;AAC7C1oB,IAAAA,MAAM,GAAG;AAAE+D,MAAAA,MAAM,qBAAO6c,cAAP;AAAR,KAAT;AACH,GAzBqD;;;AA2BtD,QAAM7c,MAAM,GAAG/D,MAAM,CAAC+D,MAAtB;AACA6iB,EAAAA,uBAAuB,CAAC7iB,MAAD,EAASge,KAAT,CAAvB;AACA,QAAM4G,SAAS,GAAG7G,cAAc,CAACC,KAAD,CAAhC;AACA,MAAI6G,YAAY,GAAG,EAAnB;;AACA,MAAI7kB,MAAM,CAACyd,OAAX,EAAoB;AAChB,UAAMqH,eAAe,GAAG9kB,MAAM,CAACyd,OAAP,CAAe9iB,UAAf,CAA0B,GAA1B,IAClB3C,IAAI,CAAC8D,OAAL,CAAa9D,IAAI,CAACsH,OAAL,CAAarD,MAAM,CAACpD,QAApB,CAAb,EAA4CmH,MAAM,CAACyd,OAAnD,CADkB,GAElB5hB,OAAO,CAACC,OAAR,CAAgBkE,MAAM,CAACyd,OAAvB,EAAgC;AAAE1hB,MAAAA,KAAK,EAAE,CAAC0B,OAAO,CAACpE,GAAR,EAAD;AAAT,KAAhC,CAFN;AAGA,UAAM0rB,YAAY,GAAGT,YAAY,CAAC1e,IAAb,CAAkBkf,eAAlB,CAArB;;AACA,QAAI,CAACC,YAAL,EAAmB;AACf5E,MAAAA,iBAAiB,CAAE,uCAAsCnC,KAAK,CAAChe,MAAO,EAArD,CAAjB;AACAvC,MAAAA,OAAO,CAACiG,IAAR,CAAa,CAAb;AACH;;AACDmhB,IAAAA,YAAY,GAAGE,YAAY,CAAC/kB,MAA5B;AACA,UAAMglB,gBAAgB,GAAGhB,mBAAQ,CAACa,YAAD,EAAetH,YAAf,EAA6B;AAC1D2G,MAAAA,sBAAsB,EAAE,KADkC;AAE1DD,MAAAA,YAAY,EAAEtH;AAF4C,KAA7B,CAAjC;;AAIA,QAAIqI,gBAAgB,CAACvC,MAAjB,IAA2BuC,gBAAgB,CAACvC,MAAjB,CAAwBtrB,MAAxB,GAAiC,CAAhE,EAAmE;AAC/DqrB,MAAAA,sBAAsB,CAACvmB,MAAM,CAACpD,QAAR,EAAkBmsB,gBAAgB,CAACvC,MAAnC,CAAtB;AACAhlB,MAAAA,OAAO,CAACiG,IAAR,CAAa,CAAb;AACH;;AACD,QAAImhB,YAAY,CAAC/O,OAAjB,EAA0B;AACtB,YAAMmP,eAAe,GAAGjtB,IAAI,CAACsH,OAAL,CAAawlB,eAAb,CAAxB;AACAD,MAAAA,YAAY,CAAC/O,OAAb,GAAuB+O,YAAY,CAAC/O,OAAb,CAAqB/T,GAArB,CAA0BoV,MAAD,IAAY;AACxD,cAAMpgB,IAAI,GAAGuU,KAAK,CAAC4U,OAAN,CAAc/I,MAAd,IAAwBA,MAAM,CAAC,CAAD,CAA9B,GAAoCA,MAAjD;AACA,cAAM+N,OAAO,GAAGltB,IAAI,CAAC8I,UAAL,CAAgB/J,IAAhB,IACVA,IADU,GAEV8E,OAAO,CAACC,OAAR,CAAgB/E,IAAhB,EAAsB;AAAEgF,UAAAA,KAAK,EAAE,CAACkpB,eAAD;AAAT,SAAtB,CAFN;;AAGA,YAAI3Z,KAAK,CAAC4U,OAAN,CAAc/I,MAAd,CAAJ,EAA2B;AACvBA,UAAAA,MAAM,CAACgO,MAAP,CAAc,CAAd,EAAiB,CAAjB,EAAoBD,OAApB;AACA,iBAAO/N,MAAP;AACH;;AACD,eAAO+N,OAAP;AACH,OAVsB,CAAvB;AAWH;AACJ,GA/DqD;;;AAiEtD,QAAMf,YAAY,GAAGC,SAAK,CAAC,CACvBlL,WAAW,CAACkM,QAAZ,GAAuB;AAAExL,IAAAA,YAAY,EAAE;AAAEO,MAAAA,OAAO,EAAEjB,WAAW,CAACkM;AAAvB;AAAhB,GAAvB,GAA6E,EADtD,EAEvBP,YAFuB,EAGvB;AAAE7f,IAAAA,eAAe,EAAEkU,WAAW,CAAClU;AAA/B,GAHuB,EAIvBhF,MAJuB,EAKvB4kB,SALuB,CAAD,CAA1B;;AAOA,OAAK,MAAMS,iBAAX,IAAgCnrB,MAAM,CAACC,IAAP,CAAYgqB,YAAY,CAACnf,eAAb,IAAgC,EAA5C,CAAhC,EAAiF;AAC7E,QAAIkU,WAAW,CAACoM,YAAZ,IAA4BpM,WAAW,CAACoM,YAAZ,CAAyBD,iBAAzB,CAAhC,EAA6E;AACzElF,MAAAA,iBAAiB,CAAE,IAAGkF,iBAAkB,oGAAvB,CAAjB;AACH;;AACD,QAAInM,WAAW,CAACqM,eAAZ,IAA+BrM,WAAW,CAACqM,eAAZ,CAA4BF,iBAA5B,CAAnC,EAAmF;AAC/ElF,MAAAA,iBAAiB,CAAE,IAAGkF,iBAAkB,uGAAvB,CAAjB;AACH;AACJ;;AACD,QAAM,CAACtB,gBAAD,EAAmByB,YAAnB,IAAmC1B,mBAAmB,CAACK,YAAD,CAA5D;;AACA,MAAIJ,gBAAJ,EAAsB;AAClBvB,IAAAA,sBAAsB,CAACvmB,MAAM,CAACpD,QAAR,EAAkBkrB,gBAAlB,CAAtB;AACAtmB,IAAAA,OAAO,CAACiG,IAAR,CAAa,CAAb;AACH;;AACD,SAAO8hB,YAAP;AACH;;AC1sBM,SAASC,mBAAT,CAA6B3b,OAA7B,EAAsCgM,OAAtC,EAA+C;AAClD,QAAM4P,OAAO,GAAGpkB,UAAU,CAACwI,OAAD,EAAU,MAAV,EAAkB,EAAlB,CAA1B,CADkD;;AAElD,QAAM;AAAE7I,IAAAA;AAAF,MAAcF,MAAM,CAAC2kB,OAAD,CAA1B;AACA,QAAMC,eAAe,GAAG,IAAIjf,GAAJ,CAAQ,CAACgf,OAAD,CAAR,CAAxB;;AACA,OAAK,MAAMvO,MAAX,IAAqBrB,OAArB,EAA8B;AAC1B,QAAIqB,MAAM,CAACrb,OAAP,IAAkBqb,MAAM,CAACrb,OAAP,CAAegW,MAAf,CAAsBnO,QAAtB,CAA+B1C,OAA/B,CAAtB,EAA+D;AAC3DkW,MAAAA,MAAM,CAACrb,OAAP,CAAe6O,KAAf,CAAqB+K,OAArB,CAA8B/K,KAAD,IAAWgb,eAAe,CAAC1gB,GAAhB,CAAoB3D,UAAU,CAACokB,OAAD,EAAUzkB,OAAV,EAAmB0J,KAAnB,CAA9B,CAAxC;AACH;AACJ;;AACD,SAAOW,KAAK,CAACpL,IAAN,CAAWylB,eAAX,CAAP;AACH;AACD;;;;;;;;;;AASA,eAAeC,mBAAf,CAAmCC,OAAnC,EAA4C;AAAE5L,EAAAA,KAAF;AAAS6L,EAAAA,YAAT;AAAuBC,EAAAA,aAAvB;AAAsCjQ,EAAAA,OAAtC;AAA+C0G,EAAAA;AAA/C,CAA5C,EAAyG;AACrG,QAAMwJ,MAAM,GAAGjlB,MAAM,CAAC8kB,OAAD,CAAN,CAAgB5kB,OAA/B;;AACA,OAAK,MAAMglB,IAAX,IAAmBnQ,OAAnB,EAA4B;AACxB,QAAI,CAACmQ,IAAI,CAACnqB,OAAN,IAAiB,CAACmqB,IAAI,CAACnqB,OAAL,CAAa6O,KAAb,CAAmBhH,QAAnB,CAA4BqiB,MAA5B,CAAtB,EAA2D;AACvD;AACH;;AACD,QAAI,CAACC,IAAI,CAACrgB,IAAV,EAAgB;AACZ;AACH;;AACD,QAAI;AACA,YAAMsgB,SAAS,GAAGluB,IAAI,CAACyK,QAAL,CAAchF,OAAO,CAACpE,GAAR,EAAd,EAA6BwsB,OAA7B,CAAlB;AACAluB,MAAAA,MAAM,CAAC1B,KAAP,CAAc,qBAAoBiwB,SAAU,GAA5C,EAAgD;AAAEnvB,QAAAA,IAAI,EAAEkvB,IAAI,CAAClvB;AAAb,OAAhD;AACA,YAAMkF,MAAM,GAAG,MAAMgqB,IAAI,CAACrgB,IAAL,CAAU;AAC3Bie,QAAAA,OAAO,EAAEmC,MADkB;AAE3Bzd,QAAAA,QAAQ,EAAEsd,OAFiB;AAG3B5L,QAAAA,KAH2B;AAI3B6L,QAAAA;AAJ2B,OAAV,CAArB;AAMAnuB,MAAAA,MAAM,CAAC1B,KAAP,CAAc,qBAAoBiwB,SAAU,GAA5C,EAAgD;AAAEnvB,QAAAA,IAAI,EAAEkvB,IAAI,CAAClvB;AAAb,OAAhD;AACA2sB,MAAAA,wBAAwB,CAACuC,IAAD,EAAOhqB,MAAP,CAAxB;;AACA,UAAI,OAAOA,MAAP,KAAkB,QAAlB,IAA8B0N,MAAM,CAACC,QAAP,CAAgB3N,MAAhB,CAAlC,EAA2D;AACvD,cAAMkqB,aAAa,GAAGF,IAAI,CAACnqB,OAAL,CAAagW,MAAb,CAAoB,CAApB,CAAtB;AACA,eAAO;AACH,WAACqU,aAAD,GAAiB;AACbnqB,YAAAA,IAAI,EAAEC;AADO;AADd,SAAP;AAKH,OAPD,MAQK,IAAIA,MAAM,IAAI,OAAOA,MAAP,KAAkB,QAAhC,EAA0C;AAC3C/B,QAAAA,MAAM,CAACC,IAAP,CAAY8B,MAAZ,EAAoByZ,OAApB,CAA6BkG,GAAD,IAAS;AACjC,gBAAM9J,MAAM,GAAG7V,MAAM,CAAC2f,GAAD,CAArB,CADiC;;AAGjC,cAAI,OAAO9J,MAAP,KAAkB,QAAtB,EACI7V,MAAM,CAAC2f,GAAD,CAAN,GAAc;AAAE5f,YAAAA,IAAI,EAAE8V;AAAR,WAAd,CAJ6B;;AAMjC,cAAI7V,MAAM,CAAC2f,GAAD,CAAN,CAAY7Z,GAAZ,IAAmB,OAAO9F,MAAM,CAAC2f,GAAD,CAAN,CAAY7Z,GAAnB,KAA2B,QAAlD,EACI9F,MAAM,CAAC2f,GAAD,CAAN,CAAY7Z,GAAZ,GAAkBrI,IAAI,CAACY,SAAL,CAAe2B,MAAM,CAAC2f,GAAD,CAAN,CAAY7Z,GAA3B,CAAlB,CAP6B;;AASjC,cAAI,CAACya,UAAL,EACIvgB,MAAM,CAAC2f,GAAD,CAAN,CAAY7Z,GAAZ,GAAkBxH,SAAlB;AACP,SAXD;AAYA,eAAO0B,MAAP;AACH;AACJ,KAlCD,CAmCA,OAAOxC,GAAP,EAAY;AACR;AACA9B,MAAAA,MAAM,CAACvB,KAAP,CAAaqD,GAAG,CAACN,QAAJ,MAAkBM,GAA/B,EAAoC;AAAE1C,QAAAA,IAAI,EAAEkvB,IAAI,CAAClvB;AAAb,OAApC;;AACA,UAAIgvB,aAAJ,EAAmB;AACftoB,QAAAA,OAAO,CAACiG,IAAR,CAAa,CAAb;AACH;AACJ;AACJ;;AACD,SAAO;AACH,KAACsiB,MAAD,GAAU;AACNhqB,MAAAA,IAAI,EAAE,MAAMpD,QAAQ,CAACitB,OAAD;AADd;AADP,GAAP;AAKH;AACD;;;;;;;;;AAOA,eAAeO,wBAAf,CAAwCtU,MAAxC,EAAgD+T,OAAhD,EAAyD;AAAE5L,EAAAA,KAAF;AAAS8L,EAAAA,aAAT;AAAwBjQ,EAAAA,OAAxB;AAAiC0G,EAAAA;AAAjC,CAAzD,EAAwG;AACpG,QAAMwJ,MAAM,GAAGjlB,MAAM,CAAC8kB,OAAD,CAAN,CAAgB5kB,OAA/B;AACA,QAAMolB,YAAY,GAAGR,OAAO,CAACxpB,OAAR,CAAgB2pB,MAAhB,EAAwB,EAAxB,CAArB;AACA,QAAMM,YAAY,GAAGtuB,IAAI,CAACqJ,QAAL,CAAcglB,YAAd,CAArB;;AACA,OAAK,MAAMJ,IAAX,IAAmBnQ,OAAnB,EAA4B;AACxB,QAAI,CAACmQ,IAAI,CAACla,SAAV,EAAqB;AACjB;AACH;;AACD,QAAI;AACA,WAAK,MAAMwa,OAAX,IAAsBrsB,MAAM,CAACC,IAAP,CAAY2X,MAAZ,CAAtB,EAA2C;AACvC,cAAM0U,aAAa,GAAG1U,MAAM,CAACyU,OAAD,CAA5B;AACA,cAAM;AAAEvqB,UAAAA;AAAF,YAAWwqB,aAAjB;AACA,cAAMxlB,QAAQ,GAAGslB,YAAY,GAAGC,OAAhC;AACA,cAAMhe,QAAQ,GAAG8d,YAAY,GAAGE,OAAhC;AACA,cAAML,SAAS,GAAGluB,IAAI,CAACyK,QAAL,CAAchF,OAAO,CAACpE,GAAR,EAAd,EAA6BkP,QAA7B,CAAlB;AACA5Q,QAAAA,MAAM,CAAC1B,KAAP,CAAc,0BAAyBiwB,SAAU,GAAjD,EAAqD;AAAEnvB,UAAAA,IAAI,EAAEkvB,IAAI,CAAClvB;AAAb,SAArD;AACA,cAAMkF,MAAM,GAAG,MAAMgqB,IAAI,CAACla,SAAL,CAAe;AAChClD,UAAAA,QAAQ,EAAE7M,IADsB;AAEhCie,UAAAA,KAFgC;AAGhC4J,UAAAA,OAAO,EAAE0C,OAHuB;AAIhCjhB,UAAAA,EAAE,EAAEiD,QAJ4B;AAKhC;AACAA,UAAAA,QAAQ,EAAEvH,QANsB;AAOhC;AACA0Y,UAAAA,OAAO,EAAG,KAAI1hB,IAAI,CAACqJ,QAAL,CAAcilB,YAAY,GAAGC,OAA7B,CAAsC;AARpB,SAAf,CAArB;AAUA5uB,QAAAA,MAAM,CAAC1B,KAAP,CAAc,0BAAyBiwB,SAAU,GAAjD,EAAqD;AAAEnvB,UAAAA,IAAI,EAAEkvB,IAAI,CAAClvB;AAAb,SAArD,EAjBuC;;AAmBvC,YAAI,OAAOkF,MAAP,KAAkB,QAAlB,IAA8B0N,MAAM,CAACC,QAAP,CAAgB3N,MAAhB,CAAlC,EAA2D;AACvD6V,UAAAA,MAAM,CAACyU,OAAD,CAAN,CAAgBvqB,IAAhB,GAAuBC,MAAvB;AACA6V,UAAAA,MAAM,CAACyU,OAAD,CAAN,CAAgBxkB,GAAhB,GAAsBxH,SAAtB;AACH,SAHD,MAIK,IAAI0B,MAAM,IAAI,OAAOA,MAAP,KAAkB,QAA5B,IAAwCA,MAAM,CAACA,MAAnD,EAA2D;AAC5D6V,UAAAA,MAAM,CAACyU,OAAD,CAAN,CAAgBvqB,IAAhB,GAAuBC,MAAM,CAACA,MAA9B;AACA6V,UAAAA,MAAM,CAACyU,OAAD,CAAN,CAAgBxkB,GAAhB,GAAsBxH,SAAtB;AACH,SA1BsC;;;AA4BvC,YAAI,CAACiiB,UAAL,EACI1K,MAAM,CAACyU,OAAD,CAAN,CAAgBxkB,GAAhB,GAAsBxH,SAAtB;AACP;AACJ,KAhCD,CAiCA,OAAOd,GAAP,EAAY;AACR;AACA9B,MAAAA,MAAM,CAACvB,KAAP,CAAaqD,GAAG,CAACN,QAAJ,MAAkBM,GAA/B,EAAoC;AAAE1C,QAAAA,IAAI,EAAEkvB,IAAI,CAAClvB;AAAb,OAApC;;AACA,UAAIgvB,aAAJ,EAAmB;AACftoB,QAAAA,OAAO,CAACiG,IAAR,CAAa,CAAb;AACH;AACJ;AACJ;;AACD,SAAOoO,MAAP;AACH;;AACD,AAAO,eAAe2U,uBAAf,CAAuC7G,cAAvC,EAAuD;AAAE9J,EAAAA;AAAF,CAAvD,EAAoE;AACvE,OAAK,MAAMmQ,IAAX,IAAmBnQ,OAAnB,EAA4B;AACxB,QAAI,CAACmQ,IAAI,CAACvG,QAAV,EAAoB;AAChB;AACH;;AACD,QAAI;AACA/nB,MAAAA,MAAM,CAAC1B,KAAP,CAAa,sBAAb,EAAqC;AAAEc,QAAAA,IAAI,EAAEkvB,IAAI,CAAClvB;AAAb,OAArC;AACA,YAAMkvB,IAAI,CAACvG,QAAL,CAAc;AAChBE,QAAAA,cADgB;AAEhB;AACA9oB,QAAAA,GAAG,EAAGyrB,GAAD,IAAS;AACV5qB,UAAAA,MAAM,CAACzB,IAAP,CAAYqsB,GAAZ,EAAiB;AAAExrB,YAAAA,IAAI,EAAEkvB,IAAI,CAAClvB;AAAb,WAAjB;AACH;AALe,OAAd,CAAN;AAOAY,MAAAA,MAAM,CAAC1B,KAAP,CAAa,sBAAb,EAAqC;AAAEc,QAAAA,IAAI,EAAEkvB,IAAI,CAAClvB;AAAb,OAArC;AACH,KAVD,CAWA,OAAO0C,GAAP,EAAY;AACR9B,MAAAA,MAAM,CAACvB,KAAP,CAAaqD,GAAG,CAACN,QAAJ,MAAkBM,GAA/B,EAAoC;AAAE1C,QAAAA,IAAI,EAAEkvB,IAAI,CAAClvB;AAAb,OAApC;AACA0G,MAAAA,OAAO,CAACiG,IAAR,CAAa,CAAb,EAFQ;AAGX;AACJ;;AACD,SAAO,IAAP;AACH;AACD,AAAO,eAAegjB,sBAAf,CAAsC;AAAE5Q,EAAAA;AAAF,CAAtC,EAAmD;AACtD,OAAK,MAAMmQ,IAAX,IAAmBnQ,OAAnB,EAA4B;AACxB,QAAI,CAACmQ,IAAI,CAACxJ,OAAV,EAAmB;AACf;AACH;;AACD,UAAMwJ,IAAI,CAACxJ,OAAL,EAAN;AACH;AACJ;AACD;;AACA,AAAO,eAAekK,SAAf,CAAyBd,OAAzB,EAAkCe,gBAAlC,EAAoD;AACvD;AACA,QAAMC,UAAU,GAAG,MAAMjB,mBAAmB,CAACC,OAAD,EAAUe,gBAAV,CAA5C,CAFuD;;AAIvD,QAAME,eAAe,GAAG,MAAMV,wBAAwB,CAACS,UAAD,EAAahB,OAAb,EAAsBe,gBAAtB,CAAtD,CAJuD;;AAMvD,SAAOE,eAAP;AACH;;AC/KD,MAAMztB,KAAG,GAAGoE,OAAO,CAACpE,GAAR,EAAZ;AACA;;AACA,AAAO,SAAS0tB,cAAT,CAAwBC,MAAxB,EAAgC/mB,IAAhC,EAAsC;AACzC,QAAMgnB,kBAAkB,GAAGjvB,IAAI,CAAC8D,OAAL,CAAakrB,MAAb,EAAqB/mB,IAArB,CAA3B;;AACA,MAAI;AACA,WAAOlH,WAAE,CAAC2P,QAAH,CAAYue,kBAAZ,CAAP;AACH,GAFD,CAGA,OAAOxtB,GAAP,EAAY;AAEX;;AACD,SAAO,KAAP;AACH;AACD;;AACA,SAASytB,sBAAT,CAAgCjnB,IAAhC,EAAsC+Q,KAAtC,EAA6ChR,MAA7C,EAAqD;AACjD,MAAIgR,KAAK,IAAIA,KAAK,CAACmW,WAAN,EAAb,EAAkC;AAC9B,UAAMC,aAAa,GAAGnnB,IAAI,CAAC+F,QAAL,CAAc,GAAd,IAAqB,EAArB,GAA0B,GAAhD;AACA/F,IAAAA,IAAI,GAAGA,IAAI,GAAGmnB,aAAP,GAAuB,UAA9B;AACH,GAHD,MAIK,IAAI,CAACpW,KAAD,IAAU,CAAC/Q,IAAI,CAAC+F,QAAL,CAAc,KAAd,CAAX,IAAmC,CAAC/F,IAAI,CAAC+F,QAAL,CAAc,MAAd,CAAxC,EAA+D;AAChE/F,IAAAA,IAAI,GAAGA,IAAI,GAAG,KAAd;AACH;;AACD,QAAM;AAAEgB,IAAAA;AAAF,MAAcF,MAAM,CAACd,IAAD,CAA1B;AACA,QAAMwB,YAAY,GAAGzB,MAAM,CAACsiB,aAAP,CAAqBrhB,OAArB,KAAiC6d,uBAAuB,CAAC7d,OAAD,CAA7E;;AACA,MAAIQ,YAAJ,EAAkB;AACdxB,IAAAA,IAAI,GAAGqB,UAAU,CAACrB,IAAD,EAAOgB,OAAP,EAAgBQ,YAAhB,CAAjB;AACH;;AACD,SAAOxB,IAAP;AACH;AACD;;;;;;;AAKA,AAAO,SAASonB,oBAAT,CAA8B;AAAEvd,EAAAA,OAAF;AAAWwd,EAAAA,mBAAX;AAAgCtnB,EAAAA;AAAhC,CAA9B,EAAyE;AAC5E,SAAO,SAASunB,cAAT,CAAwBtnB,IAAxB,EAA8B;AACjC,QAAItH,sBAAsB,CAAC6E,IAAvB,CAA4ByC,IAA5B,CAAJ,EAAuC;AACnC,aAAOA,IAAP;AACH;;AACD,QAAIA,IAAI,CAACtF,UAAL,CAAgB,GAAhB,KAAwBsF,IAAI,CAACtF,UAAL,CAAgB,IAAhB,CAAxB,IAAiDsF,IAAI,CAACtF,UAAL,CAAgB,KAAhB,CAArD,EAA6E;AACzE,YAAM6sB,WAAW,GAAGT,cAAc,CAAC/uB,IAAI,CAACsH,OAAL,CAAawK,OAAb,CAAD,EAAwB7J,IAAxB,CAAlC;AACAA,MAAAA,IAAI,GAAGinB,sBAAsB,CAACjnB,IAAD,EAAOunB,WAAP,EAAoBxnB,MAApB,CAA7B;AACA,aAAOC,IAAP;AACH;;AACD,UAAM6P,UAAU,GAAG/P,sBAAsB,CAACC,MAAD,EAASC,IAAT,CAAzC;;AACA,QAAI6P,UAAU,IAAIA,UAAU,CAAClP,IAAX,KAAoB,MAAtC,EAA8C;AAC1C,YAAM;AAAEV,QAAAA,IAAF;AAAQC,QAAAA;AAAR,UAAe2P,UAArB;AACA,UAAI7T,MAAM,GAAGgE,IAAI,CAAC5D,OAAL,CAAa6D,IAAb,EAAmBC,EAAnB,CAAb;AACA,YAAMqnB,WAAW,GAAGT,cAAc,CAAC1tB,KAAD,EAAM4C,MAAN,CAAlC;AACAA,MAAAA,MAAM,GAAGirB,sBAAsB,CAACjrB,MAAD,EAASurB,WAAT,EAAsBxnB,MAAtB,CAA/B,CAJ0C;;AAM1C/D,MAAAA,MAAM,GAAGqG,WAAW,CAACtK,IAAI,CAACsH,OAAL,CAAawK,OAAb,CAAD,EAAwB7N,MAAxB,CAApB;AACA,aAAOA,MAAP;AACH;;AACD,QAAIqrB,mBAAJ,EAAyB;AACrB;AACA;AACA,YAAMG,cAAc,GAAGH,mBAAmB,CAACttB,OAApB,CAA4BiG,IAA5B,CAAvB;;AACA,UAAIwnB,cAAJ,EAAoB;AAChB,eAAOzvB,IAAI,CAACoT,KAAL,CAAWtP,OAAX,CAAmBkE,MAAM,CAAC4Z,YAAP,CAAoBuD,aAAvC,EAAsDsK,cAAtD,CAAP;AACH;AACJ;;AACD,WAAO,KAAP;AACH,GA5BD;AA6BH;;ACjED,MAAM;AAAE9tB,EAAAA;AAAF,IAAYkC,OAAO,CAAC,iBAAD,CAAzB;;AACA,SAAS6rB,YAAT,CAAsB3hB,MAAtB,EAA8B4hB,SAA9B,EAAyCC,KAAzC,EAAgDC,GAAhD,EAAqD;AACjD,SAAO9hB,MAAM,CAACwU,KAAP,CAAa,CAAb,EAAgBqN,KAAhB,KAA0BD,SAAS,IAAI,EAAvC,IAA6C5hB,MAAM,CAACwU,KAAP,CAAasN,GAAb,CAApD;AACH;;AACD,AAAO,eAAeC,sBAAf,CAAsC9rB,IAAtC,EAA4C;AAC/C,QAAM,CAAChC,OAAD,IAAY,MAAML,KAAK,CAACqC,IAAD,CAA7B;AACA,SAAOhC,OAAO,CAAC+P,MAAR,CAAgB5O,GAAD,IAAS;AAC3B;AACA,QAAIA,GAAG,CAACyR,CAAJ,KAAU,CAAC,CAAf,EAAkB;AACd,aAAO,KAAP;AACH,KAJ0B;;;AAM3B,QAAIzR,GAAG,CAACyR,CAAJ,GAAQ,CAAC,CAAb,EAAgB;AACZ,YAAMJ,eAAe,GAAGxQ,IAAI,CAACS,SAAL,CAAetB,GAAG,CAAC0R,CAAnB,EAAsB1R,GAAG,CAAC2R,CAA1B,CAAxB;AACA,aAAO,CAAC,CAACP,uBAAuB,CAACC,eAAD,CAAhC;AACH;;AACD,WAAO,IAAP;AACH,GAXM,CAAP;AAYH;AACD,AAAO,eAAeub,mBAAf,CAAmCC,KAAnC,EAA0CC,aAA1C,EAAyD;AAC5D,QAAMjuB,OAAO,GAAG,MAAM8tB,sBAAsB,CAACE,KAAD,CAA5C;AACA,MAAIE,aAAa,GAAGF,KAApB;;AACA,OAAK,MAAM7sB,GAAX,IAAkBnB,OAAO,CAACmuB,OAAR,EAAlB,EAAqC;AACjC,QAAIloB,IAAI,GAAGioB,aAAa,CAACzrB,SAAd,CAAwBtB,GAAG,CAAC0R,CAA5B,EAA+B1R,GAAG,CAAC2R,CAAnC,CAAX;;AACA,QAAI3R,GAAG,CAACyR,CAAJ,GAAQ,CAAC,CAAb,EAAgB;AACZ3M,MAAAA,IAAI,GAAGsM,uBAAuB,CAACtM,IAAD,CAAvB,IAAiC,EAAxC;AACH;;AACD,QAAImoB,eAAe,GAAGH,aAAa,CAAChoB,IAAD,CAAnC;;AACA,QAAI9E,GAAG,CAACyR,CAAJ,GAAQ,CAAC,CAAb,EAAgB;AACZwb,MAAAA,eAAe,GAAG1uB,IAAI,CAACY,SAAL,CAAe8tB,eAAf,CAAlB;AACH;;AACDF,IAAAA,aAAa,GAAGR,YAAY,CAACQ,aAAD,EAAgBE,eAAhB,EAAiCjtB,GAAG,CAAC0R,CAArC,EAAwC1R,GAAG,CAAC2R,CAA5C,CAA5B;AACH;;AACD,SAAOob,aAAP;AACH;;AACD,eAAeG,oBAAf,CAAoCrsB,IAApC,EAA0CisB,aAA1C,EAAyD;AACrD,MAAIC,aAAa,GAAGlsB,IAApB;AACA,MAAI+G,KAAJ;AACA,QAAM4K,WAAW,GAAG,IAAIjM,MAAJ,CAAWlJ,aAAX,CAApB;;AACA,SAAQuK,KAAK,GAAG4K,WAAW,CAACC,IAAZ,CAAiBsa,aAAjB,CAAhB,EAAkD;AAC9C,UAAM,GAAGI,SAAH,EAAcC,UAAd,IAA4BxlB,KAAlC,CAD8C;;AAG9C,QAAIwlB,UAAU,CAAC/a,IAAX,EAAJ,EAAuB;AACnB0a,MAAAA,aAAa,GAAGR,YAAY,CAACQ,aAAD,EAAgB,MAAMH,mBAAmB,CAACQ,UAAD,EAAaN,aAAb,CAAzC,EAAsEllB,KAAK,CAAC4O,KAAN,GAAc2W,SAAS,CAACnxB,MAA9F,EAAsG4L,KAAK,CAAC4O,KAAN,GAAc2W,SAAS,CAACnxB,MAAxB,GAAiCoxB,UAAU,CAACpxB,MAAlJ,CAA5B;AACH;AACJ;;AACD,SAAO+wB,aAAP;AACH;;AACD,eAAeM,mBAAf,CAAmCxsB,IAAnC,EAAyCisB,aAAzC,EAAwD;AACpD,MAAIC,aAAa,GAAGlsB,IAApB;AACA,MAAI+G,KAAJ;AACA,QAAM4K,WAAW,GAAG,IAAIjM,MAAJ,CAAWjJ,SAAX,CAApB;;AACA,SAAQsK,KAAK,GAAG4K,WAAW,CAACC,IAAZ,CAAiBsa,aAAjB,CAAhB,EAAkD;AAC9C,UAAM,CAACO,SAAD,EAAYxoB,IAAZ,IAAoB8C,KAA1B,CAD8C;;AAG9CmlB,IAAAA,aAAa,GAAGR,YAAY,CAACQ,aAAD,EAAiB,YAAWD,aAAa,CAAChoB,IAAD,CAAO,IAAhD,EAAqD8C,KAAK,CAAC4O,KAA3D,EAAkE5O,KAAK,CAAC4O,KAAN,GAAc8W,SAAS,CAACtxB,MAA1F,CAA5B;AACH;;AACD,SAAO+wB,aAAP;AACH;;AACD,AAAO,eAAeQ,oBAAf,CAAoC;AAAEznB,EAAAA,OAAF;AAAW4H,EAAAA;AAAX,CAApC,EAA2Dof,aAA3D,EAA0E;AAC7E,MAAIhnB,OAAO,KAAK,KAAhB,EAAuB;AACnB,WAAO8mB,mBAAmB,CAAClf,QAAD,EAAWof,aAAX,CAA1B;AACH;;AACD,MAAIhnB,OAAO,KAAK,OAAhB,EAAyB;AACrB,WAAOonB,oBAAoB,CAACxf,QAAD,EAAWof,aAAX,CAA3B;AACH;;AACD,MAAIhnB,OAAO,KAAK,MAAhB,EAAwB;AACpB,WAAOunB,mBAAmB,CAAC3f,QAAD,EAAWof,aAAX,CAA1B;AACH;;AACD,QAAM,IAAI5wB,KAAJ,CAAW,sCAAqC4J,OAAQ,uEAAxD,CAAN;AACH;;ACvED,MAAM0nB,YAAY,GAAG,KAArB;AACA,AAAO,MAAMC,YAAN,CAAmB;AACtBryB,EAAAA,WAAW,CAACe,OAAO,GAAG,EAAX,EAAe;AACtB,SAAKuxB,OAAL,GAAe,IAAIniB,GAAJ,EAAf;AACA,SAAKoiB,cAAL,GAAsB,IAAIC,GAAJ,EAAtB;AACA,SAAKC,KAAL,GAAc,kBAAiBL,YAAa,EAA5C;AACA,UAAMM,GAAG,GAAG3xB,OAAO,CAAC4xB,MAAR,GACN,IAAIC,SAAS,CAACC,MAAd,CAAqB;AAAEC,MAAAA,QAAQ,EAAE;AAAZ,KAArB,CADM,GAEN,IAAIF,SAAS,CAACC,MAAd,CAAqB;AAAE/rB,MAAAA,IAAI,EAAEsrB;AAAR,KAArB,CAFN;;AAGA,QAAIrxB,OAAO,CAAC4xB,MAAZ,EAAoB;AAChB5xB,MAAAA,OAAO,CAAC4xB,MAAR,CAAe1xB,EAAf,CAAkB,SAAlB,EAA6B,CAACkqB,GAAD,EAAM4H,MAAN,EAAcC,IAAd,KAAuB;AAChD;AACA,YAAI7H,GAAG,CAAC7mB,OAAJ,CAAY,wBAAZ,MAA0C,SAA9C,EAAyD;AACrD;AACH;;AACDouB,QAAAA,GAAG,CAACO,aAAJ,CAAkB9H,GAAlB,EAAuB4H,MAAvB,EAA+BC,IAA/B,EAAsCE,MAAD,IAAY;AAC7CR,UAAAA,GAAG,CAACS,IAAJ,CAAS,YAAT,EAAuBD,MAAvB,EAA+B/H,GAA/B;AACH,SAFD;AAGH,OARD;AASH;;AACDuH,IAAAA,GAAG,CAACzxB,EAAJ,CAAO,YAAP,EAAsBiyB,MAAD,IAAY;AAC7B,WAAKE,aAAL,CAAmBF,MAAnB;AACA,WAAKG,gBAAL,CAAsBH,MAAtB;AACH,KAHD;AAIH;;AACDG,EAAAA,gBAAgB,CAACH,MAAD,EAAS;AACrBA,IAAAA,MAAM,CAACjyB,EAAP,CAAU,SAAV,EAAsBsB,IAAD,IAAU;AAC3B,YAAMlC,OAAO,GAAG8C,IAAI,CAACC,KAAL,CAAWb,IAAI,CAACK,QAAL,EAAX,CAAhB;;AACA,UAAIvC,OAAO,CAACgK,IAAR,KAAiB,WAArB,EAAkC;AAC9B,cAAMipB,KAAK,GAAG,KAAKC,QAAL,CAAclzB,OAAO,CAAC0O,EAAtB,EAA0B,IAA1B,CAAd;AACAukB,QAAAA,KAAK,CAACE,aAAN,GAAsB,IAAtB;AACAF,QAAAA,KAAK,CAAC/D,YAAN,GAAqB,IAArB;AACH;AACJ,KAPD;AAQH;;AACDkE,EAAAA,WAAW,CAACC,SAAD,EAAY;AACnB,UAAMC,QAAQ,GAAG;AACb5E,MAAAA,YAAY,EAAE,IAAI5e,GAAJ,EADD;AAEbyjB,MAAAA,UAAU,EAAE,IAAIzjB,GAAJ,EAFC;AAGb0jB,MAAAA,gBAAgB,EAAE,KAHL;AAIbC,MAAAA,qBAAqB,EAAE,CAJV;AAKbvE,MAAAA,YAAY,EAAE,KALD;AAMbiE,MAAAA,aAAa,EAAE;AANF,KAAjB;AAQA,SAAKjB,cAAL,CAAoBwB,GAApB,CAAwBL,SAAxB,EAAmCC,QAAnC;AACA,WAAOA,QAAP;AACH;;AACDJ,EAAAA,QAAQ,CAACG,SAAD,EAAYM,gBAAgB,GAAG,KAA/B,EAAsC;AAC1C,UAAMtuB,MAAM,GAAG,KAAK6sB,cAAL,CAAoBjlB,GAApB,CAAwBomB,SAAxB,CAAf;;AACA,QAAIhuB,MAAJ,EAAY;AACR,aAAOA,MAAP;AACH;;AACD,QAAIsuB,gBAAJ,EAAsB;AAClB,aAAO,KAAKP,WAAL,CAAiBC,SAAjB,CAAP;AACH;;AACD,WAAO,IAAP;AACH;;AACDO,EAAAA,QAAQ,CAACP,SAAD,EAAYjwB,OAAZ,EAAqB8rB,YAAY,GAAG,KAApC,EAA2C;AAC/C,UAAM7pB,MAAM,GAAG,KAAK6tB,QAAL,CAAcG,SAAd,EAAyB,IAAzB,CAAf;AACA,UAAMQ,oBAAoB,GAAG,IAAI/jB,GAAJ,CAAQzK,MAAM,CAACqpB,YAAf,CAA7B;AACArpB,IAAAA,MAAM,CAAC6pB,YAAP,GAAsBA,YAAtB;;AACA,SAAK,MAAMvT,SAAX,IAAwBvY,OAAxB,EAAiC;AAC7B,WAAK0wB,eAAL,CAAqBT,SAArB,EAAgC1X,SAAhC;AACAkY,MAAAA,oBAAoB,CAAC7J,MAArB,CAA4BrO,SAA5B;AACH;;AACD,SAAK,MAAMA,SAAX,IAAwBkY,oBAAxB,EAA8C;AAC1C,WAAKE,kBAAL,CAAwBV,SAAxB,EAAmC1X,SAAnC;AACH;AACJ;;AACDoY,EAAAA,kBAAkB,CAACV,SAAD,EAAY1X,SAAZ,EAAuB;AACrC,QAAIqY,YAAY,GAAG,KAAKd,QAAL,CAAcvX,SAAd,CAAnB;AACAqY,IAAAA,YAAY,IAAIA,YAAY,CAACT,UAAb,CAAwBvJ,MAAxB,CAA+BqJ,SAA/B,CAAhB;AACA,UAAMY,YAAY,GAAG,KAAKf,QAAL,CAAcG,SAAd,CAArB;AACAY,IAAAA,YAAY,IAAIA,YAAY,CAACvF,YAAb,CAA0B1E,MAA1B,CAAiCrO,SAAjC,CAAhB;AACH;;AACDmY,EAAAA,eAAe,CAACT,SAAD,EAAY1X,SAAZ,EAAuB;AAClC,QAAIA,SAAS,KAAK0X,SAAlB,EAA6B;AACzB,UAAIW,YAAY,GAAG,KAAKd,QAAL,CAAcvX,SAAd,EAAyB,IAAzB,CAAnB;AACAqY,MAAAA,YAAY,CAACT,UAAb,CAAwBllB,GAAxB,CAA4BglB,SAA5B;AACA,YAAMY,YAAY,GAAG,KAAKf,QAAL,CAAcG,SAAd,EAAyB,IAAzB,CAArB;AACAY,MAAAA,YAAY,CAACvF,YAAb,CAA0BrgB,GAA1B,CAA8BsN,SAA9B;AACH;AACJ;;AACDuY,EAAAA,uBAAuB,CAACjB,KAAD,EAAQkB,KAAR,EAAe;AAClC,QAAIA,KAAJ,EAAW;AACPlB,MAAAA,KAAK,CAACQ,qBAAN;AACH,KAFD,MAGK;AACDR,MAAAA,KAAK,CAACQ,qBAAN;AACH;;AACDR,IAAAA,KAAK,CAACO,gBAAN,GAAyB,CAAC,CAACP,KAAK,CAACQ,qBAAjC;AACH;;AACDW,EAAAA,gBAAgB,CAAClyB,IAAD,EAAO;AACnB,SAAK+vB,OAAL,CAAanT,OAAb,CAAsB+T,MAAD,IAAY;AAC7B,UAAIA,MAAM,CAACwB,UAAP,KAAsB9B,SAAS,CAAC+B,IAApC,EAA0C;AACtCzB,QAAAA,MAAM,CAAC0B,IAAP,CAAYzxB,IAAI,CAACY,SAAL,CAAexB,IAAf,CAAZ;AACH,OAFD,MAGK;AACD,aAAKsyB,gBAAL,CAAsB3B,MAAtB;AACH;AACJ,KAPD;AAQH;;AACDE,EAAAA,aAAa,CAACF,MAAD,EAAS;AAClB,SAAKZ,OAAL,CAAa5jB,GAAb,CAAiBwkB,MAAjB;AACH;;AACD2B,EAAAA,gBAAgB,CAAC3B,MAAD,EAAS;AACrBA,IAAAA,MAAM,CAAC4B,SAAP;AACA,SAAKxC,OAAL,CAAajI,MAAb,CAAoB6I,MAApB;AACH;;AACD6B,EAAAA,oBAAoB,GAAG;AACnB,SAAK,MAAM7B,MAAX,IAAqB,KAAKZ,OAA1B,EAAmC;AAC/B,WAAKuC,gBAAL,CAAsB3B,MAAtB;AACH;AACJ;;AAhHqB;;ACgB1B,MAAM8B,kBAAkB,GAAG1vB,OAAO,CAAC,IAAD,CAAP,CAAc2vB,IAAd,GAAqBr0B,MAAhD;;AACA,IAAIs0B,SAAS,GAAG,IAAhB;;AACA,SAASC,eAAT,CAAyB1rB,MAAzB,EAAiC;AAC7B,SAAOA,MAAM,CAAC4Z,YAAP,CAAoB0D,KAApB,IAA6B,CAAC,CAACtd,MAAM,CAAC+c,UAAP,CAAkBhD,GAAxD;AACH;;AACD,eAAe4R,4BAAf,CAA4CrT,YAA5C,EAA0DsT,WAA1D,EAAuEpT,cAAvE,EAAuF;AAAA;;AACnF,QAAMqT,aAAa,GAAGzH,cAAK,CAAC5L,cAAc,CAACxY,MAAhB,EAAwB;AAC/CoU,IAAAA,cAAc,EAAE;AACZC,MAAAA,IAAI,EAAEuX,WADM;AAEZpgB,MAAAA,GAAG,EAAE;AAAEmI,QAAAA,QAAQ,EAAElW,OAAO,CAAC+N,GAAR,CAAYmI,QAAZ,IAAwB;AAApC,OAFO;AAGZiB,MAAAA,SAAS,EAAE4D,cAAc,CAACxY,MAAf,CAAsB4Z,YAAtB,CAAmC0D,KAAnC,GACL,KADK,4BAEL9E,cAAc,CAACxY,MAAf,CAAsBoU,cAAtB,CAAqCQ,SAFhC,yEAE6C;AAL5C;AAD+B,GAAxB,CAA3B,CADmF;AAWnF;;AACAiX,EAAAA,aAAa,CAACtT,gBAAd,GAAiC,EAAjC,CAZmF;;AAcnF,QAAMpO,cAAc,GAAG,MAAMkO,iBAAiB,CAACwT,aAAD,EAAgBvT,YAAhB,CAA9C,CAdmF;;AAgBnF,QAAMwT,aAAa,GAAG,MAAMC,GAAa,mCAClCvT,cADkC;AAErCrO,IAAAA,cAFqC;AAGrCnK,IAAAA,MAAM,EAAE6rB;AAH6B,KAAzC;AAKA,SAAOC,aAAP;AACH;AACD;;;;;;;AAKA,MAAME,WAAN,CAAkB;AACdz1B,EAAAA,WAAW,CAAC;AAAEsC,IAAAA,QAAF;AAAYozB,IAAAA,MAAZ;AAAoBjsB,IAAAA;AAApB,GAAD,EAAgC;AACvC,SAAK8R,MAAL,GAAc,EAAd;AACA,SAAKoa,cAAL,GAAsB,EAAtB;AACA,SAAKC,YAAL,GAAoB,EAApB;AACA,SAAKtzB,QAAL,GAAgBA,QAAhB;AACA,SAAKozB,MAAL,GAAcA,MAAd;AACA,SAAKjsB,MAAL,GAAcA,MAAd;AACH;;AACD,QAAM2mB,SAAN,CAAgBZ,aAAhB,EAA+B;AAC3B,SAAKmG,cAAL,GAAsB,EAAtB;AACA,UAAMlG,MAAM,GAAGhuB,IAAI,CAACkJ,OAAL,CAAa,KAAKrI,QAAlB,CAAf;AACA,UAAMuzB,eAAe,GAAG,MAAMzF,SAAS,CAAC,KAAK9tB,QAAN,EAAgB;AACnDid,MAAAA,OAAO,EAAE,KAAK9V,MAAL,CAAY8V,OAD8B;AAEnDmE,MAAAA,KAAK,EAAE,KAF4C;AAGnD8L,MAAAA,aAHmD;AAInDD,MAAAA,YAAY,EAAE,KAJqC;AAKnDtJ,MAAAA,UAAU,EAAE,KAAKxc,MAAL,CAAY4Z,YAAZ,CAAyB4C;AALc,KAAhB,CAAvC;;AAOA,SAAK,MAAM,CAACqH,OAAD,EAAUwI,WAAV,CAAX,IAAqCnyB,MAAM,CAACkG,OAAP,CAAegsB,eAAf,CAArC,EAAsE;AAClE,UAAI;AAAEpwB,QAAAA,IAAF;AAAQ+F,QAAAA;AAAR,UAAgBsqB,WAApB;;AACA,UAAI,CAACrwB,IAAL,EAAW;AACP;AACH;;AACD,YAAMswB,WAAW,GAAGhrB,UAAU,CAACtJ,IAAI,CAACqJ,QAAL,CAAc,KAAKxI,QAAnB,CAAD,EAA+BmtB,MAA/B,EAAuCnC,OAAvC,CAA9B;AACA,YAAM0I,MAAM,GAAGv0B,IAAI,CAACC,IAAL,CAAU,KAAKg0B,MAAf,EAAuBK,WAAvB,CAAf;AACA,YAAMrqB,gBAAgB,GAAGqqB,WAAW,GAAG,MAAvC;;AACA,UAAI,OAAOtwB,IAAP,KAAgB,QAApB,EAA8B;AAC1B,gBAAQ6nB,OAAR;AACI,eAAK,MAAL;AAAa;AACT,kBAAI9hB,GAAJ,EACI/F,IAAI,GAAGgG,mBAAmB,CAAChG,IAAD,EAAOiG,gBAAP,CAA1B;AACJ,mBAAKiqB,cAAL,CAAoBK,MAApB,IAA8B;AAC1BtrB,gBAAAA,OAAO,EAAE4iB,OADiB;AAE1BziB,gBAAAA,WAAW,EAAEyiB,OAFa;AAG1Bhb,gBAAAA,QAAQ,EAAE7M,IAHgB;AAI1BmS,gBAAAA,SAAS,EAAE,KAAKtV;AAJU,eAA9B;AAMA;AACH;;AACD,eAAK,KAAL;AAAY;AACR,kBAAIuzB,eAAe,CAAC,MAAD,CAAnB,EAA6B;AACzB;AACA,sBAAMI,WAAW,GAAGF,WAAW,CAACjwB,OAAZ,CAAoB,QAApB,EAA8B,MAA9B,CAApB;AACAL,gBAAAA,IAAI,GAAI,aAAYwwB,WAAY,MAAzB,GAAiCxwB,IAAxC;AACH;;AACDA,cAAAA,IAAI,GAAG8d,cAAc,CAAC;AAAE9d,gBAAAA,IAAF;AAAQwP,gBAAAA,GAAG,EAAE,IAAb;AAAmBuO,gBAAAA,GAAG,EAAE,KAAxB;AAA+B/Z,gBAAAA,MAAM,EAAE,KAAKA;AAA5C,eAAD,CAArB;AACA,kBAAI+B,GAAJ,EACI/F,IAAI,GAAGkG,kBAAkB,CAAClG,IAAD,EAAOiG,gBAAP,CAAzB;AACJ,mBAAKiqB,cAAL,CAAoBK,MAApB,IAA8B;AAC1BtrB,gBAAAA,OAAO,EAAE4iB,OADiB;AAE1BziB,gBAAAA,WAAW,EAAEyiB,OAFa;AAG1Bhb,gBAAAA,QAAQ,EAAE7M,IAHgB;AAI1BmS,gBAAAA,SAAS,EAAE,KAAKtV;AAJU,eAA9B;AAMA;AACH;;AACD,eAAK,OAAL;AAAc;AACVmD,cAAAA,IAAI,GAAGge,gBAAgB,CAAC;AACpBhe,gBAAAA,IADoB;AAEpB+d,gBAAAA,GAAG,EAAE2R,eAAe,CAAC,KAAK1rB,MAAN,CAFA;AAGpBia,gBAAAA,KAAK,EAAE,KAHa;AAIpBja,gBAAAA,MAAM,EAAE,KAAKA,MAJO;AAKpBka,gBAAAA,IAAI,EAAE;AALc,eAAD,CAAvB;AAOA,mBAAKgS,cAAL,CAAoBK,MAApB,IAA8B;AAC1BtrB,gBAAAA,OAAO,EAAE4iB,OADiB;AAE1BziB,gBAAAA,WAAW,EAAEyiB,OAFa;AAG1Bhb,gBAAAA,QAAQ,EAAE7M,IAHgB;AAI1BmS,gBAAAA,SAAS,EAAE,KAAKtV;AAJU,eAA9B;AAMA;AACH;AA5CL;AA8CH;;AACD,WAAKiZ,MAAL,CAAYya,MAAZ,IAAsBvwB,IAAtB;;AACA,UAAI+F,GAAJ,EAAS;AACL,aAAK+P,MAAL,CAAY9Z,IAAI,CAACC,IAAL,CAAU,KAAKg0B,MAAf,EAAuBhqB,gBAAvB,CAAZ,IAAwDF,GAAxD;AACH;AACJ;AACJ;;AACD,QAAM0qB,cAAN,CAAqB3yB,SAArB,EAAgC;AAC5B,QAAI4yB,SAAS,GAAG,IAAhB;AACA,SAAKP,YAAL,GAAoB,EAApB;;AACA,SAAK,MAAM,CAACI,MAAD,EAASI,OAAT,CAAX,IAAgCzyB,MAAM,CAACkG,OAAP,CAAe,KAAK8rB,cAApB,CAAhC,EAAqE;AACjE;AACA,UAAIviB,MAAM,CAACC,QAAP,CAAgB+iB,OAAO,CAAC9jB,QAAxB,CAAJ,EAAuC;AACnC;AACH;;AACD,YAAMhH,IAAI,GAAG8qB,OAAb;AACA,YAAMC,sBAAsB,GAAGvF,oBAAoB,CAAC;AAChDvd,QAAAA,OAAO,EAAEjI,IAAI,CAACsM,SADkC;AAEhDmZ,QAAAA,mBAAmB,EAAExtB,SAF2B;AAGhDkG,QAAAA,MAAM,EAAE,KAAKA;AAHmC,OAAD,CAAnD;AAKA,YAAM6sB,YAAY,GAAG,MAAMnE,oBAAoB,CAAC7mB,IAAD,EAAQ5B,IAAD,IAAU;AAC5D;AACA,YAAI6sB,iBAAiB,GAAGF,sBAAsB,CAAC3sB,IAAD,CAA9C,CAF4D;AAI5D;AACA;;AACA,YAAI,CAAC6sB,iBAAL,EAAwB;AACpBJ,UAAAA,SAAS,GAAG,KAAZ;AACA/0B,UAAAA,MAAM,CAACvB,KAAP,CAAc,GAAEyL,IAAI,CAACsM,SAAU,wCAAuClO,IAAK,IAA3E;AACA,iBAAOA,IAAP;AACH,SAV2D;;;AAY5D,YAAI1C,GAAG,CAAC5D,KAAJ,CAAUmzB,iBAAV,EAA6B3vB,QAAjC,EAA2C;AACvC,iBAAO8C,IAAP;AACH,SAd2D;;;AAgB5D,cAAM8sB,aAAa,GAAG/0B,IAAI,CAACkJ,OAAL,CAAa4rB,iBAAb,CAAtB;AACA,cAAME,aAAa,GAAGD,aAAa,KAC9BlrB,IAAI,CAACZ,OAAL,KAAiB,KAAjB,IAA0BY,IAAI,CAACZ,OAAL,KAAiB,OADb,CAAb,IAElB8rB,aAAa,KAAK,KAFtB;AAGA,cAAME,iBAAiB,GAAGj1B,IAAI,CAACoT,KAAL,CAAWtK,UAAX,CAAsBgsB,iBAAtB,CAA1B;AACA,YAAII,kBAAkB,GAAGjqB,kBAAkB,CAACjL,IAAI,CAAC6hB,SAAL,CAAeiT,iBAAf,CAAD,CAA3C,CArB4D;AAuB5D;;AACA,YAAIE,aAAJ,EAAmB;AACf,cAAIC,iBAAJ,EAAuB;AACnB,iBAAKd,YAAL,CAAkBj1B,IAAlB,CAAuBc,IAAI,CAAC8D,OAAL,CAAa,KAAKkE,MAAL,CAAY+c,UAAZ,CAAuBE,GAApC,EAAyCiQ,kBAAzC,CAAvB;AACH,WAFD,MAGK;AACD,iBAAKf,YAAL,CAAkBj1B,IAAlB,CAAuBc,IAAI,CAAC8D,OAAL,CAAa9D,IAAI,CAACsH,OAAL,CAAaitB,MAAb,CAAb,EAAmCW,kBAAnC,CAAvB;AACH;AACJ;;AACD,YAAIF,aAAJ,EAAmB;AACfE,UAAAA,kBAAkB,GAAGA,kBAAkB,GAAG,WAA1C;AACAJ,UAAAA,iBAAiB,GAAGA,iBAAiB,GAAG,WAAxC;AACH,SAnC2D;;;AAqC5D,YAAIG,iBAAJ,EAAuB;AACnBH,UAAAA,iBAAiB,GAAGxqB,WAAW,CAACtK,IAAI,CAACsH,OAAL,CAAaitB,MAAb,CAAD,EAAuBv0B,IAAI,CAAC8D,OAAL,CAAa,KAAKkE,MAAL,CAAY+c,UAAZ,CAAuBE,GAApC,EAAyCiQ,kBAAzC,CAAvB,CAA/B;AACH,SAvC2D;;;AAyC5D,YAAI,CAACJ,iBAAiB,CAACnyB,UAAlB,CAA6B,GAA7B,CAAD,IAAsC,CAACmyB,iBAAiB,CAACnyB,UAAlB,CAA6B,GAA7B,CAA3C,EAA8E;AAC1EmyB,UAAAA,iBAAiB,GAAG,OAAOA,iBAA3B;AACH;;AACD,eAAOA,iBAAP;AACH,OA7C8C,CAA/C;AA8CA,WAAKhb,MAAL,CAAYya,MAAZ,IAAsBM,YAAtB;AACH;;AACD,WAAOH,SAAP;AACH;;AACD,QAAMS,WAAN,GAAoB;AAChB9tB,IAAAA,MAAM,CAACS,IAAP,CAAY,KAAKmsB,MAAjB;;AACA,SAAK,MAAM,CAACM,MAAD,EAASvwB,IAAT,CAAX,IAA6B9B,MAAM,CAACkG,OAAP,CAAe,KAAK0R,MAApB,CAA7B,EAA0D;AACtD,YAAMtY,QAAQ,GAAG,OAAOwC,IAAP,KAAgB,QAAhB,GAA2B,OAA3B,GAAqCzB,SAAtD;AACA,YAAMxB,WAAE,CAACwG,SAAH,CAAagtB,MAAb,EAAqBvwB,IAArB,EAA2BxC,QAA3B,CAAN;AACH;AACJ;;AACD,QAAM4zB,gBAAN,CAAuBC,eAAvB,EAAwC;AACpC,UAAMC,WAAW,GAAG,KAAKxb,MAAL,CAAYub,eAAZ,CAApB;AACA,UAAME,kBAAkB,GAAGF,eAAe,GAAG,WAA7C;AACA,UAAMG,UAAU,GAAGH,eAAe,CAC7BxR,MADc,CACP,KAAK7b,MAAL,CAAY+c,UAAZ,CAAuBE,GAAvB,CAA2B9lB,MADpB,EAEdkF,OAFc,CAEN,KAFM,EAEC,GAFD,CAAnB;AAGA,UAAMoxB,SAAS,GAAG,MAAMvS,eAAe,CAAC;AACpC3d,MAAAA,GAAG,EAAEiwB,UAD+B;AAEpCxxB,MAAAA,IAAI,EAAEsxB,WAF8B;AAGpCvT,MAAAA,GAAG,EAAE,KAH+B;AAIpC/Z,MAAAA,MAAM,EAAE,KAAKA;AAJuB,KAAD,CAAvC;AAMA,UAAMjH,WAAE,CAACwG,SAAH,CAAaguB,kBAAb,EAAiCE,SAAjC,EAA4C,OAA5C,CAAN;AACH;;AArKa;;AAuKlB,AAAO,eAAe3vB,SAAf,CAAuB0a,cAAvB,EAAuC;AAC1C,QAAM;AAAEnf,IAAAA,GAAF;AAAO2G,IAAAA;AAAP,MAAkBwY,cAAxB;AACA,QAAMkV,iBAAiB,GAAG1tB,MAAM,CAAC+c,UAAP,CAAkBE,GAA5C;AACA,QAAM0Q,qBAAqB,GAAG31B,IAAI,CAACC,IAAL,CAAUy1B,iBAAV,EAA6B1tB,MAAM,CAAC4Z,YAAP,CAAoBD,OAAjD,CAA9B;AACA,QAAMiU,kBAAkB,GAAG1zB,MAAM,CAACkG,OAAP,CAAeJ,MAAM,CAACmP,KAAtB,EAA6BpN,GAA7B,CAAiC,CAAC,CAACqN,QAAD,EAAWgS,KAAX,CAAD,KAAuB;AAC/E,WAAO,CACHppB,IAAI,CAAC8D,OAAL,CAAazC,GAAb,EAAkB+V,QAAlB,CADG,EAEHpX,IAAI,CAAC8D,OAAL,CAAa4xB,iBAAb,EAAgCzqB,kBAAkB,CAACme,KAAD,CAAlD,CAFG,CAAP;AAIH,GAL0B,CAA3B;;AAMA,MAAIphB,MAAM,CAAC4Z,YAAP,CAAoBwD,KAAxB,EAA+B;AAC3Bvd,IAAAA,MAAM,CAACC,IAAP,CAAY4tB,iBAAZ;AACH;;AACDruB,EAAAA,MAAM,CAACS,IAAP,CAAY4tB,iBAAZ;AACAruB,EAAAA,MAAM,CAACS,IAAP,CAAY6tB,qBAAZ;;AACA,OAAK,MAAME,SAAX,IAAwB7tB,MAAM,CAAC8V,OAA/B,EAAwC;AACpC,QAAI+X,SAAS,CAACpV,GAAd,EAAmB;AACf,YAAMoV,SAAS,CACVpV,GADC,CACG;AACLwB,QAAAA,KAAK,EAAE,KADF;AAEL6L,QAAAA,YAAY,EAAE,KAFT;AAGL;AACAhvB,QAAAA,GAAG,EAAE,CAACyrB,GAAD,EAAMzpB,IAAI,GAAG,EAAb,KAAoB;AACrB,cAAIypB,GAAG,KAAK,YAAZ,EAA0B;AACtB5qB,YAAAA,MAAM,CAACzB,IAAP,CAAa,IAAG23B,SAAS,CAAC92B,IAAK,KAAI+B,IAAI,CAACypB,GAAL,CAAS/U,IAAT,EAAgB,EAAnD;AACH;AACJ;AARI,OADH,EAWDrO,KAXC,CAWM1F,GAAD,IAAS;AAChB9B,QAAAA,MAAM,CAACvB,KAAP,CAAaqD,GAAG,CAACN,QAAJ,EAAb,EAA6B;AAAEpC,UAAAA,IAAI,EAAE82B,SAAS,CAAC92B;AAAlB,SAA7B;AACA0G,QAAAA,OAAO,CAACiG,IAAR,CAAa,CAAb;AACH,OAdK,CAAN;AAeH;AACJ,GAjCyC;;;AAmC1C,QAAM3K,WAAE,CAACwG,SAAH,CAAavH,IAAI,CAACC,IAAL,CAAU01B,qBAAV,EAAiC,QAAjC,CAAb,EAAyDvS,iBAAiB,CAAC,YAAD,CAA1E,CAAN;;AACA,MAAIsQ,eAAe,CAAC1rB,MAAD,CAAnB,EAA6B;AACzB,UAAMjH,WAAE,CAACwG,SAAH,CAAavH,IAAI,CAAC8D,OAAL,CAAa6xB,qBAAb,EAAoC,QAApC,CAAb,EAA4DzqB,eAA5D,CAAN;AACAuoB,IAAAA,SAAS,GAAG,IAAI7C,YAAJ,EAAZ;AACH;;AACDjxB,EAAAA,MAAM,CAACzB,IAAP,CAAYe,aAAA,CAAc,oBAAd,CAAZ;AACA,QAAMwT,UAAU,GAAGmO,sBAAW,CAACC,GAAZ,EAAnB;AACA,QAAMiV,kBAAkB,GAAG,EAA3B;AACA;;AACA,iBAAeC,mBAAf,GAAqC;AACjC,UAAMzV,YAAY,GAAGpe,MAAM,CAACiY,MAAP,CAAc2b,kBAAd,EAChB/rB,GADgB,CACXisB,CAAD,IAAO9zB,MAAM,CAACiY,MAAP,CAAc6b,CAAC,CAAC9B,cAAhB,CADK,EAEhBnhB,MAFgB,CAET,CAAC+D,IAAD,EAAO9T,IAAP,KAAgB8T,IAAI,CAACC,MAAL,CAAY/T,IAAZ,CAFP,EAE0B,EAF1B,CAArB;AAGA,UAAM4wB,WAAW,GAAG5zB,IAAI,CAACC,IAAL,CAAUy1B,iBAAV,EAA6B1tB,MAAM,CAAC4Z,YAAP,CAAoBuD,aAAjD,CAApB;AACA,UAAM2O,aAAa,GAAG,MAAMH,4BAA4B,CAACrT,YAAD,EAAesT,WAAf,qBACjDpT,cADiD,EAAxD;;AAGA,QAAI,CAACsT,aAAa,CAAC7X,OAAf,IAA0B6X,aAAa,CAACpT,QAAxC,IAAoD,CAACoT,aAAa,CAAChyB,SAAvE,EAAkF;AAC9E2D,MAAAA,OAAO,CAACiG,IAAR,CAAa,CAAb;AACH;;AACD,UAAMuqB,QAAQ,GAAGvf,IAAI,CAAC5O,IAAL,CAAW,MAAX,EAAkB;AAC/BzG,MAAAA,GAAG,EAAEuyB,WAD0B;AAE/Bpc,MAAAA,QAAQ,EAAE,IAFqB;AAG/BX,MAAAA,KAAK,EAAE,IAHwB;AAI/Bqf,MAAAA,GAAG,EAAE;AAJ0B,KAAlB,CAAjB;;AAMA,SAAK,MAAMC,gBAAX,IAA+BF,QAA/B,EAAyC;AACrC,UAAI,CAACE,gBAAgB,CAACnoB,QAAjB,CAA0B,iBAA1B,CAAD,IACAhO,IAAI,CAACkJ,OAAL,CAAaitB,gBAAb,MAAmC,KADvC,EAC8C;AAC1C,cAAMb,WAAW,GAAG,MAAM10B,QAAQ,CAACu1B,gBAAD,CAAlC;AACA,cAAMZ,kBAAkB,GAAGY,gBAAgB,GAAG,WAA9C;AACA,cAAMX,UAAU,GAAGW,gBAAgB,CAACtS,MAAjB,CAAwB6R,iBAAiB,CAACv2B,MAA1C,EAAkDkF,OAAlD,CAA0D,KAA1D,EAAiE,GAAjE,CAAnB;AACA,cAAMoxB,SAAS,GAAG,MAAMvS,eAAe,CAAC;AACpC3d,UAAAA,GAAG,EAAEiwB,UAD+B;AAEpCxxB,UAAAA,IAAI,EAAEsxB,WAF8B;AAGpCvT,UAAAA,GAAG,EAAE,KAH+B;AAIpC/Z,UAAAA,MAAM,EAAEA;AAJ4B,SAAD,CAAvC;AAMA,cAAMjH,WAAE,CAACwG,SAAH,CAAaguB,kBAAb,EAAiCE,SAAjC,EAA4C,OAA5C,CAAN;AACH;AACJ;;AACD,WAAO3B,aAAP;AACH,GA7EyC;;;AA+E1C,OAAK,MAAM,CAAC1c,QAAD,EAAWgf,OAAX,CAAX,IAAkCR,kBAAlC,EAAsD;AAClD,UAAMK,QAAQ,GAAGvf,IAAI,CAAC5O,IAAL,CAAW,MAAX,EAAkB;AAC/BwP,MAAAA,MAAM,EAAEtP,MAAM,CAACuP,OADgB;AAE/BlW,MAAAA,GAAG,EAAE+V,QAF0B;AAG/BI,MAAAA,QAAQ,EAAE,IAHqB;AAI/BX,MAAAA,KAAK,EAAE,IAJwB;AAK/Bqf,MAAAA,GAAG,EAAE;AAL0B,KAAlB,CAAjB;;AAOA,SAAK,MAAMG,YAAX,IAA2BJ,QAA3B,EAAqC;AACjC,YAAM9f,SAAS,GAAGnW,IAAI,CAAC8D,OAAL,CAAauyB,YAAb,CAAlB,CADiC;;AAEjC,YAAMC,SAAS,GAAGngB,SAAS,CAAC9R,OAAV,CAAkB+S,QAAlB,EAA4Bgf,OAA5B,CAAlB;AACA,YAAMnC,MAAM,GAAGj0B,IAAI,CAACsH,OAAL,CAAagvB,SAAb,CAAf;AACA,YAAMC,iBAAiB,GAAG,IAAIvC,WAAJ,CAAgB;AAAEnzB,QAAAA,QAAQ,EAAEsV,SAAZ;AAAuB8d,QAAAA,MAAvB;AAA+BjsB,QAAAA;AAA/B,OAAhB,CAA1B;AACA8tB,MAAAA,kBAAkB,CAAC3f,SAAD,CAAlB,GAAgCogB,iBAAhC;AACH;AACJ,GA9FyC;;;AAgG1C,QAAMC,iBAAiB,GAAG,IAAI7pB,MAAJ,CAAW;AAAEC,IAAAA,WAAW,EAAE2mB;AAAf,GAAX,CAA1B;AACA,QAAMkD,qBAAqB,GAAGv0B,MAAM,CAACiY,MAAP,CAAc2b,kBAAd,CAA9B;;AACA,OAAK,MAAMS,iBAAX,IAAgCE,qBAAhC,EAAuD;AACnDD,IAAAA,iBAAiB,CAACvpB,GAAlB,CAAsB,MAAMspB,iBAAiB,CAAC5H,SAAlB,CAA4B,IAA5B,CAA5B;AACH;;AACD,QAAM6H,iBAAiB,CAACrpB,MAAlB,EAAN;AACA,QAAMupB,QAAQ,GAAG9V,sBAAW,CAACC,GAAZ,EAAjB;AACAlhB,EAAAA,MAAM,CAACzB,IAAP,CAAa,GAAEe,YAAA,CAAa,GAAb,CAAkB,mBAAkBA,UAAA,CAAY,IAAG,CAAC,CAACy3B,QAAQ,GAAGjkB,UAAZ,IAA0B,IAA3B,EAAiCsO,OAAjC,CAAyC,CAAzC,CAA4C,IAA3D,CAAgE,EAAnH,EAvG0C;;AAyG1C,MAAI+S,aAAa,GAAG,MAAMiC,mBAAmB,EAA7C,CAzG0C;;AA2G1C,OAAK,MAAMQ,iBAAX,IAAgCE,qBAAhC,EAAuD;AACnDD,IAAAA,iBAAiB,CAACvpB,GAAlB,CAAsB,MAAMspB,iBAAiB,CAAC9B,cAAlB,CAAiCX,aAAa,CAAChyB,SAA/C,CAA5B;AACH;;AACD,QAAM00B,iBAAiB,CAACrpB,MAAlB,EAAN,CA9G0C;;AAgH1C,QAAMwpB,mBAAmB,GAAG,IAAIjoB,GAAJ,CAAQ+nB,qBAAqB,CAAC1sB,GAAtB,CAA2B6sB,CAAD,IAAOA,CAAC,CAACzC,YAAnC,EAAiDphB,MAAjD,CAAwD,CAAC+D,IAAD,EAAO9T,IAAP,KAAgB8T,IAAI,CAACC,MAAL,CAAY/T,IAAZ,CAAxE,EAA2F,EAA3F,CAAR,CAA5B;;AACA,OAAK,MAAMuzB,iBAAX,IAAgCE,qBAAhC,EAAuD;AACnDD,IAAAA,iBAAiB,CAACvpB,GAAlB,CAAsB,MAAMspB,iBAAiB,CAACpB,WAAlB,EAA5B;;AACA,SAAK,MAAM0B,SAAX,IAAwB30B,MAAM,CAACC,IAAP,CAAYo0B,iBAAiB,CAACzc,MAA9B,CAAxB,EAA+D;AAC3D,UAAI6c,mBAAmB,CAACG,GAApB,CAAwBD,SAAxB,CAAJ,EAAwC;AACpCL,QAAAA,iBAAiB,CAACvpB,GAAlB,CAAsB,MAAMspB,iBAAiB,CAACnB,gBAAlB,CAAmCyB,SAAnC,CAA5B;AACH;AACJ;AACJ;;AACD,QAAML,iBAAiB,CAACrpB,MAAlB,EAAN,CAzH0C;;AA2H1C,MAAI,CAACnF,MAAM,CAAC4Z,YAAP,CAAoB0D,KAAzB,EAAgC;AAC5B,UAAMoJ,sBAAsB,CAAC1mB,MAAD,CAA5B;AACA,UAAMymB,uBAAuB,CAACiH,iBAAD,EAAoB;AAC7C5X,MAAAA,OAAO,EAAE9V,MAAM,CAAC8V,OAD6B;AAE7CmE,MAAAA,KAAK,EAAE,KAFsC;AAG7C8L,MAAAA,aAAa,EAAE,KAH8B;AAI7CD,MAAAA,YAAY,EAAE,KAJ+B;AAK7CtJ,MAAAA,UAAU,EAAExc,MAAM,CAAC4Z,YAAP,CAAoB4C;AALa,KAApB,CAA7B;AAOA7kB,IAAAA,MAAM,CAACzB,IAAP,CAAa,GAAEe,gBAAA,CAAiBA,YAAA,CAAaA,WAAA,CAAY,mBAAZ,CAAb,CAAjB,CAAiE,MAAhF;AACA;AACH,GAtIyC;;;AAwI1C,MAAIw0B,SAAJ,EAAe;AACX9zB,IAAAA,MAAM,CAACzB,IAAP,CAAa,oCAAmCe,WAAA,CAAa,GAAEw0B,SAAS,CAACzC,KAAM,EAA/B,CAAkC,EAAlF;AACH,GA1IyC;AA4I1C;;;AACArxB,EAAAA,MAAM,CAACzB,IAAP,CAAYe,WAAA,CAAY,yBAAZ,CAAZ;AACA,QAAM83B,QAAQ,GAAG,2CAAa,UAAb,EAAjB;;AACA,WAASC,aAAT,CAAuBllB,OAAvB,EAAgC;AAC5B,WAAOgkB,kBAAkB,CAAChkB,OAAD,CAAzB;AACH;;AACD,iBAAemlB,YAAf,CAA4BnlB,OAA5B,EAAqC;AACjCnS,IAAAA,MAAM,CAACzB,IAAP,CAAYe,WAAA,CAAY,iBAAZ,CAAZ;AACA,UAAM,CAACmY,QAAD,EAAWgf,OAAX,IAAsBR,kBAAkB,CAAC5X,IAAnB,CAAwB,CAAC,CAAC5G,QAAD,CAAD,KAAgBtF,OAAO,CAACnP,UAAR,CAAmByU,QAAnB,CAAxC,KAAyE,EAArG;;AACA,QAAI,CAACA,QAAD,IAAa,CAACgf,OAAlB,EAA2B;AACvB;AACH;;AACD,UAAME,SAAS,GAAGxkB,OAAO,CAACzN,OAAR,CAAgB+S,QAAhB,EAA0Bgf,OAA1B,CAAlB;AACA,UAAMnC,MAAM,GAAGj0B,IAAI,CAACsH,OAAL,CAAagvB,SAAb,CAAf;AACA,UAAMY,mBAAmB,GAAG,IAAIlD,WAAJ,CAAgB;AAAEnzB,MAAAA,QAAQ,EAAEiR,OAAZ;AAAqBmiB,MAAAA,MAArB;AAA6BjsB,MAAAA;AAA7B,KAAhB,CAA5B;AACA8tB,IAAAA,kBAAkB,CAAChkB,OAAD,CAAlB,GAA8BolB,mBAA9B,CATiC;;AAWjC,UAAMA,mBAAmB,CAACvI,SAApB,CAA8B,KAA9B,EAAqCxnB,KAArC,CAA4C1F,GAAD,IAAS;AACtD9B,MAAAA,MAAM,CAACvB,KAAP,CAAaqD,GAAG,CAAC7C,OAAjB,EAA0B;AAAEG,QAAAA,IAAI,EAAEm4B,mBAAmB,CAACr2B;AAA5B,OAA1B;AACH,KAFK,CAAN,CAXiC;;AAejC,QAAIs2B,cAAc,GAAG,MAAMD,mBAAmB,CAACzC,cAApB,CAAmCX,aAAa,CAAChyB,SAAjD,CAA3B;;AACA,QAAI,CAACq1B,cAAL,EAAqB;AACjB,YAAMpB,mBAAmB,EAAzB;AACAoB,MAAAA,cAAc,GAAG,MAAMD,mBAAmB,CAACzC,cAApB,CAAmCX,aAAa,CAAChyB,SAAjD,CAAvB;;AACA,UAAI,CAACq1B,cAAL,EAAqB;AACjBx3B,QAAAA,MAAM,CAACvB,KAAP,CAAa,YAAb;AACAqH,QAAAA,OAAO,CAACiG,IAAR,CAAa,CAAb;AACH;AACJ,KAvBgC;;;AAyBjC,UAAMwrB,mBAAmB,CAAC/B,WAApB,EAAN;AACA,UAAMsB,qBAAqB,GAAGv0B,MAAM,CAACiY,MAAP,CAAc2b,kBAAd,CAA9B;AACA,UAAMa,mBAAmB,GAAG,IAAIjoB,GAAJ,CAAQ+nB,qBAAqB,CACpD1sB,GAD+B,CAC1B6sB,CAAD,IAAOA,CAAC,CAACzC,YADkB,EAE/BphB,MAF+B,CAExB,CAAC+D,IAAD,EAAO9T,IAAP,KAAgB8T,IAAI,CAACC,MAAL,CAAY/T,IAAZ,CAFQ,EAEW,EAFX,CAAR,CAA5B;;AAGA,SAAK,MAAM6zB,SAAX,IAAwB30B,MAAM,CAACC,IAAP,CAAY+0B,mBAAmB,CAACpd,MAAhC,CAAxB,EAAiE;AAC7D,UAAI6c,mBAAmB,CAACG,GAApB,CAAwBD,SAAxB,CAAJ,EAAwC;AACpC,cAAMK,mBAAmB,CAAC9B,gBAApB,CAAqCyB,SAArC,CAAN;AACH;AACJ;;AACD,QAAIpD,SAAJ,EAAe;AACXA,MAAAA,SAAS,CAACT,gBAAV,CAA2B;AAAEpqB,QAAAA,IAAI,EAAE;AAAR,OAA3B;AACH;AACJ;;AACD,QAAMwuB,OAAO,GAAGL,QAAQ,CAACzR,KAAT,CAAesQ,kBAAkB,CAAC7rB,GAAnB,CAAuB,CAAC,CAACsN,OAAD,CAAD,KAAeA,OAAtC,CAAf,EAA+D;AAC3EggB,IAAAA,OAAO,EAAErvB,MAAM,CAACuP,OAD2D;AAE3E+f,IAAAA,aAAa,EAAE,IAF4D;AAG3EC,IAAAA,UAAU,EAAE,IAH+D;AAI3EC,IAAAA,eAAe,EAAE;AAJ0D,GAA/D,CAAhB;AAMAJ,EAAAA,OAAO,CAAC53B,EAAR,CAAW,KAAX,EAAmBsS,OAAD,IAAamlB,YAAY,CAACnlB,OAAD,CAA3C;AACAslB,EAAAA,OAAO,CAAC53B,EAAR,CAAW,QAAX,EAAsBsS,OAAD,IAAamlB,YAAY,CAACnlB,OAAD,CAA9C;AACAslB,EAAAA,OAAO,CAAC53B,EAAR,CAAW,QAAX,EAAsBsS,OAAD,IAAaklB,aAAa,CAACllB,OAAD,CAA/C,EAjM0C;;AAmM1C,SAAO,IAAIrK,OAAJ,CAAY,MAAM,EAAlB,CAAP;AACH;;ACzZD,MAAMpG,KAAG,GAAGoE,OAAO,CAACpE,GAAR,EAAZ;AACA,AAAO,MAAMo2B,UAAU,GAAG;AACtBC,EAAAA,UAAU,EAAE,YADU;AAEtBC,EAAAA,UAAU,EAAE,YAFU;AAGtBC,EAAAA,eAAe,EAAE,iBAHK;AAItBC,EAAAA,YAAY,EAAE,cAJQ;AAKtBC,EAAAA,eAAe,EAAE,iBALK;AAMtBC,EAAAA,UAAU,EAAE,YANU;AAOtBC,EAAAA,YAAY,EAAE,cAPQ;AAQtBC,EAAAA,aAAa,EAAE;AARO,CAAnB;AAUP;;;;;;AAKA,AAAO,eAAeC,OAAf,CAAuBC,WAAvB,EAAoC;AACvC,QAAMC,iBAAiB,GAAG,MAAMC,UAAU,CAACF,WAAD,CAA1C;;AACA,MAAIA,WAAW,KAAKC,iBAApB,EAAuC;AACnC,QAAIE,WAAW,GAAG,KAAlB;;AACA,QAAI7yB,OAAO,CAAC8yB,MAAR,CAAeC,KAAnB,EAA0B;AACtB,YAAMC,EAAE,GAAGC,QAAQ,CAACC,eAAT,CAAyB;AAAEhmB,QAAAA,KAAK,EAAElN,OAAO,CAACmzB,KAAjB;AAAwB9e,QAAAA,MAAM,EAAErU,OAAO,CAAC8yB;AAAxC,OAAzB,CAAX;AACAD,MAAAA,WAAW,GAAG,MAAM,IAAI7wB,OAAJ,CAAa3D,OAAD,IAAa;AACzC20B,QAAAA,EAAE,CAACI,QAAH,CAAY55B,aAAA,CAAe,UAASA,WAAA,CAAYk5B,WAAZ,CAAyB,+BAA8Bl5B,WAAA,CAAYm5B,iBAAZ,CAA+B,kBAA9G,CAAZ,EAA+IU,MAAD,IAAY;AACtJh1B,UAAAA,OAAO,CAAC,CAAC,SAAS0B,IAAT,CAAcszB,MAAd,CAAF,CAAP;AACH,SAFD;AAGH,OAJmB,CAApB;AAKAL,MAAAA,EAAE,CAACM,KAAH;AACH;;AACD,QAAI,CAACT,WAAL,EAAkB;AACd34B,MAAAA,MAAM,CAACvB,KAAP,CAAc,UAASa,WAAA,CAAYk5B,WAAZ,CAAyB,uBAAsBl5B,WAAA,CAAY,QAAZ,CAAsB,+BAA5F;AACAwG,MAAAA,OAAO,CAACiG,IAAR,CAAa,CAAb;AACH;AACJ;;AACD,SAAO0sB,iBAAP;AACH;AACD,MAAMY,iBAAiB,GAAG;AAAEC,EAAAA,IAAI,EAAE,KAAR;AAAe76B,EAAAA,KAAK,EAAE,IAAtB;AAA4B20B,EAAAA,KAAK,EAAE,IAAnC;AAAyCjZ,EAAAA,MAAM,EAAE;AAAjD,CAA1B;AACA,AAAO,SAASof,KAAT,CAAeC,GAAf,EAAoBrb,OAApB,EAA6B;AAChC,MAAIzY,IAAJ;AACA,MAAID,QAAJ;AACA,MAAID,QAAQ,GAAG,EAAf;AACA,MAAIi0B,WAAJ;AACA,MAAIC,GAAG,GAAG,EAAV;AACA,QAAMC,eAAe,GAAG,EAAxB;AACA,QAAMC,aAAa,GAAG,IAAI7qB,GAAJ,EAAtB;;AACA,OAAK,MAAMyQ,MAAX,IAAqBrB,OAArB,EAA8B;AAC1Bwb,IAAAA,eAAe,CAACna,MAAD,CAAf,sBAA+B6Z,iBAA/B;AACH;;AACD,WAASQ,WAAT,CAAqBlsB,EAArB,EAAyB;AACrB,QAAI,CAACgsB,eAAe,CAAChsB,EAAD,CAApB,EAA0B;AACtBgsB,MAAAA,eAAe,CAAChsB,EAAD,CAAf,sBAA2B0rB,iBAA3B;AACH;AACJ;;AACD,WAASS,OAAT,GAAmB;AACf;AACAh0B,IAAAA,OAAO,CAAC8yB,MAAR,CAAe3Y,KAAf,CAAqBna,OAAO,CAACC,QAAR,KAAqB,OAArB,GAA+B,gBAA/B,GAAkD,sBAAvE,EAFe;;AAIfD,IAAAA,OAAO,CAAC8yB,MAAR,CAAe3Y,KAAf,CAAsB,GAAE3gB,WAAA,CAAa,UAAb,CAAwB,MAAhD,EAJe;;AAMf,UAAMy6B,eAAe,GAAGN,WAAW,GAAG,CAAd,IAAmB/zB,IAAI,GAAG,CAA1B,IAA+BF,QAAvD;;AACA,QAAIu0B,eAAJ,EAAqB;AACjBj0B,MAAAA,OAAO,CAAC8yB,MAAR,CAAe3Y,KAAf,CAAsB,KAAI3gB,WAAA,CAAYA,WAAA,CAAa,GAAEkG,QAAS,KAAIC,QAAS,IAAGC,IAAK,EAA7C,CAAZ,CAA6D,EAAvF;;AACA,WAAK,MAAMs0B,EAAX,IAAiBN,GAAjB,EAAsB;AAClB5zB,QAAAA,OAAO,CAAC8yB,MAAR,CAAe3Y,KAAf,CAAsB,GAAE3gB,WAAA,CAAa,KAAb,CAAmB,GAAEA,WAAA,CAAYA,WAAA,CAAa,GAAEkG,QAAS,KAAIw0B,EAAG,IAAGt0B,IAAK,EAAvC,CAAZ,CAAuD,EAApG;AACH;;AACDI,MAAAA,OAAO,CAAC8yB,MAAR,CAAe3Y,KAAf,CAAqB,IAArB;AACAna,MAAAA,OAAO,CAAC8yB,MAAR,CAAe3Y,KAAf,CAAqB3gB,UAAA,CAAWm6B,WAAW,GAAG,IAAd,GAAsB,uBAAsBA,WAAY,KAAxD,GAAgE,mBAA3E,CAArB;;AACA,UAAIG,aAAa,CAAC9oB,IAAd,GAAqB,CAAzB,EAA4B;AACxBhL,QAAAA,OAAO,CAAC8yB,MAAR,CAAe3Y,KAAf,CAAqB3gB,UAAA,CAAY,cAAZ,CAArB;AACH;;AACDwG,MAAAA,OAAO,CAAC8yB,MAAR,CAAe3Y,KAAf,CAAqB,MAArB;AACH,KAXD,MAYK;AACDna,MAAAA,OAAO,CAAC8yB,MAAR,CAAe3Y,KAAf,CAAqB3gB,UAAA,CAAY,oBAAZ,IAAmC,MAAxD;AACH,KArBc;;;AAuBf,UAAMP,OAAO,GAAGiB,MAAM,CAACJ,UAAP,EAAhB;;AACA,QAAIb,OAAO,CAACS,MAAZ,EAAoB;AAChBsG,MAAAA,OAAO,CAAC8yB,MAAR,CAAe3Y,KAAf,CAAsB,GAAE3gB,gBAAA,CAAiBA,WAAA,CAAY,WAAZ,CAAjB,CAA2C,MAAnE;AACAwG,MAAAA,OAAO,CAAC8yB,MAAR,CAAe3Y,KAAf,CAAqBlhB,OAAO,CAACuB,IAAR,CAAa,IAAb,CAArB;AACAwF,MAAAA,OAAO,CAAC8yB,MAAR,CAAe3Y,KAAf,CAAqB,MAArB;AACH,KA5Bc;;;AA8Bf,SAAK,MAAM,CAAC0G,MAAD,EAASsT,WAAT,CAAX,IAAoC13B,MAAM,CAACkG,OAAP,CAAekxB,eAAf,CAApC,EAAqE;AACjE,UAAI,CAACM,WAAW,CAAC9f,MAAjB,EAAyB;AACrB;AACH;;AACD,YAAM+f,QAAQ,GAAGvmB,KAAK,CAAC4U,OAAN,CAAc0R,WAAW,CAACx7B,KAA1B,IAAmCa,UAAnC,GAAgDA,YAAjE;AACAwG,MAAAA,OAAO,CAAC8yB,MAAR,CAAe3Y,KAAf,CAAsB,GAAEia,QAAQ,CAAC56B,gBAAA,CAAiBA,WAAA,CAAY,OAAOqnB,MAAnB,CAAjB,CAAD,CAA+C,MAA/E;AACA7gB,MAAAA,OAAO,CAAC8yB,MAAR,CAAe3Y,KAAf,CAAqB,OAAOga,WAAW,CAAC9f,MAAZ,CAAmBtE,IAAnB,GAA0BnR,OAA1B,CAAkC,MAAlC,EAA0C,MAA1C,CAA5B;AACAoB,MAAAA,OAAO,CAAC8yB,MAAR,CAAe3Y,KAAf,CAAqB,MAArB;AACH;AACJ;;AACDuZ,EAAAA,GAAG,CAAC35B,EAAJ,CAAOi4B,UAAU,CAACC,UAAlB,EAA8B,CAAC;AAAEpqB,IAAAA,EAAF;AAAMwsB,IAAAA;AAAN,GAAD,KAAwB;AAClD,QAAIA,UAAJ,EAAgB;AACZP,MAAAA,aAAa,CAACtsB,GAAd,CAAkBjN,IAAI,CAACyK,QAAL,CAAcpJ,KAAd,EAAmBiM,EAAnB,CAAlB;AACH,KAFD,MAGK;AACDisB,MAAAA,aAAa,CAAC3Q,MAAd,CAAqB5oB,IAAI,CAACyK,QAAL,CAAcpJ,KAAd,EAAmBiM,EAAnB,CAArB;AACH;;AACDmsB,IAAAA,OAAO;AACV,GARD;AASAN,EAAAA,GAAG,CAAC35B,EAAJ,CAAOi4B,UAAU,CAACM,UAAlB,EAA8B,CAAC;AAAEzqB,IAAAA,EAAF;AAAMid,IAAAA;AAAN,GAAD,KAAiB;AAC3CiP,IAAAA,WAAW,CAAClsB,EAAD,CAAX;AACAgsB,IAAAA,eAAe,CAAChsB,EAAD,CAAf,CAAoBwM,MAApB,IAA8ByQ,GAA9B;AACAkP,IAAAA,OAAO;AACV,GAJD;AAKAN,EAAAA,GAAG,CAAC35B,EAAJ,CAAOi4B,UAAU,CAACQ,aAAlB,EAAiC,CAAC;AAAE3qB,IAAAA,EAAF;AAAMylB,IAAAA;AAAN,GAAD,KAAmB;AAChD,QAAI,OAAOA,KAAP,KAAiBxwB,SAArB,EAAgC;AAC5Bi3B,MAAAA,WAAW,CAAClsB,EAAD,CAAX;AACAgsB,MAAAA,eAAe,CAAChsB,EAAD,CAAf,CAAoBylB,KAApB,GAA4BA,KAA5B;AACH;;AACD0G,IAAAA,OAAO;AACV,GAND;AAOAN,EAAAA,GAAG,CAAC35B,EAAJ,CAAOi4B,UAAU,CAACK,eAAlB,EAAmC,CAAC;AAAExqB,IAAAA,EAAF;AAAMlP,IAAAA;AAAN,GAAD,KAAmB;AAClDk7B,IAAAA,eAAe,CAAChsB,EAAD,CAAf,CAAoBylB,KAApB,GAA4B,CAAC,MAAD,EAAS,OAAT,CAA5B;AACAuG,IAAAA,eAAe,CAAChsB,EAAD,CAAf,CAAoB2rB,IAApB,GAA2B,IAA3B;AACAK,IAAAA,eAAe,CAAChsB,EAAD,CAAf,CAAoBlP,KAApB,GAA4Bk7B,eAAe,CAAChsB,EAAD,CAAf,CAAoBlP,KAApB,IAA6BA,KAAzD;AACAq7B,IAAAA,OAAO;AACV,GALD;AAMAN,EAAAA,GAAG,CAAC35B,EAAJ,CAAOi4B,UAAU,CAACO,YAAlB,EAAgC,CAAC;AAAE1qB,IAAAA;AAAF,GAAD,KAAY;AACxCgsB,IAAAA,eAAe,CAAChsB,EAAD,CAAf,sBAA2B0rB,iBAA3B;AACAS,IAAAA,OAAO;AACV,GAHD;AAIAN,EAAAA,GAAG,CAAC35B,EAAJ,CAAOi4B,UAAU,CAACI,YAAlB,EAAiC35B,IAAD,IAAU;AACtCk7B,IAAAA,WAAW,GAAGl7B,IAAI,CAACk7B,WAAnB;AACAh0B,IAAAA,QAAQ,GAAGlH,IAAI,CAACkH,QAAhB;AACAC,IAAAA,IAAI,GAAGnH,IAAI,CAACmH,IAAZ;AACAF,IAAAA,QAAQ,GAAGjH,IAAI,CAACiH,QAAhB;AACAk0B,IAAAA,GAAG,GAAGn7B,IAAI,CAACm7B,GAAX;AACAI,IAAAA,OAAO;AACV,GAPD,EAvFgC;;AAgGhC95B,EAAAA,MAAM,CAACH,EAAP,CAAU,OAAV,EAAmB,MAAM;AACrBi6B,IAAAA,OAAO;AACV,GAFD;AAGA95B,EAAAA,MAAM,CAACH,EAAP,CAAU,MAAV,EAAkB,MAAM;AACpBi6B,IAAAA,OAAO;AACV,GAFD;AAGA95B,EAAAA,MAAM,CAACH,EAAP,CAAU,MAAV,EAAkB,MAAM;AACpBi6B,IAAAA,OAAO;AACV,GAFD;AAGA95B,EAAAA,MAAM,CAACH,EAAP,CAAU,OAAV,EAAmB,MAAM;AACrBi6B,IAAAA,OAAO;AACV,GAFD;AAGAA,EAAAA,OAAO;AACV;;AC/FD,MAAMM,2BAA2B,GAAG,CAACt4B,GAAD,EAAMioB,GAAN,EAAWsQ,GAAX,KAAmB;AACnD,QAAMC,MAAM,GAAGvQ,GAAG,CAACnkB,GAAnB;AACA5F,EAAAA,MAAM,CAACvB,KAAP,CAAc,KAAI67B,MAAO,KAAIx4B,GAAG,CAAC7C,OAAQ,EAAzC;AACAs7B,EAAAA,SAAS,CAACxQ,GAAD,EAAMsQ,GAAN,EAAW,GAAX,CAAT;AACH,CAJD;;AAKA,SAASG,WAAT,CAAqB3Q,UAArB,EAAiCE,GAAjC,EAAsC;AAClC,QAAM0Q,OAAO,GAAGC,SAAS,CAAC90B,GAAG,CAAC5D,KAAJ,CAAU+nB,GAAG,CAACnkB,GAAd,EAAmBiK,QAApB,CAAzB;AACA,SAAO4qB,OAAO,CAACz3B,UAAR,CAAmB6mB,UAAnB,CAAP;AACH;;AACD,MAAM8Q,QAAQ,GAAG,CAAC5Q,GAAD,EAAMsQ,GAAN,EAAW/tB,IAAX,EAAiB6F,OAAjB,EAA0B8R,GAAG,GAAG,OAAhC,KAA4C;AAAA;;AACzD3X,EAAAA,IAAI,GAAG0F,MAAM,CAACzJ,IAAP,CAAY+D,IAAZ,CAAP;AACA,QAAMsuB,IAAI,GAAGtzB,IAAI,CAACgF,IAAD,EAAO;AAAEuuB,IAAAA,IAAI,EAAE;AAAR,GAAP,CAAjB;AACA,QAAMC,WAAW,GAAGC,IAAI,CAACD,WAAL,CAAiB7W,GAAjB,CAApB;AACA,QAAM/gB,OAAO,GAAG;AACZ,qBAAiB,OADL;AAEZ,mCAA+B,GAFnB;AAGZ,oBAAgB43B,WAAW,IAAI,0BAHnB;AAIZF,IAAAA,IAJY;AAKZI,IAAAA,IAAI,EAAE;AALM,GAAhB;;AAOA,MAAIjR,GAAG,CAAC7mB,OAAJ,CAAY,eAAZ,MAAiC03B,IAArC,EAA2C;AACvCP,IAAAA,GAAG,CAACY,SAAJ,CAAc,GAAd,EAAmB/3B,OAAnB;AACAm3B,IAAAA,GAAG,CAACnK,GAAJ;AACA;AACH;;AACD,MAAIgL,cAAc,GAAGnR,GAAG,CAAC7mB,OAAJ,CAAY,iBAAZ,KAAkC,EAAvD;;AACA,MAAI,yBAAA6mB,GAAG,CAAC7mB,OAAJ,CAAY,eAAZ,+EAA8B8I,QAA9B,CAAuC,cAAvC,MACA,CAAC,MAAD,EAAS,SAAT,EAAoBA,QAApB,CAA6B+d,GAAG,CAACoR,MAAjC,CADA,IAEA,CAACL,WAFD,IAGA,CAACM,cAAc,CAACN,WAAD,CAHnB,EAGkC;AAC9BI,IAAAA,cAAc,GAAG,EAAjB;AACH,GAtBwD;;;AAwBzD,MAAI,WAAWr1B,IAAX,CAAgBq1B,cAAhB,KAAmCG,MAAM,CAACC,QAAP,CAAgB/yB,IAAvD,EAA6D;AACzD,UAAMgzB,UAAU,GAAGF,MAAM,CAACC,QAAP,CAAgB/yB,IAAhB,CAAqB,CAAC+D,IAAD,CAArB,CAAnB;AACApJ,IAAAA,OAAO,CAAC,kBAAD,CAAP,GAA8B,MAA9B;AACAm3B,IAAAA,GAAG,CAACY,SAAJ,CAAc,GAAd,EAAmB/3B,OAAnB;AACAm4B,IAAAA,MAAM,CAACG,QAAP,CAAgBD,UAAhB,EAA4BlqB,IAAI,CAACoqB,UAAL,EAA5B,EAA+CpB,GAA/C,EAAoD,SAASqB,OAAT,CAAiB55B,GAAjB,EAAsB;AACtE,UAAIA,GAAJ,EAAS;AACLu4B,QAAAA,GAAG,CAACnK,GAAJ;AACAlwB,QAAAA,MAAM,CAACvB,KAAP,CAAc,+BAA8Ba,WAAA,CAAYyqB,GAAG,CAACnkB,GAAhB,CAAqB,EAAjE;AACA5F,QAAAA,MAAM,CAACvB,KAAP,CAAa,OAAOqD,GAAP,KAAe,QAAf,GAA0BA,GAAG,CAACN,QAAJ,EAA1B,GAA2CM,GAAxD;AACH;AACJ,KAND;AAOA;AACH,GApCwD;;;AAsCzD,QAAM;AAAE65B,IAAAA;AAAF,MAAY5R,GAAG,CAAC7mB,OAAtB;;AACA,MAAIy4B,KAAJ,EAAW;AACP,UAAM;AAAE7qB,MAAAA,IAAI,EAAE8qB;AAAR,QAAqB7qB,WAAQ,CAACoB,OAAD,CAAnC;AACA,UAAM,CAAC0pB,UAAD,EAAaC,QAAb,IAAyBH,KAAK,CAACj3B,OAAN,CAAc,QAAd,EAAwB,EAAxB,EAA4BhB,KAA5B,CAAkC,GAAlC,CAA/B;AACA,UAAMusB,KAAK,GAAG8L,QAAQ,CAACF,UAAD,EAAa,EAAb,CAAtB;AACA,UAAM3L,GAAG,GAAG4L,QAAQ,GAAGC,QAAQ,CAACD,QAAD,EAAW,EAAX,CAAX,GAA4BF,QAAQ,GAAG,CAA3D;AACA,UAAMI,SAAS,GAAG9L,GAAG,GAAGD,KAAN,GAAc,CAAhC;AACA,UAAMgM,UAAU,GAAGC,mBAAgB,CAAC/pB,OAAD,EAAU;AAAE8d,MAAAA,KAAF;AAASC,MAAAA;AAAT,KAAV,CAAnC;AACAmK,IAAAA,GAAG,CAACY,SAAJ,CAAc,GAAd,oCACO/3B,OADP;AAEI,uBAAkB,SAAQ+sB,KAAM,IAAGC,GAAI,IAAG0L,QAAS,EAFvD;AAGI,wBAAkBI;AAHtB;AAKAC,IAAAA,UAAU,CAACE,IAAX,CAAgB9B,GAAhB;AACA;AACH;;AACDA,EAAAA,GAAG,CAACY,SAAJ,CAAc,GAAd,EAAmB/3B,OAAnB;AACAm3B,EAAAA,GAAG,CAACpa,KAAJ,CAAU3T,IAAV;AACA+tB,EAAAA,GAAG,CAACnK,GAAJ;AACH,CAzDD;;AA0DA,MAAMqK,SAAS,GAAG,CAACxQ,GAAD,EAAMsQ,GAAN,EAAW+B,MAAX,KAAsB;AACpC,QAAMtB,WAAW,GAAGC,IAAI,CAACD,WAAL,CAAiBz6B,IAAI,CAACkJ,OAAL,CAAawgB,GAAG,CAACnkB,GAAjB,KAAyB,OAA1C,CAApB;AACA,QAAM1C,OAAO,GAAG;AACZ,mCAA+B,GADnB;AAEZ,qBAAiB,OAFL;AAGZ,oBAAgB43B,WAAW,IAAI,0BAHnB;AAIZE,IAAAA,IAAI,EAAE;AAJM,GAAhB;AAMAX,EAAAA,GAAG,CAACY,SAAJ,CAAcmB,MAAd,EAAsBl5B,OAAtB;AACAm3B,EAAAA,GAAG,CAACnK,GAAJ;AACH,CAVD;;AAWA,SAASmM,cAAT,CAAwBpG,kBAAxB,EAA4C9jB,OAA5C,EAAqD9J,MAArD,EAA6D;AACzD,OAAK,MAAM,CAACqP,OAAD,EAAU4kB,MAAV,CAAX,IAAgCrG,kBAAhC,EAAoD;AAChD,QAAI9jB,OAAO,CAACnP,UAAR,CAAmB0U,OAAO,GAAGrX,IAAI,CAACoE,GAAlC,CAAJ,EAA4C;AACxC,YAAM;AAAE6E,QAAAA;AAAF,UAAcF,MAAM,CAAC+I,OAAD,CAA1B;AACA,YAAMoqB,cAAc,GAAGD,MAAM,KAAK,GAAX,GAAiB,EAAjB,GAAsBA,MAA7C;AACA,aAAO3yB,UAAU,CAACwI,OAAO,CAACzN,OAAR,CAAgBgT,OAAhB,EAAyB6kB,cAAzB,EAAyC73B,OAAzC,CAAiD,SAAjD,EAA4D,GAA5D,CAAD,EAAmE4E,OAAnE,EAA4EjB,MAAM,CAACsiB,aAAP,CAAqBrhB,OAArB,KAAiC6d,uBAAuB,CAAC7d,OAAD,CAAxD,IAAqEA,OAAjJ,CAAjB;AACH;AACJ;;AACD,SAAO,IAAP;AACH;;AACD,AAAO,eAAenD,SAAf,CAAuB0a,cAAvB,EAAuC;AAC1C,QAAM;AAAEnf,IAAAA,GAAF;AAAO2G,IAAAA;AAAP,MAAkBwY,cAAxB;AACA,QAAM;AAAEnb,IAAAA,IAAI,EAAE8yB,WAAR;AAAqB/yB,IAAAA,QAArB;AAA+BoB,IAAAA;AAA/B,MAAwCwB,MAAM,CAAC+c,UAArD;AACA,QAAMoX,KAAK,GAAG,OAAOn0B,MAAM,CAAC+c,UAAP,CAAkBhD,GAAzB,KAAiC,WAAjC,GAA+C/Z,MAAM,CAAC+c,UAAP,CAAkBhD,GAAjE,GAAuE,IAArF,CAH0C;;AAK1C,MAAIqa,WAAW,GAAGxb,sBAAW,CAACC,GAAZ,EAAlB;AACA,QAAMxb,IAAI,GAAG,MAAM6yB,OAAO,CAACC,WAAD,CAA1B,CAN0C;;AAQ1C,MAAI9yB,IAAI,KAAK8yB,WAAb,EAA0B;AACtBiE,IAAAA,WAAW,GAAGxb,sBAAW,CAACC,GAAZ,EAAd;AACH;;AACD,QAAMwb,UAAU,GAAG,IAAIC,mBAAJ,EAAnB,CAX0C;;AAa1Cz9B,EAAAA,OAAO,CAACC,GAAR,GAAc,CAAC,GAAGy9B,IAAJ,KAAa;AACvB58B,IAAAA,MAAM,CAACzB,IAAP,CAAYwhB,IAAI,CAACL,MAAL,CAAY,GAAGkd,IAAf,CAAZ;AACH,GAFD;;AAGA19B,EAAAA,OAAO,CAACV,IAAR,GAAe,CAAC,GAAGo+B,IAAJ,KAAa;AACxB58B,IAAAA,MAAM,CAACxB,IAAP,CAAYuhB,IAAI,CAACL,MAAL,CAAY,GAAGkd,IAAf,CAAZ;AACH,GAFD;;AAGA19B,EAAAA,OAAO,CAACT,KAAR,GAAgB,CAAC,GAAGm+B,IAAJ,KAAa;AACzB58B,IAAAA,MAAM,CAACvB,KAAP,CAAashB,IAAI,CAACL,MAAL,CAAY,GAAGkd,IAAf,CAAb;AACH,GAFD;;AAGArD,EAAAA,KAAK,CAACmD,UAAD,EAAar0B,MAAM,CAAC8V,OAAP,CAAe/T,GAAf,CAAoByI,CAAD,IAAOA,CAAC,CAACzT,IAA5B,CAAb,CAAL;AACA,QAAMy9B,kBAAkB,GAAG,IAAIzL,GAAJ,EAA3B;AACA,QAAM0L,iBAAiB,GAAG,IAAI/tB,GAAJ,EAA1B;AACA,QAAMguB,eAAe,GAAG,IAAI3L,GAAJ,EAAxB;AACA,QAAM6E,kBAAkB,GAAG1zB,MAAM,CAACkG,OAAP,CAAeJ,MAAM,CAACmP,KAAtB,EAA6BpN,GAA7B,CAAiC,CAAC,CAACqN,QAAD,EAAWgS,KAAX,CAAD,KAAuB;AAC/E,WAAO,CAACppB,IAAI,CAAC8D,OAAL,CAAazC,GAAb,EAAkB+V,QAAlB,CAAD,EAA8BgS,KAA9B,CAAP;AACH,GAF0B,CAA3B,CA1B0C;;AA8B1C,QAAMuT,sBAAsB,GAAG38B,IAAI,CAACC,IAAL,CAAUI,oBAAV,EAAgC,iBAAhC,CAA/B;AACAV,EAAAA,MAAM,CAAC1B,KAAP,CAAc,uBAAsB+B,IAAI,CAACyK,QAAL,CAAcpJ,GAAd,EAAmBhB,oBAAnB,CAAyC,EAA7E;AACA,QAAMu8B,qBAAqB,GAAGxQ,cAAK,CAAC5L,cAAD,EAAiB;AAChDxY,IAAAA,MAAM,EAAE;AACJoU,MAAAA,cAAc,EAAE;AACZC,QAAAA,IAAI,EAAEhc,oBADM;AAEZmT,QAAAA,GAAG,EAAE;AAAEmI,UAAAA,QAAQ,EAAElW,OAAO,CAAC+N,GAAR,CAAYmI,QAAZ,IAAwB;AAApC,SAFO;AAGZiB,QAAAA,SAAS,EAAE;AAHC;AADZ;AADwC,GAAjB,CAAnC,CAhC0C;;AA0C1C,MAAI,EAAE,MAAMjW,iBAAiB,CAACtG,oBAAD,CAAzB,KAAoD,CAACmQ,aAAU,CAACmsB,sBAAD,CAAnE,EAA6F;AACzFh9B,IAAAA,MAAM,CAAC1B,KAAP,CAAa,yCAAb;AACA0B,IAAAA,MAAM,CAACzB,IAAP,CAAYe,aAAA,CAAc,4BAAd,CAAZ;AACA,UAAMsiB,OAAc,CAACqb,qBAAD,CAApB;AACA,UAAMx1B,kBAAkB,CAAC/G,oBAAD,CAAxB;AACH,GALD,MAMK;AACDV,IAAAA,MAAM,CAAC1B,KAAP,CAAc,wCAAd;AACH;;AACD,MAAIqxB,mBAAmB,GAAG;AAAEttB,IAAAA,OAAO,EAAE;AAAX,GAA1B;;AACA,MAAI;AACAstB,IAAAA,mBAAmB,GAAG5tB,IAAI,CAACC,KAAL,CAAW,MAAMZ,WAAE,CAACH,QAAH,CAAY+7B,sBAAZ,EAAoC;AAAEn7B,MAAAA,QAAQ,EAAE;AAAZ,KAApC,CAAjB,CAAtB;AACH,GAFD,CAGA,OAAOC,GAAP,EAAY;AAEX;;AACD,QAAMo7B,UAAU,GAAG,EAAnB;AACA70B,EAAAA,MAAM,CAAC8d,KAAP,CAAapI,OAAb,CAAqB,CAAC,CAAC8L,UAAD,EAAasT,YAAb,CAAD,KAAgC;AACjD,UAAMC,WAAW,GAAIF,UAAU,CAACrT,UAAD,CAAV,GAAyBwT,SAAS,CAACC,iBAAV,CAA4BH,YAA5B,CAA9C;;AACA,SAAK,MAAM,CAACI,WAAD,EAAcC,YAAd,CAAX,IAA0Cj7B,MAAM,CAACkG,OAAP,CAAe00B,YAAY,CAACt9B,EAA5B,CAA1C,EAA2E;AACvEu9B,MAAAA,WAAW,CAACv9B,EAAZ,CAAe09B,WAAf,EAA4BC,YAA5B;AACH;;AACD,QAAI,CAACL,YAAY,CAACt9B,EAAb,CAAgBpB,KAArB,EAA4B;AACxB2+B,MAAAA,WAAW,CAACv9B,EAAZ,CAAe,OAAf,EAAwBu6B,2BAAxB;AACH;;AACDp6B,IAAAA,MAAM,CAACzB,IAAP,CAAa,kBAAiBsrB,UAAW,OAAMsT,YAAY,CAAC9mB,MAAb,IAAuB8mB,YAAY,CAACM,OAAQ,EAA3F;AACH,GATD;;AAUA,QAAMC,eAAe,GAAG,MAAOh8B,GAAP,IAAe;AACnC,UAAM,CAACi8B,IAAD,EAAOr7B,GAAP,IAAc,MAAMwF,OAAO,CAACC,GAAR,CAAY,CAClC3G,WAAE,CAACH,QAAH,CAAYZ,IAAI,CAACC,IAAL,CAAUoB,GAAV,EAAe,cAAf,CAAZ,CADkC,EAElCN,WAAE,CAACH,QAAH,CAAYZ,IAAI,CAACC,IAAL,CAAUoB,GAAV,EAAe,cAAf,CAAZ,CAFkC,CAAZ,CAA1B;AAIA,WAAO;AACHi8B,MAAAA,IADG;AAEHr7B,MAAAA;AAFG,KAAP;AAIH,GATD;;AAUA,MAAIs7B,WAAJ;;AACA,MAAIv1B,MAAM,CAAC+c,UAAP,CAAkBC,MAAtB,EAA8B;AAC1B,QAAI;AACAuY,MAAAA,WAAW,GAAG,MAAMF,eAAe,CAACh8B,GAAD,CAAnC;AACH,KAFD,CAGA,OAAOyT,CAAP,EAAU;AACNnV,MAAAA,MAAM,CAACvB,KAAP,CAAc,iDAAgDa,WAAA,CAAY,cAAZ,CAA4B,KAAIA,WAAA,CAAY,cAAZ,CAA4B,EAA1H;AACAU,MAAAA,MAAM,CAACzB,IAAP,CAAa;;MAEnBe,WAAA,CAAY,SAAZ,CAAuB,KAAIA,aAAA,CAAc,oCAAd,CAAoD;;;MAG/EA,WAAA,CAAY,QAAZ,CAAsB,KAAIA,aAAA,CAAc,oFAAd,CAAoG;;6DALxH;AAQAwG,MAAAA,OAAO,CAACiG,IAAR,CAAa,CAAb;AACH;AACJ;;AACD,OAAK,MAAMmqB,SAAX,IAAwB7tB,MAAM,CAAC8V,OAA/B,EAAwC;AACpC,QAAI+X,SAAS,CAACpV,GAAd,EAAmB;AACfoV,MAAAA,SAAS,CACJpV,GADL,CACS;AACLwB,QAAAA,KAAK,EAAE,IADF;AAEL6L,QAAAA,YAAY,EAAEqO,KAFT;AAGL;AACAr9B,QAAAA,GAAG,EAAE,CAACyrB,GAAD,EAAMzpB,IAAN,KAAe;AAChBu7B,UAAAA,UAAU,CAAC3K,IAAX,CAAgBnH,GAAhB,oCAA0BzpB,IAA1B;AAAgCwM,YAAAA,EAAE,EAAEuoB,SAAS,CAAC92B;AAA9C;AACH;AANI,OADT,EASKmP,IATL,CASU,MAAM;AACZvO,QAAAA,MAAM,CAACzB,IAAP,CAAY,oBAAZ,EAAkC;AAAEa,UAAAA,IAAI,EAAE82B,SAAS,CAAC92B;AAAlB,SAAlC;AACH,OAXD,EAYKoI,KAZL,CAYY1F,GAAD,IAAS;AAChB9B,QAAAA,MAAM,CAACvB,KAAP,CAAc,mCAAkCqD,GAAI,EAApD,EAAuD;AAAE1C,UAAAA,IAAI,EAAE82B,SAAS,CAAC92B;AAAlB,SAAvD;AACA0G,QAAAA,OAAO,CAACiG,IAAR,CAAa,CAAb;AACH,OAfD;AAgBH;AACJ;;AACD,iBAAe8xB,cAAf,CAA8B9T,GAA9B,EAAmCsQ,GAAnC,EAAwC;AACpC,UAAMC,MAAM,GAAGvQ,GAAG,CAACnkB,GAAnB;AACA,UAAMk4B,cAAc,GAAGxD,MAAM,CAACtuB,QAAP,CAAgB,SAAhB,KAA8BsuB,MAAM,CAAC52B,KAAP,CAAa,GAAb,EAAkB,CAAlB,CAArD;AACA,QAAI+2B,OAAO,GAAGC,SAAS,CAAC90B,GAAG,CAAC5D,KAAJ,CAAUs4B,MAAV,EAAkBzqB,QAAnB,CAAvB;AACA,UAAMkuB,eAAe,GAAGtD,OAAxB;AACA,QAAIuD,aAAa,GAAG,KAApB;AACA,QAAIC,WAAW,GAAG,KAAlB;;AACA,QAAIxD,OAAO,CAACpsB,QAAR,CAAiB,WAAjB,CAAJ,EAAmC;AAC/B2vB,MAAAA,aAAa,GAAG,IAAhB;AACAvD,MAAAA,OAAO,GAAG9wB,UAAU,CAAC8wB,OAAD,EAAU,WAAV,EAAuB,EAAvB,CAApB;AACH,KAHD,MAIK,IAAIA,OAAO,CAACpsB,QAAR,CAAiB,MAAjB,CAAJ,EAA8B;AAC/B4vB,MAAAA,WAAW,GAAG,IAAd;AACAxD,MAAAA,OAAO,GAAG9wB,UAAU,CAAC8wB,OAAD,EAAU,MAAV,EAAkB,EAAlB,CAApB;AACH;;AACDJ,IAAAA,GAAG,CAACx6B,EAAJ,CAAO,QAAP,EAAiB,MAAM;AACnB,YAAM;AAAEs7B,QAAAA,MAAF;AAAUv1B,QAAAA;AAAV,UAAkBmkB,GAAxB;AACA,YAAM;AAAE1d,QAAAA;AAAF,UAAiBguB,GAAvB;;AACA,UAAIhuB,UAAU,KAAK,GAAnB,EAAwB;AACpBqwB,QAAAA,UAAU,CAAC3K,IAAX,CAAgB+F,UAAU,CAACG,eAA3B,EAA4C;AACxCkD,UAAAA,MADwC;AAExCv1B,UAAAA,GAFwC;AAGxCyG,UAAAA;AAHwC,SAA5C;AAKH;AACJ,KAVD;;AAWA,QAAIouB,OAAO,KAAK3Y,cAAc,CAAC,SAAD,EAAYzZ,MAAZ,CAA9B,EAAmD;AAC/CsyB,MAAAA,QAAQ,CAAC5Q,GAAD,EAAMsQ,GAAN,EAAW9uB,eAAX,EAA4BkvB,OAA5B,EAAqC,KAArC,CAAR;AACA;AACH;;AACD,QAAIA,OAAO,KAAK3Y,cAAc,CAAC,SAAD,EAAYzZ,MAAZ,CAA9B,EAAmD;AAC/CsyB,MAAAA,QAAQ,CAAC5Q,GAAD,EAAMsQ,GAAN,EAAW5W,iBAAiB,CAAC,aAAD,CAA5B,EAA6CgX,OAA7C,EAAsD,KAAtD,CAAR;AACA;AACH;;AACD,SAAK,MAAM,CAAC5Q,UAAD,CAAX,IAA2BxhB,MAAM,CAAC8d,KAAlC,EAAyC;AACrC,UAAI,CAACqU,WAAW,CAAC3Q,UAAD,EAAaE,GAAb,CAAhB,EAAmC;AAC/B;AACH;;AACDmT,MAAAA,UAAU,CAACrT,UAAD,CAAV,CAAuBqU,GAAvB,CAA2BnU,GAA3B,EAAgCsQ,GAAhC;AACA;AACH;;AACD,UAAM8D,kBAAkB,GAAG,EAA3B;;AACA,aAASC,eAAT,CAAyBC,aAAzB,EAAwC;AACpC,UAAIF,kBAAkB,CAACnyB,QAAnB,CAA4BqyB,aAA5B,CAAJ,EAAgD;AAC5C,eAAOv2B,OAAO,CAAC3D,OAAR,CAAgB,IAAhB,CAAP;AACH;;AACDg6B,MAAAA,kBAAkB,CAAC5+B,IAAnB,CAAwB8+B,aAAxB;AACA,aAAOj9B,WAAE,CACJmqB,IADE,CACG8S,aADH,EAEF9vB,IAFE,CAEIgd,IAAD,IAAWA,IAAI,CAAC+S,MAAL,KAAgBD,aAAhB,GAAgC,IAF9C,EAGF72B,KAHE,CAGI,MAAM;AAAK;AAHf,OAAP;AAIH;;AACD,QAAI62B,aAAa,GAAGh+B,IAAI,CAAC2B,KAAL,CAAWy4B,OAAX,CAApB;AACA,QAAI8D,gBAAgB,GAAGF,aAAa,CAACpa,GAAd,CAAkB6C,WAAlB,EAAvB;AACA,QAAI0X,eAAe,GAAGD,gBAAtB;AACA,QAAIE,OAAO,GAAG,CAACF,gBAAD,IAAqBA,gBAAgB,KAAK,OAAxD,CAvDoC;;AAyDpCA,IAAAA,gBAAgB,GAAGA,gBAAgB,IAAI,OAAvC;;AACA,mBAAeG,cAAf,CAA8BjE,OAA9B,EAAuC;AACnC,UAAIA,OAAO,CAACz3B,UAAR,CAAmBqF,MAAM,CAAC4Z,YAAP,CAAoBuD,aAAvC,CAAJ,EAA2D;AACvD,cAAMrT,OAAO,GAAG,MAAMisB,eAAe,CAAC3D,OAAO,CAAC/1B,OAAR,CAAgB2D,MAAM,CAAC4Z,YAAP,CAAoBuD,aAApC,EAAmD9kB,oBAAnD,CAAD,CAArC;;AACA,YAAIyR,OAAJ,EAAa;AACT,iBAAOA,OAAP;AACH;AACJ;;AACD,WAAK,MAAM,CAACuF,OAAD,EAAU4kB,MAAV,CAAX,IAAgCrG,kBAAhC,EAAoD;AAChD,YAAIoI,aAAJ;;AACA,YAAI/B,MAAM,KAAK,GAAf,EAAoB;AAChB+B,UAAAA,aAAa,GAAGh+B,IAAI,CAACC,IAAL,CAAUoX,OAAV,EAAmB+iB,OAAnB,CAAhB;AACH,SAFD,MAGK,IAAIA,OAAO,CAACz3B,UAAR,CAAmBs5B,MAAnB,CAAJ,EAAgC;AACjC+B,UAAAA,aAAa,GAAGh+B,IAAI,CAACC,IAAL,CAAUoX,OAAV,EAAmB+iB,OAAO,CAAC/1B,OAAR,CAAgB43B,MAAhB,EAAwB,IAAxB,CAAnB,CAAhB;AACH,SAFI,MAGA;AACD;AACH;;AACD,YAAImC,OAAJ,EAAa;AACT,cAAItsB,OAAO,GAAG,CAAC,MAAMisB,eAAe,CAACC,aAAD,CAAtB,MACT,MAAMD,eAAe,CAACC,aAAa,GAAG,OAAjB,CADZ,MAET,MAAMD,eAAe,CAACC,aAAa,GAAG,YAAjB,CAFZ,MAGT,MAAMD,eAAe,CAACC,aAAa,GAAG,aAAjB,CAHZ,CAAd;;AAIA,cAAI,CAAClsB,OAAD,IAAYmqB,MAAM,KAAK,GAAvB,IAA8Bj0B,MAAM,CAAC+c,UAAP,CAAkBG,QAApD,EAA8D;AAC1D,kBAAMoZ,YAAY,GAAGt+B,IAAI,CAACC,IAAL,CAAUoX,OAAV,EAAmBrP,MAAM,CAAC+c,UAAP,CAAkBG,QAArC,CAArB;AACApT,YAAAA,OAAO,GAAG,MAAMisB,eAAe,CAACO,YAAD,CAA/B;AACH;;AACD,cAAIxsB,OAAJ,EAAa;AACTqsB,YAAAA,eAAe,GAAG,OAAlB;AACA,mBAAOrsB,OAAP;AACH;AACJ,SAbD,MAcK;AACD,eAAK,MAAMysB,mBAAX,IAAkC9Q,mBAAmB,CAACuQ,aAAD,EAAgBh2B,MAAM,CAAC8V,OAAvB,CAArD,EAAsF;AAClF,kBAAMhM,OAAO,GAAG,MAAMisB,eAAe,CAACQ,mBAAD,CAArC;;AACA,gBAAIzsB,OAAJ,EAAa;AACT,qBAAOA,OAAP;AACH;AACJ;AACJ;AACJ;;AACD,aAAO,IAAP;AACH;;AACD,UAAMA,OAAO,GAAG,MAAMusB,cAAc,CAACjE,OAAD,CAApC;;AACA,QAAI,CAACtoB,OAAL,EAAc;AACV,YAAM0sB,MAAM,GAAGv/B,UAAA,CAAW,MAAX,CAAf;AACAU,MAAAA,MAAM,CAACvB,KAAP,CAAc,SAAQ67B,MAAO,KAAI6D,kBAAkB,CAAC/zB,GAAnB,CAAwBlI,GAAD,IAAS28B,MAAM,GAAG38B,GAAzC,EAA8C5B,IAA9C,CAAmD,IAAnD,CAAyD,EAA1F;AACA,aAAOi6B,SAAS,CAACxQ,GAAD,EAAMsQ,GAAN,EAAW,GAAX,CAAhB;AACH;AACD;;;;;;;AAKA,mBAAerL,WAAf,CAAyB7c,OAAzB,EAAkC;AAC9B,YAAM2sB,sBAAsB,GAAG/B,eAAe,CAAC7wB,GAAhB,CAAoBiG,OAApB,CAA/B;;AACA,UAAI2sB,sBAAJ,EAA4B;AACxB,eAAOA,sBAAP;AACH;;AACD,YAAMC,kBAAkB,GAAG,CAAC,YAAY;AACpC,cAAMtK,eAAe,GAAG,MAAMuK,SAAU,CAAC7sB,OAAD,EAAU;AAC9CgM,UAAAA,OAAO,EAAE9V,MAAM,CAAC8V,OAD8B;AAE9CmE,UAAAA,KAAK,EAAE,IAFuC;AAG9C8L,UAAAA,aAAa,EAAE,KAH+B;AAI9CD,UAAAA,YAAY,EAAEqO,KAJgC;AAK9C3X,UAAAA,UAAU,EAAExc,MAAM,CAAC4Z,YAAP,CAAoB4C;AALc,SAAV,CAAxC;AAOAgY,QAAAA,kBAAkB,CAAClK,GAAnB,CAAuBxgB,OAAvB,EAAgCsiB,eAAhC;AACA,eAAOA,eAAP;AACH,OAV0B,GAA3B;;AAWAsI,MAAAA,eAAe,CAACpK,GAAhB,CAAoBxgB,OAApB,EAA6B4sB,kBAA7B;;AACA,UAAI;AACArC,QAAAA,UAAU,CAAC3K,IAAX,CAAgB+F,UAAU,CAACC,UAA3B,EAAuC;AAAEpqB,UAAAA,EAAE,EAAEwE,OAAN;AAAegoB,UAAAA,UAAU,EAAE;AAA3B,SAAvC;AACA,eAAO,MAAM4E,kBAAb;AACH,OAHD,SAIQ;AACJhC,QAAAA,eAAe,CAAC9T,MAAhB,CAAuB9W,OAAvB;AACAuqB,QAAAA,UAAU,CAAC3K,IAAX,CAAgB+F,UAAU,CAACC,UAA3B,EAAuC;AAAEpqB,UAAAA,EAAE,EAAEwE,OAAN;AAAegoB,UAAAA,UAAU,EAAE;AAA3B,SAAvC;AACH;AACJ;AACD;;;;;;;AAKA,mBAAe8E,YAAf,CAA4B56B,IAA5B,EAAkC;AAAE66B,MAAAA,cAAF;AAAkBpiB,MAAAA,SAAlB;AAA6BxS,MAAAA;AAA7B,KAAlC,EAAoF;AAChF;AACA,UAAIm0B,OAAJ,EAAa;AACTp6B,QAAAA,IAAI,GAAGge,gBAAgB,CAAC;AACpBhe,UAAAA,IAAI,EAAEA,IADc;AAEpB+d,UAAAA,GAAG,EAAEoa,KAFe;AAGpBla,UAAAA,KAAK,EAAE,IAHa;AAIpBja,UAAAA,MAJoB;AAKpBka,UAAAA,IAAI,EAAE;AALc,SAAD,CAAvB;AAOH,OARD,MASK,IAAIyb,aAAJ,EAAmB;AACpBQ,QAAAA,eAAe,GAAG,KAAlB;AACH,OAFI,MAGA,IAAIP,WAAW,IAAInhB,SAAnB,EAA8B;AAC/B0hB,QAAAA,eAAe,GAAG,MAAlB;AACAn6B,QAAAA,IAAI,GAAGyY,SAAP;AACH,OAjB+E;;;AAmBhF,cAAQ0hB,eAAR;AACI,aAAK,MAAL;AAAa;AACT,gBAAI1hB,SAAJ,EACIzY,IAAI,GAAGgG,mBAAmB,CAAChG,IAAD,EAAOiG,gBAAP,CAA1B;AACJ;AACH;;AACD,aAAK,KAAL;AAAY;AACR,gBAAI0zB,aAAJ,EAAmB;AACf35B,cAAAA,IAAI,GAAG,MAAMkf,eAAe,CAAC;AAAE3d,gBAAAA,GAAG,EAAE60B,OAAP;AAAgBp2B,gBAAAA,IAAhB;AAAsB+d,gBAAAA,GAAG,EAAEoa,KAA3B;AAAkCn0B,gBAAAA;AAAlC,eAAD,CAA5B;AACH,aAFD,MAGK;AACDhE,cAAAA,IAAI,GAAG8d,cAAc,CAAC;AAAE9d,gBAAAA,IAAI,EAAEA,IAAR;AAAcwP,gBAAAA,GAAG,EAAE,IAAnB;AAAyBuO,gBAAAA,GAAG,EAAEoa,KAA9B;AAAqCn0B,gBAAAA;AAArC,eAAD,CAArB;AACH;;AACD,gBAAI62B,cAAJ,EACI76B,IAAI,GACC,aAAYhE,IAAI,CAACqJ,QAAL,CAAc+wB,OAAd,EAAuB/1B,OAAvB,CAA+B,MAA/B,EAAuC,eAAvC,CAAwD,MAArE,GAA6EL,IADjF,CARI;;AAWR,gBAAIyY,SAAJ,EACIzY,IAAI,GAAGkG,kBAAkB,CAAClG,IAAD,EAAOiG,gBAAP,CAAzB;AACJ;AACH;AApBL,OAnBgF;;;AA0ChF,aAAOjG,IAAP;AACH;AACD;;;;;;AAIA,mBAAe86B,sBAAf,CAAsChtB,OAAtC,EAA+CitB,WAA/C,EAA4DC,eAA5D,EAA6E;AACzE,YAAMpK,sBAAsB,GAAGvF,oBAAoB,CAAC;AAChDvd,QAAAA,OADgD;AAEhDwd,QAAAA,mBAFgD;AAGhDtnB,QAAAA;AAHgD,OAAD,CAAnD;AAKAg3B,MAAAA,eAAe,GAAG,MAAMtO,oBAAoB,CAAC;AACzCva,QAAAA,SAAS,EAAErE,OAD8B;AAEzCjB,QAAAA,QAAQ,EAAEmuB,eAF+B;AAGzC/1B,QAAAA,OAAO,EAAE81B,WAHgC;AAIzC31B,QAAAA,WAAW,EAAEL,MAAM,CAAC+I,OAAD,CAAN,CAAgB1I;AAJY,OAAD,EAKxCnB,IAAD,IAAU;AACT;AACA,cAAM6sB,iBAAiB,GAAGF,sBAAsB,CAAC3sB,IAAD,CAAhD;;AACA,YAAI6sB,iBAAJ,EAAuB;AACnB;AACA,cAAIvvB,GAAG,CAAC5D,KAAJ,CAAUmzB,iBAAV,EAA6B3vB,QAAjC,EAA2C;AACvC,mBAAO2vB,iBAAP;AACH,WAJkB;;;AAMnB,gBAAMmK,OAAO,GAAGj/B,IAAI,CAACkJ,OAAL,CAAa4rB,iBAAb,CAAhB;;AACA,cAAImK,OAAO,KACNF,WAAW,KAAK,KAAhB,IAAyBA,WAAW,KAAK,OADnC,CAAP,IAEAE,OAAO,KAAK,KAFhB,EAEuB;AACnB,mBAAOnK,iBAAiB,GAAG,WAA3B;AACH;;AACD,iBAAOA,iBAAP;AACH;;AACDn1B,QAAAA,MAAM,CAACvB,KAAP,CAAc,WAAU6J,IAAK;qDACQhJ,WAAA,CAAY,UAAZ,CAAwB;0DACnBA,WAAA,CAAa,gBAAegJ,IAAK,IAAjC,CAAsC,gCAFhF;AAGA,eAAOA,IAAP;AACH,OA1B2C,CAA5C;AA2BA,UAAIjE,IAAI,GAAGg7B,eAAX;AACA,UAAIb,eAAe,KAAK,KAApB,IAA6BV,cAAjC,EACIz5B,IAAI,GAAG,MAAM+rB,mBAAmB,CAAC/rB,IAAD,EAAQb,GAAD,IAAS;AAC5C,cAAMoX,SAAS,GAAGva,IAAI,CAACoT,KAAL,CAAWtP,OAAX,CAAmB9D,IAAI,CAACoT,KAAL,CAAW9L,OAAX,CAAmB8yB,OAAnB,CAAnB,EAAgDj3B,GAAhD,CAAlB;AACA,cAAM+7B,IAAI,GAAGzL,SAAS,CAAC3B,QAAV,CAAmBvX,SAAnB,CAAb;;AACA,YAAI2kB,IAAI,IAAIA,IAAI,CAAC9M,gBAAjB,EAAmC;AAC/BqB,UAAAA,SAAS,CAACX,uBAAV,CAAkCoM,IAAlC,EAAwC,KAAxC;AACA,iBAAQ,GAAE/7B,GAAI,IAAGs6B,cAAe,EAAhC;AACH;;AACD,eAAOt6B,GAAP;AACH,OAR+B,CAAhC;;AASJ,UAAIg7B,eAAe,KAAK,KAAxB,EAA+B;AAC3B,cAAMrQ,YAAY,GAAG9pB,IAAI,CAAC2H,QAAL,CAAc,iBAAd,CAArB;AACA,cAAMwzB,UAAU,GAAG,MAAMrP,sBAAsB,CAAC9rB,IAAD,CAA/C;AACA,cAAMo7B,eAAe,GAAGD,UAAU,CAACp1B,GAAX,CAAgB5G,GAAD,IAAS;AAC5C,cAAI8E,IAAI,GAAGjE,IAAI,CAACS,SAAL,CAAetB,GAAG,CAAC0R,CAAnB,EAAsB1R,GAAG,CAAC2R,CAA1B,CAAX;;AACA,cAAI3R,GAAG,CAACyR,CAAJ,GAAQ,CAAC,CAAb,EAAgB;AACZ3M,YAAAA,IAAI,GAAGsM,uBAAuB,CAACtM,IAAD,CAAvB,IAAiC,EAAxC;AACH;;AACDA,UAAAA,IAAI,GAAGA,IAAI,CAAC5D,OAAL,CAAa,iBAAb,EAAgC,EAAhC,CAAP;AACA,iBAAOrE,IAAI,CAACoT,KAAL,CAAWtP,OAAX,CAAmB9D,IAAI,CAACoT,KAAL,CAAW9L,OAAX,CAAmB8yB,OAAnB,CAAnB,EAAgDnyB,IAAhD,CAAP;AACH,SAPuB,CAAxB;AAQAwrB,QAAAA,SAAS,CAACjB,QAAV,CAAmBkL,eAAnB,EAAoC0B,eAApC,EAAqDtR,YAArD;AACH;;AACDkR,MAAAA,eAAe,GAAGh7B,IAAlB;AACA,aAAOg7B,eAAP;AACH;AACD;;;;;;;;AAMA,mBAAeK,gBAAf,CAAgCvtB,OAAhC,EAAyCosB,gBAAzC,EAA2DpkB,MAA3D,EAAmE;AAC/D;AACA,UAAI,CAACA,MAAM,CAACokB,gBAAD,CAAP,IAA6B,CAACh8B,MAAM,CAACC,IAAP,CAAY2X,MAAZ,CAAlC,EAAuD;AACnD,eAAO,IAAP;AACH;;AACD,YAAM;AAAE9V,QAAAA,IAAF;AAAQ+F,QAAAA;AAAR,UAAgB+P,MAAM,CAACokB,gBAAD,CAA5B;AACA,UAAIoB,aAAa,GAAGt7B,IAApB,CAN+D;;AAQ/D,YAAMu7B,cAAc,GAAGrB,gBAAgB,KAAK,KAArB,IAA8B,CAAC,CAACpkB,MAAM,CAAC,MAAD,CAA7D;AACAwlB,MAAAA,aAAa,GAAG,MAAMV,YAAY,CAACU,aAAD,EAAgB;AAC9CT,QAAAA,cAAc,EAAEU,cAD8B;AAE9C9iB,QAAAA,SAAS,EAAE1S,GAFmC;AAG9CE,QAAAA,gBAAgB,EAAEjK,IAAI,CAACqJ,QAAL,CAAc20B,aAAa,CAACwB,IAA5B,IAAoC;AAHR,OAAhB,CAAlC,CAT+D;;AAe/D,UAAItB,gBAAgB,KAAK,KAArB,IACAA,gBAAgB,KAAK,OADrB,IAEAA,gBAAgB,KAAK,MAFzB,EAEiC;AAC7BoB,QAAAA,aAAa,GAAG,MAAMR,sBAAsB,CAAChtB,OAAD,EAAUosB,gBAAV,EAA4BoB,aAA5B,CAA5C;AACH,OAnB8D;;;AAqB/D,aAAOA,aAAP;AACH,KAvRmC;;;AAyRpC,QAAIG,iBAAiB,GAAGjD,kBAAkB,CAAC3wB,GAAnB,CAAuBiG,OAAvB,CAAxB;;AACA,QAAI2tB,iBAAJ,EAAuB;AACnB,YAAMC,eAAe,GAAG,MAAML,gBAAgB,CAACvtB,OAAD,EAAUosB,gBAAV,EAA4BuB,iBAA5B,CAA9C;;AACA,UAAI,CAACC,eAAL,EAAsB;AAClBxF,QAAAA,SAAS,CAACxQ,GAAD,EAAMsQ,GAAN,EAAW,GAAX,CAAT;AACA;AACH;;AACDM,MAAAA,QAAQ,CAAC5Q,GAAD,EAAMsQ,GAAN,EAAW0F,eAAX,EAA4B5tB,OAA5B,EAAqCqsB,eAArC,CAAR;AACA;AACH,KAlSmC;;;AAoSpC,UAAMwB,YAAY,GAAG,MAAM/+B,QAAQ,CAACkR,OAAD,CAAnC,CApSoC;;AAsSpC,QAAIsoB,OAAO,CAACz3B,UAAR,CAAmBqF,MAAM,CAAC4Z,YAAP,CAAoBuD,aAAvC,KAAyD,CAACwY,aAA9D,EAA6E;AACzErD,MAAAA,QAAQ,CAAC5Q,GAAD,EAAMsQ,GAAN,EAAW2F,YAAX,EAAyB7tB,OAAzB,EAAkCqsB,eAAlC,CAAR;AACA;AACH,KAzSmC;AA2SpC;AACA;;;AACA,UAAMyB,eAAe,GAAG,CAACnD,iBAAiB,CAAC3F,GAAlB,CAAsBhlB,OAAtB,CAAD,KACnB,MAAMnK,OAAO,CAACkE,GAAR,CAAY3L,WAAZ,EAAyB4R,OAAzB,EAAkC3K,KAAlC,CAAwC,MAAM,IAA9C,CADa,CAAxB;;AAEA,QAAIy4B,eAAJ,EAAqB;AACjB,YAAM;AAAEC,QAAAA;AAAF,UAAuBD,eAAe,CAAC9zB,QAA7C;AACA,YAAMg0B,WAAW,GAAG74B,IAAI,CAAC04B,YAAD,CAAxB;;AACA,UAAIE,gBAAgB,KAAKC,WAAzB,EAAsC;AAClC;AACA;AACA;AACA,cAAMC,kBAAkB,GAAGr+B,IAAI,CAACC,KAAL,CAAWi+B,eAAe,CAAC9+B,IAAhB,CAAqBK,QAArB,EAAX,CAA3B;AACAq7B,QAAAA,kBAAkB,CAAClK,GAAnB,CAAuBxgB,OAAvB,EAAgCiuB,kBAAhC,EALkC;;AAOlC,cAAMf,eAAe,GAAG,MAAMK,gBAAgB,CAACvtB,OAAD,EAAUosB,gBAAV,EAA4B6B,kBAA5B,CAA9C;;AACA,YAAI,CAACf,eAAL,EAAsB;AAClB9E,UAAAA,SAAS,CAACxQ,GAAD,EAAMsQ,GAAN,EAAW,GAAX,CAAT;AACA;AACH;;AACDM,QAAAA,QAAQ,CAAC5Q,GAAD,EAAMsQ,GAAN,EAAWgF,eAAX,EAA4BltB,OAA5B,EAAqCqsB,eAArC,CAAR,CAZkC;;AAclC,YAAI6B,qBAAqB,GAAG,IAA5B;;AACA,YAAI;AACAA,UAAAA,qBAAqB,GAAG,MAAMrR,WAAS,CAAC7c,OAAD,CAAvC;AACH,SAFD,CAGA,OAAOrQ,GAAP,EAAY;AAEX,SALD,SAMQ;AACJ,cAAI,CAACu+B,qBAAD,IACA,CAACJ,eAAe,CAAC9+B,IAAhB,CAAqBm/B,MAArB,CAA4BtuB,MAAM,CAACzJ,IAAP,CAAYxG,IAAI,CAACY,SAAL,CAAe09B,qBAAf,CAAZ,CAA5B,CADL,EACsF;AAClFxD,YAAAA,kBAAkB,CAAC0D,KAAnB;AACA,kBAAMv4B,OAAO,CAACC,EAAR,CAAWF,GAAX,CAAexH,WAAf,CAAN;AACAuzB,YAAAA,SAAS,CAACT,gBAAV,CAA2B;AAAEpqB,cAAAA,IAAI,EAAE;AAAR,aAA3B;AACH;AACJ;;AACD;AACH;AACJ,KAjVmC;;;AAmVpC,QAAI82B,eAAJ;AACA,QAAIS,cAAJ;;AACA,QAAI;AACAA,MAAAA,cAAc,GAAG,MAAMxR,WAAS,CAAC7c,OAAD,CAAhC;AACH,KAFD,CAGA,OAAOrQ,GAAP,EAAY;AACR9B,MAAAA,MAAM,CAACvB,KAAP,CAAc,GAAEg8B,OAAQ;EAClC34B,GAAI,EADM;AAEAy4B,MAAAA,SAAS,CAACxQ,GAAD,EAAMsQ,GAAN,EAAW,GAAX,CAAT;AACA;AACH;;AACD,QAAI;AACA0F,MAAAA,eAAe,GAAG,MAAML,gBAAgB,CAACvtB,OAAD,EAAUosB,gBAAV,EAA4BiC,cAA5B,CAAxC;AACH,KAFD,CAGA,OAAO1+B,GAAP,EAAY;AACR9B,MAAAA,MAAM,CAACvB,KAAP,CAAc,GAAEg8B,OAAQ;EAClC34B,GAAI,EADM;AAEAy4B,MAAAA,SAAS,CAACxQ,GAAD,EAAMsQ,GAAN,EAAW,GAAX,CAAT;AACA;AACH;;AACD,QAAI,CAAC0F,eAAL,EAAsB;AAClBxF,MAAAA,SAAS,CAACxQ,GAAD,EAAMsQ,GAAN,EAAW,GAAX,CAAT;AACA;AACH;;AACDM,IAAAA,QAAQ,CAAC5Q,GAAD,EAAMsQ,GAAN,EAAW0F,eAAX,EAA4B5tB,OAA5B,EAAqCqsB,eAArC,CAAR;AACA,UAAM0B,gBAAgB,GAAG54B,IAAI,CAAC04B,YAAD,CAA7B;AACAh4B,IAAAA,OAAO,CAAC4E,GAAR,CAAYrM,WAAZ,EAAyB4R,OAAzB,EAAkCH,MAAM,CAACzJ,IAAP,CAAYxG,IAAI,CAACY,SAAL,CAAe69B,cAAf,CAAZ,CAAlC,EAA+E;AAC3Er0B,MAAAA,QAAQ,EAAE;AAAE+zB,QAAAA;AAAF;AADiE,KAA/E;AAGH;;AACD,QAAMO,YAAY,GAAI5C,cAAD,IAAoB;AACrC,QAAID,WAAW,IAAIv1B,MAAM,CAAC8d,KAAP,CAAa3mB,MAAb,KAAwB,CAA3C,EAA8C;AAC1C,aAAOkhC,KAAK,CAACC,kBAAN,mCAA8B/C,WAA9B;AAA2CgD,QAAAA,UAAU,EAAE;AAAvD,UAA+D/C,cAA/D,CAAP;AACH,KAFD,MAGK,IAAID,WAAJ,EAAiB;AAClB,aAAOiD,KAAK,CAACJ,YAAN,CAAmB7C,WAAnB,EAAgCC,cAAhC,CAAP;AACH;;AACD,WAAOiD,IAAI,CAACL,YAAL,CAAkB5C,cAAlB,CAAP;AACH,GARD;;AASA,QAAMtM,MAAM,GAAGkP,YAAY,CAAC,OAAO1W,GAAP,EAAYsQ,GAAZ,KAAoB;AAC5C,QAAI;AACA,aAAO,MAAMwD,cAAc,CAAC9T,GAAD,EAAMsQ,GAAN,CAA3B;AACH,KAFD,CAGA,OAAOv4B,GAAP,EAAY;AACR9B,MAAAA,MAAM,CAACvB,KAAP,CAAc,SAAQsrB,GAAG,CAACnkB,GAAI,EAA9B;AACA5F,MAAAA,MAAM,CAACvB,KAAP,CAAaqD,GAAG,CAACN,QAAJ,MAAkBM,GAA/B;AACA,aAAOy4B,SAAS,CAACxQ,GAAD,EAAMsQ,GAAN,EAAW,GAAX,CAAhB;AACH;AACJ,GAT0B,CAAZ,CAUVx6B,EAVU,CAUP,OAVO,EAUGiC,GAAD,IAAS;AACtB9B,IAAAA,MAAM,CAACvB,KAAP,CAAaa,UAAA,CAAY,sCAAqCA,WAAA,CAAYoG,IAAZ,CAAkB,GAAnE,CAAb,EAAqF5D,GAArF;AACAyvB,IAAAA,MAAM,CAAC6H,KAAP;AACAtzB,IAAAA,OAAO,CAACiG,IAAR,CAAa,CAAb;AACH,GAdc,EAeVlM,EAfU,CAeP,SAfO,EAeI,CAACkqB,GAAD,EAAM4H,MAAN,EAAcC,IAAd,KAAuB;AACtCvpB,IAAAA,MAAM,CAAC8d,KAAP,CAAapI,OAAb,CAAqB,CAAC,CAAC8L,UAAD,EAAasT,YAAb,CAAD,KAAgC;AAAA;;AACjD,YAAM4D,WAAW,GAAG5D,YAAY,CAAC6D,EAAb,6BAAmB7D,YAAY,CAAC9mB,MAAhC,yDAAmB,qBAAqB7U,QAArB,GAAgCwB,UAAhC,CAA2C,IAA3C,CAAnB,CAApB;;AACA,UAAI+9B,WAAW,IAAIvG,WAAW,CAAC3Q,UAAD,EAAaE,GAAb,CAA9B,EAAiD;AAC7CmT,QAAAA,UAAU,CAACrT,UAAD,CAAV,CAAuBmX,EAAvB,CAA0BjX,GAA1B,EAA+B4H,MAA/B,EAAuCC,IAAvC;AACA5xB,QAAAA,MAAM,CAACzB,IAAP,CAAY,wBAAZ;AACH;AACJ,KAND;AAOH,GAvBc,EAwBV0iC,MAxBU,CAwBHv7B,IAxBG,CAAf;AAyBA,QAAMouB,SAAS,GAAG,IAAI7C,YAAJ,CAAiB;AAAEM,IAAAA;AAAF,GAAjB,CAAlB;AACA2P,EAAAA,aAAa,CAAC,MAAM;AAChBpN,IAAAA,SAAS,CAACH,oBAAV;AACH,GAFY,CAAb,CAzgB0C;;AA8gB1C,WAASwN,cAAT,CAAwBv7B,GAAxB,EAA6Bw7B,OAA7B,EAAsC;AAClC,QAAIA,OAAO,CAACjK,GAAR,CAAYvxB,GAAZ,CAAJ,EAAsB;AAClB;AACH;;AACDw7B,IAAAA,OAAO,CAAC9zB,GAAR,CAAY1H,GAAZ;AACA,UAAM25B,IAAI,GAAGzL,SAAS,CAAC3B,QAAV,CAAmBvsB,GAAnB,CAAb;;AACA,QAAI25B,IAAI,IAAIA,IAAI,CAACpR,YAAjB,EAA+B;AAC3B2F,MAAAA,SAAS,CAACT,gBAAV,CAA2B;AAAEpqB,QAAAA,IAAI,EAAE,QAAR;AAAkBrD,QAAAA;AAAlB,OAA3B;AACH;;AACD,QAAI25B,IAAI,IAAIA,IAAI,CAACnN,aAAjB,EAAgC,CAAhC,MAGK,IAAImN,IAAI,IAAIA,IAAI,CAAC/M,UAAL,CAAgB1hB,IAAhB,GAAuB,CAAnC,EAAsC;AACvCyuB,MAAAA,IAAI,CAAC/M,UAAL,CAAgBzU,OAAhB,CAAyBja,GAAD,IAAS;AAC7BgwB,QAAAA,SAAS,CAACX,uBAAV,CAAkCoM,IAAlC,EAAwC,IAAxC;AACA4B,QAAAA,cAAc,CAACr9B,GAAD,EAAMs9B,OAAN,CAAd;AACH,OAHD;AAIH,KALI,MAMA;AACD;AACAtN,MAAAA,SAAS,CAACT,gBAAV,CAA2B;AAAEpqB,QAAAA,IAAI,EAAE;AAAR,OAA3B;AACH;AACJ;;AACD,WAASo4B,eAAT,CAAyBlvB,OAAzB,EAAkC;AAC9B;AAGA,QAAImvB,SAAS,GAAGjF,cAAc,CAACpG,kBAAD,EAAqB9jB,OAArB,EAA8B9J,MAA9B,CAA9B;;AACA,QAAI,CAACi5B,SAAL,EAAgB;AACZ;AACH,KAP6B;;;AAS9B,QAAI,CAACA,SAAS,CAACjzB,QAAV,CAAmB,KAAnB,CAAL,EAAgC;AAC5BizB,MAAAA,SAAS,IAAI,WAAb;AACH,KAX6B;AAa9B;AACA;AACA;;;AACA,UAAMC,iBAAiB,GAAGD,SAAS,CAAC58B,OAAV,CAAkB,MAAlB,EAA0B,MAA1B,CAA1B;AACA,UAAM88B,WAAW,GAAG1N,SAAS,CAAC3B,QAAV,CAAoB,GAAEoP,iBAAkB,WAAxC,CAApB;;AACA,QAAIC,WAAJ,EAAiB;AACb1N,MAAAA,SAAS,CAACX,uBAAV,CAAkCqO,WAAlC,EAA+C,IAA/C;AACH,KApB6B;;;AAsB9B,QAAI1N,SAAS,CAAC3B,QAAV,CAAmBmP,SAAnB,CAAJ,EAAmC;AAC/BH,MAAAA,cAAc,CAACG,SAAD,EAAY,IAAIvyB,GAAJ,EAAZ,CAAd;AACA;AACH,KAzB6B;AA2B9B;;;AACA,QAAI8tB,kBAAkB,CAAC1F,GAAnB,CAAuBhlB,OAAvB,CAAJ,EAAqC;AACjC2hB,MAAAA,SAAS,CAACT,gBAAV,CAA2B;AAAEpqB,QAAAA,IAAI,EAAE;AAAR,OAA3B;AACA;AACH;AACJ,GArkByC;;;AAukB1C,QAAMywB,GAAG,GAAGn3B,MAAM,CAACiY,MAAP,CAAcinB,EAAE,CAACC,iBAAH,EAAd,EACPtuB,MADO,CACA,CAACuuB,KAAD,EAAQC,CAAR,KAAc,CAAC,GAAGD,KAAJ,EAAW,IAAIC,CAAC,IAAI,EAAT,CAAX,CADd,EACwC,EADxC,EAEPxvB,MAFO,CAECwvB,CAAD,IAAOA,CAAC,CAACC,MAAF,KAAa,MAAb,IAAuBD,CAAC,CAACE,QAAF,KAAe,KAF7C,EAGP13B,GAHO,CAGFw3B,CAAD,IAAOA,CAAC,CAACG,OAHN,CAAZ;AAIA,QAAMv8B,QAAQ,GAAG6C,MAAM,CAAC+c,UAAP,CAAkBC,MAAlB,GAA2B,QAA3B,GAAsC,OAAvD;AACAqX,EAAAA,UAAU,CAAC3K,IAAX,CAAgB+F,UAAU,CAACI,YAA3B,EAAyC;AACrC1yB,IAAAA,QADqC;AAErCC,IAAAA,QAFqC;AAGrCC,IAAAA,IAHqC;AAIrCg0B,IAAAA,GAJqC;AAKrCD,IAAAA,WAAW,EAAE5gB,IAAI,CAACC,KAAL,CAAWmI,sBAAW,CAACC,GAAZ,KAAoBub,WAA/B;AALwB,GAAzC,EA5kB0C;;AAolB1C,MAAI51B,IAAI,KAAK,MAAb,EAAqB;AACjB,UAAMtB,aAAa,CAACC,QAAD,EAAWC,QAAX,EAAqBC,IAArB,EAA2BmB,IAA3B,CAAnB;AACH,GAtlByC;AAwlB1C;;;AACA,QAAMuwB,QAAQ,GAAG,2CAAa,UAAb,EAAjB,CAzlB0C;;AA2lB1C,iBAAeE,YAAf,CAA4BnlB,OAA5B,EAAqC;AACjCnS,IAAAA,MAAM,CAACzB,IAAP,CAAYe,WAAA,CAAY,iBAAZ,CAAZ;AACA+hC,IAAAA,eAAe,CAAClvB,OAAD,CAAf;AACA0qB,IAAAA,kBAAkB,CAAC5T,MAAnB,CAA0B9W,OAA1B;AACA2qB,IAAAA,iBAAiB,CAACxvB,GAAlB,CAAsB6E,OAAtB;AACA,UAAMnK,OAAO,CAACC,EAAR,CAAWiqB,KAAX,CAAiB3xB,WAAjB,EAA8B4R,OAA9B,CAAN;AACA2qB,IAAAA,iBAAiB,CAAC7T,MAAlB,CAAyB9W,OAAzB;AACH;;AACD,QAAMslB,OAAO,GAAGL,QAAQ,CAACzR,KAAT,CAAesQ,kBAAkB,CAAC7rB,GAAnB,CAAuB,CAAC,CAACsN,OAAD,CAAD,KAAeA,OAAtC,CAAf,EAA+D;AAC3EggB,IAAAA,OAAO,EAAErvB,MAAM,CAACuP,OAD2D;AAE3EggB,IAAAA,UAAU,EAAE,IAF+D;AAG3ED,IAAAA,aAAa,EAAE,IAH4D;AAI3EE,IAAAA,eAAe,EAAE;AAJ0D,GAA/D,CAAhB;AAMAJ,EAAAA,OAAO,CAAC53B,EAAR,CAAW,KAAX,EAAmBsS,OAAD,IAAamlB,YAAY,CAACnlB,OAAD,CAA3C;AACAslB,EAAAA,OAAO,CAAC53B,EAAR,CAAW,QAAX,EAAsBsS,OAAD,IAAamlB,YAAY,CAACnlB,OAAD,CAA9C;AACAslB,EAAAA,OAAO,CAAC53B,EAAR,CAAW,QAAX,EAAsBsS,OAAD,IAAamlB,YAAY,CAACnlB,OAAD,CAA9C,EA3mB0C;;AA6mB1C,QAAM6vB,iBAAiB,GAAG,IAAIjzB,GAAJ,CAAQxM,MAAM,CAACC,IAAP,CAAYmtB,mBAAmB,CAACttB,OAAhC,EAC7B+H,GAD6B,CACxB8I,SAAD,IAAe;AACpB,UAAM,CAAChE,WAAD,IAAgB3L,2BAA2B,CAAC2P,SAAD,CAAjD;AACA,WAAOrP,yBAAyB,CAACqL,WAAD,EAAcxN,GAAd,CAAhC;AACH,GAJiC;AAAA,GAK7B0Q,MAL6B,CAKtB,CAAC,CAACT,CAAD,EAAIsJ,eAAJ,CAAD,KAA0BA,eAAe,IAAI,CAACA,eAAe,CAAC,KAAD,CALvC;AAAA,GAM7B7Q,GAN6B,CAMzB,CAAC,CAAC+H,OAAD,CAAD,KAAgB,GAAE9R,IAAI,CAACsH,OAAL,CAAawK,OAAb,CAAsB,KANf,CAAR,CAA1B;;AAOA,WAAS8vB,eAAT,GAA2B;AACvBnO,IAAAA,SAAS,CAACT,gBAAV,CAA2B;AAAEpqB,MAAAA,IAAI,EAAE;AAAR,KAA3B;AACH;;AACD,QAAMi5B,UAAU,GAAG9K,QAAQ,CAACzR,KAAT,CAAe,CAAC,GAAGqc,iBAAJ,CAAf,EAAuC;AACtDtgC,IAAAA,GAAG,EAAE,GADiD;AAEtDk2B,IAAAA,UAAU,EAAE,IAF0C;AAGtDD,IAAAA,aAAa,EAAE,IAHuC;AAItDE,IAAAA,eAAe,EAAE;AAJqC,GAAvC,CAAnB;AAMAqK,EAAAA,UAAU,CAACriC,EAAX,CAAc,KAAd,EAAqBoiC,eAArB;AACAC,EAAAA,UAAU,CAACriC,EAAX,CAAc,QAAd,EAAwBoiC,eAAxB;AACAC,EAAAA,UAAU,CAACriC,EAAX,CAAc,QAAd,EAAwBoiC,eAAxB;AACA,SAAO,IAAIn6B,OAAJ,CAAY,MAAM,EAAlB,CAAP;AACH;;ACnwBD,MAAMpG,KAAG,GAAGoE,OAAO,CAACpE,GAAR,EAAZ;;AACA,SAASygC,SAAT,GAAqB;AACjBniC,EAAAA,MAAM,CAACzB,IAAP,CAAa;EACfe,WAAA,CAAa,UAAb,CAAwB;;;;OAInBA,UAAA,CAAW,yCAAX,CAAsD;;EAE3DA,WAAA,CAAY,WAAZ,CAAyB;;;;;EAKzBA,WAAA,CAAY,QAAZ,CAAsB;;;;;;;KAZR,CAmBVuW,IAnBU,EAAZ;AAoBH;;AACD,AAAO,eAAeusB,GAAf,CAAmBxF,IAAnB,EAAyB;AAC5B;AACA,QAAMxR,QAAQ,GAAG5B,KAAK,CAACoT,IAAD,EAAO;AACzByF,IAAAA,KAAK,EAAE,CAAC,SAAD,EAAY,KAAZ,EAAmB,SAAnB,EAA8B,iBAA9B;AADkB,GAAP,CAAtB;;AAGA,MAAIjX,QAAQ,CAACkX,OAAb,EAAsB;AAClBtiC,IAAAA,MAAM,CAACnB,KAAP,GAAe,OAAf;AACH;;AACD,MAAIusB,QAAQ,CAACmX,KAAb,EAAoB;AAChBviC,IAAAA,MAAM,CAACnB,KAAP,GAAe,QAAf;AACH;;AACD,MAAIusB,QAAQ,CAACoX,IAAb,EAAmB;AACfL,IAAAA,SAAS;AACTr8B,IAAAA,OAAO,CAACiG,IAAR,CAAa,CAAb;AACH;;AACD,MAAIqf,QAAQ,CAACzJ,OAAb,EAAsB;AAClB3hB,IAAAA,MAAM,CAACzB,IAAP,CAAY2F,OAAO,CAAC,iBAAD,CAAP,CAA2Byd,OAAvC;AACA7b,IAAAA,OAAO,CAACiG,IAAR,CAAa,CAAb;AACH;;AACD,MAAIqf,QAAQ,CAACqX,MAAb,EAAqB;AACjBziC,IAAAA,MAAM,CAACzB,IAAP,CAAYe,aAAA,CAAc,qBAAd,CAAZ;AACA,UAAMuI,UAAU,EAAhB;AACH,GAtB2B;;;AAwB5B,MAAI0Z,WAAJ;;AACA,MAAI;AACAA,IAAAA,WAAW,GAAGrd,OAAO,CAAC7D,IAAI,CAACC,IAAL,CAAUoB,KAAV,EAAe,cAAf,CAAD,CAArB;AACH,GAFD,CAGA,OAAOI,GAAP,EAAY;AACR9B,IAAAA,MAAM,CAACvB,KAAP,CAAc,wCAAuCiD,KAAI,sCAAzD;AACAoE,IAAAA,OAAO,CAACiG,IAAR,CAAa,CAAb;AACH;;AACD,QAAMuc,GAAG,GAAG8C,QAAQ,CAAC,GAAD,CAAR,CAAc,CAAd,KAAoB,SAAhC;AACAprB,EAAAA,MAAM,CAAC1B,KAAP,CAAc,gBAAegqB,GAAI,EAAjC,EAjC4B;;AAmC5B,MAAIA,GAAG,KAAK,OAAZ,EAAqB;AACjBxiB,IAAAA,OAAO,CAAC+N,GAAR,CAAYmI,QAAZ,GAAuBlW,OAAO,CAAC+N,GAAR,CAAYmI,QAAZ,IAAwB,YAA/C;AACH;;AACD,MAAIsM,GAAG,KAAK,KAAZ,EAAmB;AACfxiB,IAAAA,OAAO,CAAC+N,GAAR,CAAYmI,QAAZ,GAAuBlW,OAAO,CAAC+N,GAAR,CAAYmI,QAAZ,IAAwB,aAA/C;AACH;;AACD,QAAM3T,MAAM,GAAGqkB,qBAAqB,CAACtB,QAAD,EAAW7J,WAAX,CAApC;AACAvhB,EAAAA,MAAM,CAAC1B,KAAP,CAAc,kBAAiByhB,IAAI,CAACL,MAAL,CAAYrX,MAAZ,CAAoB,EAAnD;AACA,QAAMsD,QAAQ,GAAG,MAAMlK,YAAY,CAACC,KAAD,CAAnC;AACA1B,EAAAA,MAAM,CAAC1B,KAAP,CAAc,YAAWqN,QAAQ,GAAG,SAAH,GAAe,YAAa,EAA7D;AACA,QAAMkV,cAAc,GAAG;AACnBnf,SAAAA,KADmB;AAEnB2G,IAAAA,MAFmB;AAGnBsD,IAAAA,QAHmB;AAInB4V,IAAAA,WAJmB;AAKnBvhB,IAAAA;AALmB,GAAvB;;AAOA,MAAIsoB,GAAG,KAAK,KAAZ,EAAmB;AACf,UAAMjH,UAAU,CAAC+J,QAAQ,CAAC,GAAD,CAAR,CAAc,CAAd,CAAD,EAAmBvK,cAAnB,CAAhB;AACA,WAAO/a,OAAO,CAACiG,IAAR,CAAa,CAAb,CAAP;AACH;;AACD,MAAIuc,GAAG,KAAK,IAAZ,EAAkB;AACd,UAAMzG,SAAS,CAACuJ,QAAQ,CAAC,GAAD,CAAR,CAAc,CAAd,CAAD,EAAmBvK,cAAnB,CAAf;AACA,WAAO/a,OAAO,CAACiG,IAAR,CAAa,CAAb,CAAP;AACH;;AACD,MAAIqf,QAAQ,CAAC,GAAD,CAAR,CAAc5rB,MAAd,GAAuB,CAA3B,EAA8B;AAC1BQ,IAAAA,MAAM,CAACvB,KAAP,CAAc,8BAAd;AACAqH,IAAAA,OAAO,CAACiG,IAAR,CAAa,CAAb;AACH;;AACD,MAAIuc,GAAG,KAAK,OAAZ,EAAqB;AACjB,UAAMoa,SAAY,CAAC7hB,cAAD,CAAlB;AACA,WAAO/a,OAAO,CAACiG,IAAR,CAAa,CAAb,CAAP;AACH;;AACD,MAAIuc,GAAG,KAAK,KAAZ,EAAmB;AACf,UAAMqa,SAAU,CAAC9hB,cAAD,CAAhB;AACA,WAAO/a,OAAO,CAACiG,IAAR,CAAa,CAAb,CAAP;AACH;;AACD,MAAIuc,GAAG,KAAK,SAAZ,EAAuB;AACnB,UAAM1G,OAAc,CAACf,cAAD,CAApB;AACA,WAAO/a,OAAO,CAACiG,IAAR,CAAa,CAAb,CAAP;AACH;;AACD/L,EAAAA,MAAM,CAACvB,KAAP,CAAc,yBAAwB6pB,GAAI,EAA1C;AACAxiB,EAAAA,OAAO,CAACiG,IAAR,CAAa,CAAb;AACH;;;;;;"}